\input{header.tex}
%\documentclass[12pt, leqno]{book}
%\usepackage{amsmath,amscd,amsthm,amssymb,amsxtra,latexsym,epsfig,epic,graphics}
%\usepackage[matrix,arrow,curve]{xy}
%\usepackage{graphicx}
%\usepackage{diagrams}
%%\usepackage{amsrefs}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%\textwidth16cm
%%\textheight20cm
%%\topmargin-2cm
%\oddsidemargin.8cm
%\evensidemargin1cm
%
%%%%%%Definitions
%\input preamble.tex
%\def\TU{{\bf U}}
%\def\AA{{\mathbb A}}
%\def\BB{{\mathbb B}}
%\def\CC{{\mathbb C}}
%\def\QQ{{\mathbb Q}}
%\def\RR{{\mathbb R}}
%\def\facet{{\bf facet}}
%\def\image{{\rm image}}
%\def\cE{{\cal E}}
%\def\cF{{\cal F}}
%\def\cG{{\cal G}}
%\def\cH{{\cal H}}
%\def\cHom{{{\cal H}om}}
%\def\h{{\rm h}}
% \def\bs{{Boij-S\"oderberg{} }}
%
%\makeatletter
%\def\Ddots{\mathinner{\mkern1mu\raise\p@
%\vbox{\kern7\p@\hbox{.}}\mkern2mu
%\raise4\p@\hbox{.}\mkern2mu\raise7\p@\hbox{.}\mkern1mu}}
%\makeatother
%
%%%
%%\pagestyle{myheadings}
%\date{April 30, 2018}
%%\date{}
%\title{Curves}
%%{\normalsize ***Preliminary Version***}} 
%\author{David Eisenbud and Joe Harris }
%
%\begin{document}

\chapter{What linear series exist?}\label{Brill-Noether}

In the last few chapters, we have alternated between setting up a general description of linear series on curves, and showing how this plays out in examples. It's time to return to the general theory, and the next question to ask, naturally, is ``What linear systems exist?"

\section{Clifford's theorem}

For which $g, r$ and $d$ does there exist a curve $C$ of genus $g$ and a linear system $(\cL,V)$ on $C$ of degree $d$ and dimension $r$? For line bundles of large degree $d \geq 2g-1$ by the Riemann-Roch theorem: on any curve, there exists a linear series of degree $d > 2g-2$ and dimension $r$ iff $r \leq d-g$. For line bundles of degree $d \leq 2g-2$, we have:

\begin{theorem}[Clifford's theorem]\label{Clifford}
Suppose that $C$ is a smooth projective curve of genus $g\geq 2$. If $D$ is a divisor on $C$ of degree $d \leq 2g-2$, then $r(D) := h^0(D) - 1 \leq d/2$. Moreover, if equality holds then either $D\sim 0$, $D\sim K$ or
 $C$ is hyperelliptic and $D$ is a multiple of the unique $g^1_2$ on $C$.
\end{theorem}

\begin{proof} We prove the inequality, and  postpone the case of equality to give a slick characteristic 0 proof using  uniform position (Corollary~\ref{Clifford equality}). Note that the result is true in any characteristic; see for example \cite[Theorem ****]{Hartshorne1977}.

When $r(K-D)\leq 1$, the inequality in Clifford's theorem is immediate from the Riemann-Roch formula. On the other hand, when $r(K-D) \geq 1$ we note that
$$
 r(D)+r(K-D) \leq r(K) \leq g-1.
$$
Adding this and the Riemann-Roch formula
$$
r(D)-r(K-D) = d - g +1
$$
yields $2r(D)\leq d$ as required.
\end{proof}

Combining these statements, we have:

\begin{theorem}\label{arbitrary linear series}
There exists a curve $C$ of genus $g$ and line bundle $\cL$ of degree $d$ on $C$ with $h^0(\cL) \geq r+1$ if and only if
$$
r \leq
\begin{cases}
d-g, \quad \text{if } d \geq 2g-1; \text{ and} \\
d/2,  \quad \text{if } 0 \leq d \leq 2g-2.
\end{cases}
$$
\end{theorem}

\begin{exercise}
Prove a slightly stronger version of Theorem~\ref{arbitrary linear series} in the range $d \leq g-1$: that under the hypotheses of Theorem~\ref{arbitrary linear series} there exists a \emph{complete} linear series of degree $d$ and dimension $r$ for any $r \leq d/2$.
\end{exercise}

\section{Castelnuovo's theorem}

Theorem~\ref{arbitrary linear series} gives a complete and sharp answer to the question of existence.
% originally posed: for which $d,r$ and $g$ does there exists a triple $(C,\cL,V)$ with $C$ a curve of genus $g$, $\cL$ a line bundle of degree $d$ on $C$ and $V \subset H^0(\cL)$ of dimension $r+1$. 
%
But maybe that wasn't the question we meant to ask! After all, we're interested in describing curves in projective space as images of abstract curves $C$ under maps given by linear systems on $C$. Observing that the linear series that achieve equality in Clifford's theorem give maps to $\PP^r$ that are 2 to 1 onto a rational curve, we might hope that we would have a different---and more meaningful---answer if we  restrict our attention to linear series $\cD = (\cL,V)$ for which the associated map $\phi_\cD$ is at least a birational embedding. 

We will show that the maximal dimension of a birationally very ample linear series of degree $d$ on a curve of genus $g$ is a decreasing function of $g$. With this understanding, we need only ask:

\begin{question}
What is the largest possible genus of an irreducible, nondegenerate curve $C \subset \PP^r$ of degree $d$?
\end{question}

The numerical answer is a little complicated. For positive integers $d$ and $r$, we write
$$
 d = M(r-1) + 1 + \epsilon \quad \text{ with } \quad 0 \leq \epsilon \leq r-2
$$
and set
$$
\pi(d,r) = \frac{M(M-1)}{2}(r-1) + M\epsilon.
$$

\begin{theorem}[Castelnuovo's bound]
If $C \subset \PP^r$ is an irreducible, nondegenerate curve of degree $d$ and arithmetic genus $p_a$, then
$$
p_a \leq \pi(d,r).
$$
\end{theorem}
\fix{The uniform position argument coming up is char 0; is the theorem char 0 only? We should say.}

We will say that a curve achieving the bound is a \emph{Castelnuovo curve}. \fix{For plane curves they only exist at the bound. Is there a band
of existence in general?}
We will see in Chapter~\ref{} that the bound is sharp: for every $r$ and $d \geq r$, there exist curves with genus exactly $\pi(d,r)$. 

\begin{example}
For plane curves, $r=2$ so $\epsilon = 0$ and $M = d-1$, so we recover the necessary $p = \pi(d,2) =  {d-1\choose 2}$: thus every reduced irreducible
plane curve is a Castelnuovo curve.
\end{example}

\begin{example}
 When $r=3$ we have $d= 2M+1+\epsilon$ with $\epsilon = 0$ or 1. and $\pi(d,3) = M*M-1+M\epsilon$. If $C$ is a curve of class
$M+1,M+1$ on a smooth quadric (that is, the complete intersection of the quadric with a surface of degree $M+1$), then
$\deg C = 2M+2, \epsilon=1, then \ p_a(C) = M^2 = \pi(d,3)$. Also, if $C$ has class $(M,M+1)$ then
$\deg C = 2M+1, \epsilon=0, then \ p_a(C) = M(M-1) = \pi(d,3)$ again, so these two classes of curves on a smooth quadric
achieve the bound, and a variant of this works for singular quadrics as well. However, these are the only Castelnuovo curves in $\PP^3$.
We will see analogues of these curves, lying in certain classes on rational normal scrolls, in Chapter~\ref{ScrollsChapter}. 
In some sense the construction there makes the  numerical answer more reasonable. 
\end{example}

To prove the result, we will give lower bounds for the dimensions of the linear series  cut on a curve $C$ by hypersurfaces of degree $m$. For large values of $m$ the line bundle $\cO_C(m)$ is non-special and $H^1(\sI_{C/\PP^r}(m) = 0$, so a lower bound on the dimension of its space of sections translates, via the Riemann-Roch theorem, into an upper bound on the genus $g$ and this is the Castelnuovo bound. To execute this strategy, we need to know more about the set of points that can be the general hyperplane section of a curve. The following definition will be convenient:

\begin{definition}
If $\sV = (V,cL)$ is a linear system on a variety and $\Gamma$ is a subscheme then the number of conditions
imposed by $\Gamma$ on $\sV$ is the dimension of the image of $V$ in $H^0(\sL\mid_\Gamma) = H^0(\sL \otimes \sO_\Gamma)$; or, numerically,
$$
\dim(V) - \dim \left(V \cap H^0(\cL\otimes \cI_{\Gamma/X}) \right).
$$\end{definition}

Thus, for example, if $X = \PP^r$, the number of conditions imposed by $\Gamma$ on $H^0(\cO_{\PP^r}(m))$ is the value $h_\Gamma(m)$ of the Hilbert function of $\Gamma$.
Note that the number of conditions imposed by $\Gamma$ on a linear system $V$ is necessarily less than or equal to the degree $d$ of $\Gamma$; if it is equal we say that $\Gamma$ \emph{imposes independent conditions on $V$}.

To apply this notion, suppose $C \subset \PP^r$ is an irreducible, nondegenerate curve. Let $\Gamma = C \cap H$ be a general hyperplane section of $C$. Let $V_m \subset H^0(\cO_C(m))$ be the linear series cut on $C$ by hypersurfaces of degree $m$ in $\PP^r$, that is, the image of the restriction map
$$
H^0(\cO_{\PP^r}(m)) \to H^0(\cO_C(m)).
$$
Since the ideal sheaf of the hyperplane section is $\cI_{\Gamma/C} = \sO_C(-1)$ we have:
\begin{align*}
h^0(\cO_C(m)) - h^0(\cO_C(m-1)) & \geq \text{\# of conditions imposed by $\Gamma$ on $H^0(\cO_C(m))$} \\
&\geq \text{\# of conditions imposed by $\Gamma$ on $V_m$} \\
&\geq \text{\# of conditions imposed by $\Gamma$ on $H^0(\cO_{\PP^r}(m))$} \\
&\geq h_\Gamma(m).
\end{align*}
Thus the dimension $h^0(\cO_C(m))$ is bounded below by the sum
$$
h^0(\cO_C(m)) \geq \sum_{k=0}^m h_\Gamma(k).
$$

To apply this we need a lower bound on the Hilbert function of a general hyperplane section $\Gamma$ of our curve $C$. The key statement is a general position result:

\begin{lemma}[Linear General Position]\label{
\begin{general}
 
\end{general}
 position lemma}
If $C \subset \PP^r$ is an irreducible, nondegenerate curve and $\Gamma = C \cap H$ a general hyperplane section of $C$, then the points of $\Gamma$ are in linearly general position in $H \cong \PP^{r-1}$; that is, no $r$ points of $\Gamma$ lie in a hyperplane $\PP^{r-2} \subset H$.
\end{lemma}

Thus, for example, if $C \subset \PP^3$ is a space curve, the general position lemma says that no three points of a general plane section $\Gamma = H \cap C$ of $C$ are colinear. Even this case is surprisingly tricky to prove (and is false in characteristic $p$); the following exercise sketches a proof.

\begin{exercise}
Let $C \subset \PP^3$ be an irreducible, nondegenerate space curve. Assuming characteristic 0,
\begin{enumerate}
\item Show that if $p, q \in C$ are general, then the tangent lines $\TT_pC$ and $\TT_qC \subset \PP^3$ do not intersect.
\item Using this, show that for general $p, q \in C$ the line $\overline{p,q}$ is not a trisecant; that is, it does not intersect $C$ a third time.
\item Using the irreducibility of $C \times C$, show that $C$ can have at most a 1-parameter family of trisecant lines.
\item Deduce that a general plane $H \subset \PP^3$ does not contain three colinear points of $C$.
\end{enumerate}
\end{exercise}

The truth of Lemma~\ref{general position lemma} was originally asserted by Castelnuovo. It follows easily from the far stronger Uniform Position Theorem, to which we now turn. 

\subsection{Uniform position} 

\subsubsection{The monodromy group of a generically finite morphism}

Let $f : Y \to X$ be a dominant map between varieties of the same dimension over $\CC$, and suppose that $X$ is irreducible. There is then an open subset $U \subset X$ such that $U$ and 
its preimage $V = f^{-1}(U)$ are smooth, and the restriction of $f$ to $V$ is a covering space in the classical topology. Let $d$ be the number of sheets. This is the degree of the extension $K(Y)/K(X)$.

A basic construction from homotopy theory now associates a monodromy group to any finite topological covering map: Choose a base point $p_0 \in U \subset X$, and suppose $\Gamma := f^{-1}(p_0)  = \{q_1,\dots,q_d\}$. If $\gamma$ is any loop in $U$ with base point $p_0$, for any $i = 1, \dots, d$ there is a unique lifting of $\gamma$ to an arc $\tilde \gamma_i$ in $V$ with initial point $\tilde \gamma_i(0) = q_i$ and end point $\tilde \gamma_i(1) = q_j$ for some $j \in \{1,2,\dots,d\}$. Since we could traverse the loop in the opposite direction, the index $j$ determines $i$, and the map $i\mapsto j$ is a permutation of $\{1,2,\dots,d\}$. 
Since the set $\Gamma$ is discreet, the permutation depends only on the class of $\gamma$ in $\pi_1(U,p_0)$ so we have defined a homomorphism to the symmetric group:
$$
\pi_1(U,p_0)  \to {\rm Perm}(\Gamma) \cong S_d.
$$
The image $M$ of this map is called the \emph{monodromy group} of the map $f$. It depends on the labeling of the points of $\Gamma$, but is well-defined  up to conjugation. Moreover, it is independent of the choice of open set $U$: if $U' \subset U$ is a Zariski open subset, the map $\pi_1(U', p_0) \to \pi_1(U,p_0)$ is surjective,  so the image of $\pi_1(U', p_0)$ in $S_d$ is the same.

Since we assumed that $X$ is irreducible, the space $U$ is (path) connected, and it follows that the monodromy group is transitive if and only if the space $V$ is (path) connected. But $V$ is a smooth
variety, so this is the case if and only if $V$ is irreducible.

\fix{call it the universal h s}
We will apply this construction to the ``general hyperplane section'', constructed as follows:
Let $C \subset \PP^r$ be a smooth irreducible, nondegenerate curve of degree $d$, let $X = {\PP^r}^*$ be the space of hyperplanes in $\PP^r$. We define the \emph{universal hyperplane section of $C$} to be the variety:
$$
Y = \{ (H, p) \in {\PP^r}^* \times C \mid p \in H \}.
$$
We will compute the monodromy of the projection $f: Y$ to ${\PP^r}^*$. Its fibers are the hyperplane
sections of $C$, so it is a dominant finite map. If we let $U\subset {\PP^r}^*$ be an open subset of hyperplanes
meeting $C$ transversely, then the restriction of $f$ to the preimage $V$ of $U$ is a covering space
whose fibers each consist of $d$ distinct points, which we think of as the general hyperplane sections
of $C$.

\begin{theorem}[Uniform Position Theorem]\label{uniform position lemma}
The monodromy group of the general hyperplane sections of an irreducible curve $C \subset \PP^r_\CC$ is the full symmetric group $S_d$.
\end{theorem}

Informally, this theorem says that two subsets of the same cardinality in the general hyperplane section of $C$
are indistinguishable from the point of view of any discrete invariant that is semicontinuous in the Zariski topology. We shall see examples below.

This result fails over fields of finite characteristic; see \cite{Rathmann} and \cite{Kadets} for examples and details of what is known. 

\begin{fact}
There is another characterization of the monodromy group $M$ that will not be used here but that is worth knowing. In the situation described above, if we assume that $Y$ is irreducible the pullback map $f^*$ expresses the function field $K(Y)$ as a finite algebraic extension of $K(X)$; the degree $d$ is the degree of this extension, and $M$ is equal to the Galois group of the Galois normalization of $K(Y)$ over $K(X)$. (see \cite{Harris1979}.)
\end{fact}

Since the symmetric group $S_d$ is generated by transpositions, we may prove that a subgroup $M\subset S_d$ is equal to $S_d$ by showing that $M$ is doubly transitive and contains a transposition (of course it will then follow that $M$ is $k$-fold transitive for any $k\leq d$.) We can translate these properties into geometry as follows:

%\begin{lemma}\label{transitivity lemma}
%Let $f : Y \to X$ be a generically finite cover of degree $d$, with  monodromy group $M \subset S_d$; let $U \subset X$ and $V = f^{-1}(U) \subset Y$ be open sets as above. For any $k = 1,2,\dots,d$, let $V_k^*$ be the complement of the large diagonal in the $k$th fiber power of $V \to U$; that is,
%$$
%V_k^* = \{ (x; y_1,\dots, y_k) \in U \times V^k \mid f(y_i) = x \text{ and } y_i \neq y_j \; \forall i \neq j\}.
%$$
%Then $V_k^*$ is irreducible if and only if $M$ is $k$ times transitive. \qed
%\end{lemma}
\begin{lemma}\label{transitivity lemma}
Let $f : Y \to X$ be a generically finite cover of degree $d$, with  monodromy group $M \subset S_d$.
The $k$-fold fiber product $\prod_1^k(Y/X)$ is irreducible if and only if $M$ is $k$ times transitive.
\end{lemma}

\begin{proof}
The monodromy of the covering $f^k: \times^k(Y/X) \to X$ is the the diagonal action of
$M$ in the product $\prod_1^k S_d$.
\end{proof}

Thus a consequence of the Uniform Position Theorem is an irreducibility result:

\begin{corollary} If $C\subset \PP^r$ is a smooth curve of degree $d$, then 
for $k\leq \deg C$, the fibered products $\prod_1^k(Y/{\PP^r}^*)$  of the general hyperplane section 
of $C$ are irreducible.
\end{corollary}

Here is a sufficient condition for double transitivity:

\begin{lemma}\label{transposition lemma}
Let $f : Y \to X$ be a generically finite cover of degree $d$ over an irreducible variety $X$, with  monodromy group $M \subset S_d$.  
If,  for some smooth point $p \in X$ the fiber $f^{-1}(p)\subset V$ consists of $d-2$ reduced points $p_1,\dots, p_{d-2}$ and one point $q$ of multiplicity 2, where $q$ is also a smooth point of $Y$, then $M$ contains a transposition.
\end{lemma}

\begin{proof} To begin with, let $U \subset X$ be a Zariski open subset of the smooth locus in $X$, as in the definition of the monodromy group, so that  $V := f^{-1}(U)$ is also smooth and the restriction $f|_V : V \to U$ expresses $V$ as a $d$-sheeted covering space of $U$, with $U,V$ smooth and $p\in X$

Now, let $A \subset X$ be a small neighborhood of $p$ in the classical topology. The preimage $f^{-1}(A)$ will have $d-1$ connected components, one containing each of the points $p_1,\dots,p_{d-2}$ and $q$; let
 $B \subset f^{-1}(A) \subset Y$ be the connected component of $f^{-1}(A)$ containing the point $q$.

Let $p' \in A \cap U$. Two of the $d$ points of $f^{-1}(p')$ will lie in the component $B$ of $f^{-1}(A)$ containing $q$; call these $q'$ and $q''$. Since $B \cap V$ is connected (it's the complement of a proper subvariety in the neighborhood $B$ of the smooth point $q \in Y$), we can draw a real arc $\gamma : [0,1] \to B \cap V$ joining $q'$ to $q''$; by construction, the permutation of $f^{-1}(p')$ associated to the loop $f \circ \gamma$ will exchange $q'$ and $q''$ and fix each of the remaining $d-2$ points of $f^{-1}(p')$.
\end{proof}

%For every $k\leq \deg C$ we consider the fiber product over $U$ minus the main diagonal $\Delta$
%\begin{align*}
% Y^{k*} :=&Y\times_U Y\times_U \cdots Y\times_U \setminus \Delta  =\\
%                                                 & \{ (H, p_1,\dots, p_k) \in {\PP^r}^* \times C^k \mid p_1,\dots, p_k \in H, p_i \neq p_j \hbox{ for all } i,j \}.
%\end{align*}

\begin{proof}[Proof of the Uniform Position Theorem]
We show first that the monodromy group $M$ is twice transitive, and then that it contains a transposition. It follows that $M$ contains all the transpositions so that  $M = S_d$.
Restricting to an open subset of $C$, we may assume that $C$ is smooth.

For the double transitivity, we introduce a related cover: set
$$
\Phi = \{ (H, p, q) \in {\PP^r}^* \times C \times C \mid p + q \subset H \}
$$
(Here $p+q$ is the divisor $p+q$ on $C$, viewed as a subscheme of $C$.) The projection $\pi_{2,3} : \Phi \to C \times C$ is a $\PP^{r-2}$-bundle, and so irreducible; applying Lemma~\ref{transitivity lemma}, we deduce that $M$ is twice transitive.

To prove that $M$ contains a transposition, we will use the characteristic 0 hypothesis. As we shall see in Chapter~\ref[Theorem ****]{InflectionsChapter}, a general hyperplane containing
the tangent line at a general point of $C$ meets $C$ with multiplicity exactly 2 at $p$ and meets $C$ transversely elsewhere. 

\fix{integrate this with the paragrapsh above}
Given this, let $p \in C$ be a general point, and let $H \subset \PP^r$ be a general hyperplane containing the tangent line $T_pC$. Since a general tangent line to $C$ is not bitangent (Exercise~\ref{}), the fiber of $\Phi$ over the point $H \in {\PP^r}^*$ consists of the point $p$ with multiplicity 2, and $d-2$ reduced points; applying Lemma~\ref{transposition lemma}, we deduce that $M$ contains a transposition.
\end{proof}

\subsubsection{Hyperplane sections of curves}

\begin{corollary}[numerical uniform position lemma]
Let $C\subset \PP^r$ be an irreducible curve, and let $H\cap C$ be a general hyperplane section. Any two subsets of $H\cap C$ with the same cardinality impose the same number of conditions on forms of any degree; that is, any two subsets of the same cardinality have the same Hilbert function.
\end{corollary}

\begin{proof} Let $U = {\PP^r}^* \setminus C^*$ be the open subset of hyperplanes transverse to $C$, and set
\begin{align*}
 Y^{k*} :=&Y\times_U Y\times_U \cdots Y\times_U \setminus \Delta  =\\
                                                 & \{ (H, \Gamma) \in {\PP^r}^* \times C^k \mid \Gamma \subset H, \hbox{ and $\Gamma$ consists of $k$ distinct points.}\}.
\end{align*}
for the variety parametrizing subsets $\Gamma$ of cardinality $k$ in hyperplane sections $H \cap C$ of $C$. Because the monodromy is of the general hyperplane section of $C$ is
$k$-times transitive, $Y_k^*$ is irreducible.

For each $m$ the number of conditions that $\Gamma$ imposes on forms of degree $m$ is lower semicontinuous, so it achieves its maximum on a Zariski open subset of $Y^{k*}$. Since $Y^{k*}$ is irreducible, the complement of this open has dimension strictly less than $\dim Y^{k*} = r$. Thus a general hyperplane $H \in {\PP^r}^*$ will lie outside the image of $Y^{k*}$, meaning that the number of conditions imposed by all the $k$-element subsets $\Gamma \subset C \cap H$ will have this maximal value.
\end{proof}

\fix{We need to add as deduction the ``linear general position lemma".}

Another easy consequence of the uniform position lemma is a result about sums of linear series.
Recall that if $D$ is a divisor on a curve $C$ we write $r(D) = \dim |D| = h^0(\cO_C(D))-1$.

\begin{corollary}\label{Clifford equality plus}
If $D,E$ are effective divisors on a curve $C$ then
$$
r(D+E) \geq r(D)+r(E).
$$
If the genus of $C$ is $>0$ and $D+E$ is birationally very ample, then the inequality is strict.
\end{corollary}.

Note that on $\PP^1$ any effective divisor $D$ has $r(D) = \deg D$, so the inequality above is
always an equality for $C = \PP^1$.

\begin{proof}
 The inequality follows in general because the sums of divisors in $|D|$ and divisors in $|E|$ already move in 
 a family of dimension $r(D)+r(E)$; the key point is the strict inequality in case $D+E$ is birationally very ample.
 
In the case where $D+E$ is birationally very ample then, restricting to an open set,
we may identify $C$ with its image under the complete linear series $|D+E|$, and we see that a general hyperplane section $H\cap C$ contains a divisor equivalent to $D$. Since the monodromy of the general hyperplane section
is the symmetric group, this implies that \emph{every} subset of $\deg D$ elements in $H\cap C$ is
equivalent to $D$. But if $p\in D$ and $q\notin D$, then $D-p+q \equiv D$, whence $q\equiv p$. Thus
$r(p)\geq 1$, so $C\cong \PP^1.$
\end{proof}

A special case of Corollary~\ref{Clifford equality plus} completes the ``equality'' case of Clifford's Theorem:

\begin{corollary}\label{Clifford equality}
If $D$ is an effective divisor on a curve of genus $g\geq 2$ and $r(D) = d/2$, then either $D= 0$ or 
$D=K$ or $C$ is hyperelliptic and $D$ is a multiple of the $g^1_2$.
\end{corollary}

\begin{proof}
  By the argument given in Theorem~\ref{Clifford}, if $r(D) = d/2$, but $D\neq 0,K$, then
$$
r(D) + r(K-D) = r(K) = g-1;
$$
which implies that every canonical divisor is expressible as a sum of a divisor in $|D|$ and a divisor in $|K-D|$.
By Corollary~\ref{Clifford equality plus}, $K$ is not very ample; so $C$ is hyperelliptic. Moreover the
divisors equivalent to $D$ are sums of the fibers of the map given by $|K|$.
\end{proof}

\subsection{Castelnuovo's bound}

We return now to Castelnuovo's analysis.

The general position lemma is the special case $m=1$ of the numerical uniform position lemma. This may not seem like much information about $\Gamma$, but in fact it's all we need:

\begin{proposition}\label{min hilb}
If $\Gamma \subset \PP^n$ is a collection of $d$ points in linearly general position that span $\PP^n$, then 
$$
h_\Gamma(m) \geq \min\{d, mn+1\}
$$
\end{proposition}

\begin{proof}
Suppose first that $d \geq mn+1$, and let $p_1,\dots,p_{mn+1} \in \Gamma$ be any subset of $mn+1$ points. It suffices to show that $\Gamma' = \{p_1,\dots,p_{mn+1}\}$ imposes independent conditions of $H^0(\cO_{\PP^n}(m))$, that is, for any $p_i \in \Gamma'$ there is a hypersurface $X \subset \PP^n$ of degree $m$ containing all the points $p_1,\dots, \hat{p_i},\dots,p_{mn+1}$ but not containing $p_i$.

To construct such an $X$, group the $mn$ points of $\Gamma' \setminus \{p_i\}$ into $m$ subsets $\Gamma_k$ of cardinality $n$; each set $\Gamma_k$ will span a hyperplane $H_k \subset \PP^n$, and we can take $X = H_1 \cup \dots \cup H_m$. 

In the case where $d<mn+1$, we add $mn+1-d$ general points; each one imposes exactly one
additional condition on hypersurfaces of degree $m$.
\end{proof}

This may seem like a crude argument, but the bound derived is sharp, as the following exercise asserts

\begin{exercise}
Let $D \subset \PP^n$ be a rational normal curve. If $\Gamma \subset D$ is any collection of $d$ points on $D$ (or for that matter any subscheme of $D$ of degree $d$) then the Hilbert function of $\Gamma$ is
$$
h_\Gamma(m) = \min\{d, mn+1\}
$$
\end{exercise} 

Castelnuovo in fact proved a converse to this observation:

\begin{fact}
If $d \geq 2n+3$, then any collection of $d$ points in $\PP^n$ in linearly general position with Hilbert function $h_\Gamma(m) = \min\{d, mn+1\}$ must lie on a rational normal curve. 
\end{fact}

This was a key ingredient in Castelnuovo's theorem characterizing curves of maximal genus; we'll see how it's applied in Chapter~\ref{} (scrolls, if we include it). For a proof, see for example~\cite{ACGH} or~\cite{Montreal}

At this point, all that remains is to add up the lower bounds in the proposition. To this end, let $C \subset \PP^r$ be as above an irreducible, nondegenerate curve of degree $d$, and set $M = \lfloor{\frac{d-1}{r-1}}\rfloor$, so that we can write
$$
d = M(r-1) + 1 + \epsilon \quad \text{ with } \quad 0 \leq \epsilon \leq r-2.
$$
We have 
\begin{align*}
h^0(\cO_C(M)) &\geq \sum_{k=0}^M h^0(\cO_C(k)) - h^0(\cO_C(k-1)) \\
&\geq  \sum_{k=0}^M k(r-1)+1 \\
&= \frac{M(M+1)}{2}(r-1) + M + 1
\end{align*}
and similarly
$$
h^0(\cO_C(M+m)) \geq \frac{M(M+1)}{2}(r-1) + M + 1 + md.
$$
For sufficiently large $m$, the line bundle $\cO_C(M+m)$ will be nonspecial, so by the Riemann-Roch Theorem,
\begin{align*}
g &= (M+m)d - h^0(\cO_C(M+m)) + 1 \\
&\leq (M+m)d - \bigl(  \frac{M(M+1)}{2}(r-1) + M + 1 + md \bigr) \\
& = M\bigl( M(r-1) + 1 + \epsilon \bigr) - \bigl(  \frac{M(M+1)}{2}(r-1) + M + 1 \bigr) \\
&= \frac{M(M-1)}{2}(r-1) + M\epsilon.
\end{align*}

%To summarize our discussion: for positive integers $d$ and $r$, we write
%$$
% d = M(r-1) + 1 + \epsilon \quad \text{ with } \quad 0 \leq \epsilon \leq r-2
%$$
%and set
%$$
%\pi(d,r) = \frac{M(M-1)}{2}(r-1) + M\epsilon.
%$$
%In these terms, we have proved the

%\begin{theorem}[Castelnuovo's bound]
%If $C \subset \PP^r$ is an irreducible, nondegenerate curve of degree $d$ and genus $g$, then
%$$
%g \leq \pi(d,r).
%$$
%\end{theorem}
%
%We will see in Chapter~\ref{} that this is in fact sharp: for every $r$ and $d \geq r$, there do exist such curves with genus exactly $\pi(d,r)$. For now, we make a few observations:

\begin{enumerate}
\item In case $r=2$, all the inequalities used in the derivation of Castelnuovo's bound are in fact equalities, and indeed we see that in this case $\pi(d,2) = \binom{d-1}{2}$ is the genus of a smooth plane curve of degree $d$.

\item In case $r=3$, we have
$$
\pi(d,3) =
\begin{cases}
\left( k - 1 \right)^2 &\text{ if $d=2k$ is even; and} \\
k(k-1) &\text{ if $d=2k+1$ is odd.}
\end{cases}
$$
In this case again, it's not hard to see the bound is sharp: these are exactly the genera of curves of bidegree $(k,k)$ and $(k+1,k)$ respectively on a quadric surface $Q \cong \PP^1 \times \PP^1 \subset \PP^3$.
\item In general we see that for fixed $r$, asymptotically
$$
\pi(d,r) \sim \frac{d^2}{2(r-1)}.
$$
\end{enumerate}


\begin{exercise}
Show that with $C$ and $M$ as above, the line bundle $\cO_C(M)$ is nonspecial. (We will see in Section~\ref{} that this is sharp; that is, there exist curves $C \subset \PP^r$ with $\cO_C(M-1)$ special).
\end{exercise}


\section{Brill-Noether theory}

\subsection{Basic questions addressed by Brill-Noether theory}

In the last section, we restricted our attention to the linear series most of interest to us: those corresponding to embeddings of our curve in projective space (or at any rate birational embeddings) and their limits. But there is one other respect in which Castelnuovo theory fails to address a basic concern: the curves with linear systems achieving Castelnuovo's bound are, like hyperelliptic curves, very special. (In fact, we'll see in the following exercise that in general they are even rarer than hyperelliptic curves.) 

\begin{exercise}
We have seen that complete intersections $C = Q \cap S \subset \PP^3$ of a quadric surface $Q$ and a surface $S$ of degree $k$ achieve Castelnuovo's bound $g = \pi(2k, 3)$ on the genus of curves of degree $2k$ in $\PP^3$. In fact, we will see in Chapter~\ref{**} (scrolls, if we include it) that any curve $C \subset \PP^3$ of degree $2k$ and genus $g = \pi(2k, 3) = (k-1)^2$ is of this form.
\begin{enumerate}
\item Find the dimension of the subvariety $\Gamma \subset M_g$ consisting of Castelnuovo curves.
\item Find the dimension of the subvariety $H \subset M_g$ of hyperelliptic curves, and compare this to the result of the first part.
\end{enumerate}
\end{exercise}

The bottom line is, even with Castelnuovo's bound, if we were to pick a curve $C$ of genus $g$ ``at random," we would still have no idea what linear systems existed on $C$ or how they behaved.

Brill-Noether theory addresses exactly this issue: it asks, ``what linear series exist on a \emph{general} curve of a given genus?" When it comes to non-special linear series, of course, Riemann-Roch answers the question simply and completely, so we'll restrict our attention to special linear series (that is, with $r > d - g$). 
Here is a crude version of the result:

\begin{theorem}[Brill Noether, bare-bones version]\label{basic BN}
A general curve $C$ of genus $g$  possesses a linear series of degree $d$ and dimension $r$ if and only if
$$
 \rho(g,r,d) := g - (r+1)(g-d+r) \geq 0.
$$
\end{theorem}

%\begin{theorem}[Brill Noether, bare-bones version]\label{basic BN}
%Fix non-negative integers $g, r$ and $d$ with $d \leq g+r$, and let $C$ be a general curve of genus $g$. If we denote by $W^r_d(C) \subset \Pic^d(C)$ the locus of invertible sheaves $\cL$ with $h^0(\cL) \geq r+1$, then
%$$
%\dim W^r_d(C) = \rho(g,r,d) := g - (r+1)(g-d+r).
%$$
%In particular, it is the case that a general curve of genus $g$ possesses a linear series of degree $d$ and dimension $r$ if and only if $\rho(g,r,d) \geq 0$.
%\end{theorem}

\fix{Add chart from 3264 comparing the Clifford, Castelnuovo and Brill-Noether bounds}

In the following sections, we'll see why we might naively expect this to be the case, and we'll also state some of the many refinements and strengthenings of the theorem.  A proof of the existence half of the theorem (the ``if" part of the statement) may be found in \cite[Theorem ****]{3264};  we will give in Chapter~\ref{InflectionsChapter} of this book a relatively simple proof of the nonexistence part (the ``only if"). 

The case $r=1$ is already interesting:

\begin{corollary}
If $C$ is any curve of genus $g$, then $C$ admits a rational function of degree $d$ for some positive $d \leq \lceil \frac{g+2}{2}\rceil$.
\end{corollary}

Thus any curve of genus 2 is hyperelliptic, any curve of genus 3 or 4 is either hyperelliptic or trigonal  (admits a 3-1 map to $\PP^1$), and so on.


\subsection{Heuristic argument leading to the statement of Brill-Noether}

The proof of the Brill-Noether theorem starts with a simple dimension count---one that was first carried out almost a century and a half ago. \fix{let's say more about the history here, or at the end of this section}

Let $C$ be a smooth projective curve of genus $g$, and $D = p_1 + \dots + p_d$ a divisor on $C$. We'll assume here the points $p_i$ are distinct; the same argument (with  more complicated notation) can be carried out in general.

When does the divisor $D$ move in an $r$-dimensional linear series? Riemann-Roch gives an answer: it says that $h^0(D) \geq r+1$ if and only if the vector space $H^0(K-D)$ of 1-forms vanishing on $D$ has dimension at least $g-d+r$---that is, if and only if the  evaluation map
$$
H^0(K) \to H^0(K|_D) = \bigoplus k_{p_i}
$$
has rank at most $d-r$. 

We can represent this map by a $g \times d$ matrix. Choose a basis $\omega_1,\dots,\omega_g$ for the space $H^0(K)$ of 1-forms on $C$; choose an analytic open neighborhood $U_j$ of each point $p_j \in D$ and choose a local coordinate $z_j$ in $U_j$ around each point $p_j$, and write
$$
\omega_i = f_{i,j}(z_j)dz_j
$$
in $U_j$. We will have $r(D) \geq r$ if and only if the  matrix-valued function
$$
A(z_1,\dots,z_d) = 
\begin{pmatrix}
f_{1,1}(z_1) & f_{2,1}(z_1) & \dots & f_{g,1}(z_1) \\
f_{1,2}(z_2) & f_{2,2}(z_2) & \dots & f_{g,2}(z_2) \\
\vdots & \vdots &  & \vdots \\
f_{1,d}(z_d) & f_{2,d}(z_d) & \dots & f_{g,d} (z_d)
\end{pmatrix}
$$
has rank $d-r$ or less at $(z_1,\dots,z_d) = (0,\dots,0)$.

The point is, we can think of $A$ as a matrix valued function in an open set $U = U_1 \times U_2 \times \dots \times U_d \subset C_d$; and for divisors $D \in U$, we have $r(D) \geq r$ if and only if $\rank(A(D)) \leq d-r$. Now, in the space $M_{d,g}$ of $d \times g$ matrices, the subset of matrices of rank $d-r$ or less has codimension $r(g-d+r)$ (\cite[Theorem ****]{Eisenbud1995},  so if the map $A$ is dimensionally transverse to this degeneracy locus in $M_{d,g}$, we could deduce that the locus of divisors with $r(D) \geq r$ has dimension $d - r(g-d+r)$, so such divisors would exist only if
$$
d - r(g-d+r) \; \geq \; r.
$$
At the same time, if any divisor of degree $d$ with $h^0(D) \geq r+1$ exists, then there must be at least an $r$-dimensional family of them; this is exactly the statement of the Brill-Noether Theorem.


\subsection{Refinements of the Brill-Noether theorem}

As we indicated, Theorem~\ref{basic BN} is just a starting point. It raises a slew of questions, both about the geometry of the schemes $W^r_d(C)$ parametrizing linear series on a general curve $C$ (what are their dimensions, are they irreducible, etc.), and about the geometry of the linear systems themselves (do they give embeddings; what's the Hilbert function of the image, and so on). A great deal of progress has been made on these fronts; we collect here some of the main results.

\begin{theorem}[Brill-Noether theorem, omnibus version]\label{BN omnibus}
Let $C$ be a general curve of genus $g$. If we set $\rho = g - (r+1)(g-d+r)$, then
\begin{enumerate}
\item $\dim(W^r_d(C)) = \rho$;
\item\label{sing wrd} the singular locus of $W^r_d(C)$ is exactly $W^{r+1}_d(C)$;
\item\label{irr wrd} if $\rho > 0$ then $W^r_d(C)$ is irreducible;
\item\label{rho=0} if $\rho = 0$ then $W^r_d$ consists of a finite set of  points of cardinality
$$
\#W^r_d = g! \prod_{\alpha=0}^r \frac{\alpha!}{(g-d+r+\alpha)!};
$$
\item\label{Petri} if $L$ is any invertible sheaf on $C$, the map
$$
\mu : H^0(L) \otimes H^0(\omega_CL^{-1}) \rTo H^0(\omega_C)
$$
is injective, and the Zariski tangent space to the scheme $W^r_d(C)$ at the point $L$ is the annihilator of the image of $\mu$;
\item\label{general va} if $|D|$ is a general $g^r_d$ on $C$, then
\begin{enumerate}
\item if $r \geq 3$ then $D$ is very ample; that is, the map $\phi_D : C \to \PP^r$   embeds $C$ in $\PP^r$;
\item if $r=2$ the map $\phi_D : C \to \PP^2$ gives a birational embedding of $C$ as a nodal plane curve; and 
\item if $r=1$, the map $\phi_D : C \to \PP^2$ expresses $C$ as a simply branched cover of $\PP^1$.
\end{enumerate}

\item\label{maximal rank}[The maximal rank theorem] If $L \in W^r_d(C)$ is a general point (or any point, if $\rho = 0$), then for each $m > 0$ the multiplication map
$$
\rho_m : \Sym^m H^0(L) \to H^0(L^m)
$$
has maximal rank; that is, it is either injective or surjective.
\item\label{interpolation}[The interpolation theorem]
Let $d, g$ and $r$
be nonnegative integers with $\rho(d, g, r) \geq 0$. There is a general curve of degree $d$ and genus $g$ through $n$ general
points in $\PP^r$
if and only if
$$
(r-1)n \leq (r + 1)d-(r-3)(g-1)
$$
except in the four exceptional cases $(d, g, r) = (5, 2, 3),(6, 4, 3),(7, 2, 5)$ or $(10, 6, 5)$.
\end{enumerate}

\fix{add references, attributions, etc.}

\end{theorem}

A few special cases are worth noting:
\begin{enumerate}

\item As a special case of Part~\ref{rho=0}, we see that the number of $g^1_{k+1}$s on a general curve of genus $g = 2k$ is the $k$th Catalan number 
$$
c_k = \frac{2k!}{k!(k+1)!}.
$$
We have already seen this in the first case: in genus 2, it says the canonical series $|K|$ is the unique $g^1_2$ on a curve of genus 2. In the next chapter, we'll also see how to verify this directly for curves of genus 4---where it says that there are exactly two $g^1_3$s on a general curve of genus 4---and in genus 6, where it says that a general curve of genus 6 has 5 $g^1_4$s.  In genus 8, it says that a general curve of genus 8 has 14 $g^1_5$s, but we don't know of any way of seeing this directly from the geometry of a general curve of genus 8; and we know even less for larger $k$.

\item Part\ref{Petri} implies Part\ref{sing wrd}. In fact, a fairly elementary argument shows that at a point $L \in W^r_d(C) \setminus W^{r+1}_d(C)$, the tangent space to $W^r_d$ at the point $L$ is the annihilator
in $(H^0(\omega_C))^*$ of the image of $\mu$; given that $\mu$ is injective, we can compare dimensions and deduce that $W^r_d$ is smooth at $L$.

\item Part~\ref{maximal rank} is the celebrated \emph{maximal rank theorem} of Eric Larson. It answers in general a question that has come up multiple times so far in this book: every time we've asked what hypersurfaces contain a curve $C \subset \PP^r$ embedded by a linear system $|L|$, we've looked at the maps $\rho_m$. Each time, we knew the dimensions of the spaces $\Sym^m H^0(L)$ and $H^0(L^m)$, and the question was the rank of $\rho_m$; now we know the answer for a general linear system of any degree and dimension.Thus the maximal rank theorem tells us the Hilbert function of a general curve $C \subset \PP^r$ embedded by a general linear system.

\item There is a possible extension of the maximal rank theorem of Part~\ref{maximal rank}. If $C \subset \PP^r$ is a general curve embedded by a general linear series, the maximal rank theorem tells us the dimension of the $m$th graded piece of the ideal of $C$, for any $m$: this is just the dimension of the kernel of $\rho_m$. But it doesn't tell us what a minimal set of generators for the homogeneous ideal of $C$ might look like. For example, if $m_0$ is the smallest $m$ for which $I(C)_m \neq 0$, or numerically the smallest $m$ such that $\binom{m+r}{r} > md-g+1$, we can ask: is the homogeneous ideal $I(C)$ generated by $I(C)_{m_0}$?

To answer this question---given that we know the dimensions of $I(C)_m$ for every $m$---we would need to know the ranks of the multiplication maps
$$
\sigma_m : I(C)_m \otimes H^0(\cO_{\PP^r}(1)) \to I(C)_{m+1}
$$
for each $m$. In particular, we may conjecture that \emph{the maps $\sigma$ have maximal rank}; if this were true we could deduce the degrees of a minimal set of generators for the homogeneous ideal $I(C)$.

\item There is another object worth mentioning: for any curve $C$, there exists a scheme $G^r_d(C)$ parametrizing linear series of degree $d$ and dimension $r$; that is, in set-theoretic terms,
$$
G^r_d = \left\{ (L, V) \mid L \in Pic^d(C), \text{ and } V \subset H^0(L) \text{ with } \dim V = r+1 \right\}.
$$

(This requires a little more technical machinery to construct, which is why we haven't introduced it.) $G^r_d(C)$ maps to $W^r_d(C)$; the map is a birational isomorphism, being an isomorphism over the open subset $W^r_d(C) \setminus W^{r+1}_d(C)$ and having positive-dimensional fibers over $W^{r+1}_d(C)$. In fact, another version of Part~\ref{sing wrd} is the statement that \emph{for a general curve $C$, the scheme $G^r_d(C)$ is smooth for any $d$ and $r$}.

\item Parts~\ref{general va} and~\ref{maximal rank} describe the geometry of a general curve $C$ as embedded in projective space by a general linear series. But there are many remaining questions! One is the question of secant planes: a naive dimension count would suggest that an irreducible, nondegenerate curve $C \subset \PP^3$ will have a finite number of 4-secant lines, but no 5-secant lines. Is this true for a general curve embedded in $\PP^3$ by a general linear series?
\end{enumerate}

\input footer.tex