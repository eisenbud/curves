\input{header}

\chapter{Inflection points and the Brill Noether Theorem}
\label{InflectionsChapter}

\fix{ The last section needs work.}

In this chapter, we will introduce the \emph{inflection points} of a linear system, and use them to give a proof of one implication in the statement of the Brill-Noether theorem.

Just as a point $p \in C$ on a smooth plane curve $C \subset \PP^2$ is called a \emph{flex point} if there is a line $L \subset \PP^2$ having contact of order 3 or more with $C$ at $p$, a point on a smooth, nondegenerate curve $C \subset \PP^r$ will be called an \emph{inflection point} if there is a hyperplane $H \subset \PP^r$ having contact of order $r+1$ or more with $C$ at $p$. This notion can be extended to arbitrary linear series on smooth curves (as opposed to very ample ones); we'll see below that (in characteristic 0) every linear series has finitely many inflection points, and how to count them.


\section{Inflection points,  Pl\"ucker formulas and Weierstrass points}

\subsection{Definitions}
To define the inflection points of a linear series $\sD = (\sL, V)$ on a curve $C$, we will use the following result:

\begin{proposition} Let $V$ be a vector space of global sections of an invertible sheaf $\sL$ on a smooth curve $C$, and let $p \in C$ be a point. There exists a basis $\sigma_0, \dots, \sigma_r$ of $V$ consisting of sections vanishing to different orders at $p$. Thus the set
$$
\{ \ord_p(\sigma) \mid \sigma \neq 0 \in V \}
$$
 has cardinality $\dim V$
\end{proposition}

\begin{proof} Let $\tau_0, \dots, \tau_r$ be any basis of $V$. If  $\tau_i$ and $\tau_j$ vanish to the same order $a$ then as germs of sections of $\sL$ at $p$, they both represent nonzero classes in the one-dimensional vector space
$\frak{m}_{C,p}^a\sL/\frak{m}_{C,p}^{a+1}\sL$. \fix{what is our notation for the maximal ideal? What is our notation for the localization of $\sL$ at $p$?} Thus some nonzero linear combination $\tau_i' := a\tau_i+b\tau_j$  vanishes to strictly higher order. Since the coefficients $a$ and $b$ are both necessarily nonzero we may change bases, replacing $\tau_i$ with $\tau_i'$. As long as our basis contains elements vanishing to the same order we can repeat this process; since the order $\ord_p(\sigma)$ of any section at $p$ is bounded above by the degree of $\sL$, this process must terminate.
\end{proof}

Using the Proposition, we may write
$$
\{ \ord_p(\sigma) \mid \sigma \neq 0 \in V \} = \{a_0,\dots,a_r\} \; \text{ with } \; 0\leq a_0 < a_1 < \dots < a_r.
$$
The sequence $a_i = a_i(\cD,p)$ is called the \emph{vanishing sequence} of $\cD$ at $p$.  Since $a_i \geq i$, the numbers $\alpha_i = \alpha_i(\cD,p) = a_i - i$ are often more interesting, and the sequence $0 \leq \alpha_0 \leq \alpha_1 \leq \dots \leq \alpha_r$ is called the \emph{ramification sequence} of $\cD$ at $p$. 

We say that $p$ is an \emph{inflection point} of the linear series $\cD$ if $(\alpha_0,\dots,\alpha_r) \neq (0,\dots,0)$, and we define the weight of $p$ to be
$$
w(\cD, p) = \sum_{i=0}^r \alpha_i(\cD, p).
$$

If $\cD$ is very ample, so that it may be viewed at the linear series cut on $C$ by hyperplanes for some embedding $C \subset \PP^r$, then this coincides with the notion above: $p$ is an inflection point if $a_r > r$; that is, if there is a hyperplane $H \subset \PP^r$ having contact of order $r+1$ or more with $C$ at $p$.

The first two terms in the ramification sequence are particularly important: $\alpha_0(\cD, p)$, is nonzero if and only if $p$ is a base point of $\cD$; and $\alpha_1(\cD, p) = 0$ if and only if, in addition, the map $\phi_\cD$ is an immersion (that is, has nonzero derivative) at $p$.


\subsection{The Pl\"ucker formula}

In characteristic 0,a linear series on a smooth projective curve can have only finitely many inflection points, and in fact the sum of the weights of all the inflection points depends only on the genus of the curve and the degree of the the linear series. The result is called the Pl\"ucker Formula:

\begin{theorem}
 \begin{equation}\label{Plucker formula}
\sum_{p \in C} w(\cD, p) \; = \; (r+1)d + r(r+1)(g-1).
\end{equation}
\end{theorem}
For a proof, see for example~\cite{} (3264?). 

\begin{exercise}
Show that in case $r=1$ this is exactly the Riemann-Hurwitz formula for branched covers of $\PP^1$.
\end{exercise}

The result also holds in positive characteristic under the hypothesis that the number of inflection points is finite. It is hard even to imagine a plane curve in which every point is a flex!---but in positive characteristic there are such ``strange'' curves \cite[]{Hartshorne}.

The Pl\"ucker formula leaves many questions unanswered: we don't know, for example, what combinations of inflection points are possible on the canonical series. \fix{Original statement was stronger -- made me nervous.} One thing we do know is the behavior of the inflection points for a general linear series; we'll state this here and prove it as a corollary to the proof of the Brill-Noether theorem later in this chapter.

\begin{theorem}
If $C$ is a general curve of genus $g$, $L \in \pic^d(C)$ a general line bundle of degree $d$ with $h^0(L) = r+1$ and $V = H^0(L)$, then every inflection point of the linear series $\cD = (L, V)$ has weight 1 and hence ramification sequence $(0, \dots, 0, 1)$.
\end{theorem}

As a sample application of the Pl\"ucker formula, we can give a simple proof of Proposition~\ref{rnc unique uninflected}, which says that the rational normal curve is the only curve with no inflection points. 

\begin{proof}
Suppose $C \subset \PP^r$ is a curve of degree $d$ and genus $g$. If $C$ has no inflection points then, by the Pl\"ucker formula, we must have
$$
(r+1)d + r(r+1)(g-1) = 0.
$$
This immediately implies that $g=0$, so that we must have $(r+1)(d-r) = 0$ and hence $d=r$; thus $C$ is a rational normal curve.
\end{proof}

\subsection{Weierstrass points}

As with any extrinsic invariant of a curve in projective space, we can derive an intrinsic invariant of an abstract curve by applying the invariant to the canonical linear series. We define a \emph{Weierstrass point} of a curve $C$ to be an inflection point of the canonical linear series $|K_C|$. 

Thus $p$ is a Weierstrass point of $C$ if there exists a  differential form on $C$ vanishing to order $g$ or more at $p$. The \emph{weight} $w_p$ of a Weierstrass point $p \in C$  is defined to be the weight $w(|K_C|,p)$ of $p$ as an inflection point of the canonical series. 

The Pl\"ucker formula tells us  the total weight of the Weierstrass points on a given curve $C$:

\begin{corollary}\label{plucker formula}
The sum of the weights of the Weierstrass points on a curve $C$ of genus $g$ is
$$
\sum_{p \in C} w_p = g^3-g.
$$\qed
\end{corollary}

It will follow from the proof of the Brill-Noether theorem below that on a general curve $C$, every Weierstrass point has weight 1; thus there are $g^3-g$ distinct Weierstrass points on $C$

%Since there are only finitely many ramification points of the canonical series, a general point $p$ on any curve $C$ has gap sequence $(1,2,\dots,g)$, and correspondingly its Weierstrass semigroup
%is $W_p = (0, g+1, g+2, \dots)$. A Weierstrass point is called \emph{normal} if it has weight 1; this is tantamount to saying that the gap sequence is $(1,2,\dots,g-1,g+1)$, or that the semigroup is $(0, g, g+2, g+3, \dots)$. (The full Brill-Noether theorem tells us that a general curve $C$ has only normal Weierstrass points; this will be a consequence of Theorem~\ref{BN with inflection and dimension} below.)

\subsubsection{The Weierstrass semigroup} 

By definition, a point $p \in C$ on a curve $C$ of genus $g$ is a Weierstrass point iff $h^0(K_C(-gp)) \neq 0$; that is, iff there exists a holomorphic differential on $C$ vanishing to order at least $g$ at $p$. Now, the Riemann-Roch formula tells us that
$$
h^0(\cO_C(gp)) = g - g + 1 + h^0(K_C(-gp))
$$
so the condition $h^0(K_C(-gp)) \neq 0$ is equivalent to saying that $h^0(\cO_C(gp)) > 1$; in other words, there exists a nonconstant rational function on $C$, regular on $C \setminus \{p\}$ and having a pole of order at most $g$ at $p$.

This suggests that we look at the set of all possible orders of pole at $p$ of rational functions regular on $C \setminus \{p\}$; that is,
$$
W(C,p) := \left\{ \ord_p(f) \mid f \in K(C) \text{ with $f$ regular on } C \setminus \{p\} \right\}.
$$
This is clearly a sub-semigroup of the natural numbers $\NN$; it is called the \emph{Weierstrass semigroup} of the point $p$.  

Now, another way to characterize the condition that there exists a rational function on $C$, regular on $C \setminus \{p\}$, with a pole of order exactly $k$ at $p$ is to say that
$$
h^0(\cO_C(kp)) = h^0(\cO_C((k-1)p)) + 1.
$$
Applying Riemann-Roch to both sides of this equation, we see that it is equivalent to the condition
$$
h^0(K_C(-kp)) = h^0(K_C((-k+1)p)).
$$
This holds  if and only if there does \emph{not} exist a regular differential on $C$ with a zero of order exactly $k-1$ at $p$. In other words, the complement $\NN \setminus W(C,p)$ is exactly the vanishing sequence of the canonical series at $p$, shifted by 1; in particular, it has cardinality  exactly $g$. This is called the \emph{Weierstrass gap sequence} of the point $p$.

%
%By the Riemann-Roch theorem, $p\in C$ is a Weierstrass point if and only if $h^0(\cO_C(gp)) \geq 2$, or in other words to saying that there exists a non-constant rational function on $C$, regular away from $p$ and having a pole of order $g$ or less at $p$. The same argument shows more generally that for any $k \geq 0$, there exists a rational function on $C$, regular on $C \setminus \{p\}$ and having a pole of order exactly $k$ at $p$---that is,
%$$
%h^0(\cO_C(kp)) > h^0(\cO_C((k-1)p))
%$$
%if and only if 
%$$
%h^0(K_C(-kp)) = h^0(K_C((-k+1)p)).
%$$
%This holds  if and only if there does \emph{not} exist a regular differential on $C$ with a zero of order exactly $k-1$ at $p$. 
%
%In sum, for each point $p\in C$ there exist exactly $g$ values of $k$ such that there does \emph{not} exist a rational function on $C$ with a pole of order exactly $k$ at $p$; these are called the \emph{gap values} of the point $p \in C$, and by the above they comprise exactly the vanishing sequence of the canonical series $|K_C|$ at $p$, shifted by 1. Note that the set of $k$ such that there \emph{does} exist a rational function on $C$ with a pole of order exactly $k$ at $p$, regular on $C \setminus \{p\}$---forms a subsemigroup of $\NN$, called the \emph{Weierstrass semigroup} of $p \in C$. Its complement in $\NN$ is the set of $g$ gap values.  

There is still much we don't know about Weierstrass points in general. Most notably, we don't know what semigroups of finite index in $\NN$ occur as Weierstrass semigroups; an example of Buchweitz shows that not all semigroups occur, but there are also positive results, such as the statement ([EH]) that every semigroup of weight $w \leq g/2$ occurs, and its refinement and strengthening by Pflueger (\cite{**}).

\begin{exercise}
Buchweitz' example (the semigroup of $\sL^2$ has the wrong number of elements)
\end{exercise}

 



\section{Finiteness of the automorphism group}
\fix{Neither proof in this chapter is very accessible/depends on facts beyond this course. Let's give just one of the two proofs with more details, and factify the other.}

As an application we will deduce a fundamental fact: that the automorphism group of a curve of genus $g\geq 2$ is finite. The starting idea behind the argument is simple: because the Weierstrass points of a curve $C$ are intrinsically defined, \emph{any automorphism of $C$ must carry Weierstrass points to Weierstrass points}. Since there are only finitely many Weierstrass points, then, it will suffice to show that the subgroup of $Aut(C)$ of automorphisms of $C$ that fix each  Weierstrass point is finite. The following two lemmas establish a strong version of this:

\begin{lemma}
Let $C$ be a smooth projective curve of genus $g \geq 2$, and $f: C \to C$ an automorphism of $C$.
\begin{enumerate}
\item If $f$ has $2g+3$ or more distinct fixed points, then $f$ is the identity; and
\item If $f$ has $2g+2$ distinct fixed points, then either $f$ is the identity or $C$ is hyperelliptic and $f$ is the hyperelliptic involution.
\end{enumerate}
\end{lemma}

We give two arguments, one invoking the classical topology and applying the Lefschetz fixed point formula and the other more algebro-geometric.

\begin{proof}[Proof  using the classical topology]
For the first, we recall the definition of the \emph{Lefschetz number} of a map $f : M \to M$ of a compact oriented real $n$-manifold $M$. This is the alternating sum of the traces of the action of $f$ on $H^i(X,\CC)$:
$$
L(f) := \sum_{i=0}^n {\rm Trace}\left(f^* : H^i(X,\CC) \to H^i(X,\CC)\right).
$$
The Lefschetz fixed point formula then says that if $f$ has isolated fixed points, the number of those points, properly counted, is equal to $L(f)$.

The fixed points of a map $\phi$ of $C$ to $C$ are the intersection of the graph of $\phi$ with the diagonal in $C\times C$, and are thus a Zariski closed subset of $\phi$. It follows that any map other than the identity has isolated fixed points. Moreover, any complex analytic map is orientation-preserving \fix{somewhere we need to talk about the classical topology, and  orientation in particular} so each fixed point of an automorphism $f$ contributes positively to $L(f)$. In particular,  the number of distinct fixed points is at most $L(f)$.

Now suppose $f: C \to C$ is any automorphism. Of necessity, $f$ acts as the identity on $H^0(C, \CC)$ and $H^2(C, \CC)$, so if we want to bound $L(f)$ we just have to say something about the action of $f$ on $H^1(C,\CC)$. To do this, note that \fix{note that the reader might not know about the Hodge decomposition!} the action of $f$ on $H^1(C,\CC)$ respects the \emph{Hodge decomposition}
$$
H^1(C,\CC)  = H^0(K_C) \oplus H^1(\cO_C).
$$  
Moreover, the action of $f$ on $H^0(K_C)$ preserves the definite Hermitian inner product
$$
H(\eta, \phi) = \int_C \eta \wedge \overline \phi,
$$
and it follows that \emph{the eigenvalues of the action of $f$ on $H^0(K_C)$ are all complex numbers of absolute value 1}, and likewise for the action on $H^1(\cO_C)$ \fix{this all needs to be spelled out} . The absolute value of the trace of $f^*: H^1(C,\CC) \to H^1(C,\CC)$ is thus at most 2g, and hence
$$
L(f) \leq 2 + 2g,
$$
\fix{where did the 2 come from??} proving the stated inequality in general.

Finally, if we have equality then $f$ must act as $-1$ on $H^1(C,\CC)$, \fix{why? How about +1?} and it follows (again from Lefschetz) that $f^2$ is the identity; applying the Riemann-Hurwitz formula to the map from $C$ to the quotient $B = C/\langle f \rangle$ we may deduce that $B = \PP^1$, so $C$ is hyperelliptic and $f$ the hyperelliptic involution.
\end{proof}

An alternative argument showing that if $f$ is not the identity, then it has  for the lemma may be given using the intersection pairing on the surface $S = C \times C$ and applying the index theorem for surfaces.
 \fix{need to define N(S), state the index formula.}

\begin{proof}[Proof of 1. using intersection theory]
Let $\Delta$ and $\Gamma \subset S$ be the diagonal and the graph of $f$ respectively, and let $\Phi_1$ and $\Phi_2 \subset S$ be fibers of the two projection maps; let $\delta, \gamma, \varphi_1$ and $\varphi_2$ be the classes of these curves in the Neron-Severi group $N(S)$  of $S$. The number of fixed points of $f$ (counted with multiplicities) is the intersection number  $b = \delta \cdot \gamma$.

We know all the other pairwise intersection number of these classes: the ones involving $\varphi_1$ or $\varphi_2$ are obvious; we have
$$
\delta^2 = 2 - 2g
$$
and since the automorphism $id_C \times f : C\times C \to C \times C$ carries $\Delta$ to $\Gamma$, we see that $\gamma^2 = 2-2g$ as well.

We can now apply the index theorem for surfaces to deduce our inequality. To keep things relatively simple, let's introduce two new classes: set
$$
\delta' = \delta - \varphi_1 - \varphi_2 \quad \text{and} \quad \gamma' = \gamma - \varphi_1 - \varphi_2,
$$
so that $\delta'$ and $\gamma'$ are orthogonal to the class $\varphi_1 + \varphi_2$. Since $\varphi_1 + \varphi_2$ has positive self-intersection, the index theorem\fix{give the statement} tells us that the intersection pairing must be negative definite on the span $\langle \delta',\gamma' \rangle \subset N(S)$. In particular, the determinant of the intersection matrix
\begin{center}
\begin{tabular}{c|c|c}
& $\delta'$ &  $\gamma'$  \\
\hline
$\delta'$ & $-2g$ & $b-2$ \\
\hline
$\gamma'$ & $b-2$ & $-2g$ 
\end{tabular}
\end{center}
(where again $b = \gamma \cdot \delta$) is nonnegative, or equivalently, $b\leq 2g+2$.
\end{proof}

Having established an upper  bound on the number of fixed points an automorphism $f$ of $C$ (other than the identity) may have, it remains to find a lower bound on the number of distinct Weierstrass points; this is the content of the next lemma.


\begin{lemma}
If $C$ is a smooth projective curve of genus $g \geq 2$, then $C$ has at least $2g+2$ distinct Weierstrass points; and if it has exactly $2g+2$ Weierstrass points it is hyperelliptic.
\end{lemma}

\begin{proof}
Let $p \in C$ be any point, and $w_1=w_1(p),\dots,w_g = w_g(p)$ the ramification sequence of the canonical series $|K_C|$ at $p$. By definition, 
$$
h^0(K_C(-(w_i+i)p)) = g - i.
$$
Applying Clifford's theorem we have
$$
g-i \leq \frac{2g - 2 - w_i - i}{2} + 1;
$$
solving, we see that
$$
w_i \leq i
$$
and hence
$$
w_p \leq \binom{g}{2}
$$
where $w_p$ is the total weight of $p$ as a Weierstrass point. Since the total weight of the Weierstrass points on $C$ is $g^3-g$ by the Pl\"ucker formula~\ref{***}, we see that the number of distinct Weierstrass points must be at least
$$
\frac{g^3-g}{\binom{g}{2}} = 2g+2.
$$
Finally, by the strong form of Clifford's Theorem \ref{***}, equality here implies that the curve is hyperelliptic.\fix{still need to say why only the hyperelliptic involution fixes all the W-points.}
\end{proof}

\section{Proof of (half of) the Brill-Noether theorem}

The Brill-Noether theorem tells us exactly which linear series exist on a general curve:

\begin{theorem} Let $d,g,r$ be non-negative integers, and set 
$$
\rho =\rho(g,r,d) := g - (r+1)(g-d+r).
$$
 \begin{enumerate}
\item If $\rho \geq 0$, then every curve $C$ of genus $g$ possesses a $g^r_d$.
\item If $\rho < 0$ then a general curve of genus $g$ does not possess a $g^r_d$.
\end{enumerate}
\end{theorem}

The first part, often called the ``existence half" of Brill-Noether, was originally proved by Kempf (\cite{}) and Kleiman-Laksov (\cite{}); both proofs relied on an application of the Thom-Porteous formula to a particular map of vector bundles on the Jacobian of $C$. A sketch of this argument may  be found in \cite[Appendix D.3]{3264}.  

To understand where the number $\rho$ comes from, consider an invertible sheaf $\cL$ of degree $d$ on a curve $C$ of genus $g$. If 
$h^0(\cL) = r+1$ then, by the Riemann-Roch Theorem, $h^1(\cL) = g-d+r$. 
Given such an invertible sheaf $\cL$ one can show that, in a neighborhood of $\cL$, the subset of the Picard variety of a curve C consisting of invertible sheaves of 
degree $d$ with at least $r$ sections is defined by the vanishing of the subdeterminants of
size $k+1$ in a matrix $M$ of size $(k+h^0(\cL) )\times (k+ h^1(\cL))$, for any large $k$. The number
$(r+1)(g-d+r)$ is the upper bound for the codimension of the minors of any such matrix $M$, as in shown in
\cite[Theorem ***]{Eisenbud}. Thus, given the existence of $\cL$, the set of invertible sheaves of degree $d$ on $C$ with at least $r+1$ sections must have dimension at least $\rho$.

We will  apply the Pl\"ucker formula, to deduce the second half of the statement above---the ``nonexistence half."---and some further refinements. 
Our proof will use an ingenious idea first suggested by Castelnuovo \fix{Since Castelnuovo's intentions are several times quoted, I'd like an actual citation!}:
a ``general curve of genus $g$" may be a mysterious object for large $g$. But we can construct nodal curves of arithmetic genus $g$ readily: we just start with $\PP^1$, pick $2g$ distinct points $p_1,\dots,p_g, q_1,\dots,q_g \in \PP^1$, and identify each pair of points $p_i, q_i$ to form a $g$-nodal curve $C_0$. We will see below that there exists a family of smooth curves of genus $g$ specializing to such a curve, and we can analyze linear series on the general member of such a family by considering how they specialize to $C_0$.

Interestingly, Castelnuovo introduced this construction not to prove the Brill-Noether theorem---then considered as established---but to answer an enumerative question: Castelnuovo asked, if a general curve of genus $g = 2k$ has a finite number of $g^1_{k+1}$s, what is the number? As we've seen, for genera $g = 2, 4$ and 6 the answers are 1, 2 and 5 respectively; Castelnuovo used his construction to find the number in general, as we'll describe below. It was Altman and Kleiman, in~\cite{}, who first proposed that Castelnuovo's construction could be used to prove the Brill-Noether theorem, and carried out the reduction given in Proposition~\ref{} below.

Our first task is to describe ``the curve obtained by identifying pairs of points on $\PP^1$'':

\subsubsection{Step 1: Constructing nodal curves}
We follow the treatment of \cite{Serre, Corps locaux, pp70ff},
 where a slightly more general case is treated.
 
Suppose that $\{\{p_1,p_1'\},\dots, \{p_g,p_g'\}\}$ is a set of $g$ pairs of smooth points on a curve $C$, and let $\pi: C \to C':=C/\sim$ be the set-theoretic quotient of $C$ by the equivalence relation
 $p_i\sim q_i$ for each $i$. Let $r_i\in C'$ be the common image of $p_i, q_i$. We claim that $C'$ can be given the structure of an  algebraic curve with nodes at the points $r_i$, in the sense that the completion satisfies
$$
\widehat\cO_{C', r_i} \cong k[[x,y]]/(xy).
$$
 To prove this we may suppose that the curve $C$ is affine, with coordinate ring $R$.
For each $i$ we let $\cO_{r_i}$  be the set of germs of sections of $\cO_C$ that are
 defined at both $p_i$ and $q_i$, and have the same value. Thus, regarding everything
 as subsets of the quotient field of $R$, 
 $$
 \cO_{r_i} = k+(\gm_{R,p_i} \cap \gm_{R,q_i}) \subset \cO_{C,p_i}\cap \cO_{C,q_i}.
 $$
 Finally, we set 
 $$
 R' = R \bigcap_{i=1}^g \cO_{r_i}.
 $$

Note that $\cO_{r_i}$ has vector space codimension 1 in 
 $\cO_{C,p_i}\cap \cO_{C,q_i}$, which is the semi-localization of $R$ at
 $\gm_{C,p_i}\cap \gm_{C,q_i}$, the result of inverting every element not in the 
 union of the two maximal ideals. If $f\in R$ is a function vanishing at $p_i, q_i$ but not at $p_j$ or $p_j'$.
then $\cO_{r_j}[f^{-1}$ is strictly bigger than
$\cO_{r_j}$, and thus $\cO_{r_j} [f^{-1}] = \cO_{C,p_j} \cap \cO_{C,p_j'}$.
Since localization commutes with finite intersections, we see that $R$ and $R'$
coincide away from the points $p_i,q_i$, and the local ring $\cO_{C',r_i}$ of $C'$ at $r_i$ is
equal to $\cO_{r_i}$.

Since $\cO_{C,p_i}\cap \cO_{C,q_i}$ is a finite algebra over $\cO_{C', r_i}$,
the exact sequence of $\cO_{C', r_i}$-modules
$$
0\to \cO_{C', r_i} \to cO_{C,p_i}\cap \cO_{C,q_i} \to k \to 0
$$
completes to the exact sequence
$$
0\to \widehat\cO_{C', r_i} \to k[[x]]\times k[[y]] \to k \to 0
$$
where the last map is the difference of the natural projections
$k[[x]] \to k$ and $k[[y]] \to k$. Thus
$\widehat\cO_{C', r_i} \cong k[[x,y]]/(xy)$ as required, completing the construction.

\begin{exercise}
\begin{enumerate}
\item Using the fact that $d > 2g+2$, show that no two secant or tangent lines to $C \subset \PP^n$ meet; and
\item Deduce from this that the image $C' = \pi(C)$ is isomorphic to the curve constructed above.
\end{enumerate}
\end{exercise}
\fix{I assume that the reader is to do this one double point at a time, inductively. To complete this, we seem to need the properties of $2g+2$ also for singular curves. Also: does this need projection from a *general point of the secant line, as specified?}

\subsubsection{Step 2: Castelnuovo's specialization}

Next, Castelnuovo proposed analyzing a family of smooth curves specializing to a $g$-nodal one; in order to use this construction in a proof of Brill-Noether, we have to prove that such families exist. We'll state the lemma we need here:

\begin{lemma}\label{specialization to nodal curve}
Let $p_1,\dots,p_g, q_1,\dots, q_g \in \PP^1$ be distinct points, and $C_0$ the curve obtained by identifying $p_i$ with $q_i$ for $i = 1,\dots,g$. There exists a family of curves $\pi : \cC \to B$, where
\begin{enumerate}
\item $B$ is a smooth curve, with distinguished point $0 \in B$;
\item for all $b \neq 0 \in B$, the fiber $C_b = \pi^{-1}(b)$ is a smooth, projective curve of genus $g$;  and
\item the fiber over $0$ is the curve $C_0$.
\end{enumerate}
\end{lemma}

This Lemma will follow from the local geometry of Severi varieties, as worked out in Chapter~\ref{PlaneCurvesChapter}, and we defer the proof to that chapter.

The lemma can also be proved by deformation theory, as in \fix{ citations to Greuel et al would work here. You would think that Hartshorne (\cite{}) and Sernesi (\cite{}) would have it but Joe was unable to find this statement, or anything implying it, in either book.}. 
%
%\begin{lemma}\label{BN in family}
%If $p_1,\dots,p_g, q_1,\dots, q_g \in \PP^1$ are general points and $\cC \to B$ is a family of curves as described in Lemma~\ref{specialization to nodal curve} above, then for general $b \in B$ the fiber $C_b$ does not possess a $g^r_d$ with $\rho < 0$.
%\end{lemma}
%
%From this, we deduce the basic
%
%\begin{theorem}\label{bare-bones BN}
%A general curve $C$ of genus $g$ does not possess a $g^r_d$ with $\rho(g,r,d) < 0$.
%\end{theorem}

\subsubsection{Step 3: The Altman-Kleiman analysis}

The analysis proposed by Altman and Kleiman considers the question: given a family $\pi : \cC \to B$, and a family $\{ \cD_b = (L_b, V_b)\}_{b \neq 0 \in B}$ of linear series on the curves $C_b$ with $b \neq 0$, how can we describe the ``limit" of the linear series $\cD_b$ as $b \to 0$? 

Suppose now we have a family $\pi : \cC \to B$ and in Lemma~\ref{specialization to nodal curve}, and suppose that the general curve $C_b$ in the family does have a line bundle  of degree $d$ with $r+1$ sections. Let 
$$
\pi^\circ: \cC^circ := \cC \setminus C_0\to B^\circ := B\setminus 0.
$$
and write $\Pic_{\cC^\circ/B^\circ}$ for the relative Picard scheme.

Choose a curve $B'^\circ$ in $\Pic_{\cC^\circ/B^\circ}$ whose general point corresponds
to an invertible sheaf on $B_b$ that has degree $d$ with $r+1$ independent sections.  We may complete $B'^\circ$ to a curve $B'$ that is a ramified covering of $B$. Making a base change to the normalization $B'$,  we arrive at a new family $\cC'\to B'$ with a distinguished invertible sheaf $\cL$ whose restriction to each fiber $C_b$ for $b \neq 0 \in B'$ has degree $d$ and at least $r+1$ independent sections \fix{This requires
us to have constructed the relative Picard scheme, and to know its universal property.}

\fix{what we really want is a well-defined family of *sections* that are local generators everywhere. If we don't do this all at once, I think we have to make the base change
argument all over again later...}

%The basic outline of the argument is by contradiction, but straightforward: we assume that the general curve $C_b$ in the family does have a $g^r_d$, consider what the limit of those $g^r_d$s might look like and, using our knowledge of the relatively simple curve $C_0$, arrive at a contradiction. By way of notation, let $B^\circ = B \setminus \{0\}$ and let $\cC^\circ = \pi^{-1}(B^\circ)$ be the complement in $\cC$ of the special fiber. The proof proceeds essentially in four/five steps.
%
%\
%
%\noindent {\bf Step 0: Existence of such a family}
%
%\begin{lemma}\label{cusp smoothing lemma}
%For each $g$, there exists a family $\cC \to B$ of curves with $B$ smooth and one-dimensional; $C_b$ a smooth curve of genus $g$ for $b \neq 0 \in B$ and $C_0$ a rational curve with $g$ cusps.
%\end{lemma}

%\
%
%\noindent {\bf Step 1: Finding a family of $g^r_d$s over $B^\circ$}
%
%Suppose now that the general curve $C_b$ in the family does have a line bundle  of degree $d$ with $r+1$ sections. The first thing to observe is that, possibly after a base change, we can pick out one such line bundle $\cL_b$ for each $b \neq 0$, varying regularly with $b$; or, in other words \emph{there exists a  line bundle $\cL^\circ$ on the complement $\cC^\circ$ of the special fiber such that}
%$$
%\deg(\cL^\circ|_{C_b}) = d \quad \text{and} \quad h^0(\cL^\circ|_{C_b}) \geq r+1
%$$
%for all $b \neq 0 \in B$. \fix{need to give argument for this assertion}

%\
%
%\noindent {\bf Step 2: Extending the line bundle $\cL^\circ$ to a sheaf on all of $\cC$}

Although  $\cL^\circ$ may not extend to a line bundle on $\cC$, we claim that \emph{there exists a torsion-free sheaf $\cL$ on all of $\cC$ such that $\cL|_{\cC^\circ} \cong \cL^\circ$}.

To see this, we choose an auxiliary line bundle $\cM$ on $\cC$ with relative degree $e > d + 2g$ and let $\cM^\circ$ be the restriction of $\cM$ to $\cL^\circ$. Consider the line bundle 
$$
\cN^\circ = (\cL^\circ)^* \otimes \cM^\circ.
$$
The bundle $\cN^\circ$ has lots of sections: the direct image, as a sheaf on $B$, is locally free of rank $e-g+1 > 0$, and after restricting to an open neighborhood of $0 \in B$ we can assume it's generated by them \fix{This seems to require that the
orginal fibers had exactly $r+1$ independent sections. Also, we are still in a punctured neighborhood of $b$, so this might need some further argument}. Choose a section $\sigma$ of $\cN^\circ$; let $D^\circ \subset \cC^\circ$ be its divisor of zeros, and let $D \subset \cC$ be the closure of $D^\circ$ in $\cC$. Now, away from $C_0$ we can write
$$
\cL^\circ = (\cN^\circ)^* \otimes \cM^\circ = \cI_{D^\circ/\cC^\circ} \otimes \cM^\circ
$$
and accordingly the sheaf
$$
\cL := \cI_{D/\cC} \otimes \cM
$$
is the desired sheaf. 

Even if the family we originally started with had smooth total space, the base change called for in the first step would yield a family $\cC$ with  total space singular at the nodes of $C_0$. If $D$ passes through any of these points it need not be Cartier, 
so $\cL|_{C_0}$, though torsion-free, may not be invertible.

In sum, if the general fiber $C_b$ of our family has a $g^r_d$, we can conclude that the special fiber $C_0$ has a torsion-free sheaf $\cL_0$ with 
$$
c_1(\cL_0) = d;
$$
\fix{where did the reader learn about Chern classes of torsion-free sheaves?? Might be better to say degree and explain what that means for a torsion-free sheaf.}
and, by upper-semicontinuity of cohomology,
$$
h^0(\cL_0) \geq r+1.
$$

Fortunately the torsion-free sheaves on nodal curves have a simple structure: 

\begin{lemma}\label{torsion free at node}
Let $p$ be a  node of a curve $C$. If $\cF$ is a torsion-free sheaf on $C$, then in a neighborhood of $p$ in $C$ the sheaf $\cF$ is either locally free or locally isomorphic to the ideal sheaf $\cI_{p/C}$ of $p$ in $C$.
\end{lemma}

\begin{proof} We may work over the local ring $R := \cO_{C,p}$, which has codimension
1 in its integral closure $\widetilde R$, and replace $\cF$ with 
its localization at $p$ as well, noting that this is an ideal in $R$. We write
$\gm$ for the maximal ideal of $R$

Consider the endomorphism ring of $\cF$, and note that it is commutative and integral over $R$ so 
$$
R \subset \End \cF \subset \widetilde R.
$$
Since
$\widetilde R/R \cong k$, the ring $\End(\cF)$ is equal to either 
$R$ or $\widetilde R$. 

First, suppose
$\End(\cF)=\widetilde R$, which is a discrete valuation ring.
 As an 
$\widetilde R$-module, $\cF$ is free of rank 1.  The conductor
$\ann(\widetilde R/R)$ is $\gm$.
Since the conductor is also an ideal of $\widetilde R$, and thus isomorphic to $\widetilde R$
as $\widetilde R$-module,
we see that $\cF \cong \gm$ as $R$-modules.

On the other hand suppose
$\End(\cF)=R$. 
Since
$\End \cF = R = \gm \widetilde R$ we have
$$
(\gm \widetilde R)\cF = \cF.
$$
Since $\widetilde R\cF \cong \widetilde R$, we see
that 
$$
\cF = \gm \widetilde R\cF = 
(\gm \widetilde R)\widetilde R\cF \cong \gm \widetilde R = R,
$$
 as required.
\end{proof}

\begin{exercise}
 The proof above works whenever $R$ is a local domain with integral closure $\widetilde R$ and the conductor
 $\ann \widetilde R/R = \gm$,
 the maximal ideal of $R$. Show that this is the case for ordinary nodes and cusps, but not for any other curve singularities.
\end{exercise}

%\begin{exercise}
%\begin{enumerate}
%\item Show  that the conclusion of Lemma~\ref{torsion free at node} holds in case $p$ is a node of $C$
%\item Show by example that the conclusion of Lemma~\ref{torsion free at cusp} is false in case $p$ is either a tacnode or a triple point of $C$.
%\end{enumerate}
%\end{exercise}
%


\subsubsection{Step 4: The reduction to Schubert calculus}

The point of the argument thus far has been to reduce a problem involving linear series on a smooth curve---that is, a line bundle of degree $d$ with $r+1$ global sections---to one involving sections of a torsion-free sheaf on a $g$-nodal curve. Why is this an improvement? 

The answer is, if we have a linear system on a $g$-nodal curve $C_0$, we can look at its pullback to the normalization $\PP^1$ of $C_0$, where we understand the geometry of linear systems much better. To see how this goes, suppose that as above we have a family $\cC \to B$ of curves specializing from a smooth curve of genus $g$ to a $g$-nodal curve $C_0$; suppose that we have a linear series $\cD_b = (\cL_b, V_b)$ of degree $d$ and dimension $r$ on the smooth fibers $C_b$. In addition, suppose for the moment that the family of line bundles $\cL_b$ extends to a line bundle on all of $\cC$. (Of course, once we've done this we'll double back and consider what happens if the limit of $\cL_b$ is torsion-free but not locally free.) What has this reduction bought us?

Quite a lot, actually. The point is, if $\cL_0$ is a line bundle of degree $d$ on the $g$-nodal curve $C_0$, and $\nu : \PP^1 \to C_0$ the normalization map, the pullback $\nu^*\cL$ is the line bundle $\cO_{\PP^1}(d)$; and if $V_0 \subset H^0(\cL_0)$ is an $(r+1)$-dimensional vector space of sections of $\cL_0$, then the pullback $\nu^*(V_0)$ is  an $(r+1)$-dimensional subspace of $H^0(\cO_{\PP^1}(d))$. There are of course a lot of these---if we imagine $\PP^1$ as embedded in $\PP^d$ by the complete linear series $|\cO_{\PP^1}(d)|$, they correspond exactly to linear spaces $\Lambda \cong \PP^{d-r-1} \subset \PP^d$, so that we have a Grassmannian of them. The question is, \emph{when is the $g^r_d$ on $\PP^1$ associated to a linear space $\Lambda \subset \PP^d$ the pullback of a $g^r_d$ on $C_0$}?

The answer is straightforward: in order for a linear series on $\PP^1$ to be the pullback of a linear series on $C_0$, it has to be the case that for each $i = 1,\dots, g$, every divisor of the linear series containing $p_i$ must also contain $q_i$ and vice versa. In terms of the geometry of the linear space $\Lambda \subset \PP^d$, this is tantamount to saying that \emph{$\Lambda$ must intersect the secant line $\overline{p_i,q_i}$ to the rational normal curve $\PP^1 \subset \PP^d$ for each $i=1,\dots,g$}.

Do we expect there to exist linear spaces $\Lambda \cong \PP^{d-r-1} \subset \PP^d$ meeting each of $g$ general chords to a rational normal curve? To answer this, we can make a dimension count. To start, the Grassmannian $\GG(d-r-1,d)$ has dimension $(r+1)(d-r)$. Next, for a given line $L \subset \PP^d$, the locus of $(d-r-1)$-planes $\Lambda \subset \PP^d$ meeting $L$ is a Schubert cycle, denoted $\Sigma_r(L)$; it has codimension $r$ in $\GG(d-r-1,d)$. \emph{If}  the Schubert cycles $\Sigma_r(\overline{p_i,q_i})$ associated to $g$ general chords to the rational normal curve in $\PP^d$ intersect dimensionally transversely, this will be the case only if
$$
rg \leq (r+1)(d-r),
$$
which is exactly the condition $\rho(g,r,d) \geq 0$.

We must also consider the case when the limit $\cL_0$ of the line bundles $\cL_b$ in our family is not locally free at some subset $r_1, \dots, r_\delta$ of the nodes of $C_0$. In this case, let $\widetilde C_0$ be the partial normalization of $C_0$ at these nodes, and $\widetilde \nu : \widetilde C_0 \to C_0$ the partial normalization map, so that $\widetilde C_0$ is the ($g-\delta$)-nodal curve obtained by identifying $g-\delta$ pairs of general points on $\PP^1$. The pullback $\widetilde \nu^*(\cL_0)$ is then locally free of degree $d-2\delta$ on $\widetilde C_0$, so that an $(r+1)$-dimensional space of sections of $\cL_0$ will correspond to a plane $\Lambda \cong \PP^{d-2\delta-r-1} \subset \PP^{d-2\delta}$, meeting each of $g-\delta$ general chords to a rational normal curve in $\PP^{d-2\delta}$. Again, \emph{if} the corresponding Schubert cycles intersect properly, the existence of such planes would imply that
$$
r(g-\delta) \leq \dim\GG(d-2\delta-r-1,d-2\delta) = (r+1)(d-r-2\delta),
$$
which amounts to the inequality $\rho \geq \delta \geq 0$. 

In sum, we have established the 

\begin{theorem}[Altman-Kleiman] If $\rho(g,r,d)<0$ and 
the Schubert cycles $\Sigma_r(\overline{p_i,q_i})$ associated to $g$ general chords to a rational normal curve of degree $d$ are dimensionally transverse, then a general curve of genus $g$ will possess no $g^r_d$.
\end{theorem}

In other words, we have reduced the nonexistence half of classical Brill-Noether to an assertion about general chords to a rational normal curve. This is exactly how
the Brill-Noether theorem was originally proven, in \cite{}. The proof given there is
complicated, because the assertion about dimensional transversality
is \emph{not} true without the hypothesis that the points $p_i,q_i$ are general. For example, if $C$ is a plane conic, and $g=3$, then it is clear that 3 general chords do not meet (and this shows that a general curve of genus 3 is not hyperelliptic!); but there are plenty of triples of concurrent chords---just take three lines through a point off the conic. Fortunately there is an easier way, which we will now explain.

\

\noindent {\bf Step 5: Applying the Pl\"ucker formula}

When trying to prove a statement in algebraic geometry about ``general'' objects of some kind, specialization can sometimes eliminate the hypothesis of generality.
Though there are triples of concurrent chords to a conic are not concurrent, three tangent lines can never be concurrent! There are many ways to see this, but the one most relevant to our present circumstances is: if the tangent lines to a plane conic $C \subset \PP^2$ met at a point $r \in \PP^2$, then the projection map $\pi_r : C \to \PP^1$ would be a degree 2 map with three or more ramification points, a violation of the Riemann-Hurwitz formula.

This suggests both the statement we should be proving, and how to prove it. 

\begin{lemma}
Let $C \cong \PP^1 \subset \PP^d$ be a rational normal curve, and $p_1,\dots,p_g \in C$ any $g$ points of $\PP^1$. If $L_i = \overline{2p_i}$ is the tangent line to $C$ at $p_i$, then the Schubert cycles $\Sigma_r(L_i)$ intersect properly; in particular, if $rg > (r+1)(d-r)$, then the intersection $\cap \Sigma_r(L_i)$ is empty.
\end{lemma}

Note that since tangent lines to a curve are specializations of secant lines, this implies that for $g$ general chords $L_i$ to a rational normal curve, the corresponding Schubert cycles $\Sigma_r(L_i)$ will intersect properly. \fix{we are using the semicontinuity of fiber dimension in a complete family. Since we seem to be talking to people who don't already know about specialization, we should say a little more about this.} Thus, once we establish the lemma we will have completed the proof of the nonexistence half of Brill Noether.

\begin{proof}
We will just prove the ``in particular" part here; the more general statement will follow, as we'll indicate in Exercise~\ref{} below.

Suppose $\Lambda \cong \PP^{d-r-1} \subset \PP^d$ is a linear space meeting each of the tangent lines $L_i$, and consider the linear series cut on $\PP^1$ by hyperplanes containing $\Lambda$. The condition that $\Lambda \cap \overline{2p_i} \neq \emptyset$ means exactly that no hyperplane containing $\Lambda$ is transverse to $C$ at $p_i$, or in other words that the linear series $\cD$ cut on $\PP^1$ by hyperplanes containing $\Lambda$ will have ramification sequence at least $(0, 1, 1,\dots,1)$ at $p_i$. Thus the sum of the weights of $\cD$ at the points $p_1,\dots,p_g$ is at least $rg$, and applying the Pl\"ucker formula we arrive at the inequality
$$
rg \leq (r+1)(d-r).
$$
\end{proof}


%
%Now, back to our family $\pi : \cC \to B$ of curves. We have assumed that for some $d$ and $r$ with $\rho(g,r,d) < 0$ the general curve $C_b$ has a $g^r_d$, and deduced that the special fiber $C_0$ has a rank 1 torsion-free sheaf $\cL_0$ of degree $d$ with at least $r+1$ sections; we now have to derive from this a contradiction.
%
%To see most clearly where this contradiction comes from, let's start with the simplest case: where $\cL_0$ is indeed locally free. In this case, let $\nu :  C^\nu \cong \PP^1 \to C$ be the normalization of $C$ and let $q_1,\dots, q_g \in \PP^1$ be the points lying over the cusps of $C_0$. We have
%$$
%\nu^*(\cL) \cong \cO_{\PP^1}(d)
%$$  
%and 
%$$
%V = \nu^*(H^0(\cL_0)) \subset H^0(\cO_{\PP^1}(d))
%$$
%is an $(r+1)$-dimensional space of sections. (If $H^0(\cL_0) > r+1$, just choose any $(r+1)$-dimensional subspace.) 
%
%Now, given that any section $\sigma \in V \subset H^0(\cO_{\PP^1}(d))$ is pulled back from the cuspidal curve $C$, we see that \emph{$\sigma$ cannot vanish to order exactly 1 at the point $q_i \in \PP^1$ lying over any of the cusps of $C_0$}. It follows that for each $i$ the ramification index 
%$$
%\alpha_1(V,q_i) \geq 1 
%$$
%and hence in  general $\alpha_1(q_i,V) \geq 1$ for all $i \geq 1$. In particular, the weight of the inflection point $q_i$ for the linear series $V$ satisfies
%$$
%w(V, q_i) \geq r
%$$
%and correspondingly
%$$
%\sum_{i=1}^g w(V, q_i) \geq rg
%$$
%But the Pl\"ucker formula~\ref{} tells us that the total weight of all inflection points for the series $V$ is
%$$
%\sum_{p \in \PP^1} w(V,p) = (r+1)(d-r)
%$$
%and there's our contradiction: by the hypothesis that 
%$$
%\rho(g,r,d) := g - (r+1)(g-d+r) < 0
%$$
%we have $rg > (r+1)(d-r)$.
%
%Finally, the case where $\cL_0$ is not locally free is if anything even easier. Suppose now that the sheaf $\cL$ fails to be locally free at $l$ of the cusps of $C_0$, say $\nu(p_1),\dots,\nu(p_l)$. Again, we can pull $\cL$ back to $\PP^1$; again we have
%$$
%\nu^*(\cL_0) \cong \cO_{\PP^1}(d);
%$$  
%and again we pull back section of $\cL$ to arrive at a linear system
%$$
%V = \nu^*(H^0(\cL_0)) \subset H^0(\cO_{\PP^1}(d))
%$$
%of degree $d$ and genus $g$ on $\PP^1$. The only difference here is that sections of $V$ all vanish at $p_1,\dots,p_l$, so that we have
%$$
%w(V,p_k) \geq 
%\begin{cases}
%r+1 &\text{ if } k \leq l; \text{ and} \\
%r  &\text{ if } k > l.
%\end{cases}
%$$
%so that
%$$
%\sum_{k=1}^g w(V, p_k) \geq rg + l
%$$
%and our contradiction is even more of a contradiction!

\section{Corollaries and extensions of our proof}

 In the final section of this chapter, we'll see how we can deduce stronger forms of Brill-Noether using the ideas above.

\subsection{Brill-Noether with inflection}

\fix{this section is clearly left over from when Joe hoped to smooth cusps directly;
and the level of breeziness is pretty high. needs to be fixed to get rid of this anachronism; and possibly some of it should be ``factified"}

An easy modification of the argument above tells us something about the inflection points of linear series on a general curve $C$. We start with a definition.

\begin{definition}
Let $C$ be a smooth curve of genus $g$ and $p_1,\dots,p_n \in C$ distinct points of $C$. If $\cD = (L,V)$ is a linear system on $C$ of degree $d$ and dimension $r$, we define the \emph{adjusted Brill-Noether number} of $\cD$ relative to the points $p_k$ to be
$$
\rho(\cD; p_1,\dots,p_k) := g - (r+1)(g-d+r) - \sum_{k=1}^n w(\cD,p_k).
$$
\end{definition}

\begin{theorem}\label{Brill-Noether with inflection}
Let $(C;p_1,\dots,p_n)$ be a general $n$-pointed curve of genus $g$ (that is, let $C$ be a general curve and $p_1,\dots,p_n \in C$ general points; equivalently, let $(C;p_1,\dots,p_n)$ correspond to a general point of $M_{g,n}$). If $\cD$ is any linear system on $C$, then
$$
\rho(\cD; p_1,\dots,p_k) \geq 0.
$$
\end{theorem}

\begin{proof}
To start, let $\cC \to B$ be a family of curves as in the proof of Lemma~\ref{cusp smoothing lemma}. Let $\sigma_1, \dots, \sigma_n : B \to \cC$ be sections of $\cC \to B$ with $\sigma_k(0)$ a smooth point of $C_0$ for all $k$ (such sections can always be found after passing to an \'etale open neighborhood of $0 \in B$). Exactly as in the proof of Lemma~\ref{BN in family}, if the general curve $C_b$ in our family admits a $g^r_d$ $\cD$ with
$$
\rho(\cD;\sigma_1(b),\dots,\sigma_n(b)) < 0
$$
we can choose a family $\{\cD_b\}$ of such linear series on the fibers $C_b$ for $b \neq 0$ and, taking limits, we arrive at a $g^r_d$ $\cD_0$ on $\PP^1$ with
$$
w(\cD_0, q_i) \geq r
$$
for each of the $g$ points $q_i \in \PP^1$ lying over the cusps of $C_0$, and in addition
$$
w(\cD_0, r_k) \geq w(\cD_b,\sigma_k(b))
$$
where $r_k \in \PP^1$ is the point in $\PP^1$ lying over $\sigma_k(0) \in C_0$. Adding up, we have
\begin{align*}
\sum_{i=1}^g w(\cD_0, q_i) + \sum_{k=1}^n w(\cD_0, r_i) &\geq rg + \sum_{k=1}^n w(\cD_b,\sigma_k(b)) \\
&> rg + g - (r+1)(g-d+r) = (r+1)(d-r)
\end{align*}
since we assumed that 
$$
\rho(\cD_b;\sigma_1(b),\dots,\sigma_n(b)) = g - (r+1)(g-d+r) - \sum_{k=1}^n w(\cD_b,\sigma_k(b)) < 0.
$$
But as before the Pl\"ucker formula for $\PP^1$ tells us that
$$
\sum_{p \in \PP^1} w(\cD_0, p) = (r+1)(d-r),
$$
a contradiction.
\end{proof}

\subsection{Brill-Noether with dimension}

Theorem~\ref{Brill-Noether with inflection} might at first glance seem relevant only to problems involving inflection, but in fact in can be used to prove results that have nothing to do with inflection points. For example, one consequence is the stronger form of Brill-Noether:

\begin{theorem}\label{BN with dimension}
If $C$ is a general curve of genus $g$, then for any $d$ and $r$ with $\rho(g,r,d) \geq 0$,
$$
\dim W^r_d(C) = \rho(g,r,d).
$$
\end{theorem}

\begin{proof}
The basic idea of the proof is simple: basically, we argue that if we had a $(\rho+1)$-dimensional family of $g^r_ds$ on $C$, then we could find one with nonzero ramification at $\rho+1$ general points of $C$, violating Theorem~\ref{Brill-Noether with inflection}. \fix{the equality needs this AND the other inequality, which
comes from the determinantal codimension argument}

This idea is easier to implement after specializing, so once more we go back to our family $\cC \to B$ of smooth curves specializing to a $g$-cuspidal curve $C_0$, with normalization $\PP^1$. The basic lemma is:

\begin{lemma}\label{forced ramification}
Let $\Sigma$ be a complete curve and let $\{ \cD_\lambda \}_{\lambda \in \Sigma}$ be a (nonconstant) family of $g^r_ds$ on $\PP^1$ parametrized by $\Sigma$. If $p \in \PP^1$ is any fixed point, then for at least one $\lambda \in \Sigma$ we have $w(\cD_\lambda,p)>0$.
\end{lemma}

\begin{proof}
Embed $\PP^1$ in $\PP^d$ as a rational normal curve of degree $d$. Given a $(d-r-1)$-plane $\Lambda \subset \PP^d$, the hyperplanes in $\PP^d$ containing $\Lambda$ cut out a $g^r_d$ $\cD_\Lambda$ on $\PP^1$, and indeed every $g^r_d$ on $\PP^1$ can be described in this way for a unique $\Lambda$. The $g^r_d$s on $\PP^1$ are thus parametrized by the Grassmannian $\GG(d-r-1,d)$, and we can think of $\Sigma$ as a complete curve in $\GG(d-r-1,d)$.

Consider now the hyperplanes $H \subset \PP^d$ such that the divisor $H \cap \PP^1$ has multiplicity $\geq r+1$ at $p$. These correspond to points in a linear space of codimension $r+1$ in $(\PP^d)^*$; in particular, their intersection is an $r$-plane $\Omega \subset \PP^d$, called the \emph{osculating plane} to the rational normal curve at $p$. The condition that a  $g^r_d$ $\cD_\Lambda$ have non-zero ramification at $p$---in other words, that $\cD_\Lambda$ contains a divisor with multiplicity $\geq r+1$ at $p$---is simply that $\Lambda \cap \Omega \neq \emptyset$. But the set of such $\Lambda$ is a hyperplane section of $\GG(d-r-1,d)$ under trhe Pl\"ucker embedding; in particular, any complete curve $\Sigma \subset \GG(d-r-1,d)$ must intersect it.
\end{proof}

Given this lemma, the proof of Theorem~\ref{BN with dimension} proceeds as follows. We know from the basic dimension estimates of Chapter~\ref{} that $\dim W^r_d(C) \geq \rho(g,r,d)$ for any $C$ \fix{this needs the existence theorem}; we have to show that we cannot have $\dim W^r_d(C) > \rho(g,r,d)$ for a general curve $C$. We argue as follows:

First: if it were the case that $\dim W^r_d(C) > \rho(g,r,d)$ for a general curve $C$, we would have, after specializing and pulling back to $\PP^1$, at least a $(\rho + 1)$-dimensional family of $g^r_d$s on $\PP^1$, all of which had ramification weight at least $r$ at the points $q_i$ of $\PP^1$ lying over the cusps of $C_0$. 

Secondly, we pick any $\rho + 1$ points $r_k \in \PP^1$ other than the $q_i$. Applying Lemma~\ref{forced ramification} repeatedly, we find that there is at least a $\rho$-dimensional subfamily of $g^r_d$s having nonzero ramification at $p_1$, a $(\rho - 1)$-dimensional subfamily of $g^r_d$s having nonzero ramification at $p_1$ and $p_2$, and so on; ultimately, we conclude that there is a $g^r_d$ $\cD$ on $\PP^1$ with ramification index at least $r$ at each $q_i$ and nonzero ramification index at each $r_k$. 

Finally, we observe that the linear series $\cD$ has total ramification at least
$$
rg + \rho + 1 = (r+1)(d-r)+1
$$
at the points $q_i$ and $r_k$, once more violating the Pl\"ucker formula.
\end{proof}

We can combine Theorem~\ref{BN with dimension} and Theorem~\ref{Brill-Noether with inflection} into one theorem, more complicated but more inclusive:

\begin{theorem}\label{BN with inflection and dimension}
Let $C$ be a smooth curve of genus $g$ and $p_1,\dots,p_n \in C$ distinct points; for $k = 1,\dots,n$ let $\alpha^k = (\alpha^k_0,\dots\alpha^k_r)$ be a nondecreasing sequence of nonnegative integers, and let
$$
G^r_d(p_1,\dots,p_n; \alpha^1,\dots,\alpha^n) = \{\cD \in G^r_d(D) \mid \alpha_i(\cD, p_k) \geq \alpha^k_i \}.
$$
If $(C, p_1,\dots,p_n)$ is a general $n$-pointed curve, then either $G^r_d(p_1,\dots,p_n; \alpha^1,\dots,\alpha^n)$ is empty or
$$
\dim G^r_d(p_1,\dots,p_n; \alpha^1,\dots,\alpha^n) = \rho(g,r,d) - \sum_{k+1}^n \sum_{i=0}^r \alpha^k_i.
$$
\end{theorem}

Finally, we can combine this last theorem with a little dimension-counting to deduce a simple fact:

\begin{theorem}
If $\cD$ is a general $g^r_d$ on a general curve, then $\cD$ has only simple ramification; that is,
$$
w(\cD, p) \leq 1 \quad \text{for all } p \in C.
$$
\end{theorem}

Note that applying this in case $d=2g-2$ and $r = g-1$, we arrive at the statement made earlier: that a general curve $C$ of genus $g$ has only normal Weierstrass points!

\input{footer}