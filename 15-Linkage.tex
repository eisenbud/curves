\input{header}

\chapter{Linkage and the canonical sheaves of singular curves}
\label{LiaisonChapter}\label{linkageChapter}\label{LinkageChapter}


\section{Introduction} 
The ideal of each curve $C$ in the plane is generated by one equation. Its homogeneous coordinate ring
is therefore Cohen-Macaulay \cite[****]{Eisenbud1995}, so we say that the curve is arithmetically Cohen-Macaulay, 
which implies that 
$$
H^1_*(\sI_C) := \bigoplus_{m\in \ZZ}H^1(\sI_C(m)) = 0,
$$
 and its degree determines its (arithmetic) genus. In $\PP^3$ the simplest ideals of curves are
complete intersections, generated by two equations; again these are arithmetically Cohen-Macaulay, and again the genus is determined by the degrees of the equations.
 Next simplest, perhaps
is a curve $C$ that is \emph{directly linked} to a complete intersection, which means roughly that its union $X = C\cup D$
with a complete intersection
curve $D$ is again a complete intersection (the precise definition is given below). We will see that such a curve $C$ is arithmetically Cohen-Macaulay,
and its genus is determined by the degrees of the equations of $X$ and $D$. 

In the first sections of this chapter we will examine the equivalence relation on curves in $\PP^3$ that is defined by linkage. Much of the story extends to the case of singular curves, and the second part of this chapter is devoted to this extension, and to a more general version of the Riemann-Roch theorem. We also complete the description of the canonical module on a smooth curve
in terms of a plane model.

Allowing sequences of direct links we define an equivalence relation called  \emph{linkage} or \emph{liaison}, 
and curves in the linkage class of a complete intersection are often said to be ``licci." 
A famous theorem of Hartshorne and Rao \cite{MR520926} shows that the linkage class of a curve $C\subset \PP^3$
is defined by the finite dimensional graded module $H^1_*(\sI_C)$,
and the correspondence is quite constructive: from a finite-dimensional graded module one can
actually construct curves.

Aside from providing a striking classification result, linkage is quite useful in analyzing Hilbert schemes. We will exploit this systematically in cases of low degree and genera in Chapters~\ref{HilberSchemes1} and \ref{HilbertSchemes2}, and we begin
this chapter with what is perhaps the simplest example, computing the dimension of the component of
the Hilbert scheme $Hilb_{3m+1}(\PP^3)$ that is the closure of the open subset $\cH^0$  parametrizing twisted cubics (see Proposition~\ref{hilb of twisted cubics} for another proof).

Let $C\subset \PP^3$ be a twisted cubic. As we saw already in Chapter~\ref{linear series chapter} the ideal of $C$
is minimally generated by the three $2\times 2$ minors of the matrix
$$
\begin{pmatrix}
 x_0&x_1&x_2\\
 x_1&x_2&x_3
\end{pmatrix}\,.
$$
The minor $Q_{1,2}$ involving the first two columns and the minor $Q_{2,3}$ involving the last two columns clearly
both vanish on the line $L: x_1 = x_2 = 0$, which meets the twisted cubic in the two points corresponding to the
vanishing of the linear forms in the first row and in the second row, respectively -- that is, it is a secant line to $C$. 
A general linear combination $Q$ of these two minors defines a smooth quadric, which is thus isomorphic to $\PP^1\times \PP^1$. The curve $C$ necessarily lies in the divisor class $(1,2)$ (or, symmetrically, $(2,1)$), and the line in class $(1,0)$, summing to the 
complete intersection $(2,2)$ of Q with (say) $Q_{1,2}$
 
 This suggests that we set up an incidence correspondence between twisted cubics and their secant lines. Let $\PP^9$ denote the projective space of quadrics in $\PP^3$, and consider
$$
\Phi = \{ (C, L, Q, Q') \in \cH^\circ \times \GG(1,3) \times \PP^9 \times \PP^9 \; \mid \; Q \cap Q' = C \cup L \}.
$$

We'll analyze $\Phi$ by considering the projection maps to $\cH^\circ$ and $\GG(1,3)$; that is, by looking at the diagram
\begin{diagram}[small]
& &  \Phi & & \\
& \ldTo^{\pi_1} & & \rdTo^{\pi_2} & \\
\cH^\circ & & & & \GG(1,3)
\end{diagram}

Consider first the projection map $\pi_2 : \Phi \to \GG(1,3)$ on the second factor. By what we just said, the fiber over any point $L \in \GG(1,3)$ is an open subset of $\PP^6 \times \PP^6$, where $\PP^6$ is the space of quadrics containing $L$; it follows that $\Phi$ is irreducible of dimension $4 + 2\times 6 = 16$. Going down the other side, we see that the map $\pi_1 : \Phi \to \cH^\circ$ is surjective, with fiber over every curve $C$ an open subset of $\PP^2 \times \PP^2$, where $\PP^{2}$ is the projective space of quadrics containing $C$; we conclude that $\cH^\circ$ is irreducible of dimension 12, in accord with our previous
computation of the space of twisted cubics as $PGL(4,\CC)/\PGL(2,\CC)$.


\section{Linkage of smooth curves in $\PP^3$}\label{SLinkage}\label{linkage section}

If the union of two smooth curves in $\PP^3$ is a complete intersection of surfaces, then the degrees and genera
of the curves are related. The relation is true much more generally, as we shall see in the next section, but the special
case is already useful and attractive:

\begin{theorem}\label{liaison genus formula-first version} Let $C, {C_2}\subset \PP^3$ be distinct smooth irreducible curves of  of degrees $c,d$ whose union is the complete intersections of two surfaces $S,T$, with $S$ smooth. If the degrees of $S,T$ are $s,t$ respectively, then
$$
\begin{aligned}
&\deg C_1+\deg C_2 = st\\
&g(C_1) - g({C_2}) = \frac{s+t-4}{2}(\deg C_1-\deg {C_2}).
\end{aligned}
 $$
\end{theorem}
In words, the difference between the genera of $C_1$ and ${C_2}$ is proportional to the difference in their degrees, with constant of proportionality $(s+t-4)/2$. Note that in the case of the complete intersection of two quadrics, the multiplier $(s+t-4)/2 = 0$, and indeed the line and the twisted cubic have the same genus.

\begin{proof}
B\'ezout's Theorem implies that the degree of $S\cap T = C_1\cup C_2$ is $st$, whence the first formula.

By the adjunction formula in $\PP^3$ the canonical divisor of $S$ has class $K_S = (s-4)H$. Thus, from the 
adjunction formula on the surface $S$ we get
$$
g(C_i) = \frac{C_i^2+C_i\cdot K_S}{2}+1 = \frac{C_i^2+(s-4) \deg C_i}{2}+1.
$$
Subtracting, we get
$$
g(C_1)-g(C_2) = \frac{C_1^2-C_2^2+(s-4) (\deg C_1-\deg C_2)} {2}.
$$
Because $C_1+C_2$ is in the class $tH$ on $S$ we have
$$
C_1^2-C_2^2 = (C_1-C_2)(C_1+C_2) = t(\deg C_1-\deg C_2)
$$
and substituting this into the previous formula we get the second formula of the theorem.
\end{proof}

\begin{remark}
Linkage is closely related to linear equivalence; here is a special case:
Suppose that $S$ is a smooth surface in $\PP^3$, and $C\subset S$ is a curve. If $T$ is a sufficiently general surface of degree $t$
containing $C$ then the curve $C'$ that is the link of $C$ with respect to $S,T$ lies in the class $tH-C$. If we link again with
respect to an other surface $T'$ of degree $t'$ we thus arrive at $C'' = C+(t-t')H$. Thus if $t=t'$ we get a curve in the same 
linear equivalence class as $C$. Moreover, since every rational function on $S$ is the restriction to $S$ of the ratio of two forms of the same degree on $\PP^3$,
the set of curves on $S$ that can be obtained from $C$ by two linkages with surfaces $T, T'$ of the same degree is exactly the 
linear series $|C|$ on $S$.
\end{remark}

\section{Linkage of purely 1-dimensional schemes in $\PP^3$}
To say that the union of distinct smooth irreducible curves $C, C'$  is a complete intersection $X$ means that 
the ideal $I_X$ of the complete intersection is the intersection $I_C\cap I_{C'}$. Since this ideal contains $I_CI_{C'}$, the ideal quotient
$(I_X:I_C) := \{F \mid FI_C\subset I_X\}$
contains $I_{C'}$. On the other hand, if $F \notin I_{C'}$ and we choose $G\in I_C\setminus I_{C'}$, then $FG\notin I_{C'}$, so in fact
$(I_X:I_C) = I_{C'}$. It turns out that this relationship is the key to the formulas connecting the degrees and genera of $C,C'$, which hold 
for arbitrary purely 1-dimensional subschemes of $\PP^3$, as we shall see in Theorem~\ref{direct linkage}. This suggests the definition
of direct linkage for such subschemes:

\begin{definition}
Let $C,C'$ be purely 1-dimensional subschemes of $\PP^3$. We say that $C'$ is \emph{directly linked} to $C$ if there is a complete
intersection $X$ containing $C,C'$ and $(I_X:I_C) = I_{C'}$. We say that $C'$ is \emph{linked} to $C$ if they are connected by a chain of such
direct linkages, and we say that $C'$ is \emph{evenly linked} to $C$ if the chain involves an even number of steps.
\end{definition}

As in the smooth case treated above, direct linkage is a symmetric relationship:
\begin{proposition}
Let $C_1\subset \PP^3$ be a purely 1-dimensional subscheme with saturated homogeneous ideal $I_1$ and suppose that $C_1$ is contained in a complete intersection of
hypersurfaces $S\cap T$. The ideal $I_2 = (I_{S\cap T}:I_1)$ is a saturated ideal, defining a purely 1-dimensional subscheme and 
$I_1 = (I_{S\cap T}: I_2)$ as well.
\end{proposition}
 
\begin{proof}
Since $S\cap T$ is a complete intersection, the ideal $I_{S\cap T}$ is unmixed of codimension 2, and it follows
that $I_2 = (I_{S\cap T}:I_1)$ is unmixed of codimension 2 as well (and thus, in particular, saturated).
Thus it suffices to prove that $I_1 = (I_{S\cap T}: I_2)$ after localizing at a codimension 2 prime $P$
that contains $I_{S\cap T}$. 

Write $R$ for the localization at $P$ of the homogeneous coordinate ring of $S\cap T$. 
Because $I_{S\cap T}$ is a complete intersection, the ring $R$ is
 is zero-dimensional and Gorenstein.
By \cite[***]{Eisenbud1995}, every finitely generated $R$-module is reflexive. Since 
$$
I_{C_2}R= \ann_{R}(I_{C_1}R) \cong Hom_R(R/I_{C_1}R, R)
$$
the proposition follows.
\end{proof}

Iterating direct links we thus define the equivalence relation of \emph{linkage} among purely 1-dimensional subschemes
of $\PP^3$.

\section{Examples I: Ropes}

To give an example of a linkage involving non-reduced curves (and one where the supports of the two linked curves have a common component), we introduce a very basic example of a non-reduced curve.

\begin{definition}
A \emph{rope} $C \subset \PP^3$ is the scheme $V(I^2_L)$ defined by the square of the ideal of a line $L \subset \PP^3$.
\end{definition}

The basic properties of ropes are straightforward; we'll go through them here. 

\begin{proposition}
The Hilbert function $h_C(m)$ and Hilbert polynomial $p_C(m)$ are both equal to $3m+1$.
\end{proposition}

\begin{proof}
This is readily seen in coordinates: if $L=V(X_0, X_1)$, then the $m$th graded piece $I(C)_m$ of the ideal of $C$ is spanned by the collection of monomials $X_0^{\alpha_0}X_1^{\alpha_1}X_2^{\alpha_2}X_3^{\alpha_3}$ with $\alpha_0 + \alpha_1 \geq 2$; the quotient accordingly has basis
$$
X_2^m, X_2^{m-1}X_3,\dots, X_3^m, 
$$
$$
X_0X_2^{m-1}, X_0X_2^{m-2}X_3, \dots, X_0X_3^{m-1}
$$
and 
$$
X_1X_2^{m-1}, X_1X_2^{m-2}X_3, \dots, X_1X_3^{m-1}.
$$
Counting, we see that the dimension of the quotient---the value $h_C(m)$---is $3m+1$.
\end{proof}

\begin{corollary}
A rope has degree 3 and arithmetic genus 0.
\end{corollary}

(For the degree, we could have simply observed that a general plane section of a rope is a ``fat point," that is, the scheme of $\PP^1$ defined by the square of the ideal of a point.)

So far, a rope sounds very much like a twisted cubic, and indeed we can realize a rope as the flat limit of a family of twisted cubics. Again, this is readily done in coordinates: if $X \subset \PP^3$ is a twisted cubic, let $[X_0,\dots,X_3]$ be a general choice of homogeneous coordinates on $\PP^3$, and consider the one-parameter subgroup of $PGL_4$ given by
$$
A_t : [X_0,\dots,X_3] \mapsto [tX_0, tX_1, X_2,X_3];
$$
we leave it as an exercise to see that the flat limit of the twisted cubics $A_t(C)$ is the rope $V(X_0^2, X_0X_1,X_1^2)$.

One basic fact about twisted cubics $X \subset \PP^3$ is that any two quadrics containing $X$ intersect in the union of $X$ and a line---in other words, a twisted cubic is directly linked to a line. In the latter form, the same assertion is true for ropes: we have the

\begin{proposition}
If $C = V(I_L^2)$ is the rope with support $L$, and $Q_1, Q_2$ are two quadrics containing $C$ and having no common component, then $C$ is directly linked to $L$ in the complete intersection $V(Q_1,Q_2)$.
\end{proposition}

We leave the proof as an exercise.

\section{Degree and genus of linked curves}

The degrees and (arithmetic) genera 
of directly linked schemes are related exactly as in the simple case above:

\begin{theorem}\label{direct linkage}\label{linked genus formula}
If $C_1,{C_2}\subset \PP^3$ are purely 1-dimensional schemes that are directly linked by surfaces $S,T$ of degrees $s,t$  then 
$$
\begin{aligned}
&\deg C_1+\deg C_2 = st\\
&p_a(C_1) - p_a({C_2}) = \frac{s+t-4}{2}(\deg C_1-\deg {C_2}).
\end{aligned}
 $$
\end{theorem}

Since we have left the realm of smooth curves and surfaces, we will need a more sophisticated duality theory, and we
postpone the proof to explain the necessary ideas.



\section{Dualizing sheaves and the Riemann-Roch theorem for singular curves }\label{duality}

Recall that in Chapter~\ref{RR} we claimed that the canonical sheaf of a smooth curve---the sheaf of differential forms---was ``the most important invertible sheaf'' after the structure sheaf. In the general setting of Cohen-Macaulay schemes, the analogue of the canonical sheaf is called the dualizing sheaf.
The general definition of the dualizing sheaf is not very illuminating; what is useful is how it is constructed and its cohomological properties relating to duality.
However, having a definition may be comforting. 

\begin{definition}
Let $X$ be a projective scheme over of pure dimension $d$ over $\CC$. The \emph{dualizing sheaf} for $X$ is a coherent sheaf $\omega_X$ 
with a map $\eta: H^d(\omega_X) \to \CC$ such that for every coherent sheaf  $\sF$ the compositive map
$$
H^d(\sF) \times \Hom(\sF, \omega_X) \to H^d(\omega_X) \rTo^\eta \CC
$$
is a perfect pairing. 
\end{definition}

\begin{fact}
If $X$ is locally Cohen-Macaulay then more generally
$$
H^a(\sF) \times \Ext^{d-a}(\sF, \omega_X) \to H^d(\omega_X) \rTo^\eta \CC
$$
is a perfect pairing for all $a$. (In the non-Cohen-Macaulay case a similar result is true if we replace $\omega_X$ by a dualizing complex
and work in the derived category.) 
\end{fact}

One can construct the dualizing sheaf on a scheme
$X$ by comparing it with any scheme $Y$ whose dualizing sheaf is known, in the following sense:
\begin{fact} \label{construction of dualizing sheaf}\label{omega}\label{general adjunction}
Suppose that $f: X\to Y$ is a finite morphism between projective schemes $X,Y$ of pure dimensions $d,e$. If $Y$ has a dualizing sheaf $\omega_Y$,
then $\omega := \sExt_Y^{e-d}(f_*\sO_X,  \omega_Y)$, regarded as a sheaf on $X$, is a dualizing sheaf for $X$ in a way compatible with the residue maps.
Moreover, if $Y$ is smooth, then $X$ is Cohen-Macaulay if and only if $ \sExt_Y^{e-d}(f_*\sO_X,  \omega_Y)= 0$ for all $m\neq e-d$.
\end{fact}

Like the canonical sheaves on smooth curves, any two dualizing sheaves on  $X$ are isomorphic in a way compatible with the
residue maps. If $X$ is smooth then the top degree differential forms $\omega_X :=\wedge^d(\Omega_X)$,
together with the classical residue (see for example~\cite[p. 648, 708]{Griffiths-Harris1978}), is a dualizing sheaf, as implied by Serre duality. 

See Exercises \ref{codimension0} and \ref{codimension1} for a comparison of this general result with some
familiar cases, and see for example \cite{AltmanKleiman} for a thorough exposition.

Several similarities to the smooth case are consequences:

\begin{proposition}\label{similarities}
If $C$ is a purely 1-dimensional projective scheme over $\CC$, then:
\begin{enumerate}

\item $\sHom_C(\omega_C, \omega_C) = \sO_C$, and  thus if $C$ is integral then the generic rank of $\omega_C$ is 1.

\item For any invertible sheaf $\sL$, 
$h^0(\omega_C\otimes_C\sL ) = h^1(\sL)$ and
$h^1(\omega_C\otimes_C\sL)= h^0(\sL).$
and thus
$$
\chi(\omega_C\otimes_C\sL)= -\chi(\sL^{-1}).
$$

\item $\deg \omega_C = 2p_a(C) -2.$

\end{enumerate}
\end{proposition}

\begin{proof}
\noindent{\bf 1:} We claim that the natural map $\sO_C \to \sHom_C(\omega_C, \omega_C)$ is an isomorphism. Choose a Noether
normalization of $C$, that is, a finite map $C\to \PP^1$.
By Theorem~\ref{general adjunction} $\omega_C \cong \sO_C^\vee := \sHom_{\PP^1}(\sO_C,\sO_{\PP^1}(-2)).$
Now
$$
\begin{aligned}
\sHom_{C}(\sO_C^\vee,\sO_C^\vee ) &=\sHom_{C}(\sO_C^\vee, \sHom_{\PP^1}(\sO_C^\vee,\sO_{\PP^1}(-2)))\\
&= \sHom_{\PP^1}(\sO_C^\vee, \sO_{\PP^1}(-2)))\\
&= (\sO_C^\vee)^\vee.
\end{aligned}
$$

Since $C$ is unmixed it is locally Cohen-Macaulay so, by the Auslander-Buchsbaum formula, 
$\sO_C$ is locally free as an $\sO_{\PP^1}$-module.
Thus the natural map $\sO_C \to (\sO_C^\vee)^\vee$ is an isomorphism, proving first equality in the Proposition.
This implies in particular that if $C$ is integral then $\omega_C$ is generically isomorphic to $\sO_C$.

\noindent{\bf 2:} The duality property of $\omega_C$ shows that, if $\sL$ is an invertible sheaf, then
$$
\begin{aligned}
h^1(\omega_C \otimes_{\cO_C} \sL) &= h^0(\Hom_C(\omega_C\otimes_{\cO_C} \sL, \omega_C))\\
&= h^0(\Hom_C(\sL, \sHom(\omega_C,\omega_C))\\
&=h^0 (\sHom(\sL, \sO_C)\\
&= h^0(\sL^{-1}).
\end{aligned}
$$
Also
$$
\begin{aligned}
h^0(\omega_C\otimes_C\sL) &= h^0 \bigl(Hom_C(\sO_C, \omega_C\otimes_C\sL)\bigr)\\
&=h^0 \bigl(Hom_C(\sO_C\otimes_C\sL^{-1}, \omega_C)\bigr)\\
&=H^1 (\sL^{-1}). 
\end{aligned}
$$

\noindent{\bf 3:} By definition, $p_a(C) = 1-\chi(\sO_C)$, and 
 $\deg \omega_C = \chi(\omega_C) - \chi(\sO_C),$
 so by what we have proven above
 $\deg \omega_C = -2\chi(\sO_C) = 2p_a(C)-2.$
 \end{proof}


\subsection{Proof of Theorem~\ref{direct linkage}}

\begin{proof}
 Let $X$ be the complete intersection of surfaces of degrees $s,t$ containing $C$, and let $S_X = S/(F,G)$ be its homogeneous coordinate ring, where
$S = \CC[x_0,\dots,x_3]$ is the homogeneous coordinate ring of $\PP^3$.
From the free resolution
$$
0\rTo S(-s-t) \rTo^{
\begin{pmatrix}
 G \\ -F
\end{pmatrix}}
 S(-s)\oplus S(-t) \rTo^{
\begin{pmatrix}
 F & G
\end{pmatrix}}
 S \rTo S/(F,G) \rTo 0
$$
 and Theorem~\ref{omega} we see that
 $$
\omega_X =  \sExt^2_C(\sO_X, \omega_{\PP^3}) =\sExt^2(\sO_X, \sO_{\PP^3}(-4)) = \sO_X(s+b-4).
 $$
Note that for any ideals $J\subset I$ in a ring $A$ we have $Hom_A(A/I, A/J) \cong (J:I)/J$, where the isomorphism
sends a homomorphism $\phi$ to the element $\phi(1)$. Again from Theorem~\ref{omega} we have 
$$
\omega_C = \Hom_X(\sO_C, \omega_X) = \Hom_X(\sO_C, \sO_X)(s+t-4) = \frac{\sI_X:\sI_C}{\sI_X}(s+t-4),
$$
where we have identified $\sO_C$ with its pushforward under the inclusion map $C\to X$. 

Since $C$ is purely 1-dimensional it is Cohen-Macaulay, so
$\chi(\omega_C(m)) = -\chi(\sO_C(-m))$. It follows that the degree of $\omega_C$, which is the leading coefficient of the Hilbert polynomial of $\omega_C$, is 
equal to $\deg C$, and 
$$
st = \deg \sO_X =\deg \sO_{C'}+\deg \omega_C = \deg \sO_{C'}+\deg \sO_C
$$
as required by the formula for the sum of the degrees.

From Theorem~\ref{omega} we see that $\chi(\sO_X) = st(4-s-t)/2$. Since $\sO_{C'} = \sO_{\PP^3}/(\sI_X : \sI_C)$ and
$(\sI_X : \sI_C)/(\sI_X) = \omega_C(4-s-t)$ we have
$$
\begin{aligned}
-\frac{(s+t-4)}{2} (\deg C +& \deg C') \\&= -\frac{(s+t-4)}{2}st \\
&= \chi(\sO_X) \\&=  \chi(\sO_{C'})+\chi(\omega_C(4-s-t)) \\&= \chi(\sO_{C'})-\chi(\sO_C(s+t-4)) \\&= \chi(\sO_{C'})-(s+t-4)\deg C-\chi(\sO_C)
\\&= (1-p_a(\sO_{C'})) - (1-p_a(\sO_C) -(s+t-4)\deg C,
\end{aligned}
$$
whence 
$$
p_a(\sO_C) -p_a(\sO_{C'} = \frac{(s+t-4)}{2} (\deg C - \deg C'). 
$$
 \end{proof}

Linkage behaves in a simple way with respect to deficiency modules:

\begin{theorem}\label{HR}
If $C,C'$ are purely 1-dimensional subschemes of $\PP^3$ that are directly linked by a complete intersection of degrees $s,t$ then
$$
D(C') = Hom_\CC(D(C), \CC) (-s-t+4).
$$ 
as graded modules over the homogeneous coordinate ring of $\PP^3$.
\end{theorem}

\begin{proof}
Suppose that the homogeneous ideal of $C$ is generated by forms of degree $a_i, i=1,\dots,s$. Since $C$ is locally Cohen-Macaulay,
the local rings $\sO_{C,p}$ have projective dimension 2 as modules over $\sO_{\PP^3, p}$, and $\sI_{C,p}$ has projective dimension 1.
Thus we have an exact sequence
$$
0\to \sE \to \oplus_i\sO_{\PP^3}(-a_i) \to \sI_C \to 0.
$$
Since the first and second cohomology groups of the twists of $\sO_{\PP^3}$ vanish, we deduce an isomorphism
$$
D(C) := \oplus_{m\in \ZZ} H^1(\sI_C(m)) \cong \oplus_{m\in \ZZ} H^2(\sE(m)).
$$

Let $X$ be the complete intersection of two hypersurfaces, of degrees $s,t$, containing $C$. From the inclusion we deduce a
map of resolutions
$$
\begin{diagram}[small]
0&\rTo& \sE &\rTo& \oplus_i\sO_{\PP^3}(-a_i)                                         &\rTo&\sO_{\PP^3}&\rTo &\sO_C &\rTo& 0\\
&&\uTo&&\uTo&&\uTo&&\uTo\\
0&\rTo& \sO_{\PP^3}(-s-t) &\rTo& \sO_{\PP^3}(-s)\oplus \sO_{\PP^3}(-t) &\rTo& \sO_{\PP^3}&\rTo& \sO_X &\rTo& 0\\
\end{diagram}
$$
We dualize this diagram, form the mapping cone, and twist by $-s-t$. Note that $\Hom_{\PP^3}(\sO_C, \sO_{\PP^3}) = 0$. 
Also, since the vertical map $\sO_{\PP^3}\to \sO_{\PP^3}$ on the right
is an isomorphism we may cancel these terms. Noting that $\omega_C = \Ext^2(\sO_C, \sO_{\PP^3}(-4))$ we get the diagram with 
exact rows:
$$
\begin{diagram}[small]
 0&\lTo&\omega_C(-s-t+4)&\lTo&\sE^*(-s-t) &\lTo&  \oplus_i\sO_{\PP^3}(a_i-s-t)&\lTo&  0\\
 &&\dTo^\phi&&\dTo&&\dTo\\
 0&\lTo&\sO_X&\lTo&\sO_{\PP^3} &\lTo& \sO_{\PP^3}(-t)\oplus \sO_{\PP^3}(-s) &\lTo&0\\
 &&\dTo\\
 &&\sO_{C'}\\
 &&\dTo\\
 && 0
\end{diagram}.
$$
Here the column on the left is an exact sequence because $(\sI_X:\sI_C)/\sI_X \cong \omega_C(-s-t+4)$, as explained above.
We can now write a resolution of $\sI_{C'}$ by taking the mapping cone:
$$
\begin{diagram}
0\leftarrow \sI_{C'} \leftarrow \sO_{\PP^3}(-t)\oplus \sO_{\PP^3}(-s) \oplus \sE^*(-s-t) \leftarrow \oplus_i\sO_{\PP^3}(a_i-s-t)\leftarrow  0
\end{diagram}
$$
From this we see that 
$$
H^1(\sI_{C'}(m) \cong H^1(\sE^*(-s-t+m) \cong Hom_\CC( H^2(\sE(s+t-m-4)), \CC)
$$
where the last equality is from Serre duality on $\PP^3$. Summing over $m$ we see that
$D(C') \cong Hom(D(C)(s+t-4), \CC)$,
and since Serre duality is functorial, the isomorphism holds not only as graded vector spaces, but as graded $S$-modules. 

To prove that the relation of direct linkage is symmetric, we can repeat this argument starting from the locally free
resolution of $C'$, above, using the same forms of degree $s,t$ and we see that  direct link of $C'$ is $C$.
\end{proof}

Sometimes the following consequence is a useful way to compute the deficiency module:

\begin{corollary}[Corollary of the proof of Theorem~\ref{HR}]\label{deficiency as dual of Ext}
If $C$ is a purely 1-dimensional subscheme of $\PP^3$ with homogeneous ideal $I = I_C$ then 
$$
D(C) \cong Hom_\CC (Ext^3(S/I, S), \CC)(-4), \CC)
$$
as graded modules over the homogeneous coordinate ring $S$ of $\PP^3$.
\end{corollary}

This is a special case of the local duality isomorphism between local cohomology and the dual of Ext; see for example \cite[Theorem A.1.9]{MR2103875}.
\begin{proof}
We may choose a surjection  $\psi:  \oplus_iS(-a_i)\rTo I$, and choose the map
$\phi: \oplus_i\sO_{\PP^3}(-a_i)\rTo\sI_C$
in the proof of Theorem~\ref{HR}
to be the corresponding map of sheaves, so that
$\sE$ is the sheafification of the graded module $E = \ker \psi$.

Since $I$ is a saturated ideal,
 the depth of $S/I$ is at least 1, so $\pd\ S/I\leq 3$, and $I$ has a free resolution of the form
$$
0\rTo G \rTo F \rTo \oplus_iS(-a_i)  \rTo S\rTo S/I \rTo 0.
$$
where $G\to F$ is a free presentation of $E$. and there is an exact sequence
$$
0 \to E^* \to F^* \to G^* \to Ext^3_S(S/I, S) \to 0.
$$
Since $\sO_C$ is Cohen-Macaulay the sheafification of $Ext^3_S(S/I, S)$ is 0; that is,
$Ext^3_S(S/I, S)$ has finite length, and writing $\widetilde{(\phantom{-})}$ for the sheafification functor,
we have a short exact sequence of sheaves 
$$
0\to \sE^* \to \widetilde{F^*} \to \widetilde{G^*}\to 0.
$$
From this we see that 
$$
Ext^3_S(S/I,S) = H^1_*(\sE^*) = Hom_\CC( H^2_*(\sE(-4)),\CC) = H^1_*(\sI)(-4),
$$
proving the assertion.
\end{proof}


\section{The linkage equivalence relation}
As an immediate consequence of Theorem~\ref{HR} we have:
\begin{corollary}(Hartshorne)
 If two curves $C,C'$ are linked by an even length chain of direct linkages, then 
 $D(C)$ and $D(C')$ are isomorphic up to a shift in grading.
\end{corollary}

As we mentioned at the beginning of this Chapter, the converse is also true: the Hartshorne-Rao modules, up to shift in grading, provide a complete invariant of
linkage. Even more precise results are known (and the characteristic 0 hypothesis is largely unnecessary); here is a sample:

\begin{fact}
\begin{theorem}
Let $S = \CC[x_0, \dots, x_3]$ be the homogeneous coordinate ring of $\PP^3$, and let $M$ be a graded $S$-module of finite length.
\begin{enumerate}
\item There is a smooth curve $C$ with $D(C) = M(m)$ for some integer $m$.
\item There is a minimum value of $m$ such that $M(m) = D(C_0)$ for some purely one-dimensional scheme $C_0$.
\item Every curve that is evenly linked to $C_0$ is obtained from $C_0$ by deformation and a process called
\end{enumerate}
\end{theorem}

Moreover, each Liaison class has a relatively simple structure, known as the \emph{Lazarsfeld-Rao property}.
We say that $C'$ is obtained from $C$ by an \emph{ascending double link} if $I_{C'} = fI_C+(g)$ for some regular sequence
contained in $I_C$---see Exercise~\ref{Basic double links}. 

\begin{theorem}\cite{MR1087803}\label{LR property}
Let $M = D(C_0)$ the the Hartshorne Rao invariant of a purely 1-dimensional subscheme of $\PP^3$, and suppose that
$M$ is minimal in the sense that no $M(m)$ is the invariant of a purely 1-dimensional scheme. 
\begin{enumerate}
 \item Every curve $C$ in $\PP^3$ with $D(C) = M$ is a deformation of $C_0$ through curves with invariant $M$.
 \item Every curve in the even linkage class of $C_0$ is the result of a series of ascending double links followed by a deformation.
\end{enumerate}
\end{theorem}

In \cite{MR714753} it is shown that general curves of reasonably large degree in $\PP^3$ and many others have the property in the hypothesis
of  Theorem~\ref{LR property}.
\end{fact}


\section{possibly good examples}

\fix{The following was part of a different intro to the singular case. Add some of it to the 
previous Sect}

The sheaf of differentials on a singular curve $C_0$ is generally not well-behaved, generally not even torsion-free,
 and it does not
have the properties that make the canonical sheaf useful. The canonical
sheaf on $C_0$ must be defined differently:

\begin{definition}\label{canonical as Hom}
Let $C_0$ be a purely 1-dimensional scheme and let $\rho: C_0\to \PP^1$ be a finite morphism. The canonical sheaf $\omega_{C_0}$
is the sheaf $\rho^{-1}\Hom_{\PP^1}(\rho_*\sO_{C_0}, \omega_{\PP^1})$ on $C_0$. 
\end{definition}

To demystify the last phrase of this definition, note that because the map
$\rho$ is finite,  the open sets $U = \rho^{-1}V$, where $V\subset \PP^1$ is open, form a basis for the open sets of $C_0$; and for
such an open set $U$ the ring $\sO_C(U)$ is equal, as a set, to 
$(\rho_*\sO_C)(V)$. Thus if $\sL$ is any coherent sheaf on $C_0$ then $\rho_*\sL$, or more properlu $\rho^{-1}(\rho_*(\sL)$,
may be regarded as a coherent sheaf on $C_0$.

The reader may be concerned with applying the name ``canonical'' to a definition that seems to
depend on the choice of a map $\rho$, but in fact if $\rho': C_0 \to \PP^1$ is another such map,
there is a canonical isomorphism between the apparently different sheaves $\omega_{C_0}$ defined above.

More generally:

\begin{fact}
Suppose that $X$ is a smooth projective variety and $\omega_X$ is the sheaf of differential forms of degree $\dim X$.
If $\psi: C_0 \to X$ is any finite morphism of pure-dimensional schemes, then
$$
\omega_{C_0} \cong \sExt^{\dim X -\dim C_0}(\sO_{C_0}, \omega_X),
$$
and any two such representations are canonically isomorphic.
\end{fact}

For a proof in the case of the inclusion of a projective variety see \cite[Section III.7]{Hartshorne1977}, while for the more general assertion above see \cite{AltmanKleiman}. 

\begin{example}
Consider the case when $C = C_0$ is smooth, connected projective curve. If $\psi: C\to \PP^1$ is a finite  ($\equiv$ non-constant) morphism to $\PP^1$, then Hurwitz' Theorem asserts that the canonical sheaf on
$C$ is $(\rho^*\omega_{\PP^1})(R)$, where $R$ is the ramification divisor. It is not hard to show that this
agrees with Definition~\ref{canonical as Hom}. For simplicity, suppose that the degree of the map is 2---the general case
is virtually the same. If
 $ p\in\PP^1$ is a point over which there are two disjoint smooth branches
we can complete the local ring at $p$ and, after tensoring
with $\widehat \sO_{C,p} \cong k[[x]]$, the map of rings becomes 
$$
R := k[[x]] \subset R':= k[[x]]e_1\times k[[x]]e_2; \quad x =xe_1+xe_2,
$$
where the $e_i$ are orthogonal idempotents. Tensoring with the quotient field $Q = k((x))$ of $k[[x]]$
we get a map $Q \to Q':= Qe_1\times Qe_2$. As in any such situation there is a natural map of $Q$-vectorspaces in the other direction, the trace, which takes any element of $Q'$ to the trace of that element
regarded as a homomorphism $Q' \to Q'$ of $Q$-modules. Because $R'$ is finite, and thus integral, over $R$, the trace takes elements of $R'$ to $R$; that is $Tr \in \widehat \omega_{R'} = \Hom_R(R', R) \cong R^2$.

In this situation the trace generates $\widehat \omega_{R'}$ \emph{as an $R'$-module}: 
$$
(e_1Tr) (e_1) = Tr(e_1^2) = Tr(e_1) = Tr 
\begin{pmatrix}
 1&0\\0&0
\end{pmatrix} 
=1$$
while $e_1Tr(e_2) = Tr(e_1e_2) = Tr(0) = 0$
and similarly with $(e_2Tr)$, the other projection.

However, if $p$ is a simple branch point then, upon completing, the map of local rings becomes
$$
R := k[[x]] \subset R':= k[[y]; \quad x = y^2
$$
Again taking $Q = k((x))$, the quotient field of $R$, we see that $Q' = Q\otimes_RR'$ is freely generated as a $Q$-module by 1 and $y$. Again, since $R'$ is integral over $R$ the map $Tr$ takes $R'$ to $R$.
We have $Tr(1) = 2$,  but
$$
Tr(y) = Tr
\begin{pmatrix}
 0&1\\1&0
\end{pmatrix} 
=0
$$
so $\frac{1}{2}Tr$ is the projection onto the first summand,
Furthermore, $yTr$ takes 1 to $Tr(y) =0$ and $y$ to $Tr(y^2) = Tr(x) = 2x$,
so the cyclic module $R'Tr$ does not contain any map taking $y$ to a nonzero scalar, and
thus does not contain a projection onto the second factor.
However $y^{-1}= x^{-1}y$ so
$$
y^{-1}Tr(1) = 
Tr
\begin{pmatrix}
0&1\\ x^{-1}&0
\end{pmatrix} 
=0
$$
while
$
y^{-1}Tr(y) = Tr(1) = 2
$
so 
$$
\frac{1}{2}y^{-1}Tr: R' = R\oplus Ry \to R
$$
 is the second projection, and $y^{-1}Tr$ generates $\omega_{R'} = \Hom_R(R', R)$ as an $R'$-module.

This corresponds to the fact that a local generator of the module of regular differential forms
on $\Spec R'$ is $y^{-1}$ times the pullback of a local generator $dx$, or equivalently
that a differential form on $C'$ must be multiplied by $y$ to ensure that it ``descends'' to a regular differential
form on $\PP^1$. Note that if we write
$R' = k[[x,y]]/(f)$  with $f(x,y) = y^2-x$, then we have written the regular differential form on $C$
$$
y^{-1}dx = \frac{dx}{\partial f/\partial y}
$$
a formula we have seen before.
\end{example}
 

\section{A general Riemann-Roch theorem}

The canonical sheaf on a smooth curve shows its importance through the Riemann-Roch theorem,
and the same goes for singular curves. Though we will not make use of the generality further, we pause to prove a more general version of the Riemann-Roch theorem.

\begin{definition}
 If $\sF$ is a sheaf of generic rank $r$ on a projective integral curve $C$ over $\CC$ we define the degree
 of $\sF$ to be $\chi(\sF) -r\chi(\sO_C)$.
\end{definition}

\begin{fact}
The degree of $\sF$ is actually the degree of a divisor class called the first Chern class of $\sF$. See
for example \cite[Chapter ***]{3264}
for more information. 
\end{fact}

Thus:
\begin{theorem}\label{general RR without duality}
$$
 \chi(\sF) = \deg \sF + r\chi(\sO_C) = \deg \sF + r(1-p_a(C)).
 $$
\end{theorem}
 
This statement would be
a tautology if there were no other way to compute $\deg(\sF)$, but there is:

\begin{lemma} Let $C$ be an integral projective curve, let $\sF$ be a coherent sheaf on $C$ of generic rank $r$, and let $\sL$ be an invertible sheaf on $C$.
\begin{enumerate}
\item If $\sF$ is generated by its global sections and $\sigma_1,\dots, \sigma_r$ is a maximal generically independent
collection of global sections,  then 
$$
\deg (\sF) = r \chi(\sO_C)+
\dim_\CC H^0(\coker(\sO_C^r \rTo^{(\sigma_1,\dots, \sigma_r)}\sF))\,;
$$

\item $\deg (\sL \otimes \sF) = \deg (\sF) +r\deg (\sL).$

\end{enumerate}
Thus if $\sO_C(1)$ is a very ample invertible sheaf on $C$ and $m$ is a sufficiently large integer so that
$\sF(m)$ is generated by global sections, then the degree of $\sF(m)$ and the degree of $\sO_C(1)$ are computed by the formula in item (1)
and $\deg \sF = \deg(\sF(m)) - m \rank(\sF) \deg (\sO_C(1))$
\end{lemma}

\begin{proof}
The Euler characteristic is additive on short exact sequences. For example if $\sG$ is a coherent sheaf of finite support, then $\sG$ can be written as an iterated extension of
copies of the skyscraper sheaves with 1-dimensional fibers at various closed points $p_i\in C$ we see that $\chi(\sG) = \dim_\CC(H^0(\sG))$. Applying additivity again, we get item 1.

For item 2, note first that we can write $\sL$ as $\sL_1\otimes_C(\sL_2)^{-1}$ for very ample invertible sheaves
$\sL_i$ such that $\sL_i\otimes_C\sF$ is generated by global sections, so it is enough to prove (2) when $\sL$ is
a very ample invertible sheaf or its inverse. 

If $\sL$ is very ample and $\sL\otimes \sF$ is generated by global sections,
and the generic rank of $\sF$ is $r$, then by choosing $r$ general sections we get a short exact sequence
$0\rTo \sO_C^r \rTo^{(\sigma_1,\dots, \sigma_r)}\sF \rTo \sG\rTo 0$
where $\sG$ has finite support. Since $\sG \otimes \sL \cong \sG$ for any invertible sheaf $\sL$, it suffices to 
prove the given formula when $\sF \cong \sL^{\oplus r}$, or even for $\sL$ itself. Since $\sL$ is very ample,
it has the form $\sO_C(D)$ for some effective divisor $D$ supported on the smooth locus of $C$, 
and, applyng $\chi$ to the exact sequences 
$$ 
\begin{aligned}
&0\to \sO_C \to \sO_C(D)  \to \sO_D \to 0\\
&0\to \sO_C(-D) \to \sO_C  \to \sO_D \to 0\\
\end{aligned}
$$
the result follows (this is the usual proof of the usual Riemann-Roch theorem in the smooth case.)
\end{proof}

Using the dualizing property of $\omega_C$ we can reformulate Theorem~\ref{general RR without duality} as
\begin{theorem}\label{general RR with duality}
If $C$ is an integral curve and $\sF$ is a coherent sheaf on $C$, then
$$
h^0(\sF) = \deg(\sF) + \rank(\sF)(1-p_a(C)) + h^0(\Hom_C(\sF, \omega_C)).
$$
\end{theorem}

\section{Comparing the canonical sheaf with that of the normalization}

Suppose that $\nu:C\to C_0$ is the normalization of a singular curve. We 
want to compare the canonical sheaf of $C$ with
that of $C_0$---this is useful, for example, when $C_0$ is a plane curve, where the canonical
sheaf is, as in the smooth case, is easy to compute as the restriction of $\sO_{\PP^2}(\deg C_0 -3)$, but where we may wish to understand the canonical sheaf of $C$ instead.

\begin{example}
 If $C$ is a plane curve of degree $d$, then 
$$
\omega_C = \sExt^1(\sO_C, \omega_{\PP^2}) = \sExt^1(\sO_C, \sO_{\PP^2}(-3)) \cong \sO_C(d-3),
$$
where the last isomorphism can be seen from the long exact sequence in $\sExt$ applied
to the locally free resolution
$$
0\to \sO_{\PP^2}(-d) \to \sO_{\PP^2} \to\sO_{X} \to 0
$$
of $\sO_C$ as a sheaf on $\PP^2$. 
\end{example}

Using Definition~\ref{canonical as Hom} we can give a formula for the adjoint ideal of any curve singularity.

\begin{theorem}\label{general adjoint}
If $\nu: C \to C_0$ is the normalization of a reduced connected projective curve then the 
adjoint ideal 
$$
\fA_{C/C_0} :=\ann_{\sO_{C_0}}\frac{\omega_{C_0}}{\nu_* \omega_C}
$$
is equal to the conductor ideal
$$
\mathfrak f_{C/C_0}: = \ann_{\sO_{C_0}}\frac{\nu_* \sO_C}{\sO_{C_0}}	
$$
Moreover, if $C_0$ is a plane curve, then 
$$
\delta(C_0) = \length \frac{\nu_* \sO_C}{\sO_{C_0}} = \length \frac {\sO_{C_0}}{\mathfrak f_{C/C_0}}.
$$
\end{theorem}

Here $\delta(C_0)$ is the ``deficiency'' or the ``number of nodes equivalent to the singularities of $C_0$'' as
explained in Chapter~\ref{RiemannRochChapter}. The notation $\mathfrak f$ for the conductor comes from the german term \emph{F\"uhrer}. The property in the last statement of the
Theorem  was first noted (for plane curves) in Daniel Gorenstein's thesis under Oscar Zariski\footnote{Gorenstein is better remembered for his work on the classification of finite simple groups.}. This is the
reason why Grothendieck gave the name ``Gorenstein" to Cohen-Macaulay rings that have cyclic canonical 
modules--see~\cite{Bass}. 

In the previous chapter we used the adjoint ideal as a condition on a polynomial
$e$ to multiply differential forms on $C$ for $e\phi$ to belong to $\omega_C$ is always sufficient, but may be necessary only
when $\omega_{C_0}$ is cyclic---which is equivalent to the statement that $C_0$ is locally
Gorenstein. This condition is always satisfied for singularities of curves in the plane.
See Example~\ref{nongorenstein} for a singularity that is not locally planar, and behaves differently.


\begin{proof}[Proof of Theorem~\ref{general adjoint}]
  Let 
$\rho: C_0 \to \PP^1$ be a finite morphism. Both $\rho_*\nu_*\sO_C$ and $\rho_*\sO_{C_0}$
are torsion free coherent sheaves over $\sO_{\PP^1}$, and are thus locally free. Since $\rho_*$ is left-exact,
the inclusion $\sO_{C_0} \subset \nu_*\sO_C$ pushes forward to an inclusion
$$
\alpha: \rho_*\sO_{C_0} \hookrightarrow \rho_*\nu_*\sO_C
$$
and since $\sO_C$ is equal to $\sO_{C_0}$ generically on $\PP^1$, the cokernel $\coker \alpha$ has finite length; indeed, it is supported on the 
image of the singular locus of $C_0$. Since the maps $\nu$ and $\rho$ are finite, we may harmlessly think of both 
$\sO_{C_0}$ and $\sO_C$ as coherent sheaves on $\PP^1$, and we will simplify the notation by dropping $\nu_*$ and $\rho_*$.
Taking duals into $\sO_{\PP^1}$ and defining
$\alpha^\vee := \Hom_{\PP^1}(\alpha, \sO_{\PP^1}) $ we get a map that fits into the long exact sequence
of $\sExt_{\PP^1}(-, \sO_{\PP^1})$:
$$
\begin{diagram}[small]
 0&\rTo& 
 \Hom_{\PP^1}(\coker \alpha,\sO_{\PP^1})
&\rTo&
\omega_{C}
& \rTo^{\alpha^\vee}&
\omega_{C_0}\\
&\rTo&
\sExt^1_{\PP^1}(\coker \alpha, \sO_{\PP^1})
&\rTo&
\sExt^1_{\PP^1}(\sO_C, \sO_{\PP^1})
&\rTo&
\cdots
\end{diagram}
$$
Since $\coker \alpha$ has finite support, $ \Hom_{\PP^1}(\coker \alpha,\sO_{\PP^1}) = 0$ and
$\sExt^1_{\PP^1}(\coker \alpha, \sO_{\PP^1})$ has the same length and the same annihilator
as $\coker \alpha$. Furthermore, because $\sO_C$ is locally free as an $\sO_{\PP^1}$-module, the term
$\sExt^1_{\PP^1}(\sO_C, \sO_{\PP^1})$ vanishes, and we get the more manageable exact sequence
$$
\begin{diagram}
 0&\rTo&
\omega_{C}
& \rTo^{\alpha^\vee}&
\omega_{C_0}
&\rTo&
\sExt^1_{\PP^1}(\coker \alpha, \sO_{\PP^1})
&\rTo&
0
\end{diagram}
$$
It follows that the sheaves $\nu_*\sO_C/\sO_{C_0}$ and $\omega_{C_0}/\nu_*\omega_C$ have the same
length $\delta(C_0)$. Note that the \emph{conductor} $\mathfrak f_{C/C_0}$ of $C/C_0$, which is defined to be the annihilator of $\sO_C/\sO_{C_0}$ 
in $\sO_{C_0}$, is at the same time an ideal sheaf of $\sO_{C_0}$ and an ideal sheaf of $\sO_C$ via the inclusion $\sO_{C_0}\subset \sO_C$. The argument above shows that $\mathfrak f_{C/C_0}$ is also the annihilator ideal of $\omega_{C_0}/\omega_C$. By definition, this is the adjoint ideal of $C_0$, proving the first statement
of the Theorem.

A further simplification occurs when $C_0\subset \PP^2$ is a plane curve, or more generally any 
curve such that the canonical module of $C_0$ is an invertible sheaf (this is the definition of the Gorenstein property).
If the defining equation of 
$C_0$ is the form $F$ of degree $d$, then there is a locally free resolution of  $\sO_C$ of the form
$$
0\rTo \sO_{\PP^2}(-d) \rTo^F \sO_{\PP^2} \rTo \sO_C \rTo 0
$$
and thus $\omega_C \cong \sExt^1_{\PP^2}(\sO_{C_0}, \omega_{\PP^2})$
is cokernel of the map $\sO_{\PP^2}(-3) \to \sO_{\PP^2}(d-3)$ given by multiplication by $F$. Thus
$\omega_{C_0}$ is locally cyclic, and  since the support of $\omega_{C_0}/\omega_C$ is finite, this module is
 globally cyclic, so
$\omega_{C_0}/\omega_C \cong \sO_{C_0}/\mathfrak f_{C/C_0}$.
Since the length of $\omega_{C_0}/\omega_C$ is equal to the length of 
$\sO_{C}/\sO_{C_0}$, the last statement of the Theorem follows.
\end{proof}

\begin{example}
 Working locally, consider the germ of a node, represented by the ring $R_0:= k[[x,y]]/(xy)$, and
 the projection to a line represented by the inclusion 
 $$
 P:= k[[t]] \subset R_0: t\mapsto x+y.
 $$
 The normalization of $R_0$ is the map $R_0 \to R := k[[x]]e_1\times k[[y]]e_2$,
 where $e_1= x/t, e_2= y/t$ are orthogonal idempotents.Writing 
 $Q_1 = k((t)) \subset Q:= k((x))\times k((y))$
 for the map of total quotient rings, we know that, because the extension is separable, the trace map
 $Tr := Tr_{Q/Q_1}: Q \to Q_1$ generates $\Hom_{Q_1}(Q,Q_1)$ as a $Q$-vector space. Thus we may write the
 elements of $\omega_{R_0} = \Hom_{P}(R_0,P)$ and $\omega_R = \Hom_{P}(R,P)$ as
 multiples of $Tr$ by elements of $Q$.
 
 Since $R \cong Pe_1\oplus Pe_2$ as a $P$-module, the module $\Hom_P(R,P)$ is
 generated by the two projections, and it is easy to check that these are the maps
 $(x/t)Tr$ and $(y/t)Tr$. One can also check easily that 
 $$
 g := \frac{x-y}{t^2} Tr \in \Hom_P(R_0,R).
 $$
 Since
$xg = x/t$ and $yg = y/t$ in $Q$ we have
 $xg = x/tTr$ and $yg= y/tTr$, the generators of $\Hom_{P}(R,P)$. 
 The ring $R_0$, regarded As a $P$-module, is freely generated by 1 and $x$.
 Immediate computation shows that $gTr(1) = 0$ while $gTr(x) = 1$.
 Furthermore $(x-y)g = 1$ in $Q$,  and thus $\frac{1}{2}(x-y)gTr = Tr$ takes 1 to 1
 and $x$ to $t$, proving that $gTr$  generates
 $\Hom_P(R_0,P)$. We also see directly from this that the adjoint ideal
 of $\omega_{R_0}/\omega_R$ is the conductor ideal $(x,y)R_0 = (x,y)R = \mathfrak f_{R/R_0}$,
 as shown by  Theorem~\ref{general adjoint}. 
\end{example}

\begin{example}\label{nongorenstein}
We showed earlier that the adjoint ideal of a planar triple point is the square of the ideal of the point. Consider now
  the germ of a spatial triple point singularity $R_0 := k[[x,y,z]]/(xy, xz,yz)$, the vertex of the cone over 3
 non-colinear points in the plane, with normalization $R = k[[x]]\times k[[y]]\times k[[z]]$.
 If we set $t = x+y+z\in R_0\subset R$, then the three idempotents that generated $R$ as an $S$-module
 can be written as $x/t, y/t, z/t$. We have $x^2/t = xt_t= x$ and similarly for $y$ and $z$, so
 the conductor is given by $\ff_{R/R_0} = (x,y,z)R = (x,y,z)R_0$.
 
 The ring $R$ is also finite over $S := k[[x,y,z]]$, and is isomorphic as such to 
 $S/(x,y)\oplus S/(x,z) \oplus S/(y,z)$, so we can compute its canonical module from the
 resolution that is the direct sum of the three Koszul complexes resolving these summands, and 
 as such the canonical module $\omega_R = \Ext^2(R,S)$ is isomorphic to $R$ as an $S$-module.
 

 The $S$-module $R_0$, on the other hand,   has free resolution
 $$
 0\rTo S^2\rTo^{
	\begin{pmatrix}
 0&z\\
 y&-y\\
 -x&0
\end{pmatrix}}
 S^3 \rTo^{
\begin{pmatrix}
 xy&xz&yz
\end{pmatrix}}
 S \rTo R_0 \rTo 0. 
 $$
The canonical module of $R_0$ (which would be the germ of the canonical module of a global curve with such a singularity) is thus 
 $$
 \omega_{R_0} = \Ext^2(R_0, S) = 
 \coker 
\begin{pmatrix}
 0&y&-x\\z&-y&0
\end{pmatrix}
$$
a module requiring 2 generators.
\end{example}
The inclusion $\omega_{R} \subset \omega_{R_0}$ is thus induced by the 
dual of the last map in a comparison map between the two resolutions. Computation
confirms the conclusion of Theorem~\ref{general adjoint} that $\fA_{R/R_0} = \ff_{R/R_0} = (x,y,z)$. However, the length of $R/R_0$ is 2, and the length of $R_0/\ff_{R/R_0} = R_0/(x,y,z)$ is  1, so the
last conclusion of Theorem~\ref{general adjoint} fails, along with its hypothesis.



\section{Exercises}

\begin{exercise}
 Verify that the genus formula in Theorem~\ref{direct linkage} agrees with the usual calculation of degrees and genera for divisors on a quadric of
 classes $(a,b)$ and $(d-a, d-b)$.
\end{exercise}

\begin{exercise}
 Let $C$ be an integral projective curve, and let $\sE$ be a locally free sheaf of rank $r$ on $C$. Show that
 $\deg(\sE) = \deg(\wedge^r(\sE))$.
 
 Hint: First show that any locally free sheaf on $C$ is an iterated extension of invertible sheaves.
\end{exercise}

\begin{exercise}
Let $C$ be the disjoint union of 3 skew lines. 
\begin{enumerate}
 \item prove that $C$ lies on a unique quadric, and that $H^2(\sI_C) = 0$
 \item compute the Hartshorne-Rao module $D(C)$.
 \item show that if $\Gamma$ is the union of 3 points in $\PP^3$ then
 $H^1\sI(\Gamma) = 0$ iff the three points are colinear.
 \item Using the exact sequence in cohomology coming from the short exact sequence
$$
0\to \sI_C \rTo^{\ell} \sI_C(1) \to \sI_\Gamma(1) \to 0
$$
where $\ell$ is a linear form, show that the map of vector spaces
$$
H^1(\sI_C) \rTo^{\ell} H^1\sI_C(1))
$$
has rank<2 if and only if $\ell$ vanishes on 3 collinear points on the three lines (including the case when $\ell$ vanishes identically on one of the lines).
Conclude that if a different union $C'$ of 3 skew lines is linked to $C$, then $C'$ lies on the same quadric as $C$.
\end{enumerate}
See~\cite{Migliore} for more examples of this type.
\end{exercise}

\begin{exercise}
 Compute the Hilbert function of the Hartshorne-Rao module of a curve of type $(a,b)$ on a smooth quadric surface.
 Hint: The ideal sheaf of the curve on the quadric $Q$ is an extension of the ideal sheaf of the quadric in $\PP^3$
 with the ideal sheaf of the curve on the quadric, which is 
 $$
 \sO_Q(-a,-b) = \pi_1^*(\sO_{\PP^1}(-a)) \otimes pi_2^*(\sO_{\PP^1}(-b)),
 $$
 where $\pi_1, \pi_2$ are the projections to $\PP^1$. Use the K\"unneth formula
 $$
 H^1(\sO_Q(p,q)) = H^1(\sO_{\PP^1}(p)) \otimes H^0(\sO_{\PP^1}(q)) \oplus
  H^0(\sO_{\PP^1}(p)) \otimes H^1(\sO_{\PP^1}(q))
 $$
  to compute the necessary cohomology.
\end{exercise}

\begin{exercise} (Liaison addition)\label{Liaison addition}
(From the unpublished Brandeis thesis of Phillip Schwartau):
Suppose that $I, J$ are saturated ideals defining purely 1-dimensional subschemes of $\PP^3$
and that $f,g$ is a regular sequence with $f\in I$ and $g\in J$.
Prove that $g I \cap fJ = (fg)$, and conclude that if $I,J$ are purely codimension 2 ideals
 defining purely 1-dimensional schemes $C,C'$ in $\PP^3$
 then  $(gI+fJ)$ is a saturated ideal defining a purely 1-dimensional
scheme $C''$ with $D(C'') = D(C)(-\deg g) \oplus D(C')(-deg f)$.

Hint: Use the exact sequence 
$$
0\to (fg) \to gI \oplus fJ \to gI+fJ \to 0
$$
and the corresponding exact sequence of quotients by these ideals.
\end{exercise}


\begin{exercise}(Basic double links)\label{Basic double links}
The special case of the construction in Exercise~\ref{Liaison addition} in which $C'$ is trivial is already interesting. 

\begin{enumerate}
 \item Show that if $I$ is a purely codimension 2 ideal
 defining a purely 1-dimensional scheme $C$ in $\PP^3$
 and $(f, g)$ is a regular sequence with $g\in I$, then
 then  $fI+(g)$ defines a scheme $C'$ with $D(C') = D(C)(-\deg f)$.

 \item Show directly that, with notation as above, $C'$ is directly linked to $C$
 in two steps. \fix{add hint} Since the degrees of the generators of $D(C')$ are more positive, this
 is sometimes called an \emph{ascending double link}. Geometrically it amounts to taking the
 union of $C$ with some  components that are complete intersections.
 \end{enumerate}

\end{exercise}

The next two exercises illustrate Theorem~\ref{general adjunction}:

\begin{exercise}\label{codimension0}
Show that if $C\to D$ is a map of smooth curves with ramification index $e$ at $p\in C$, and $t$ is a local
analytic parameter at $p$, then 
locally analytically at $p$ the sheaf $\sHom_C(\sO_C, \omega_D)$ is $\sO_C(e)$.
\end{exercise}

\begin{exercise}\label{codimension1}
 Show that if $C\subset S$ is a cartier divisor on a surface $S$ with canonical sheaf $\omega_S$, 
 then $\sExt^1(\sO_C, \omega_S) \cong \sO_C\otimes \sO_S(C)$, and thus $K_C = (K_S+C)\cap C$.
\end{exercise}

\input{footer}

