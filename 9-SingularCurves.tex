\input{header}

\chapter{Singular Curves}
\label{SingularCurvesChapter}

**** David: This started out as a chapter in which we extend the constructions/theorems of the rest of the book to the case of singular curves. We since abandoned that goal as too difficult and open-ended, and my understanding is that we were going to replace it with a chapter on plane curves. So here's the chapter on plane curves, but I haven't changed the title of the chapter (and I commented out, rather than deleted, the stuff that was already written). ****

\

As anyone who has slogged through the last chapter knows, describing curves in projective space $\PP^3$  is difficult: the ideal of such a curve typically has three or more generators, which in turn have to satisfy certain syzygies; in consequence, even basic facts about them---for example, the dimension of the family of all curves of given degree and genus---remain very unclear.

The case of plane curves makes a striking contrast: a curve $C \subset \PP^2$ is necessarily the zero locus of a single homogeneous polynomial, and conversely any homogeneous polynomial $F(X,Y,Z)$ defines a plane curve. There is a downside, however: while any smooth projective curve can be embedded in $\PP^r$ for any $r \geq 3$, most curves cannot be embedded in the plane. 

On the other hand, it is true that every curve can be birationally embedded in $\PP^2$: we can embed $C$ as a curve $\tilde C \subset \PP^r$ in a higher-dimensional projective space and find a projection $\PP^r \to \PP^2$ that carries $\tilde C$ birationally onto its image. This is indeed how 19th century geometers typically described a curve, in the days before abstract varieties: as the normalization of a plane curve. (The points on the normalization were realized as valuations on the function field of $C$, essentially taking advantage of the fact that for smooth curves birational and biregular isomorphism are the same thing.) Much of the analysis of the geometry of the curve---for example, the description of the linear systems on the curve---was carried out in this setting.

Plane curves, in other words, occupied a central role in the development of the theory of algebraic curves; and there are still many aspects of the geometry of a curve that are best approached in this way. In this chapter, we'll describe some of the tools used to study plane curves.

To describe our approach at the outset: we will start, in Section~\ref{smooth plane curves}, with the case of smooth plane curves. As noted, this covers only a small fraction of all curves, but it will allow us to establish our basic constructions in a relatively simple setting. Then, in Section~\ref{nodal plane curves}, we'll extend this analysis to nodal plane curves; this is a significant expansion by virtue of Theorem~\ref{****}, which says that every smooth projective curve is the normalization of a nodal plane curve. Finally, in Section~\ref{arbitrary plane curve} we'll describe the most general form of this analysis, applicable to any reduced  and irreducible plane curve.

\section{Smooth Plane Curves}\label{smooth plane curves}

Let's start by posing two ``keynote" problems, which we'll solve in this section. In both, we'll be given the equation $F(X,Y,Z)$ of a smooth plane curve $C$; in the second, we'll be given in addition a divisor $D = \sum m_ip_i$ on $C$. We ask:
\begin{enumerate}
\item Find all regular differentials/sections of $K_C$; that is, write down a basis for $H^0(K_C)$; and
\item Describe the complete linear system $|D|$; that is, find all effective divisors $E$ on $C$ with $E \sim D$.
\end{enumerate}

Note that this subsumes questions like, are two given divisors $D$ and $E$ linearly equivalent? And, is a given divisor $D$ linearly equivalent to an effective divisor? As we said above, in this section we'll solve these problems for a smooth plane curve; in the following section we'll do it for (the normalization of) a plane curve with nodes; this will allow us to answer these questions algorithmically for an arbitrary smooth curve.

 So: let's say $C \subset \PP^2$ is the plane curve given as the zero locus of a homogeneous polynomial $F(X,Y,Z)$ of degree $d$. We'll introduce affine coordinates $x = X/Z$ and $y = Y/Z$ on the affine open subset $U \cong \AA^2$ given by $Z \neq 0$, and let $f(x,y) = F(X,Y,1)$ be the inhomogeneous form of $F$, so that $\tilde C = C \cap U$ is given as the zero locus $V(f) \subset U$. Finally, just for simplicity, we'll assume that $C$ is transverse to the line $L = V(Z)$ at infinity, meeting it at $d$ points $p_1,\dots,p_d$, none of which is the point $[0,1,0]$ (equivalently, $\tilde C$ has no vertical asymptotes).
 
 We start by drastically scaling back our ambitions: instead of asking for a basis of $H^0(K)$, let's just see if we can write down a single rational 1-form on $C$. This is manageable: we can just take a regular 1-form on $\AA^2$, such as $dx$, and restrict/pull back to $C$. In fact, this will be regular on the open subset $\tilde C$, but a change of coordinate calculation shows that it will have double poles at the point $p_1,\dots,p_d$ of $C \cap L$.
 
 How do we get rid of the poles of $dx$? The natural thing to do would be simply to divide $dx$ by a polynomial $h(x,y)$ of degree 2 or more, but there's a problem: $h(x,y)$ will vanish at points of $C \cap U$, potentially creating poles of the quotient $dx/h$. There is a solution to this: \emph{choose a polynomial $h$ that vanishes only at those points of $C \cap U$ where $dx$ already has a zero}; hopefully, the zeroes of $h$ will just cancel the zeroes of $dx$ rather than creating new poles.
 
 In fact, we have just the polynomial: we take
 $$
 h(x,y) = \frac{\partial f}{\partial y}(x,y).
 $$
 To see that this works, note that on $C$,
 $$
 df = \frac{\partial f}{\partial x}dx + \frac{\partial f}{\partial y}dy \equiv 0.
 $$
Since $\frac{\partial f}{\partial x}$ and $\frac{\partial f}{\partial y}$ have no common zeroes on $\tilde C$ by the hypothesis of smoothness, we see that at any point $p \in \tilde C$,
$$
\ord_p(dx) = \ord_p(\frac{\partial f}{\partial y})
$$ 
so in fact the quotient 
$$
\omega_0 = \frac{dx}{\partial f/\partial y}
$$
is everywhere regular and nowhere 0 in $\tilde C$.

What about the points $p_i$? Well, the differential $dx$ had poles of order $2$ at the points $p_i$; and $\partial f/\partial y$, being a polynomial of degree $d-1$, will have poles of order $d-1$. We conclude that $\omega_0$ has zeroes of order $d-3$ at the points $p_i$; in other words, the divisor
$$
(\omega_0) = (d-3)D.
$$
In particular, if $d \geq 3$ then $\omega_0$ is a global regular differential on $C$.

This also says that we can afford to multiply $\omega_0$ by any polynomial $g(x,y)$ of degree $d-3$ or less without introducing poles, so that 
$$
g\omega_0 = \frac{g(x,y)dx}{\partial f/\partial y}
$$ 
is likewise a global regular differential, for $g$  any polynomial of degree $\leq d-3$.

We have thus found a vector space of regular differentials, of dimension $\binom{d-1}{2}$. But at the same time, the degree of a differential like $\omega_0$ is
$$
\deg((\omega_0)) = (d-3)\deg(D) = d(d-3),
$$
so that the genus of $C$ is 
$$
\frac{d(d-3)}{2} + 1 = \binom{d-1}{2}.
$$
In other words, we have found all the global regular differentials on $C$! We have
$$
H^0(K_C) = \left\{ \frac{g(x,y)dx}{\partial f/\partial y} \mid \deg g \leq d-3\right\}.
$$

In fact, we could have done this all abstractly, without coordinates: by adjunction, we have
$$
K_C = (K_{\PP^2} \otimes \cO_{\PP^2}(d))|_C = \cO_C(d-3),
$$
and from the exact sequence
$$
0 \to \cO_{\PP^2}(-3) \to \cO_{\PP^2}(d-3) \to \cO_C(d-3)=K_C \to 0
$$
and the vanishing of $H^1(\cO_{\PP^2}(-3))$, we see that the map on global sections
$$
H^0(\cO_{\PP^2}(d-3)) \to H^0(K_C)
$$
is surjective. 

What about our second problem, finding all effective divisors linearly equivalent to a given divisor $D$? To answer this, start by expressing $D$ as the difference 
$$
D = E - F
$$
of two effective divisors on $C$. Next, let $G(X,Y,Z)$ be a polynomial in the plane of any degree $m$ vanishing on the divisor $E$, but not containing $C$ (taking $m$ sufficiently large ensures the existence of such a polynomial), and let $A$ be the divisor cut on $C$ residually; that is, we write
$$
(G) = E + A
$$
as divisors on $C$. Now, let $H$ be another polynomial of the same degree $m$ as $G$, vanishing on $A + F$ but again not vanishing identically on $C$. Let $D'$ be the divisor cut on $C$ by $H$ residual to $A+F$; that is, write
$$
(H) = A + F + D'.
$$
Now, the divisor of the rational function $H/G$ is principal, so we have
$$
0 \sim (H) - (G) = D' + F - E
$$
or in other words, \emph{$D'$ is an effective divisor linearly equivalent to $D$.}

Note that in the simplest nontrivial case $d=3$, we have reproduced the classic description of the group law on a plane cubic curve. If we choose as origin on the curve a point $o$, then to add two points $p$ and $q \in C$ means to find the (unique) divisor of degree 1 linearly equivalent to $p + q - o$. In this situation, we can carry out the process described above with $m=1$: draw the line $L$ through the points $p$ and $q$, and let $r \in C$ be the remaining point of intersection of $L$ with $C$; then draw the line $M$ though the points $r$ and $o$, and let $s \in C$ be the remaining point of intersection of $L$ with $C$. This is the classical construction of the group law.

We claim now that in fact we have found in this way \emph{all} effective divisors $D' \sim D$. To see this, suppose $D'$ is any effective divisor with $D' \sim D$. Carrying out the first step of the process as before, we arrive at a divisor $A$ with 
$$
\cO_C(A+F+D') = \cO_C(A+F+D)  = \cO_C(m).
$$
But from the exact sequence 
$$
0 \to \cO_{\PP^2}(m-d) \to \cO_{\PP^2}(m)  \to \cO_C(m) ]\to 0
$$
and the vanishing of $H^1(\cO_{\PP^2}(m-d))$, we have that every global section of $ \cO_C(m)$ is the restriction to $C$ of a homogeneous polynomial of degree $m$ on $\PP^2$. Thus there is a polynomial $H$ cutting out the divisor $A+F+D'$ on $C$, as claimed.

Note that if, in the process described, it turns out there is no polynomial $H$ vanishing on  $A + F + D$ but not vanishing identically on $C$, that simply means that $|D| = \emptyset$; that is, \emph{$D$ is not linearly equivalent to any effective divisor}. (It may not be obvious that the existence of such an $H$ is independent of the choice of $m$ or $G$, but the argument here shows it is.)

\section{Nodal Plane Curves}\label{nodal plane curves}

As noted, smooth plane curves are very special among all curves. We now want to carry out the analyses above for a larger class of plane curves, curves with at most nodes as singularities. These are still special among all plane curves, but as we'll see in Proposition~\ref{nodal projection} below, every smooth curve is the normalization of a nodal plane curve, so that this will in theory allow us to answer the ``keynote" questions above for an arbitrary smooth curve. (In the final section of this chapter, we'll indicate how the constructions here may be extended to an arbitrary plane curve.)

The set-up, in any event, is as follows: we have nodal plane curve $C_0 \subset \PP^2$, with normalization $\nu : C \to C_0$; or, equivalently, a smooth projective curve $C$ and a birational embedding of $C$ in $\PP^2$ with image a nodal curve $C_0$. Our goals will be as before: 
\begin{enumerate}
\item to write out explicitly all global regular 1-forms on $C$; and
\item given a divisor $D$ on $C$, to  determine $|D|$; that is, find all effective divisors linearly equivalent to $D$.
\end{enumerate}

As before, we'll choose homogeneous coordinates  $[X,Y,Z]$ on $\PP^2$ so that the curve $C_0$ intersects the line $L = V(Z)$ at infinity transversely at points $p_1,\dots,p_d$ other than $[0,1,0]$; in addition, we can assume that all the nodes of $C_0$ lie in the affine plane $U = \PP^2 \setminus L$, and that neither branch of $C_0$ at a node has vertical tangent. (As before, these conditions are not logically necessary; they serve only to keep the notation reasonably simple, and in any case are satisfied by a general choice of coordinates.) Let the nodes of $C_0$ be $q_1,\dots,q_\delta$, with $r_i, s_i \in C$ lying over $q_i$; we'll denote by $\Delta$ the divisor $\sum r_i + \sum s_i$ on $C$.

Let $F(X,Y,Z)$ be the homogeneous polynomial of degree $d$ defining the curve $C_0$, and let $f(x,y) = F(x,y,1)$ be the defining equation of the affine part $C_0 \cap U$ of $C_0$. We start by considering the rational differential $\nu^*(dx)$ on $C$. In the smooth case, we saw that this differential was regular and nonzero in the finite plane, but had poles of order 2 at the point of $C \cap L$; this followed from the equation
$$
 df = \frac{\partial f}{\partial x}dx + \frac{\partial f}{\partial y}dy \equiv 0.
 $$
and the fact that $\frac{\partial f}{\partial x}$ and $\frac{\partial f}{\partial y}$ have no common zeroes on $C_0$. But now $\frac{\partial f}{\partial x}$ and $\frac{\partial f}{\partial y}$ do have common zeroes, specifically, the pullbacks $\nu^*(\frac{\partial f}{\partial x})$ and $\nu^*(\frac{\partial f}{\partial y})$ have simple zeroes at the points $r_i$ and $s_i$. We conclude, accordingly, that the differential $\nu^*dx$ has double poles at the points $p_i$, and simple poles at the points $r_i$ and $s_i$; proceeding as before, we see that for a polynomial $g(x,y)$ of degree $\leq d-3$, the differential
$$
\nu^*( \frac{g(x,y)dx}{\partial f/\partial y})
$$
will be regular except for simple poles at the points $r_i$ and $s_i$.

So, how do we get rid of these poles? There is one simple way: we require that $g$ vanishes at the points $q_i$. We say in this case that $g$ (and the curve defined by $g$) \emph{satisfies the adjoint conditions}. In any event, we see that
$$
 \left\{ \nu^* \frac{g(x,y)dx}{\partial f/\partial y} \mid \deg g \leq d-3 \text{ and } g(q_i) = 0 \; \forall i \right\} \subset H^0(K_C).
$$
Now, in the smooth case, we were able to compare dimensions to conclude that this inclusion was indeed an equality. We can do the same thing here: to begin with, by the genus formula, we see that the genus of $C$ is
$$
g(C) = \binom{d-1}{2} - \delta.
$$
On the other hand, the space of polynomials $g$ of degree $\leq d-3$ vanishing at the points $q_i$ has dimension at least $ \binom{d-1}{2} - \delta$; we conclude from this that indeed
$$
H^0(K_C) =  \left\{ \nu^* \frac{g(x,y)dx}{\partial f/\partial y} \mid \deg g \leq d-3 \text{ and } g(q_i) = 0 \; \forall i \right\},
$$
and as lagniappe we see also that \emph{the nodes $q_i$ of an irreducible nodal plane curve of degree $d$ impose independent conditions on curves of degree $d-3$}.

\subsection{linear series on a nodal curve}

Next, we take up the second of our keynote problems in this setting: with $C \to C_0 \subset \PP^2$ as above, given a divisor $D$ on $C$, can we find the complete linear series $|D|$?

In fact we can, by a process analogous to what we did in the smooth case. We'll do this first in the case where $D = E-F$ is the difference of two effective divisors whose support is disjoint from the support $\{r_i, s_i\}$ of $\Delta$; the general case is only notationally more complicated. To start, we find an integer $m$ and a polynomial $G$ vanishing on the divisor $E$ \emph{and at the nodes $r_1,\dots,r_\delta$ of $C_0$}, but not vanishing identically on $C_0$. We can then write the zero locus of $G$ pulled back to $C$ as
$$
(\nu^*G) = E + \Delta + A,
$$
as before. Once more, just for simplicity, let's assume that the support of $A$ is disjoint from the support of $\Delta$; this means just that the curve $V(G)$ is smooth at the points $q_i$ and is not tangent to either of the branches of $C_0$ there.

Next, we find polynomials $H$ of the same degree $m$, vanishing at $A+F$ and at the points $q_i$ but not on all of $C_0$. Let $D'$ be the divisor cut on $C$ by $H$ residual to $E + \Delta + A$; that is, we write
$$
(\nu^*H) = E + \Delta + A + D'.
$$
Finally, since $\nu^*(G/H)$ is a rational function on $C$, we see that 
$$
E + \Delta + A = (\nu^*H) \sim (\nu^*G) = E + \Delta + A + D',
$$
and we conclude that $D'$ is an effective divisor linearly equivalent to $D$ on $C$.

But, do we get in this way \emph{all} effective divisors linearly equivalent to $D$ on $C$? The answer is yes, but it's not immediate; it follows from the following proposition, known classically as \emph{completeness of the adjoint series}.

\begin{proposition}\label{adjoint completeness}
If $C_0 \subset \PP^2$ is a nodal plane curve and $\nu : C \to C_0$ its normalization, then the linear series cut on $C$ by plane curves of degree $m$ passing through the nodes is complete.
\end{proposition}

We will prove this in a moment, but note first that the solution to our problem follows from the proposition exactly as in the smooth case.

\begin{proof}
To prove Proposition~\ref{adjoint completeness}, we introduce another surface: the blow-up $\pi : S \to \PP^2$ of $\PP^2$ at the points $r_i$. The proper transform on $C_0 \subset \PP^2$ in $S$ is the normalization of $C_0$, which we will again call $C$.

There are two divisor classes on $S$ that will come up in our analysis: the pullback of the class of line in $\PP^2$, which we'll denote $H$; and the sum of the exceptional divisors, which we'll call $E$. In these terms, we have
$$
C \sim dH - 2E \quad \text{and} \quad K_S \sim -3H + E
$$
(the first follows from the fact that $C_0$ has multiplicity 2 at each of the points $q_i$, the second from considering the pullback to $S$ of a rational 2-form on $\PP^2$). If $A$ is a curve in $\PP^2$ of degree $m$ passing through the points $q_i$, we can associate to it the effective divisor $\pi^*A - E$; this gives us an isomorphism
$$
H^0(\cI_{\{q_1,\dots,q_\delta\}/\PP^2}(m)) \cong H^0(\cO_S(mH-E)).
$$
In these terms we can describe the linear series cut on $C$ by plane curves of degree $m$ passing through the nodes of $C_0$ as the image of the map
$$
H^0(\cO_S(mH-E)) \to H^0(\cO_C(mH-E)),
$$
and the proposition amounts to the assertion that this map is surjective.

The obvious way to prove this is to view this map as part of the long exact cohomology sequence associated to the exact sequence of sheaves
$$
0 \to \cO_S(mH-E-C) = \cO_S((m-d)H + E)  \to \cO_S(mH-E) \to \cO_C(mH-E) \to 0,
$$
from which we see that it will suffice to establish that $H^1(\cO_S((m-d)H + E)) = 0$. To do this, we apply Serre duality, which says that $H^1(\cL) \cong H^1(K_S\otimes \cL^{-1})^*$; in this instance it 
tells us that
$$
H^1(\cO_S((m-d)H + E)) \cong H^1(\cO_S((d-m-3)H))^*
$$
Now, the line bundle $\cO_S((d-m-3)H)$ is just the pullback to $S$ of the bundle $\cO_{\PP^2}(d-m-3)$, which has vanishing $H^1$; thus the Proposition will follow from the 
\begin{lemma}
Let $X$ be a smooth projective surface, and $\pi : Y \to X$ a blow-up. If $\cL$ is any line bundle on $X$, then
$$
H^1(Y, \pi^*\cL) = H^1(X, \cL).
$$
\end{lemma}
The lemma follows by applying the Leray spectral sequence, which relates the cohomology of $\cL$ on $Y$ to the cohomology of the direct image $\pi_*\pi^*\cL$ (Leray is particularly simple in this setting, since all higher direct images are 0), and the observation that $\pi_*\pi^*\cL \cong \cL$.
\end{proof}




\begin{proposition}\label{nodal projection}
If $C \subset \PP^n$ is a smooth curve in projective space, and $\Lambda \cong \PP^{n-3} \subset \PP^n$, then the projection $\pi_\Lambda : C \to \PP^2$ is birational onto its image, which will be a nodal curve.
\end{proposition}







%Throughout this book thus far, we have developed techniques for dealing with smooth, projective curves; to the extent that we have considered singular curves we have studied them by applying the ideas and constructions we've developed to their normalizations. But singular curves have a fascinating geometry in their own right, not only for the singularities themselves but the effect singularities have on associated objects such as the Jacobian. In this chapter, we will undertake a brief survey of the geometry of singular curves and what we can say about linear series on them.
%
%To say what classes of curves we'll be dealing with here: for the most part, we will confine ourselves to working with reduced, projective curves. Many of the results we will derive will in fact will be applicable to a larger class of curves, namely those that are \emph{Cohen-Macaulay}; these may well be non-reduced, but cannot have embedded points. In Section~\ref{} below, we'll mention some examples of nonreduced curves to which we can apply our ideas (such as, for example, \emph{ribbons}), and we'll develop these ideas further in the following chapter, where we introduce more algebraic techniques. But for the rest of this chapter, we will take the objects of our study to be reduced, projective curves over $\CC$.
%
%
%\section{The arithmetic genus and singularities}
%
%To start at the beginning, when we first defined the notion of the \emph{genus} of a smooth projective curve, we gave several different but equivalent characterizations of the genus. As you might expect, these diverge in the presence of singularities, so we adopt the following universal definition.
%
%\begin{definition}
%Let $C$ be an arbitrary one-dimensional projective scheme over a field $\CC$. By the \emph{arithmetic genus} $p_a(C)$ of $C$ we mean 1 minus the Euler characteristic of the structure sheaf of $C$:
%$$
%p_a(C) \; = \; 1 - \chi(\cO_{C}).
%$$
%In contrast, if $C$ is reduced, we define the \emph{geometric genus} to be the genus of the normalization $C^\nu$ of $C$.
%\end{definition}
%
%Note that the arithmetic genus satisfies many of the formulas derived above in the smooth case: for example, if $C \subset S$ is a divisor on a smooth surface, the adjunction formula holds:
%$$
%p_a(C) \; = \; \frac{C\cdot C + K_S\cdot C}{2} + 1.
%$$
%Thus, for example, a double conic curve $C = V((XY-Z^2)^2) \subset \PP^2$, like every other plane quartic curve, has arithmetic genus 3. (If you're curious, we'll see what the Jacobian of $C$ looks like in Section\ref{} below.)
%
%\subsection{Relation between the arithmetic and geometric genus}
%
%Our first order of business is to understand the relationship between the arithmetic and geometric genera of a reduced projective curve $C$. To this end, let $\nu : C^\nu \to C$ be the normalization of $C$, and consider the exact sequence of sheaves on $C$:
%$$
%0 \to \cO_C \to \nu_*\cO_{C^\nu} \to \cF \to 0
%$$
%where $\cF$ is simply defined to be the quotient $\nu_*\cO_{C^\nu}/\cO_C$; note that $\cF$ is supported exactly at the singular points of $C$.
%
%The point here is that, because the map $\nu$ is finite, there are no higher direct images of $\nu_*\cO_{C^\nu}$; so the Leray-Serre spectral sequence tells us that
%$$
%\chi(\nu_*\cO_{C^\nu}) \; = \chi(\cO_C).
%$$
%Thus, the difference between the arithmetic and geometric genera of $C$ is
%$$
%g(C) \; = \; p_a(C) - h^0(\cF).
%$$
%We can refine this a little: for each singular point $p \in C$, denote by $\delta_p$ the dimension (as vector space over $\CC$) of the stalk $\cF_p$ of $\cF$ at $p$. This is called the \emph{delta-invariant} of $p$, and is the most fundamental numerical invariant of a curve singularity. In these terms, we can write
%$$
%g(C) \; = \; p_a(C) - \sum_{p \in C} \delta_p.
%$$
%
%\subsection{The delta invariant}
%
%To see how this works in practice, let's calculate the delta invariant of some relatively simple singularities.
%
%\subsubsection{the $\delta$-invariant of a node}
%
%To start with the simplest singularity, suppose that $p$ is a node of $C$: that is, a neighborhood of $p \in C$\footnote{we can take this to be either a complex analytic neighborhood or an \'etale neighborhood} is the union of two smooth curves intersecting transversely at $p$. In this case, there will be two points $q, r \in C^\nu$ in the normalization lying over $p$, and we see that if $U$ is a suitably small neighborhood of $p \in C$ then a function $\tilde f \in \cO_{C^\nu}(\nu^{-1}(U)$ on the preimage of $U$ in $C^\nu$  is the pullback of a function $f \in \cO_C(U)$ if and only if the values $\tilde f(q) = \tilde f(r)$ agree. It follows that the stalk of the sheaf $\cF$ at $p$ is one-dimensional, so $\delta_p = 1$.
%
%\subsubsection{the $\delta$-invariant of a cusp}
%
%By definition, a \emph{cusp} of a curve $C$ is a point $p \in C$ such that the normalization map is given in terms of suitable local coordinates in a neighborhood $U$ of $p$ as
%$$
%\nu : t \mapsto (t^2, t^3).
%$$
%We see from this that a function  is the pullback of a function $f \in \cO_C(U)$ if and only if the derivative $f'(0) = 0$; this being again one linear condition, we see that $\delta_p = 1$.
%
%\subsubsection{the $\delta$-invariant of a tacnode}
%$\tilde f \in \cO_{C^\nu}(\nu^{-1}(U))$
%As with a node, a suitably small neighborhood $U$ of a tacnode $p \in C$ is a union of two smooth curves; but this time the two branches are simply tangent to one another rather than transverse. It is no longer the case, accordingly, that a function $\tilde f \in \cO_{C^\nu}(\nu^{-1}(U))$ is a pullback if and only if the values of $\tilde f$ at the points  $q, r \in C^\nu$ lying over $p$ agree: for example, a function that has a simple zero at $q$ but vanishes to order 2 or more at $r$ cannot be a pullback. The correct statement is that $\tilde f$ will descend to $C$ if and only if $f(q) = f(r)$ and the derivatives $f'(q)$ and $f'(r)$ (with respect to suitably chosen local coordinates) agree. Thus we see that $\delta_p = 2$.
%
%\subsubsection{the $\delta$-invariant of an ordinary triple point}
%
%An ordinary triple point is again a \emph{planar} singularity, meaning its Zariski tangent space is 2-dimensional, or, equivalently, it is embeddable in a smooth surface. A small neighborhood of such a point $p \in C$ consists of a union of three smooth branches, intersecting pairwise transversely at $p$. In order for a function on the preimage of $U$ to be a pullback, naturally, its values at the three points $q,r,s \in \nu^{-1}(p)$ lying over $p$ have to agree, so that $\delta_p \geq 2$. But this is not a sufficient condition: a function  $\tilde f$ with a simple zero at $q$ but vanishing to order at least 2 at $r$ and $s$ cannot be a pullback. Rather, the fact that the tangent lines to the three branches are linearly dependent means that in order for $\tilde f$ to descend its derivatives at $q, r$ and $s$ must satisfy a linear relation as well, and so we have $\delta_p = 3$. 
%
%\subsubsection{the $\delta$-invariant of a spatial triple point}
%
%By way of contrast with the last example, suppose now that $p$ is a \emph{spatial triple point}: in other words, a neighborhood of $p \in C$ is a union of three smooth branches with linearly independent tangent lines (so that $\dim T_p(C) = 3$). In this case, it is a necessary and sufficient condition for a function $\tilde f$ to descend is simply that its values at the points lying over $p$ agree, from which we see that $\delta_p = 2$.
%
%\begin{exercise}
%Consider the following curves $C \subset \PP^3$ of degree 3 in $\PP^3$. In each case, determine the arithmetic genus; and, in those cases where $p_a(C) = 0$ show that the curve $C$ is indeed the flat limit of a family of twisted cubics.
%\begin{enumerate}
%\item the union of a line and a conic curve meeting transversely at one point;
%\item the union of a conic and a tangent line;
%\item the union of three concurrent, coplanar lines;
%\item the union of three concurrent but not coplanar lines.
%\end{enumerate}
%\end{exercise}
%
%\section{The dualizing sheaf and Riemann-Roch for singular curves}
%
%Without question, the most fundamental object we deal with in analyzing the geometry of a smooth curve $C$ is its canonical bundle/divisor class $K_C$, defined simply to be the cotangent bundle of $C$ or equivalently the sheaf of regular 1-forms. Is there an analog of this in the case of singular curves?
%
%The answer is an emphatic ``yes:" if $C$ is Cohen-Macaulay (and in particular, if $C$ is reduced), we can introduce the \emph{dualizing sheaf} $\omega_C$, which is a more than adequate understudy for the role of canonical bundle. (Indeed, in a large range of cases, those of \emph{Gorenstein} curves, it is locally free, as we'll see in the subsection below.) We will give a relatively concrete description of the dualizing sheaf here, and a more abstract, algebraic definition in the next chapter.
%
%To understand the definition of the dualizing sheaf, it is useful (and amusing) to recall a bogus proof of the Riemann-Roch formula, which highlights the key property of the canonical bundle. To set this up, suppose now that $C$ is a smooth projective curve of genus $g$, and imagine we have a divisor $D = p_1 + \dots + p_d$ consisting of $d$ distinct points on $C$. We choose a local coordinate $z_i$ on $C$ around $p_i$, and ask: given a $d$-tuple of scalars $a_1,\dots,a_d$, when is there a rational function on $C$, regular away from the points $p_i$, with polar part $a_i/z_i$ at $p_i$? 
%
%Since any rational function regular away from the $p_i$ is determined, up to the addition of a scalar, by its polar parts at the $p_i$, this is tantamount to asking for the dimension of the vector space $\cL(D)$ of rational functions with at most simple poles along $D$. In particular, we see that the dimension
%$$
%\dim \c(D) \; \leq \; d + 1,
%$$
%with equality holding iff every $d$-tuple of scalars $a_1,\dots,a_d$ represents the polar part of some function $f \in \cL(D)$. But there is an obstruction to this being the case: if $\phi$ is any global regular 1-form on $C$, then for any $f \in \cL(D)$ we have
%$$
%\sum_i Res_{p_i} (f \cdot \phi) \; = \; 0,
%$$
%which (potentially) imposes a linear condition on the polar parts of $f$. Of course, if $\omega$ vanishes at all the points $p_i$ of $D$, this condition is vacuous; the actual number of conditions imposed is the difference $g - h^0(K_C -D)$. Altogether, then, we have established the inequality
%$$
%h^0(D) \; \leq \; d + 1 - g + h^0(K_C - D).
%$$
%
%Now we apply this inequality to the divisor $K-D$, which has degree $2g-2-d$; we arrive at
%$$
%h^0(K-D) \; \leq \; 2g - 2 + 1 - g + h^0(D).
%$$
%Finally, we add the last two inequalities, and almost all the terms cancel, leaving us with
%$$
%h^0(D) + h^0(K-D) \; \leq \; h^0(K-D) + h^0(D);
%$$
%since equality holds here, it most hold in both the inequalities above, and we deduce the statement of the Riemann-Roch formula.
%
%The point of this derivation of Riemann-Roch is that is emphasizes the crucial fact underlying the formula: that \emph{the sum of the residues of a rational 1-form on a smooth projective curve is zero}. Now, suppose that $C$ is a possibly singular projective curve, and $D = p_1+\dots + p_d$ a divisor $D$ (whose support we will for simplicity assume is disjoint from the singular locus of $C$). Say we want to derive an analogous formula for the dimension $h^0(D)$ of the space of rational functions on $C$ with at most poles along a divisor $D$, with the role of a global regular 1-form $\phi \in H^0(K)$ played by a global section of the dualizing sheaf $\omega_C$. We need to define the dualizing sheaf $\omega_C$ so that its sections may be viewed as rational differentials on $C$, with three properties:
%
%\begin{enumerate}
%\item we should have $\deg(\omega_C) = 2p_a(C)-2$;
%\item we should have $h^0(\omega_C) = p_a(C)$; and, crucially,
%\item for any rational function $f \in h^0(D)$ and every section $\phi \in H^0(\omega_C)$, the sum of the residues of the rational differential $f\phi$ at the points of $D$ is 0.
%\end{enumerate}
%
%
%
%\subsection{the Gorenstein condition}
%
%\section{Picard groups of singular curves}
%
%Let's start with the simplest case: suppose $C$ is an irreducible curve with a node $r$ and no other singularities. We'll denote by $\nu : C^\nu \to C$ the normalization of $C$, and let $p, q \in C^\nu$ be the two points of $C^\nu$ lying over $r$.
%
%Let $\Pic^0(C)$ denote the group of line bundles of degree 0 on $C$, and $\Pic^d(C)$ the set of line bundles of degree $d$ (which is again a principal homogeneous space for $\Pic^0(C)$). To describe these, consider the map
%$$
%\nu^* : \Pic^0(C) \to \Pic^0(C^\nu)
%$$
%given simply by associating to a line bundle $\cL \in \Pic^0(C)$ its pullback $\nu^*\cL$ to $C^\nu$. If $\cL \in \Pic^0(C)$ is any line bundle on $C$, the fibers $(\nu^*\cL)_p$ and $(\nu^*\cL)_q$ of the pullback are each identified with the fiber $\cL_r$, and so with each other; conversely, if $\cM$ is any line bundle on $C^\nu$ and $\phi : \cM_p \cong \cM_q$ any isomorphism between the fibers of $\cM$ at $p$ and $q$, we can identify the fibers to arrive at a line bundle $\cL$ on $C$ whose pullback to $C^\nu$ is $\cM$ with the specified identification of fibers.
%
%We see thus that the map $\nu^*$ above is surjective, with fibers isomorphic to $\CC^*$; that is, we have an exact sequence
%$$
%0 \to \CC^* \to \Pic^0(C) \to \Pic^0(C^\nu) \to 0.
%$$
%In other words, $\Pic^0(C)$ is a $\CC^*$-bundle over $\Pic^0(C^\nu)$ (though not a product). \fix{to describe the extension, we need the Poincar\'e bundle of $C^\nu$---is this something we're planning to introduce?}
%
%A similar description applies to an irreducible curve $C$ with an ordinary cusp $r$ and no other singularities. Again,  denote by $\nu : C^\nu \to C$ the normalization map, with $p \in C^\nu$ the point lying over the cusp of $C$. Just as in the nodal case, the pullback $\nu^*\cL$ of a line bundle $\cL$ on $C$ comes equipped with a trivialization over the scheme-theoretic preimage $\nu^{-1}(p)$; the difference is that now $\nu^{-1}(p) = 2r$ is a double point. The space of such trivializations is now a copy of $\CC$ rather than $\CC^*$, so we have instead a sequence
%$$
%0 \to \CC \to \Pic^0(C) \to \Pic^0(C^\nu) \to 0.
%$$
%
%We note in passing that these descriptions of the Picard variety $\Pic^0(C)$ can also be arrived at via a variant of Abel's theorem. For example, in the nodal case, if we let $H^0(\omega_C)^*$ be the space of linear functions on the space of sections of the dualizing sheaf $\omega_C$, we can define an inclusion of the first homology group $H_1(C,\ZZ)$ (the condition that a section of $\omega$ correspond to a rational differential on $C^\nu$ with opposite residues at $p$ and $q$ allows us to define the integral of such a form along a loop passing through the node).  \fix{need a picture here}
%We can then define the Jacobian to be the quotient $H^0(\omega_C)^*/H_1(C,\ZZ)$, and a variant of the Abel-Clebsch theorem tells us that this is naturally identified with $\Pic^0(C)$.
%
%The difference here is that, while $H^0(\omega_C)^*$ is still a complex vector space of dimension $g$, the lattice $H_1(C,\ZZ)$ has rank only $2g-1$: it contains the homology of $C^\nu$, with one additional generator corresponding to a loop on $C$ passing through the node. The quotient is therefore not compact, and we arrive at the same picture of $\Pic^0(C)$ as a $\CC^*$-bundle over $\Pic^0(C^\nu)$. 
%
%We conclude this discussion with some terminology and one important fact. To start with, the object $\Pic^0(C)$ described here may be called simply the Jacobian of $C$; in some sources, however, it is called a \emph{generalized Jacobian}; the term ``Jacobian" is reserved for Jacobians of smooth curves, which are abelian varieties. Similarly, the sort of algebraic group arising here---an extension of an abelian variety by a product of $\CC^*$s and $\CC$s---is often called a \emph{semi-abelian variety}, to distinguish it from abelian varieties.
%
%\begin{fact}
%Picard varieties fit in families: if $\pi : \cC \to B$ is a flat, projective morphism whose fibers  are irreducible  curves having at worst nodes and cusps, the Picard varieties $\{\Pic^0(C_b)\}_{b \in B}$ likewise form a flat family: that is, there exists an associated morphism $\cP \to B$ whose fiber over each point $b \in B$ is the Picard variety of the corresponding curve $C_b$.
%\end{fact}
%
%\subsection{Compactifying the Jacobian}  
%
%Many of the applications of the Jacobian we gave in Chapter~\ref{} depended only on the fact that the Jacobian of a smooth curve is irreducible of dimension $g$, and those continue to hold in the case of nodal and/or cuspidal curves. For example, we have the
%
%\begin{exercise}
%Let $C$ be a projective curve of genus $g$ having only nodes and cusps as singularities. Show that a general line bundle of degree $g+3$ on $C$ is very ample.
%\end{exercise}
%
%On the other hand, many of the deeper applications of the Jacobian rely essentially on the fact that it is a complete variety, and here we need to modify our construction if we are to port over these results. We need, in other words, to \emph{compactify} the Jacobians of singular curves, if we can, and this is what we'll describe below.

\input{footer}