\input{header}

\chapter{Moduli} 
\label{Moduli chapter}\label{ModuliChapter}

\section{What is a moduli problem?}

Algebraic geometry is almost unique among geometric categories in that the objects---varieties,  schemes or maps between them---can be parametrized by other varieties or schemes. The set of submanifolds of a given manifold, or more generally of maps between two given manifolds, seems too large to be given the structure of a finite-dimensional manifold itself. By contrast, any algebraic variety is specified by a finite collection of polynomials, which in turn have a finite number of coefficients, so it's not too far-fetched that the collection of all varieties with specified numerical invariants, or morphisms between two given varieties, could be given the structure of a ``moduli space'' that is a variety (or scheme or\dots) in its own right.

For example, projective plane curves of degree $d$
are in natural one-to-one correspondence with the forms of degree $d$ modulo the group of nonzero scalars---that is, with the points of the dual of the projective space
$ \PP(H^0(\sO_{\PP^2}(d)))=\PP^{\binom{d+2}{2}-1} $.
Perhaps this is the origin of the impulse in algebraic geometry to make 
 \emph{moduli}, or \emph{parameter spaces}---spaces parametrizing algebro-geometric objects of a specified sort. In this chapter, we'll give a general framework for the notion of moduli space, introducing the main examples that we will treat in this book.

There are at least two ways in which this possibility has been useful in algebraic geometry. First, the existence of a moduli space that in some \emph{natural} parameterizes objects of a certain type allows us to speak of ``the general object'', meaning that we allow ourselves to avoid the ``special'' properties of objects parameterized by closed subvarieties of the moduli space. We have already used this
possibility in many places in this book. 

The second reason that having a moduli space is important in algebraic geometry is that it allows us to speak coherently about
families of objects. Ideally, the notion of ``natural'' should imply that every family of objects of a given sort
is obtained by pullback along a map to the moduli space of such objects. 

This idea was already exploited informally in the nineteenth century in the guise of ``preservation of number'', used to count configurations of points or curves with a given property by specializing the 
data, and we have also exploited this idea in
Chapter~\ref{JacobianChapter} to explain the count of odd and even theta characteristics on a a general curve by appealing to the existence of a specialization to a hyperelliptic curve.

In modern terms, a \emph{moduli problem} consists of a class of objects in algebraic geometry---schemes, subschemes of a given scheme, sheaves on schemes, maps of schemes, typically defined by some common attributes---and a notion of what it means to have a \emph{family} of these objects parametrized by a scheme $B$. The notion is formalized in the idea of a \emph{moduli functor}, 
which associates to each scheme $B$ the set of families of the given sort. Examples will make this vague notion more concrete.

\subsection{Examples of moduli problems}

\begin{enumerate}\label{list of moduli problems}

\item \emph{Effective divisors on a given curve}. The objects are effective divisors of given degree on a given smooth, projective curve $C$. A family of such divisors is a subscheme $\cD \subset B \times C$, flat of degree $d$ over $B$. 
Here we are using
the equivalence between divisors of degree $d$ on a smooth curve and degree $d$ subschemes of the curve. The result is the symmetric power $C_d$, discussed in Section~\ref{symmetric section}.

\item \emph{Line bundles on a given curve}. The objects are line bundles of given degree on a given smooth projective curve $C$. A family of line bundles over $B$ is an equivalence class of line bundles $\cL$ on $B \times C$ whose restriction to each fiber of $B \times C$ over $B$ has degree $d$, with the equivalence relation that two families $\cL$ and $\cL'$ on $B \times C$ are equivalent if $\cL$ and $\cL'$ differ by a line
bundle pulled back from $B$. 
The result is the Jacobian and Picard varieties, discussed in Section~\ref{Picard section}.

\item \emph{Hurwitz spaces}. The objects are curves of a given genus, together maps to $\PP^1$ of given degree, up to isomorphism of the curves that commute with the maps. Often the allowable ramification indices are specified.

\item \emph{Severi varieties}. The objects are plane curves
of given degree $d$ and geometric genus $g$. If $g \neq {d-1\choose 2}$
the curves will necessarily be singular but are often
constrained to have only mild singularities, usually only ordinary nodes.

\item \emph{Hilbert schemes}. The objects are curves of given degree $d$ and arithmetic genus $g$ in $\PP^r$.  A family of such curves over $B$ is a subscheme $\cC \subset B \times \PP^r$, flat over $B$,  whose fibers are smooth, projective curves of genus $g$. More generally, there are Hilbert schemes
for subschemes with any specified Hilbert polynomial or Hilbert function.

\item \emph{Moduli of smooth curves}. The objects are isomorphism classes of smooth, projective curves of genus $g$. A family over $B$ is an equivalence class of smooth, projective morphism $f : \cC \to B$ whose fibers are curves of genus $g$, wheres two such families $f, f'$
are equated if there is an isomorphism from the source of $f$ to the source
of $f'$ making the diagram
$$
\begin{diagram}
\cC && \rTo^\cong && \cC'\\
&\rdTo_f&&\ldTo_{f'}\\
&&B
\end{diagram}
$$
commutative.
\end{enumerate}


We have already encountered examples 1 and 2 in Chapter~\ref{JacobianChapter}. Severi varieties will be discussed in Chapter~\ref{PlaneCurvesChapter}; we will discuss Hurwitz spaces at the end of this chapter, in connection with basic facts about the moduli space $M_g$. In this chapter we will discuss Examples 5 and 6.



\section{What is a solution to a moduli problem?}

Given a moduli problem, we want to construct a scheme $M$ whose closed points are in natural  1-to-1 correspondence with the objects we're trying to parametrize. The word \emph{natural} is the key. Most of the time, the set of objects we are interested in has cardinality $2^{\aleph_0}$, as do all positive-dimensional varieties $M$ over $\CC$, so a mere a bijection between the points of $M$ and the objects to be parametrized is useless.

What we really want from a moduli space $M$ is to understand \emph{all} the possible families of the objects it classifies. Thus it is natural to ask that there be a \emph{universal} family $\phi: \cX\to M$ of these objects over $M$,
and that every family over another base, say $B$,  be pulled back from the one on $M$ via a morphism $B\to M$ . Since we would prefer not to count families more than once, we can ask that the 
morphism $B\to M$ be unique. Such a space $M$ with its universal family $\phi$, if if exists, is called a \emph{fine moduli space}. This can be expressed more abstractly but more succinctly by saying that there is an isomorphism of functors:
$$
\{ B \mapsto \text{families of } X \text{ over } B \} \cong \{ B\mapsto \rm{Mor}_{\rm Schemes}(B, M) \}.
$$
If $M$ is a fine moduli space then the identity map $M\to M$ corresponds to the ``universal family'' $\phi: \cX \to M$. 

If a moduli space and its universal family exist, then it is unique up to unique isomorphism: given two avatars $M,M'$ of the fine moduli space of a given moduli problem,
the universal family on $M$ corresponds to a map $M\to M'$, and we similarly produce a map $M'\to M$. The pullback of the universal family on $M$ by the composition of these two maps is again the universal family, so the composition is the identity map.

\def\eps{{\epsilon}}
One of the useful features of a solution to a Moduli problem is that it lends itself to the computation of the tangent spaces
of the moduli space. Recall that if $(R,\gm)$ is the local ring at a point $m$ on a variety $\cM$ then the (Zariski) tangent
space to $M$ at $m$ is the vector space of linear functionals $Hom_{R/\gm}(\gm/\gm^2, R/\gm)$.   Assuming that
$R$ contains its residue field $R/\gm$, such functionals
are precisely the restrictions to $\gm/\gm^2$ of the ring homomorphisms $R \to R/\gm[\eps]/(\eps^2)$ inducing the identity
$R/\gm \to R/\gm$. 
 If $\cM$ is a fine moduli space for some functor $F$, then such maps are in one-to-one correspondence
with the set $F(E)$ of families over $E := \Spec(R/\gm[\eps]/(\eps^2))$. 

Under the mild
 assumption that $F$ preserves products, which is necessary for the existence of a moduli space, 
 the vector space structure on the tangent space is immediately available from this description; for example the
 sum of two tangent vectors, represented by families $X_i \to E$ is the restriction to the diagonal
 $E \subset E\times E$
 of the product family $X \times X \to E\times E$.
This often allows one to compute the tangent space to a moduli space without knowing that the moduli space exists!

%Hilbert schemes are fine moduli spaces for subschemes of a given scheme, but 
%fine moduli spaces do not exist for all moduli problems. As we'll explain in Section~\ref{coarse moduli}, there does not exist a universal family of abstract curves of genus $g$: the moduli space of curves is
%not a fine moduli space, but has a slightly weaker property.

\section{Hilbert schemes}\label{hilbert scheme section}

The Hilbert scheme is a fine moduli space representing the functor of flat families of subschemes of $\PP^r$,
that is, the functor that takes a scheme $S$ over $\CC$ to the set of subschemes $\sX \subset S\times \PP^r$
that are flat over $S$. 

\begin{example}\label{Hilb for plane curves}
 For a simple example, consider the family of degree $d$ schemes $X$ in the plane
$Hilb_p(m)(\PP^2)$
having the Hilbert polynomial $p(m) = dm+1-{d-1\choose 2}$ of a plane curve of degree $d$. Since 
$\dim X = \deg p$, $X$ has at least a component that is 1-dimensional, and this component must have degree
equal to $d$, the leading coefficient of $p$. Since the Hilbert polynomial  of this component is already equal
to $p(m)$ we see that $X$ is in fact a plane curve of degree $d$. Note that any such curve has Hilbert polynomial 
$p(m)$. The space $Hilb_{p(m)}(\PP^2)$ is thus the projective space $\PP^{{d+2\choose 2}-1}$ of forms of degree $d$,
and the universal family is the projection 
$$
\{(x,F) \in \PP^2 \times \PP^{{d+2\choose 2}-1} \mid F(x) = 0\} \to \PP^{{d+2\choose 2}-1}.
$$
\end{example}
 
Since the Hilbert polynomials of the fibers of a flat family are all equal (\cite[Section III.9]{Hartshorne1977}, the Hilbert scheme is the disjoint union of components corresponding to particular Hilbert polynomials. For example, the set of curves $C \subset \PP^r$ of degree $d$ and genus $g$ corresponds to a subset of the Hilbert scheme parametrizing subschemes of $\PP^r$ with Hilbert polynomial $p(m) = dm - g + 1$. In this section, we'll describe
 the tangent spaces to the Hilbert scheme and sketch the construction. For a rigorous treatment of the construction of the Hilbert scheme, including many generalizations,  see~\cite{HomogHilbert} or \cite{MR2222646}. In Chapters~\ref{HilbertSchemesChapter} and~\ref{HilbertSchemesCounterexamplesChapter}, we'll describe  the Hilbert schemes of curves of low degree and genus in $\PP^3$ in more detail. 

\subsection{The tangent space to the Hilbert scheme}

Following the general recipe for tangent spaces to fine moduli spaces, we need to understand flat families
of projective schemes over $E := \Spec \CC[\eps/(\eps^2)$. Recall that the if $X\subset \PP^r$ is smooth then
the dual of the exact sequence
$$
0\to \sI_{X/\PP^r}/\sI_{X/\PP^r}^2 \to \Omega_{\PP^r}\mid_X \to \Omega_X \to 0
$$
identifies $\sHom(\sI_{X/\PP^r}/\sI_{X/\PP^r}^2, \sO_X)$ with the \emph{normal bundle} of $X$ in $\PP^r$.
By analogy, for any subscheme $X\subset \PP^r$ we define the \emph{normal sheaf} to be
$$
\sN_{X/\PP^r} := \sHom(\sI_{X/\PP^r}/\sI_{X/\PP^r}^2, \sO_X).
$$

\begin{theorem}\label{tangent space of Hilb}
Let $X\subset \PP^r$ be a projective variety with Hilbert polynomial $p(m)$. The flat families 
$\sX \subset \PP^r\times E$ specializing to $X$ at the closed point defined by $(\eps)$
are in natural one-to-one correspondence with the vector space $Hom_{\PP^r}(\sI_{X/\PP^r}, \sO_X) = H^0(\sN_{X/\PP^r})$, which is thus the tangent space to the Hilbert scheme $Hilb_{p(m)}(\PP^r)$ at $[X]$.
\end{theorem}

\begin{proof}
We will actually treat the analogous result for an affine scheme $X \subset \AA^r$; since our construction is natural, it will patch on an affine cover to give the projective case stated above. To simplify the notation, set $U = \CC[\eps]/(\eps^2)$, 
and $T = \CC[\eps]/(\eps^2) = S \oplus \eps S$.

A $U$-module $M$ is flat  over $U$ if and only if $\Tor_1^U(\CC,M) = 0$. 
Since the free resolution of $\CC$ as a $U$-module has the form
$$
\cdots \rTo^\eps U \rTo^\eps U \rTo^\eps U \rTo \CC \rTo 0
$$
we have $\Tor_1^U(\CC,M)=0$ if and only if the submodule of $M$ annihilated by $\eps$ is $\eps M$.

%The algebra $T/I'$ is flat over $U$ if and only if $\Tor_1^U(T/I', \CC) = 0$.
%Let 
%$$
%F_2 \to F_1 \to T \to T/I' \to 0
%$$
%be the beginning of a $T$-free resolution of $T/I'$. Since $-\otimes_U\CC$ is right exact, 
%$\Tor_1^U(T/I', \CC)$  is the kernel of $F_1 \otimes \CC \to I$ modulo the image of
%$F_2 \otimes \CC \to F_1\otimes C$. Thus $\Tor_1^U(T/I', \CC) = 0$ if and only if
%all the relations on generators of $I$ can be lifted to relations on generators of $I'$.

We now construct a flat family from a homomorphism: Let $I = (g_1,\dots, g_t)\subset S = \CC[x_1,\dots, x_r]$ be the ideal defining $X$. 
Note that $Hom_S(I/I^2, S/I) = Hom_S(I,S/I)$.Let $\phi: I\to S/I$ be a homomorphism, and let $h_i\in S$ be
any element reducing to $\phi(g_i)$ modulo $I$.  The ideal
$\tilde I := (g_1+\eps h_1,\dots, g_t+\eps h_t)\subset S[\eps]/(\eps^2)$
defines a scheme over $\Spec U$ which restricts to $X$ modulo $(\eps)$; that is, $I' +(\eps) = I$. 

To see that $\tilde I$ is 
independent of the lifting chosen, suppose that $k_1,\dots,k_t\in I$ so that $g_i+\eps(h_i+k_i)$ are a different lifting,
generating an ideal $\tilde I'$.
Writing $k_i = \sum r_{i,j}g_j$ we have $g_i+\eps(h_i+k_i) = g_i+\eps h_i+ \sum \eps r_ij(g_i+\eps h_i)$, so 
$\tilde I' \subset \tilde I$, and symmetrically $\tilde I \subset \tilde I'$.

To prove flatness, suppose that $a\in T$ and  $\eps a  \in I'$,
so that we can write  $\eps a= \sum(r_i+\eps s_i)(g_i+\eps h_i) \in T$.
It follows that 
$\sum r_i\g_i = 0$. Since $\phi$ is a homomorphism this implies $\sum r_i h_i \in I.$ Thus
$\eps a \in  \eps I\subset T$, whence $a\in I + (\eps)$.  Writing $a =\sum p_i g_i+\eps b'$
and using the relations $g_i \equiv \eps h_i \hbox{ mod } I'$ we get
 $a \equiv \eps (\sum p_i h_i+b') \hbox{ mod } I'$, as required.

Finally, we must construct a homomorphism from a flat family over $U$ in a way that is inverse to the construction above: Given an ideal $\tilde I \subset T$ such that $T/\tilde I$ is flat over $U$ and $\tilde I + (\eps) = I +\eps$, 
let $J$ be the image of $\tilde I$ in $T/(\eps I) = S \oplus (\eps S)/(\eps I)$. We claim that $J$ is the graph of a homomorphism $\phi: I \to  (\eps S)/(\eps I) \cong S/I$. 

Since $\tilde I + \eps S = I +\eps S$,  the projection  to the first  summand of $S'$ maps $J$ onto $I$. 
To prove that $J$ is the graph of a homomorphism, it suffices to show that this projection is an isomorphism.
The kernel is
the intersection of $J$ with the second factor $(\eps S)/(\eps I )$, so we must show that
if $r\in S$ and $\eps r \in \tilde I$ then $\eps r \in \eps I$. 

Since $\eps r \in \tilde I$, the condition of flatness implies
that the image of $r$ in $T/\tilde I$ is in $\eps(T/\tilde I)$, which is to say that $r \in \tilde I + \eps S = I +\eps S$.
Thus $r \in  I + \eps S,$ whence $\eps  r \in \eps I$ as required.

Thus
$J$ defines a homomorphism $\phi$ as claimed, which means that
 $\tilde I$ is generated by $\{g+\phi g\mid g\in I\}$, so the two constructions are inverse to one another.
\end{proof}

\begin{example}\label{Hilb for plane curves-continued}
If $C$ is the plane curve of degree $d$ defined by a form $F$, then the ideal sheaf of $C$ is $\sO_{\PP^2}(-d)$, and thus
$$
\sI_{C/\PP^2}/\sI_{C/\PP^2}^2 = \sO_{\PP^2}(d)\mid_C = \sO_C(d).
$$
From the exact sequence 
$$
0\rTo\sO_{\PP^2}\rTo^F\sO_{\PP^2}(d) \rTo\sO_C(d)\rTo 0
$$
we deduce that the dimension of the tangent space to $Hilb_{p(m)}(\PP^2)=\PP^d$  at $C$
with $p(m) = dm+1-{d-1\choose 2}$,
is $h^0(\sO_C(d)) = h^0(\sO_{\PP^2}(d))-1 = \dim \PP^d$, as expected.
\end{example}

\

\subsection{Parametrizing twisted cubics} We  start with an example. As we've seen, a twisted cubic curve $C \subset \PP^3$ can be described as the zero locus of three homogeneous quadratic polynomials $Q_1, Q_2$ and $Q_3$ in the homogeneous coordinates on $\PP^3$; to specify the twisted cubic we could just list the $3 \times 10 = 30$ coefficients of these. But of course we could replace the three quadrics $Q_i$ with any three independent linear combinations of them; what matters---and what is is naturally associated to $C$---is the vector space $V = \langle Q_1, Q_2, Q_3 \rangle \subset H^0(\cO_{\PP^3}(2))$ that they span. This suggests that we consider the map of sets
$$
h : \{ \text{twisted cubic curves } C \subset \PP^3 \} \to G = G(3, H^0(\cO_{\PP^3}(2)))
$$
obtained by associating to a twisted cubic $C$ the second graded piece of its homogeneous ideal. 

We should point out one respect in which this differs from the example of plane curves given at the beginning of this chapter: there, the objects to be parametrized were the zero locus of a single polynomial, and we could vary those coefficients arbitrarily and still have a plane curve; thus, the image of the analogous map was open in the projective space $\PP^N$. In the present situation, though, if we vary the coefficients of the three quadratic polynomials $Q_i$ generally, the resulting quadrics will no longer intersect in a twisted cubic curve, but rather in eight points in $\PP^3$. Thus the image of the map $h$ is more complicated.
In fact, we'll see in Section~\ref{*****} below that the image of this map is a locally closed subvariety $U$ of the Grassmannian (we'll give the equations cutting it out in $G$), and the image can lay claim to being the moduli space of twisted cubics in $\PP^3$.

In the meantime, we can analyze the open subset of the Hilbert scheme consisting of twisted cubics as follows:

\begin{proposition}\label{hilb of twisted cubics}
The open subset $\cH^\circ$ of the Hilbert scheme $Hilb_{3m+1}(\PP^3)$ parametrizing twisted cubics is irreducible of dimension 12.
\end{proposition}

\begin{proof}  Let $C_0 \subset \PP^3$ be a twisted cubic, and consider the family of translates of $C_0$ by automorphisms $A \in \PGL_4$ of $\PP^3$: that is, the family
$$
\cC = \{ (A, p) \in \PGL_4 \times \PP^3 \; \mid \; p \in A(C_0) \}.
$$
Via the projection $\pi : \cC \to \PGL_4$, this is a family of twisted cubics, and so it induces a map
$$
\phi : \PGL_4 \to \cH^\circ.
$$
Since every twisted cubic is a translate of $C_0$, this is surjective, with fibers isomorphic to the stabilizer of $C_0$, that is, the subgroup of $\PGL_4$ of automorphisms of $\PP^3$ carrying $C_0$ to itself. By the discussion in Section~\ref{linear series 1}, every automorphism of $C_{0}$ is induced by an automorphism of $\PP^{3}$, so the stabilizer is isomorphic to $\PGL_2$ and  thus has dimension 3. Since $\PGL_4$ is irreducible of dimension 15, we conclude that \emph{$\cH^\circ$ is irreducible of dimension 12}.
\end{proof}


\subsection{Construction of the Hilbert scheme in general}

The Hilbert scheme as a whole is more complicated, even for the Hilbert polynomial $3m+1$. Not all curves of a given degree and genus lie on the same number of hypersurfaces of degree $m$ for all $m$. Furthermore, when we posed the problem, we spoke of parametrizing all subschemes $X \subset \PP^r$ with a given Hilbert polynomial; even in the case of twisted cubics there are many subschemes of $\PP^3$ that have the same Hilbert polynomial $3m+1$ as a twisted cubic---for example, the union of a plane cubic and a point---but that are not the intersection of the quadrics containing them. (See Exercises \ref{characterization of degree} and Exercise~\ref{deg of disjoint union}). 
%\begin{fact}
% \fix{State Murphy's law. Mention that we don't know about curves in P3.}
%\end{fact}

A fundamental result of~\cite{Matsusaka} provides a place to start:

\begin{lemma}\label{matsusaka}
Let $p(m) \in \QQ[m]$ be a polynomial. There exists an integer $m_0$ such that

\begin{enumerate}  

\item For any subscheme $X \subset \PP^r$ with Hilbert polynomial $p_X = p$ we have
$$
h^0(\cI_{X/\PP^r}(m)) = \binom{m+r}{r} - p(m) \quad \text{for all } m \geq m_0
$$
or in other words the Hilbert function of $X$ agrees with the Hilbert polynomial $p_X = p$ for all $m \geq m_0$; and

\item For any subscheme $X \subset \PP^r$ with Hilbert polynomial $p_X = p$ and for all $m \geq m_0$, $X$ is the intersection of the hypersurfaces of degree $m$ containing it.
\end{enumerate}
\end{lemma}
%\fix{a much stronger result is true: these forms generate the truncation of the saturated ideal. Mention Gotzmann?
Note that  for any given $X$ the existence of an $m_0$ satisfying the statement of the lemma is immediate by Serre's vanishing theorem~\ref{Serre-Grothendieck vanishing}. The point of the lemma is that we can find one value of $m_0$ that works for all $X$ with Hilbert polynomial $p$. The following result of Gotzmann provides a method for determining $m_0$. 

\begin{theorem}
The Hilbert polynomial  of the homogeneous coordinate ring of any scheme $X\subset \PP^r$ can be written uniquely in the form
$$
\chi(\sO_X(m) = {m+a_1\choose a_1}+ {m+a_2 -1\choose a_2}+ \cdots+{m+a_s -(s-1)\choose a_s},
$$
with 
$$
a_1\geq \cdots \geq a_s \geq 0
$$
where the binomial coefficients are interpreted as polynomials in $m$. Moreover, the homogeneous ideal of $X$ is
then generated in degrees $\leq s$, and one can take $m_0 = s$ in the construction of the Hilbert Scheme, above.
\end{theorem}
See~\cite{MR1023391} %Green-Gotzmann
for an exposition and a proof. From the coefficients $a_j$ one can read off uniform vanishing theorems for $H^i(\sI_X)$
 as well.
 
 For example, the Hilbert polynomial $3m+1$ of the twisted cubic may be written as
 $$
 3m+1 =  {m+1\choose 1}+ {m+1 -1\choose 1}+{m+1 -2\choose 1}+{m+0 -(3)\choose 0},
 $$
 Here $s=4$, and indeed the homogeneous ideal of the union of a plane cubic with a point, also in the plane,
 requires equations of degree 4.
 
The first item allows us to define a  map of sets
$$
h : \left\{ \text{subschemes $X \subset \PP^r$ with $p_X=p$} \right\}  \to G\big(\binom{m_0+r}{r} - p(m_0), p(m_0)\big)
$$
by sending $X$ to $H^0(\cI_{X/\PP^r}(m_0))$; the second implies that this map is injective.  In Section~\ref{eqns of Hilb} we give a set of equations on $G = G(\binom{m_0+r}{r} - p(m_0), p(m_0))$ with common zero locus the image $\im(h)$, showing that $\im(h)$ is closed and giving it the structure of a scheme; this is the Hilbert scheme we seek.


We observed above that if $Q_1, Q_2$ and $Q_3$ were general quadrics, their intersection would be
8 points,  not a twisted cubic. What we want to know is how to tell these cases apart algebraically. One way to do this is to consider the multiplication map
$$
V \otimes H^0(\cO_{\PP^3}(1)) \to H^0(\cO_{\PP^3}(3)).
$$
We saw in Chapter~\ref{genus0And1Chapter} that the cokernel of this map is the 10-dimensional space $H^0(\sO_{\PP^1}(9))$, so the image of this map is 10-dimensional, whereas
3 general quadrics form a complete intersection and would have only Koszul syzygies, so
in the case of general quadrics this map would have 12-dimensional image.
This is a map from a 12-dimensional vector space to a 20-dimensional one, and what we've seen is that if $V$ is the net of quadrics containing a twisted cubic, it has a 2-dimensional kernel; that is, it has rank 10. 

Thus if $S$ is the universal subbundle on $G = G(3, H^0(\cO_{\PP^3}(2))$, and  $H^0(\cO_{\PP^3}(d))\otimes \sO_G$ is the trivial bundle, then the multiplication map above gives a map of vector bundles
$$
\mu: S \otimes H^0(\cO_{\PP^3}(1)) \to H^0(\cO_{\PP^3}(3))
$$
We can represent this locally as a matrix of functions, and the minors of this matrix vanish on the points of
of the Hilbert scheme: in a neighborhood of a point in $G$ corresponding to a twisted cubic, the common zero locus of these minors is the locus of nets of quadrics containing a twisted cubic

\subsection{Equations defining the Hilbert scheme}\label{eqns of Hilb}

In fact, the construction of the Hilbert scheme in general is no more structurally complicated than this special case. Given a polynomial $p(m)$, we find a value of $m_0$ that satisfies the statement of Lemma~\ref{matsusaka}; we let
$$
G = G\big(\binom{m_0+r}{r} - p(m_0), p(m_0)\big)
$$
be the Grassmannian, and let $h$ be the map from the set of subschemes of $\PP^r$ with Hilbert polynomial $p$ to $G$ sending $X$ to $H^0(\cI_{X/\PP^r}(m_0))$. We then get a map of vector bundles  on $G$
$$
S \otimes H^0(\cO_{\PP^r}(1)) \to H^0(\cO_{\PP^r}(m_0+1)),
$$
and indeed in a neighborhood of any point of $G$ in the image of $h$, the common zero locus of the minors of size $\binom{r+m_0+1}{r} - p(m_0+1)$ of a matrix representative of this map is the image of $h$; and these functions define the Hilbert scheme.

\subsection{Subschemes of a given scheme}

Though the Hilbert scheme is a priori about subschemes of projective space, it is easy to see that if $X\subset \PP^n$,
then the family of subschemes $Y$ of $X$ with given Hilbert function $p$ is a closed subscheme of $Hilb_p(\PP^n)$: we simply
add the condition that the vector space of forms of high degree defining $Y$  contain the vector space defining $X$---this is also a determinantal condition.

\section{$M_g$}

In the remainder of this chapter, we will discuss the moduli space central to the theory of algebraic curves: the moduli space of curves of genus $g$ up to isomorphism.

\subsection{Genus 2}                                                                                             

Again we start with an example: the moduli space of smooth projective curves of genus $2$. We have seen that the simplest way to represent a curve $C$ of genus 2 is via the canonical map $\phi_K : C \to \PP^1$, which expresses $C$ as a 2-sheeted cover of $\PP^1$ branched over 6 distinct points $p_1,\dots,p_6 \in \PP^1$. Since this expression is unique, we see that the moduli space $M_2$ of smooth curves of genus 2 is---at least set-theoretically---the set of unordered 6-tuples of distinct points in $\PP^1$, modulo the automorphism group ${\rm Aut}(\PP^1) = PGL_2$.

 If we choose an ordering of the points $p_i$, there is a unique automorphism of $\PP^1$ carrying $p_1, p_2$ and $p_3$ to $0$, $1$ and $\infty$ respectively.  The remaining three points will be sent to three distinct points in $\PP^1 \setminus \{0, 1, \infty \} $. Of course, this depends on how we order the points in the first place; at the end of the day, we see that the symmetric group $S_6$ acts on the quasi-projective variety
$$
\Gamma = \left( \PP^1 \setminus \{0, 1, \infty \} \right)^3 \setminus \Delta
$$
(where $\Delta$ is the union of all diagonals in the triple product), and the set $M_2$ of isomorphism classes of smooth curves of genus 2 is thus identified with the points of the quotient variety $\Gamma/S_6$.

There are many questions to address---for example, is the variety $\Gamma/S_6$ a fine moduli space in the sense that there is a universal family?---but this construction at least does two things: 
%\fix{ say that it is a fine moduli space -- see Harris-Marrison thm 1.53, p. 33}

One, it may serve to convince us that $M_2$ is irreducible of dimension 3; and

Two, it allows us to write down explicitly a ``general curve of genus 2:" this is just the curve
$$
y^2 = x(x-1)(x-a)(x-b)(x-c)
$$
with $a, b$ and $c$ general scalars. We will discuss the analogous question for curves of any genus $g$ in Section~\ref{Hurwitz section} below.

\subsection{Higher genus}

In the genus 2 example, we worked with the canonical map $\phi_K$, expressing a given curve $C$ of genus 2 as a 2-sheeted cover of $\PP^1$, so that the moduli space of curves of genus 2 could be realized as the space of such double covers modulo $\PGL_2$. What if we adopted the same approach in genus 3? If a curve $C$ of genus 3 is non-hyperelliptic, the canonical map embeds $C$ as a smooth quartic curve in $\PP^2$. Since this realization is unique up to automorphisms of $\PP^2$, we could realize the space $\tilde M_3$ of non-hyperelliptic curves as the quotient of the space of smooth plane quartic curves---an open subset of the $\PP^{14}$ of all quartic curves---by the action of ${\rm Aut}(\PP^2) = PGL_3$. 

We can include the hyperelliptic curves as well if we take the the bicanonical map $\phi_{2K} : C \to \PP^{3g-4}$ (or, if we want to include the case of genus 2, the tricanonical map  $\phi_{3K} : C \to \PP^{5g-6}$). This means we have to replace the relatively simple ``space of smooth plane quartic curves" (an open subset of $\PP^{14}$) with the more daunting ``locally closed subset of the Hilbert scheme of curves of genus $g$ and degree $6g-6$ in $\PP^{5g-6}$,"
%\fix{why not open?}
 whose construction was given in Section~\ref{Hilbert scheme section}.

In this case we want to take the quotient of a subset of the Hilbert scheme by the positive-dimensional group $PGL_{5g-5}$. Unlike of the orbit space of a finite group, the orbit space in this case cannot be realized as an algebraic variety!

This is the central problem of \emph{geometric invariant theory} as developed by David Mumford in the first edition of~\cite{GIT}. We will treat the theory as a black box; to explain its inputs and outputs, we will describe a relatively well-understood example. For further examples (and a beautiful exposition) see~\cite{IntroModuli}.

\subsection{An example: plane cubics}

The simplest way to describe the moduli space of smooth curves of genus 1 is to observe that every such curve can be expressed as a 2-sheeted cover of $\PP^1$ branched over 4 points, and to construct the moduli of unordered 4-tuples of distinct points in $\PP^1$, much as we did in the case of curves of genus 2 above.

But suppose we tried a different approach: suppose we observed that any curve of genus 1 can be realized as a plane cubic, and tried to construct the moduli space by taking the quotient of the space $\PP^9$ of plane cubics---the Hilbert space---by the group ${\rm Aut}(\PP^2) = PGL_3$. 

Any $PGL_3$ orbit in $\PP^9$ contains in its closure the locus of points in $\PP^9$ corresponding to triple lines: after a change of variables adding suitable multiples of $x$ to $y$ and $z$, the curve $C$ will be defined by a cubic of the form $F(x,y,z) = x^3+$ terms in the ideal $(y,z)$.
Consider $F(x,ty, tz)$, and let $t$ go to 0. Thus in the topological quotient $\PP^9/PGL_3$ the point corresponding to triple lines is in the closure of every other point; this could not be an algebraic variety.

The same problem occurs in a less obvious fashion for other orbits. For example, in suitable coordinates every smooth cubic $C$ has affine equation of the form $y^2-x^3 - ax - b$, and the family of cubics
$$
y^2 - x^3 - t^2ax - t^3b %\fix{multiply z by t, y by 1/t, x by 1}
$$
has the cuspidal curve $y^2-x^3$ as limit. 
%\fix{what's the simplest way to see this?}
%$y^2 = x(x-1)(x-\lambda)$
%$x \to x-\lambda/3$ %\fix{maybe $x' = x+(1+\lambda)/3$ -- Tschirnhausen transformation
Thus, if a quotient existed, the point corresponding to the orbit of a cuspidal cubic would lie in the closure of every point corresponding to a smooth cubic. 

A related phenomenon involves curves with nodes: as the reader can verify, the orbit in $\PP^9$ corresponding to irreducible cubics with a node contains in its closure the locus of reducible cubics consisting of a line and a conic meeting transversely; and this orbit contains in its closure the orbit of triangles, cubics consisting of three non-concurrent lines. Thus even after restricting to an open set that contains nodal cubics, any continuous map 
to a separated space that sends orbits to points all three of these orbits must map to the same point.
These phenomena are typical of the problems that Geometric Invariant theory solves.

\subsection{Stable, semistable, unstable}

In general, given a projective variety $X \subset \PP^N$ and a reductive subgroup $G \subset PGL_{N+1}$ that carries $X$ into itself, we wish to construct a map from the set of orbits
to a projective space that preserves as much of the structure of the orbit space as possible. Thus
the output must correspond to a graded ring, and the obvious thing to try is the ring of invariants
of the homogeneous coordinate ring of the closure of $X$

However, unlike the affine case, the group may not act by transformations of the homogeneous coordinate ring $A$ of $X$, since the elements of $A$ are not functions on $X$. Thus, we need to lift the action of 
$G$ to the action of a (possibly larger) group on $A$.  This is called a \emph{linearization} of the action, and in the most general setting of group actions,
a choice of linearization matters.  But in our setting, since the kernel of the map $SL_{N+1} \to PGL_{N+1}$ consists of diagonal matrices of finite order, the kernel acts trivially on forms of degree a multiple
of $N+1$, and thus
on the homogeneous coordinate ring of the $(N+1)$-st Veronese embedding. Thus the linearization is irrelevant, and we may assume from the outset that our action lifts to the homogeneous coordinate ring $A$.

By Hilbert's theorem\footnote{Hilbert's Theorem covers the action of $SL_{N+1}$ in characteristic 0, the general case of a reductive group in any characteristic is more complicated, and combines ideas of 
Hilbert, Mumford and Haboush} the subring $A^G \subset A$ of invariant elements is finitely generated over the ground field, and the projective variety best approximating the set of orbits of $G$ on $X$ 
is $\Proj(A^G)$, usually denoted $X//G$. In view of the example above, we must ask what might be
the relationship between the points of $X//G$ and the orbits of $G$? 

To answer this question, GIT performs a sort of triage on the points of $X$ (or their orbits), dividing them into three classes:

\begin{enumerate}

\item  \emph{Stable} points. These are the points whose orbits are closed. They comprise an open subset $X^s \subset X$, and the points of an open subset of $X//G$ correspond one-to-one to the stable orbits, that is, an open subset that is set-theoretically $X^s/G$. In the case of the action of $PGL_3$ on the $\PP^9$ of plane cubics, the stable points are the smooth plane cubics, and the quotient is the affine $j$-line.

\item \emph{Strictly semistable} points. These are the points $p$ such that there exists an invariant form not vanishing at $p$.  Together with the stable points, comprise a larger open subset $X^{ss} \subset X$, called the \emph{semistable} locus. Two  semistable points $p,q$ map to the same point in $X//G$ if and only if $\overline{Gp}\cap \overline{Gq} \neq \emptyset$. In the example of the action of $PGL_3$ on  $\PP^9$, the semistable  locus contains  the orbits of smooth and nodal plane cubics; that is, smooth cubics together with the three orbits consisting of irreducible cubics with a node, unions of lines and conics meeting transversely, and triangles. In the quotient, these last three orbits correspond to just one additional point, and this quotient is just the compactification of the affine line to the projective line obtained by adding one point.

\item  \emph{Unstable} orbits. These are the points $p$ on which all invariant polynomials vanish, so that the induced map
$\Proj A \to \Proj (A^G)$ is not even defined at $p$. Thus unstable points do not correspond to any points of $X//G$; in fact, they cannot be included in any topologically separated quotient of an open subset of $X$.

\end{enumerate}

Geometric invariant theory provides tools for determining this stratification. These are crucial for the application of geometric invariant theory to specific situations; a  priori, given an action of a group $G$ on a variety $X$, we don't know that there are any stable orbits at all.

\subsection{Construction and characterization of the moduli space of curves}

Geometric invariant theory gives us a way of constructing a moduli space $M_g$ of smooth  curves of genus $g$. We start with the Hilbert scheme $\cH$ parametrizing curves of genus $g$ and degree $6g-6$ in $\PP^{5g-6}$, and pass to the open subset $W \subset \cH$ of smooth curves. Within this open subset, the locus $U \subset W$ of curves embedded by their tricanonical bundles is a closed subvariety, invariant under the automorphism group of the ambient space, and it is a theorem of Mumford~\cite{GIT} that all that orbits in $U$ are stable. The moduli space $M_g$ is the quotient $U/PGL_{5g-5}$.

The moduli space of curves is not a fine moduli space---it does not admit a universal family, for reasons discussed in Section~\ref{almost fine}. But it is a ``coarse moduli space", the best possible approximation to a fine moduli space in the category of varieties, in the following sense:

\begin{definition}
A \emph{coarse moduli space} for a moduli problem defined by a set of objects $M_0$ and a functor $F$ of families is a scheme $M$ of finite type over $k$ together with 
a natural transformation to the functor of morphisms of schemes
$$
\Psi: F\to \Mor(-, M)
$$
such that the closed points of $M$ are in one-to-one correspondence with the elements of $M_0$ and
for every scheme $M'$ and natural transformation $\Psi': F \to \Mor(-, M')$
there is a unique morphism $\eta: M\to M'$ so that $\Psi' = \Psi\circ \Mor(-, \eta)$.
\end{definition}

%\fix{ Uniqueness: we'd have maps M\to M' \to M \to M', compositions identity on closed points.}

Thus, in plain language, the theorem that $M_g$ is a coarse moduli space for smooth curves of genus $g$ means: 
\begin{enumerate}
 \item The points of $M_g$ correspond one-to-one to isomorphism classes of smooth curves.
 \item For every family $\cC \to B$ of smooth curves there is a map $B\to M_g$ carrying
 each closed point  $b \in B$ to the point representing the isomorphism class of the fiber of $\cC$ over $b$
\end{enumerate}
all in a ``maximal'' way.

\section{Compactifying moduli}

The power of the theory of the moduli space of curves was greatly increased when compactifications of the space (there are many interesting ones) were understood. There are two reasons why these results are so important:

First, the great majority of the techniques that algebraic geometers have developed for dealing with varieties apply a priori to projective varieties. An easy example uses the Satake compactification, which is a projective variety containing $M_g$ in such a way that the complement---usually referred to as the "boundary"---has codimension 2. Taking successive hyperplane sections through a given point, we see that $M_g$ there is a complete one-dimensional family of \emph{smooth} curves containing any smooth curve of genus $\geq 2$. The corresponding question for 2-dimensional families of curves is open!

Often, though, we can learn the most from a compactification where boundary is a well-behaved divisor, and this is the case for the Deligne-Mumford compactification, described below. A central example of how this is used is given in Section~\ref{mgunirational}, where we take up the question, ``can we write down a general curve of genus $g$?" 

The compactification $\overline M_g$ introduced by Deligne and Mumford in their groundbreaking 1969 paper has an important extra property: it is a \emph{modular}  compactification in the sense that the points of the boundary correspond to slightly more general
objects of the same type as the points of $M_g$. 
Briefly, a projective curve $C$ of arithmetic genus $g$ is said to be \emph{stable} if its singularities, if any, are all nodes, and the automorphism group is finite.

\begin{theorem}(Deligne, Mumford, Knudsen) \cite{Deligne-Mumford}, \cite{MR702954}\label{DM is coarse}
$\overline M_g$ is a projective variety that is a coarse moduli space for stable curves 
\end{theorem}
 
The introduction of the moduli space $\overline M_g$ of stable curves has had enormous consequences for the study of the geometry of $M_g$ and hence for curve theory in general. The following consequence is an example; it shows that if a singular curve, no matter how complicated, is the limit of a 1-parameter family of smooth curves, then the singular curve can be replaced, in a certain sense, by a \emph{unique} stable curve. Here is a precise statement.

\begin{theorem}[Stable reduction]
If $\cC \to \Delta$ is an arbitrary family of curves over the spectrum of a discrete valuation ring, smooth over the complement $\Delta^*$ of the closed point, then after pulling back via a ramified map of
discrete valuation rings and a birational modification of the total space , we can arrive at a family $\tilde \cC \to \Delta'$, whose fiber over the closed point is a stable curve, uniquely determined by the original family.
\end{theorem}

\begin{proof} The uniqueness follows immediately from Theorem~\ref{DM is coarse}; the existence of the family follows from the property explained in Section~\ref{almost fine}. However, there is also a constructive proof, which we  illustrate with a simple example, below.
\end{proof}

\subsection{A smooth curve specializing to a cusp}

Here is  the simplest nontrivial case: of stable reduction:

Let $\Delta$ be $\Spec \CC[z]_(z)$, and $\pi : \cC \to \Delta$ a family of curves such that:
\begin{enumerate}
\item The generic fiber $C_\eta$ is smooth
\item The fiber $C_0$ is reduced and irreducible, with one ordinary cusp $p$; and
\item The total space $\cC$ is smooth.
\end{enumerate}

Concretely, one could take the family in $\Spec \CC[z]_(z) \times \AA^2$
defined by $\$y^2-x^3+z(g(x,y)) = 0$ for a general polynomial $g$; but the argument below is independent of such a choice.

In these circumstances, the stable reduction theorem says that for some $m$, if we let $\beta : \Delta \to \Delta$ be the map given by $z \mapsto z^m$ and form the fiber product
$$
\tilde \cC := \cC \times_\Delta \Delta \to \Delta
$$
there exists a surface $S$ birational to $\tilde \cC$ such that the induced map $S \to \Delta$ is regular and has stable fibers. We will now describe the process by which we can construct this new family, and what its special fiber looks like.

\fix{add pictures 3.57-3.67 from~\cite{MR1631825}}

To get rid of the cusp in the special fiber we blow up $\cC$ until the special fiber has set-theoretic normal crossings (i.e., the reduced fiber has only nodes). This can be achieved in three steps:

\begin{enumerate}

\item First, of course, we blow up the point $p \in \cC$; that is, we take $S_1 := Bl_p\cC \to \Delta$. The proper transform $\tilde C_0$ of the cuspidal curve $C_0$ is now smooth; the fiber of $S_1$ over the origin $0 \in \Delta$ is the union of $\tilde C_0$ and the exceptional divisor $E_1$ of the blow up, with $E_1$ simply tangent to $
\tilde C_0$ at a point $q$. Note that since $p$ is a point of multiplicity 2 in the original fiber $C_0$,  the scheme-theoretic fiber of $S_1$ over $0 \in \Delta$ consists of $\tilde C_0$ plus the exceptional divisor $E_1$ with multiplicity 2.

\item At this point, the reduced special fiber $\tilde C_0 \cup E_1$ has a tacnode, so we have to blow up again at the point $q$; we'll call the resulting surface $S_2$ and the exceptional divisor of this second blow up $E_2$. We'll let $\pi : S_2 \to \Delta$ be again the composite map, and by abuse of notation we'll denote the proper transform of $C_0$ in $S_2$ again by $\tilde C_0$, and the proper transform of $E_1$ again by $E_1$. Note that since $q$ was a triple point of the fiber, the new exceptional divisor $E_2$ will appear as a component of multiplicity 3 in the fiber $\pi^{-1}(0)$; we have
$$
\pi^{-1}(0) = \tilde C_0 + 2E_1 + 3E_2.
$$
The first exceptional divisor $E_1$ is now transverse to the proper transform $\tilde C_0$ of the original fiber, but we haven't achieved our goal of set-theoretic normal crossings: the new exceptional divisor $E_3$ passes through the point $r$ of intersection of $E_1$ with $\tilde C_0$, forming a triple point of the reduced fiber of $S_2$ over $0 \in \Delta$. From bad to worse!

\item We have to blow up again at the point $r \in S_2$ and this achieves our goal of a nodal reduced fiber: the proper transforms $\tilde C_0$ of the original fiber and of the two previous exceptional divisors $E_1$ and $E_2$ are now disjoint, and the new exceptional divisor $E_3$ meets each transversely in one point. As a divisor, the fiber is now
$$
\pi^{-1}(0) = \tilde C_0 + 2E_1 + 3E_2 + 6E_3.
$$
\end{enumerate}

It remains to deal with the multiplicities in the special fiber. We can accomplish this with a base change followed by normalization: Starting with a family $S \to \Delta$ of curves, we first make a base change of some order $k$; that is, we replace the family $S \to \Delta$ with the fiber product $S \times_\Delta \Delta'$, where $\Delta'$ is again the spectrum of $\CC[z]_(z)$, mapping to $\Delta$ by the map $z \mapsto z^k$. We then normalize $S \times_\Delta \Delta'$ to arrive at a normal surface $S'$ fibered over $\Delta'$.

What is the effect of this process? To answer this, we'll describe it in the case $k=2$, and then extrapolate. Suppose to begin with we have a component $C$ of the special fiber $C_0$ with multiplicity $m$---in other words, at a smooth point $p \in C$, we can find local coordinates $(u,v)$ on $S$ with $C$ given as the locus $u=0$ and the map $S \to \Delta$ given by $(u,v) \mapsto u^m$. When we make a base change of order 2, we introduce a new variable $w$ with $w^2 = z$; so the local defining equation of the fiber product is $w^2 = u^m$.

What happens now when we normalize? If $m = 1$, nothing; the fiber product is already smooth. If $m=2$, by contrast, normalizing replaces the preimage of $C$ with an unramified two-sheeted cover of $C$, which appears with multiplicity 1 in the fiber of the new family. And in general, there are two cases:
\begin{enumerate}
\item If $m$ is odd, then the preimage of $C$ maps 1-1 to $C$, and appears in the fiber of the new family with the same multiplicity as $C$; while
\item If $m$ is even, the preimage of $C$ is a 2-sheeted cover of $C$, which appears in the fiber of the new family with multiplicity one half the multiplicity with which $C$ appeared in the fiber of the original family.
\end{enumerate}

A similar description applies when we perform a base change of prime order $p$ followed by normalization (and since any base change can be factored into a product of base changes of prime order, this is enough): if $C$ is a smooth component of the special fiber of multiplicity $m$ divisible by $p$, $C$ is replaced by a $p$-sheeted cover of $p$, with multiplicity $m/p$; while if $m$ is not divisible by $p$, the preimage of $C$ maps one-to-one to $C$ and has the same multiplicity as $C$. In other words, \emph{carrying out a base change of order $p$ followed by normalization replaces $S$ by the cyclic cover of $S$ branched over the union of the components of $C_0$ having multiplicity not divisible by $p$}. Note in particular that is this union is singular, so will be our new surface; thus we have to avoid this situation in we want to stay in the realm of smooth surfaces.

To see this process in our example, we start by making a base change of order 2 followed by normalization; this replaces $S$ by the two-sheeted cover of $S$ branched over the union of the curves $\tilde C_0$ and $E_2$; since $\tilde C_0$ and $E_2$ are disjoint, this union is smooth and the resulting surface is again smooth. Meanwhile, $E_1$ and $E_3$ are replaced by double covers of themselves branched over their points of intersection with $\tilde C_0 \cup E_2$; this means $E_1$ is replaced by two curves $E_1'$ and $E_1''$ each mapping isomorphically to $E_1$, and appearing in the fiber with multiplicity 1; and $E_3$ is replaced by a 2-sheeted cover branched over the two points of intersection of $E_3$ with $\tilde C_0 \cup E_2$. This is again a rational curve, which we'll call $E_3$, and which appears with multiplicity 3 in the special fiber of the new family. Altogether, the new picture is:

\

To get rid of the remaining multiplicities, we need to make a second base-change-and-normalization, this time of order 3. Again, we are lucky, in that the union of the components of the special fiber with multiplicity prime to 3 (that is, $\tilde C_0 \cup E_1' \cup E_1''$) is smooth, so that carrying out this second base change yields a smooth surface, with fiber over $0 \in \Delta$ consisting of $\tilde C_0$, two smooth rational curves $E_1'$ and $E_1''$, three smooth rational curves $E_2', E_2''$ and $E_2'''$, and finally a component $E_3$ which is a cyclic triple cover of the original $E_3$ branched over three points---by Riemann-Hurwitz, a curve of genus 1. (In general one would have to resolve the singularity of the resulting surface.)

\

At this point, we have achieved most of our goals: the (scheme-theoretic) special fiber is indeed nodal. The only thing that keeps the special fiber from being stable if the presence of smooth rational components in the special fiber meeting the rest of the fiber in only one point; and these can be blown down. We arrive finally at a family $S \to \Delta$ whose fiber over $0 \in \Delta$ is the union of the normalization $\tilde C_0$ of the original fiber, together with a curve of genus 1 meeting $\tilde C_0$ at one point.

\section{$M_g$ and $\overline M_g$ are almost fine}\label{almost fine}

Though these are not fine moduli spaces, they come close. We state the result for $\overline M_g$, and the similar statement follows for $M_g$:

\begin{fact}
\begin{enumerate}
\item If $X \to B$ and $X' \to B$ are families whose associated maps $B \to \overline M_g$ are the same then there exists a finite cover $\pi : \tilde B \to B$ such that the pullback families $X \times_B \tilde B$ and $X' \times_B \tilde B$ are the same; and
\item For any morphism $B \to \overline M_g$, there exists a finite cover $\pi : \tilde B \to B$ such that the composition $\pi \circ \phi : \tilde B \to \overline M_g$ is the map associated to a family $X \to \tilde B$
\end{enumerate}
\end{fact}

In other words, while the definition of a fine moduli space would require an isomorphism $\phi$ from the functor of families
to $\Mor(-, \overline M_g)$ in fact the natural transformation has ``finite kernel and cokernel".

 \fix{need citations and/or text.}


%Here is an example of the application of this theorem. In the chapter on plane curves, we introduce the \emph{Severi variety} $V^d_g$: in the space $\PP^N$ parametrizing all plane curves of degree $d$, it is the locus of reduced and irreducible curves of geometric genus $g$. This is only a locally closed subset of $\PP^N$; we'd like to understand better what plane curves correspond to points in its boundary.
%
%One way to approach this problem is to first establish that  $V^d_g$ has dimension $3d+g-1$, so that if $p_1,\dots,p_{3d+g-1} \in \PP^2$ are general points in the plane, there will be a finite number of reduced and irreducible curves $C_\alpha$ of degree $d$ and genus $g$ passing through $p_1,\dots,p_{3d+g-1}$. We can now ask, if we vary the points $p_i$ until $d+1$ of them are collinear, what are the limits of the curves $C_\alpha$?
%
%The key to answering this question is stable reduction. A priori, the limits $C_0$ of the curves $C_\alpha$ can be arbitrarily singular. But applying stable reduction, we can realize them as images of curves with at most nodes as singularities, and these can be analyzed in straightforward fashion. This analysis, and its surprising conclusions, can be found in \cite{**},  \cite{**} and  \cite{**}. (Severi problem, HM and CH)


\subsection{Can one write down a general curve of genus $g$?}\label{mgunirational}

More precisely: does there exist  a family of curves depending freely on parameters---in other words, a family $\cC \to B$ over an open subset $B \subset \AA^n$---that includes a general curve of genus $g$, in the sense that the induced map $\phi_\cC : B \to M_g$ is dominant? 	

We have produced such a family in genera 2 and 3. Essentially
the same approach works in genera $4$ and $5$; in each case a general canonical curve is a complete intersection, so that if we take the coefficients of its defining polynomials to be general scalars we have a general curve.

This method breaks down when we get to genus 6, where a canonical curve is not a complete intersection. But it's close enough: as discussed in Chapter~\ref{Brill-Noether}, a general canonical curve of genus 6 is the intersection of a smooth del Pezzo surface $S \subset \PP^5$ with a quadric hypersurface $Q$; since all smooth del Pezzo surfaces in $\PP^5$ are isomorphic, we can just fix one such surface $S$ and let $Q$ be a general quadric.

It gets harder as the genus increases. Let's do one more case, genus 7, which already calls for a different approach. Here we want to argue that, by Brill-Noether theory, a general curve of genus $7$ can be realized as (the normalization of) a plane septic curve with 8 nodes $p_1,\dots,p_8 \in \PP^2$. Moreover, t having nodes at 8 general points imposes $24= 3\times 8$ independent conditions on the $\PP^{35}$ of curves of degree 7. 
If we let $S = Bl_{p_1,\dots,p_8}(\PP^2)$ be the blow-up, and let $l$ and $e_1,\dots,e_8$ be the classes of the pullback of a line and of the eight exceptional divisors respectively, a divisor of class $7l - 2 \sum e_i$ is a curve of genus 7 on $S$. Thus the curves on $S$ form a linear series, parametrized by a projective space $\PP^{11}$.

The problem is, there are many such surfaces $S$; we don't have a single linear system that includes the general curve of genus 7. The good news is, that's OK because the surfaces $S$ themselves form a rationally parametrized family. Explicitly, if we look at the set $\Phi$ of pairs $(S, C)$ with $S = Bl_{p_1,\dots,p_8}(\PP^2)$  the blow-up of $\PP^2$ at eight points and $C \subset S$ a curve of class $7l - 2 \sum e_i$ on $S$, then $\Phi$ is a $\PP^{11}$-bundle over $(\PP^2)^8$, and so is again a rational variety; choosing a rational parametrization of $\Phi$ we get a family of curves of genus $7$ parametrized by $\PP^{27}$ and dominating $M_7$. As before a general point in $\PP^{27}$ yields a general curve of genus 7.

A similar approach works through genus 10, but fails in genus 11: by the Brill-Noether theorem, the smallest degree of a planar embedding of a general curve of genus 11 is 10; by our $g+2$ theorem, such a curve has ${9\choose 2}-11 = 25$ nodes. But $3 \times 25 > 65$, the dimension of the space of plane curves of degree 10, and the situation only gets worse if we look at higher degrees. Thus the nodes are no longer general points of $\PP^2$, and the genus 7 argument doesn't work. 
 Ad hoc (and much more difficult) arguments were given in genera 11, 12 13 and 14, but so far no-one can go further in producing general curves. 

One application of the construction of $\overline M_g$ was the proof that this sequence cannot go much further! To say that there exists a family $\cC \to B$ over an open subset $B \subset \AA^n$ such that the induced map $\phi_\cC : B \to M_g$ is dominant implies that $M_g$ is \emph{unirational}.  In fact an even stronger result is true:

\begin{theorem}
There is no rational curve through a general point of $M_g$; that is, $M_g$ is not uniruled.
\end{theorem}
\begin{proof}
The set of curves of genus $g$ posessing a divisor $D$ with $\rho(D) = g - (r(D)+1)(\deg(D) -g + r(D)) = -1$ is an effective divisor
in the moduli space, and this leads to the construction of an effective pluricanonical divisor on the desingularization of $\overline M_g$. The proof of this
was carried out in
\cite{Harris-Mumford-Moduli}, \cite{HarrisModuli}, and \cite{Eisenbud-HarrisModuli}
 for all genera $g \geq 23$.
If $M_g$ were uniruled, then there would be non-trivial deformations of a general rational curve in $M_g$, 
and thus the normal bundle of the general rational curve $\phi: \PP^1 \to M_g$, pulled back to $\PP^1$, would have positive degree. 
Furthermore, an effective pluricanonical form is by definition represented by a nontrivial global section of a tensor power
of $\wedge^{\dim M_g}\Omega_{M_g}$ and the pull-back of this section section to From the  would have glo there would be a nontrivial map from $\PP^1$ to $\overline M_g$, and thus to a desingularization, that met the pluricanonical divisor properly, and thus an effective canonical divisor on $\PP^1$, a contradiction.
%\fix{say something about restricting a plurican div} 
\end{proof}
 
 A consequence is that the sort of descriptions of embeddings with which much of this book is concerned, where we produce a surface on which a general curve of a certain sort lies, cannot be continued to high genus:

\begin{fact}
 A general curve $C$ of  genus $\geq 22$ does not lie in a nontrivial linear series on any surface
 except those birational to $C\times \PP^1$.
\end{fact}


\subsection{$M_g$ is not a fine moduli space}\label{coarse moduli}

Let $B$ be a curve with a fixed-point free involution $\sigma$; equivalently, let $B \to B_0$ be a map of smooth curves of degree 2, with no branching. It is easy to construct such a map starting with any curve $B_0$ of genus $\geq 1$ by homotopy theory. 
To show that no fine moduli space of smooth curves can exist, we will construct two non-isomorphic families over $B$ that
would both correspond to the same map $B_0\to M_g$. Another somewhat different obstruction to the existence is given in 
\cite[Chapter 6]{DE-JH-schemes}

Let $C$ be any smooth curve of genus $g$ with an involution $\tau : C \to C$, and let 
$$
S := B \times C/\langle (\sigma, \tau) \rangle \to B_0 := B/\langle \sigma \rangle.
$$
For each $b \in B$ we are identifying the fiber of $B \times C$ over $b$ with the fiber over $\sigma(b)$ via the map $\tau$. Since $\sigma$ has no fixed points, neither does the involution $(\sigma, \tau)$ of $B \times C$; so that the map $S \to B_0$ is a family of smooth curves of genus $g$.

All the fibers of $S \to B_0$ are isomorphic to $C$. Thus if $M$ were a fine moduli space for curves of genus $g$,
 the induced map $B_0 \to M$ would be the constant map sending $B_0$ to the point $[C] \in M_g$. This would be the
 same for the trivial family over $C\times B_0 \to B_0$. This contradicts the hypothesis that $M$ is a fine moduli space. 


\section{Hurwitz spaces and the dimension of $M_g$}\label{Hurwitz section}

Recall that the \emph{Hurwitz spaces},  parametrize branched covers of $\PP^1$ of specified degree and genus. In the simplest case, where we consider only simply branched covers, we can give at least a local description of these spaces. We will use this to estimate the dimension of the moduli space $M_g$.

We start by recalling from Chapter~\ref{genus 2 and 3 chapter} the description of connected, simply branched covers of $\PP^1$: given $b = 2d + 2g - 2$ distinct points $p_1,\dots,p_b \in \PP^1$, we have a natural bijection between the set of maps $C \to \PP^1$ of degree $d$ simply branched over the points $p_i$ and unramified elsewhere; and the set of $b$-tuples $\tau_1, \dots, \tau_b \in S_d$ of transpositions in the symmetric group $S_d$
satisfying the conditions that the product $\tau_1\cdot \dots \cdot \tau_b = e$ is the identity, and $\tau_1, \dots, \tau_b$ generate a transitive subgroup of $S_d$, modulo simultaneous conjugation by elements of $S_d$. 

Now suppose we allow the points $p_i$ to vary in $(\PP^1)^{2g+2} \setminus \Delta$, where $\Delta$ is the union of the 
diagonals $p_i=p_j$. Locally, the same correspondence between branched covers and $b$-tuples of transpositions can be carried out simultaneously and consistently. Thus, if we let $U = (\PP^1)^b \setminus \Delta$ be the complement of the big diagonal in $(\PP^1)^b$---that is, the space of ordered $b$-tuples of points in $\PP^1$, the set
$$
H := \{ (f, B) \mid f : C \to \PP^1 \text{ is simply branched over } B \}
$$
can be given the structure of a topological covering space of $U$ via projection on the second factor. $H$ thus has the structure of a complex manifold of dimension $b$.

In fact, $H$ has the structure of an algebraic variety; there are many variants of this construction, in which we allow the points to come together and thereby include non-simply branched covers. The space $H$ also has a useful modular compactification, as shown in \cite{Harris-Mumford-Moduli}. We will not pursue these lines, but rather use $H$
to estimate the dimension of the moduli space $M_g$.

To set this up, consider the map $\rho : H \to M_g$, in which we forget everything except the domain $C$ of the map $f$. For $d \gg g$, this map is surjective (this follows, for example from the $g+1$ theorem of Chapter~\ref{JacobianChapter}). Thus it suffices to know the dimension of the general fiber: how many simply branched maps $f : C \to \PP^1$ are there?

A map $f : C \to \PP^1$ is given by a rational function on $C$, whose polar divisor $D = f^{-1}(\infty)$ can be any divisor of degree $d$ on $C$ if $d$ is large. Moreover, once we specify $D$, we know by Riemann-Roch (again, for large $d$) that the space of rational functions with polar divisor $D$ is a subset of a vector space of dimension $d-g+1$. Thus the fibers of the map $\rho$ have dimension $2d-g+1$; and since the space $H$ has dimension $b = 2d+2g-2$, we conclude that
$$
\dim M_g = (2d+2g-2)-(2d-g+1) = 3g-3.
$$

\subsection{When is a general curve of genus $g$ a $d$-sheeted cover of $\PP^1$?}

We just used the Hurwitz space to estimate the dimension of the moduli space $M_g$; we did this by focussing on the case $d \gg  g$. Amusingly, we can now turn this around and answer (at least in one direction) the question posed above. The point is, to say that a general curve of genus $g$ a $d$-sheeted cover of $\PP^1$ is tantamount to saying that the map $H \to M_g$ from the space $H$ of $d$-sheeted covers of $\PP^1$ of genus $g$ to $M_g$ is dominant; if this is the case, we must have
$$
\dim H = 2d+2g-1 \geq \dim M_g = 3g-3;
$$
or in other words we have

\begin{corollary}\label{BN dim 1}
A general curve of genus $g$ is a $d$-sheeted cover of $\PP^1$ only if $d \geq \frac{g+2}{2}$.
\end{corollary}

In fact, the converse is also true, and together they form the case $r=1$ of the \emph{Brill-Nother theorem}, which we'll discuss in general in Chapter~\ref{BNChapter}. 

\section{Exercises}

%\begin{exercise}\label{symmetric power vs Hilbert scheme}
%\begin{enumerate}
% \item If $X$ is a smooth curve, then the Hilbert scheme of finite subschemes of $X$ of degree $d$ is
% isomorphic to the symmetric product of $d$ copies of $X$.
% \item If $X$ is a singular curve or any variety of dimension $r \geq 2$, the symmetric power $X^{(d)}$ is \emph{not} the Hilbert scheme of subschemes of dimension 0 and degree $d$ on $X$. 
% 
% %\fix{maybe needs a hint, especially since we can't do even the first part!}
%\end{enumerate}
% \end{exercise}


\begin{exercise}
It is not an accident that we can characterize a fine moduli space $M$ in terms of the maps into it. 
 Let $X$ be a category, and $F,G$ two functors from $X$ to the category of sets.
 A morphism $\eta: F\to G$ in the category of functors is what is called a \emph{natural transformation}:
 for every object $a\in X$ there is a morphism $\eta_a:F(a) \to G(a)$ such that for every
 morphism $f: a\to b$ in $X$ the compositions $G(f)\circ \eta_a$ and $\eta_b\circ F(f)$
 are equal. 
\begin{enumerate}
 \item Prove Yoneda's Lemma: If $X$ is any category, and $F$ is a contravariant functor from $X$ to the category of sets, then 
 $$
 \Hom_{\hbox{\scriptsize Functors on $X$}}(\Hom_X( -, Z), F) = F(Z)
 $$
 \item Conclude that if the functors $\Hom_X( -, Z)$ and $\Hom_X( -, Z')$ are isomorphic in the functor category, 
 then $Z \cong Z'$ in $X$; that is, the functor $\Hom_X( -, Z)$ determines the object $Z$.
 \end{enumerate}
\end{exercise}

\begin{exercise}\label{deg of disjoint union}
Suppose that a scheme $X\subset \PP^n$ is the disjoint union of subschemes $Y,Z$. Show that the Hilbert polynomial of
$X$ is the sum of the Hilbert polynomials of $Y$ and $Z$. What statement can you make about the Hilbert functions?
\end{exercise}

\begin{exercise}
More generally, suppose that a scheme $X\subset \PP^n$ is the union of subschemes $Y,Z$. Show that the Hilbert polynomial of
$X$ is the sum of the Hilbert polynomials of $Y$ and $Z$ minus the Hilbert polynomial of $Y\cap Z$. 
\end{exercise}

%\fix{ insert exercises about wild components of the Hilbert scheme. Start with a funny 0-scheme (Iarrobino). refer to the "fact" about Murphy's law }

\begin{exercise}
Let $H \subset \PP^3$ be a 2-plane; let $C \subset H$ be a plane cubic curve and $p \in H \setminus C$ and point in $H$ not on $C$; let $X = C \cup \{p\}$.
\begin{enumerate}
\item Show that the Hilbert polynomial of $X$ is $p_X(m) = 3m+1$.
\item Show that the smallest value of $m_0$ satisfying the statement of Lemma~\ref{} is 4.
\end{enumerate}
\end{exercise}

\begin{exercise}\label{rational normal hilbert}
Use an  argument like that of Proposition~\ref{hilb of twisted cubics} to show that the restricted Hilbert scheme $\cH^\circ \subset \cH_{0,r,r}$ of rational normal curves $C \subset \PP^r$ is irreducible of dimension $r^2+2r-3$.
\end{exercise}


\input{footer}