\input{header}

\chapter{Appendix: Homological algebra and duality}\label{CA appendix}
\section{Introduction} 

Once a curve is embedded in projective space, questions about the curve are also questions in commutative algebra. From the 1920s through the 1950s commutative algebra, in the works of Noether,  Krull,  Zariski and others, was focused on the theory of ideals in Noetherian rings. But with the work of Auslander, Buchsbaum and Serre homological techniques became important. This means, roughly, focusing on modules over these rings (representation theory) and on complexes of modules, especially free resolutions. The groundwork for this extension had of course been laid by Cayley, Hilbert, Macaulay, Gr\"obner\dots, but always in the context of polynomial rings. 

\section{Modules and sheaves: local and global cohomology}\label{local coho section}

When we study projective varieties both graded modules and the sheaves associated to them play a role. As Serre explained in %cite{Serre1955}, 
the category of coherent sheaves is the category of finitely generated graded modules \emph{modulo} the subcategory of graded modules of finite length. One expression of this is the relationship between local and global cohomology, which we will explain in this section. For the sake of simplicity, we will stick with coherent sheaves on projective space.

Let $S= k[x_{0}, \dots, x_{n}]$, the homogeneous coordinate ring of $\PP^{n}$, and write. Recall that the cohomology of the sheaf $\cM$ associated to a graded $S$-module $M$ is the cohomology of the Cech complex:
$$
\cC(M): 0\to \bigoplus_{0\leq i \leq n}^{n} M_{x_{i}} \to \bigoplus_{0\leq i<j\leq n} M_{x_{i}x_{j}} \to \cdots
$$
where $M_{m}$ denotes the localization of $M$ at the powers of $m$, corresponding to the restriction of the sheaf to the open set where $m \neq 0$. The same formula works for a module 
over any finitely generated graded $k$-algebra $R$ and the corresponding sheaf on $\Proj R$.
The homology of this complex at the term
$$
\bigoplus_{0\leq j_{0}<j_{1}<\cdots<j_{i}\leq n} M_{x_{j_{0}}x_{j_{1}}\cdots x_{j_{i}}}
$$
is 
$$
H^{i}_{*}(\cM):= \bigoplus_{d\in \ZZ} H^{i}(\cM(d)),
$$
the sum of the $i$-th cohomology spaces of all twists of $\cM$.

It is easy to see that we can add $M$ itself to the left of this complex, making an augmented complex
$$
\cC'(M): 0\to M \to \bigoplus_{0\leq i \leq n}^{n} M_{x_{i}} \to \bigoplus_{0\leq i<j\leq n} M_{x_{i}x_{j}} \to \cdots
$$
We define the homology of this complex to be the \emph{local cohomology} $H_{\gm}(M)$ of $M$ with respect to the ideal $\gm := (x_{0},\dots,x_{n})$. It follows immediately that for $i\geq 1$ we have
$H^{i}_{*}(\cM) = H^{i+1}_{\gm}(M)$, and this holds degree by degree: the local cohomology module inherits a grading from $M$ and the fact that the $x_{i}$ are homogeneous and its homogeneous component of degree $d$ is
$H^{i}(\cM(d))$. Thus the modules $H_{\gm}^{i}$ have geometric meaning for $i\geq 2$. 

We can easily elucidate the meaning for $i=0,1$ as well: First, the elements of $M$ that map to 0 in $M_{x_{j}}$ are the elements annihilated by some power of $x_{j}$ so $H^{0}_{\gm}(M)$ is the set of elements annihilated by some power of every $x_{j}$, or equivalently annihilated by some power of the maximal ideal. This is precisely the set of elements that go to 0 under the natural map
$M\to H^{0}_{*}(\cM)$.  In particuar, if
$M$ is the homogeneous coordinate ring $R = S/I$ of an algebraic set $X$, then $I$ is the saturated ideal of $X$ if and only if $H^{0}_{\gm}(R) = 0$.

We can interpret $H^{0}_{\gm}(M)$ in module-theoretic terms too: Write 
$(0_{M}:\gm^{e})$ for the elements of $M$ annihilated by $\gm^{e}$, and 
$H^{0}_{\gm}(M) =(0_{M}:\gm^{\infty})$ for the union of all the $(0_{M}:\gm^{e})$. Since $M$ is Noetherian, we have
$H^{0}_{\gm}(M) =(0_{M}:\gm^{e})$ for some $e$.  Since M is graded, this can be interpreted as the maximal submodule of $M$ of finite length. 

The discussion above shows that the sequence
$$
0 \to H^{0}_{\gm} (M) \to M\to H^{0}_{*}(\cM)
$$
is exact. But from the definitions it follows at once that we can extend this to an exact sequence
$$
0 \to H^{0}_{\gm} (M) \to M\to H^{0}_{*}(\cM) \to H^{1}_{\gm} (M) \to 0.
$$

The module $H^{1}_{\gm}(M)$ also has an important interpretation: Consider again the case $M = R = S/I$, corresponding to a projective scheme $X$, and suppose for simplicity that 
$n\geq 2$, so that $H^{1}(\cO_{\PP^{n}}(d)) = 0$ for all $d$. In this case the long exact sequence in cohomology associated to 
$$
0\to \cI_{X} \to \cO_{\PP^{n}} \to \cO_{X}\to 0,
$$
begins
$$
0\to H^{0}_{*}(\cI_{X}) \to H^{0}_{*}(\cO_{\PP^{n}}) \to H^{0}_{*}(\cO_{X})\to H^{1}_{*}(\cI_{X}) \to 0.
$$
Since the image of $H^{0}_{*}(\cO_{\PP^{n}}) \to H^{0}_{*}(\cO_{X})$ is  the same as
the image of $S/I \to H^{0}_{*}(\cO_{X})$ (both are equal to $S_{X}$), 
this shows that $H^{1}_{\gm}(S/I) = H^{1}_{*}(\cI_{X})$. This module will play an important role in the treatment of linkage, below.

The local cohomology modules  are typically artinian, but not finitely generated. But there is an 
expression of the cohomology of a sheaf or module in terms of finitely generated modules. If
$M = \oplus_{i} M_{i}$ is a graded module over a standard graded polynomial ring $S = k[x_{0}..x_{n}]$, and $M$ has infinitely many nonzero components, then the dual 
$\Hom_{k}(M,) = \prod_{i} M_{i}$ is naturally a module over the power series ring 
$\hat S = k[[x_{0}..x_{n}]]$, and thus is never finitely generated over $R$. But we can also form the
\emph{graded dual}, $\Hom_{k,gr}(M,k) := \oplus_{i}\Hom_{k}(M_{i},)$, which is again an $S$-module.

\begin{theorem}[Local duality]\label{local duality}
Let $S = k[x_{0}..x_{n}]$ be a standard graded polynomial ring over $k$. If $M$ is a finitely generated graded $S$-module, then
$$
H^{i}_{\gm} M = \Hom_{gr,k}(\Ext_{S}^{n+1-i}(M,S), k).
$$
\end{theorem}
\begin{exercise}
 Explain what is different from the above in the case $X\subset \PP^{1}$.
\end{exercise}

\section{Homological commutative algebra} 

The groundwork for homological commutative algebra was laid by Arthur Cayley, David Hilbert, Frances Sowerby Macaulay, Wolfgang Gr\"obner and others, in the context of polynomial rings. The rings we encounter in studying projective geometry are mostly factor rings $S/I$ where $S$ is a polynomial ring, or localizations (and more rarely completions) of these. But after the work of Emmy Noether and her student Wolfgang Krull it was apparent that much of commutative algebra could be done axiomatically, without reference to a base polynomial ring, making the theory at once simpler and more powerful. With the work of Chevalley, Zariski, and Cohen it became clear that most of the basic properties of interest were best treated starting from the case of local rings.

In this tradition, we will begin by describing homological properties of local rings. 
However, every statement can be transposed to the setting of a standard graded algebra, graded modules, and homogeneous ideals, where by a \emph{standard graded algebra} we mean a positively graded algebra $R$ over a field $k$ such that $R_{0} = k$ and $R$ is generated as an algebra by the finite-dimensional vector space $R_{1}$. The analogue of the maximal ideal of a local ring is then the maximal homogeneous ideal (necessarily generated by $R_{1}$. We will occasionally remark on this case, but generally leave the translation to the reader. It is also possible to define a local ring to be a non-negatively graded ring $R$ whose degree zero component is a local (ungraded) ring, and to develop the whole theory in this style, in parallel with Grothendieck's idea that it is best always to work with varieties over some base scheme. But this adds enough weight to otherwise simple arguments that we have not taken this path. 

After discussing various properties of local rings, we will return to the standard graded case, and think of a standard graded ring $R$ as a module over the standard graded polynomial ring $S := k[R_1]$. We will interpret many of the properties we have discussed in terms of syzygies and Betti tables of $R$ as an $S$-module.

All rings in this chapter will be assumed Noetherian. To indicate that $R$ is a local ring with maximal ideal $\gm$ and residue field $R/\gm = k$, we sometimes  say: ``Let $(R,\gm,k)$ be a local ring.'') We denote by $\dim R$ the \emph{Krull dimension} of $R$; that is, the maximum length of a chain of prime ideals in $R$.

\subsection{Regular local rings and syzygies}
Let $(R,\gm,k)$ be a local ring. By the Principal Ideal Theorem \cite[]{E}, the maximal ideal $\gm$ cannot be generated by  $<\dim R$ elements.

\begin{definition}
 We say that $R$ is \emph{regular} if $\gm$ can be generated by $\dim R$ elements.
\end{definition}

This deceptively simple property was first identified as important by Krull, and later recognized by Zariski as the appropriate algebraic expression of nonsingularity: A point $p$ on a scheme $X$ is called nonsingular if and only if the local ring $R = \sO_{X,p}$ is \emph{regular}. This is justified by the fact that if $R$ is the local ring of a point $p$ on a variety over an algebraically closed field, then the cotangent space to $p$ is naturally identified with the 
$k$-vector space $\gm/\gm^{2}$, whose dimension is, by Nakayama's Lemma, the minimal number of generators of $\gm$. 

The analogue of ``regular'' in the case of a standard graded algebra $R$ is that $R$ is isomorphic to the 
polynomial ring on a basis of $R_{1}$. Indeed, the localization of $R$ at the maximal homogeneous ideal is regular in the local sense if and only if this condition is satisfied.

For the regularity of $\sO_{X,p}$ to be a reasonable algebraic analogue of non-singularity, it should of course imply
that $X$ is reduced and irreducible at $p$; that is, a regular local ring should be a domain. This was proven by Krull, before the work of Zariski:

\begin{proposition}
 If $R$ is regular local ring is an integral domain; that is, 0 is a prime ideal.
\end{proposition}
\begin{proof}
 We do induction on the dimension. If $\dim R = 0$ then by definition $\gm$ is generated by 0 elements, so $R = k$,
 a field. If $\dim R>0$ then by the prime avoidance theorem \cite[]{E} there is an element $x$ not contained in trhe union of $\gm^{2}$ and the minimal primes of $R$. By the Principal Ideal Theorem, $R/(x)$ has dimension $\dim R -1$ and the maximal ideal $\gm/(x)$ has $\dim R-1$ generators, so $R/(x)$ is again regular.
 
 By induction, $(x)$ is a prime ideal of $R$ that is not a minimal prime. If $Q$ is a minimal prime contained in $(x)$,
 then $q\in Q$ implies $q = q'x$ for some $q'\in R$, and since $Q$ is prime, we have $q'\in Q$. Thus
 $Q = Qx$, and it follows from Nakayama's Lemma that $Q=0$, so $R$ is a domain.
\end{proof}

This result has a consequence that leads to an important definition:

\begin{corollary}
 Let $R$ be a regular local ring of dimension $d$. If $x_{1}, \dots, x_{d}$  generate $\gm$, then 
 $x_{i+1}$ is a nonzerodivisor modulo $(x_{1}, \dots, x_{i})$ for every $i = 1,\dots, n$
\end{corollary}
\begin{proof}
 Obvious, since $R/(x_{1},\dots, x_{i})$ is again regular, and thus a domain, and $x_{i+1}\notin (x_{1},\dots,x_{i})$.
\end{proof}

We say that a sequence of elements in the maximal ideal of $R$ that satisfies the condition of the Corollary is a \emph{regular sequence}. It is convenient to extend
the definition to modules:

\begin{definition}
 Let $R$ be a commutative ring, and let $M$ be an $R$-module. A sequence of
 elements $x_{1}, \dots, x_{n}\in R$ is called a \emph{regular sequence on $M$}, or an
 \emph{$M$-sequence}, if
 $x_{i}$ is a nonzerodivisor on $M/(x_{1}, \dots x_{i-1})M$  for all $i= 1,\dots, n$, and 
 $(x_{1}, \dots, x_{n})M \neq M$.
\end{definition}

Note that if $(R,\gm,k)$ is a local ring, $(x_{1},\dots,x_{n})\subset \gm$ and $M$ is finitely generated, then he last condition is auttomatic from Nakayama's Lemma.

 Recall
that if $M$ is a finitely generated $R$-module, then an \emph{$R$-free resolution} of $M$ is a sequence of free modules and maps
$$
\FF:\qquad F_{0} \lTo^{d_{1}} F_{1}\lTo^{d_{2}} F_{2}\cdots,
$$
an \emph{augmentation} map $F_{0} \rOnto^{d_{0}} M$ such that the kernel of $d_{i}$ is equal to the image of $d_{i+1}$ for every $i$. We say that the resolution is \emph{finite of length $n$} if $F_{n+1}= 0$ but $F_{n}\neq 0$.The resolution is called \emph{minimal} if the $d_{i}(F_{i}) \subset \gm F_{i-1}$ for all $i$; it follows from Nakayama's Lemma that this is the case if and only if the rank of $F_{i}$ is equal to the minimal
number of generates of $\ker d_{i-1}$ for all $i$. 

The minimal resolution of a module is a direct summand of any resolution; and it follows that any two minimal resolutions of a module are isomorphic~\cite[Theorem ***]{E}. 

\begin{example} The Koszul complex of a sequence $x_{1}, \dots, x_{n}$: 
Consider first a single element $x = x_{1}\in R$. We define the Koszul complex on $x$, denoted $\KK(x;R)$, to be the complex
$$
\KK(x; R): \quad R \lTo^{x} R \lTo 0.
$$
This complex is a minimal free resolution of $R/(x)$ if and only if $x$ is a nonzerodivisor contained in the maximal ideal of $R$. Observe that this is also the condition for the one element sequence $x$ to be a regular sequence.

Next consider 
a pair of elements $x_{1},x_{2}\in R$. The Koszul complex
on $x_{1},x_{2}$ is the $R$-free complex
$$
\KK(x_{1}, x_{2}; R): \quad R \lTo^{
\phi_{1}= \begin{pmatrix}
x_{1}&x_{2} 
\end{pmatrix}
} R^{2}\lTo ^{
\phi_{2}=\begin{pmatrix}
x_{2}\\-x_{1} 
\end{pmatrix}
}
R\lTo 0.
$$
It is obvious that $\coker \phi_{1} = R/(x_{1}, x_{2})$. Also $\ker \phi_{2}$ is the annihilator of the ideal $(x,y)$, and it follows from the theory of associated primes that this is 0 if and only if the ideal $(x_{1}, x_{2})$ contains a nonzerodivisor. For simplicity, let us assume that $x_{1}$ is a nonzerodivisor itself, although this is not actually necessary. The kernel of $\phi_{1}$ obviously consists of the elements $(y_{2},-y_{1})\in R^{2}$ such that $y_{2}x_{1} = y_{1}x_{2}$. Since we have assumed that $x_{1}$ is a nonzerodivisor,
the element $y_{2}$ is uniquely determined by $y_{1}$ such that $y_{1}x_{2} \in (x_{1})$, usually written 
$y_{1}\in ((x_{1}):x_{2})$. Thus, given that $x_{1}$ is a nonzerodivisor,
the kernel of $\phi_{1} $ is equal to the image of $\phi_{2}$ if and only if $x_{2}$ is a nonzerodivisor mod $x_{1}$; that is if and only if $x_{1},x_{2}$ is a regular sequence. 

Note that the right-hand term $R^{1}$ of $\KK(x_{1}, x_{2}; R)$ is somehow naturally indexed by the pair of elements $x_{1},x_{2}$; rather pedantically, we could write it as $\wedge^{2}(R^{2})$. This has the advantage that $\phi_{2}$ can be described as the result of extending $\phi_{1}$ to be a degree $-1$ derivation of the exterior algebra: if we denote the basis  elements of $R^{2}$ as $e_{1}, e_{2}$ so that $\phi_{1}(e_{i}) = x_{i}$, then
$\phi_{2}(e_{1}\wedge e_{2}) = \phi_{1}(e_{1})e_{2} - e_{1} \phi_{1}(e_{2})$. 
Here the negative sign comes because we have commuted the derivation, of degree $-1$, with an element of
odd degree, $e_{1}$. This leads us to rewrite the Koszul complex in the suggestive form:
$$
\KK(x_{1}, x_{2}; R): \quad \bigwedge^{0}R^{2} \lTo^{
\phi_{1}= \begin{pmatrix}
x_{1}&x_{2} 
\end{pmatrix}
} \bigwedge^{1}R^{2}\lTo ^{
\phi_{2}=\begin{pmatrix}
x_{2}\\-x_{1} 
\end{pmatrix}
}
\bigwedge^{2}R^{2}\lTo 0.
$$

In general the Koszul complex of a sequence of elements
$\KK(x_{1}, \dots, x_{n}; R)$ is defined to be the exterior algebra of $R^{n}= \oplus_{i=1}^{n} Re_{i}$, with first differential
$$
\bigwedge^{0}R^{n} = R \lTo ^{
\phi_{1 = }\begin{pmatrix}
 x_{1}&\cdots&x_{n} 
\end{pmatrix}
}
R^{n}=\bigwedge^{1}(R^{n}) 
$$
and the other differentials defined to extend $\phi_{1}$ to be a derivation of degree $-1$, so that 
$$
\phi_{m}(e_{i_1}\wedge \cdots \wedge e_{i_{m}})
= \sum_{j= 1}^{m} (-1)^{j-1}x_{i_{j}} e_{i_{1}}\wedge\cdots \wedge \widehat{e_{i_{j}}}\wedge \cdots \wedge e_{i_{m}}).
$$
It is easy to check that $\phi_{m-1}\phi_{m} = 0$ for all $m\geq 1$, so $\KK(x_{1}, \dots, x_{n}; R)$ is a complex.

There is a surprisingly simple necessary and sufficient condition for 
$\KK(x_{1}, \dots, x_{n};R)$
to be a minimal free resolution of $\coker \phi_{1} = R/(x_{1}, \dots, x_{n})$ \cite[]{E}:

\begin{theorem} If $(R,\gm)$ is a local ring, then
 the Koszul complex $\KK(x_{1}, \dots, x_{n};R)$ is a minimal free resolution (of $R/(x_{1}, \dots, x_{n})$) if and only if 
$x_{1},\dots x_{n}$ is a regular sequence in $R$.\qed
\end{theorem}
This result also holds in the graded polynomial ring case, if we assume that the $x_{i}$ are all of
strictly positive degree. For a proof, see \cite[Theorem 17.6]{E}.
\end{example}


Here is the homological characterization of regularity:

%\begin{theorem}(Auslander, Buchsbaum, Serre \cite{}
% A local ring $R$ is regular if and only if the following equivalent statements hold:
% 
% every finitely generated $R$-module has an $R$-free resolution of finite length; and indeed of length $\leq \dim R$.
%\end{theorem}

\begin{theorem}[Auslander, Buchsbaum, Serre \cite{}]\label{regularity characterized}\label{ABS}
The following conditions on a $d$-dimensional local Noetherian ring $R$ with residue field $k$ are equivalent:
\begin{enumerate}
 \item $R$ is regular.
\item Every finitely generated $R$-module has a finite free resolution.
\item Every finitely generated $R$-module has a  free resolution of length at most $d$.
\item A minimal set of generators $x_{1},\dots, x_{d}$ of $\gm$ is a regular sequence; equivialently,
the Koszul complex $\KK(x_{1},\dots, x_{d};R)$ is the minimal  $R$-free resolution of  $k$.
\item $\Ext_R^{i}(k,M) = 0$ for all $i>d$ and all finitely generated modules $M$.
\item $\Ext_R^{d+1}(k,k) = 0$.
\end{enumerate}
\end{theorem}

Perhaps the most interesting part of this is the implication 1) $\to$ 3), a vast extension of Hilbert's Syzygy Theorem.
Given Theorem ***, and basic facts about the functor Tor, it is surprisingly easy to prove:

\begin{proof} [Proof that 1) $\to$ 3)] Suppose that $(R,\gm,k)$ is a regular local ring $M$ be a finitely generated
 $R$-module. Let $\FF$ be a minimal free resolution of $M$, so that the differentials of the complex of vector
 spaces $k\otimes_{R}\FF$ are all 0. It follows that the length of $\FF$ is the maximal $i$ such that
 $$
 H_{i}(k\otimes_{R}\FF) = \Tor_{i}^{R}(k,M) = 0.
 $$
 However, we can compute $\Tor_{i}^{R}(k,M)$ using a resolution of $k$. By Corollary\ref{} and 
 Theorem~\ref{},  the Koszul complex of a minimal sequence of generators of $\gm$  is the minimal free resolution of $k$, and it has length $d$, so $\Tor_{i}^{R}(k,M) = 0$ for $i>d$ as required.
\end{proof}

 The homological characterization of regularity enabled the proof of long-standing conjectures:
\begin{theorem} \cite{AB} If $R$ is a regular local ring then:
\begin{itemize}
 \item Every localization of $R$ at a prime ideal is again a regular local ring
  \item  $R$ is a unique factorization  domain
\end{itemize}
 \end{theorem}
 
 \subsection{Projective dimension}
The first new invariant that we can read from the minimal $S$-free resolution of a module $M$ is its length; that is, the number of nonzero maps, which is finite by the Syzygy Theorem. This is called the \emph{projective dimension} of $M$ as an $S$-module, written $pd_{S}M$. An older name, in some ways more suitable, was \emph{homological codimension}; this is justified by the following results:

\begin{proposition}\label{pd lower bound}
If $M$ is a graded $S$-module then $\pd(M)$ is at least the codimension of the support of $M$.
\end{proposition}

In case $\pd(M)$ is equal to the codimension of the support of $M$, we say that $M$ is a
Cohen-Macaulay $S$-module, or equivalently that the sheaf $\widetilde M$ is 
\emph{arithmetically Cohen-Macaulay}. When $M = S_{X}$, the homogeneous coordinate ring of a projective scheme $X$, we say that $X$ is itself is arithmetically Cohen-Macaulay. From the examples above we see that plane curves, and also the twisted cubic, are Cohen-Macaulay.

A famous result of Auslander and Buchsbaum clarifies the meaning of projective dimension. We define the 
\emph{depth} of $M$ to be the maximum length $\ell$ of a \emph{regular sequence on $M$}; that is, a sequence $G_{1},\dots,G_{\ell}$ of homogeneous forms of strictly positive degree such that 
\begin{align*}
G_{1} &\hbox{ is a nonzerodivisor on } M;\\
G_{2} &\hbox{ is a nonzerodivisor on } M/G_{1}M;\\
\vdots&\phantom{\hbox{ is a nonzerodivisor on } }\vdots\\
G_{\ell} &\hbox{ is a nonzerodivisor on } M/(G_{1},\dots,G_{\ell-1})M.
\end{align*}

\begin{theorem}
If $M$ is a finitely generated graded module over the polynomial ring $S := \CC[x_{0},\dots,x_{n}]$, and $M$ has depth $\ell$, then the projective dimension of $M$ is $n+1-\ell$.
\end{theorem}


Suppose again that $M$ is a finitely generated graded module. Every associated prime of $M$ must then be homogeneous, and, since the set of zerodivisors on $M$ is the union of all the associated primes,  there is form $G_{1}$ of positive degree that is a nonzerodivisor on $M$ if and only if the maximal ideal $\gm$ is not an associated prime of $M$, or equivalently $M$ contains no element annihilated by $\gm$ \fix{this uses prime avoidance too; probably should have a reference}. Since $H^{1}_{gm}$ is the submodule of all elements of $M$ annihilated by a power of $\gm$, we see that
the projective dimension of $M$ is $< n+1$ if and only $H^{0}_{\gm}(M) = 0$, or equivalently
$M$ is a submodule of $H^{0}_{*}(\widetilde M)$.

Though this is not obvious from the definition, all maximal regular sequences on $M$ have the same length, and if the depth of $M$ is $\ell$ then a sequence of general linear forms of length $\ell$ is a regular sequence. This makes the depth easier to compute. Even better, the depth has an interpretation in terms of  cohomology:

\begin{theorem}\label{lc char of depth}
Let $M$ be a finitely generated graded $S$-module. The depth of $M$ is the smallest integer $i$ such that $H^{i}_{\gm}(M) \neq 0$.
\end{theorem}
 
 
\begin{exercise}
 Prove Theorem~\ref{lc char of depth} by induction on the length of a maximal regular sequence.
\end{exercise}
We can easily translate this into global cohomology in the case of a module of twisted global sections:

\begin{theorem}\label{Auslander-Buchsbaum} Suppose that $X\subset \PP^{n}$ is a  subscheme without 0-dimensional (isolated or embedded) components. The module $M = \oplus_{t\in \ZZ}H^{0}(\cO_{X}(t))$
is finitely generated, and $\depth M$ is the smallest strictly positive integer $\ell$ such that 
$H^{\ell+1}(\cO_{X}(t)) \neq 0$  for some $t$. The homogeneous coordinate ring of $X$ is equal to $M$ if
$\oplus_{t\in \ZZ}H^{1}(\cI_{X}(t)) = 0$ and has depth exactly 1 otherwise.
\end{theorem}



 \subsection{Cohen-Macaulay rings}

 It is quite possible for a local ring $(R,\gm, k)$ of dimension $d$ to contain a regular sequence of length $d$
 without being regular; an easy example is the 2-dimensional local ring
 $$
 R = k[[x,y, z]]/(y^{4}-x^{3}z) \cong k[[s^{4}, s^{3}t, t^{4}]]
 $$
In fact, we claim that $z,x$ is such a regular sequence. Since the ring $R$ is 2-dimensional, and the maximal ideal requires 3 generators $x,y,z$, the ring $R$ is not regular. 

\begin{definition}
A local ring $(R,\gm,k)$ of dimension $d$ is said to be \emph{Cohen-Macaulay}  if $\gm$ contains a regular sequence of length $d$.
\end{definition}
 Note that every 0-dimensional (that is, Artinian) local ring is automatically Cohen-Macaulay.
 
The Cohen-Macaulay condition is made easier to check by the following important homological interpretation:

\begin{theorem}\label{depth}
Let $(R,\gm, k)$ be a local ring, and let $I\subset \gm$ be an ideal. 
Let $M$ be a finitely generated 
 $R$-module. Every maximal $M$-sequence in $I$ has the same length, called the \emph{depth of $I$ on $R$}, and this number is the smallest integer $i$ such that
 $\Ext^{i}_{R}(R/I, M)\neq 0$. Moreover, if $x_{1}, \dots, x_{i}$ is a maximal $M$-sequence
 in $I$ then $\Hom_{R}(R/I, M/(x_{1}, \dots, x_{i})= \Ext^{i}_{R}(R/I, M)$ is independent of the maximal regular sequence.
\end{theorem}
 
 
\begin{proof} Suppose that $x_{1}, \dots, x_{i}\in \gm$ is a maximal regular sequence
on $M$. We will show by induction on $i$ that $\Ext^{i}_{R}(R/I, M) = \Hom(R/I,  M/(x_{1}, \dots, x_{i}) \neq 0$ and
that $\Ext^{j}_{R}(R/I,M) = 0$ for $j<i$.

First suppose $i=0$; that is, every element of $I$ is
a zero-divisor on $M$. This means that $I$ is contained in the union of the finitely
many associated primes of $M$. By the Prime Avoidance Lemma \cite[****]{E} I is contained in a single associated prime of $M$, and thus $I$ annihilates a nonzero  element $m\in M$
of $M$, so that $\Hom(R/I,M)$ contains a nonzero homomorphism sending the class of 1 to $m$.

Next suppose that $i>0$. Since $x_{2}, \dots, x_{i}$ is a maximal regular sequence on $M/(x_{1})M$ we see by induction. that $\Ext_R^{i-1}(R/I, M/x_{1}M) \neq 0$ and $\Ext^{j}_{R}(R/I,M/x_{1}M) = 0$ for $j<i-1$. From the short exact sequence
$$
0\to M\rTo^{x_{1}}M \rTo M/x_{1}M \to 0
$$
we get a long exact sequence in $\Ext_R$ containing the terms
\begin{align*}
 &\Ext_R^{j}(R/I,M) \rTo^{0} \Ext_R^{j}(R/I,M) \rTo \Ext_R^{j}(R/I,M/x_{1}M) \rTo\\ 
 &\Ext_R^{j+1}(R/I,M)\rTo^{0} \Ext_R^{j+1}(R/I,M) \rTo \cdots,
\end{align*}
where the maps marked 0 vanish because $x_{1}$ annihilates $R/I$; that is, we have 
short exact sequences
 $$
0\to \Ext_R^{j}(R/I,M) \rTo\Ext_R^{j}(R/I,M/x_{1}M) \rTo \Ext_R^{j+1}(R/I,M)\to 0.
 $$
By induction, the middle term of this sequence vanishes for $j<i-1$, so 
$\Ext_R^{j}(R/I,M) = 0$ for $j<i$ and 
$$
\Ext_R^{i}(R/I,M) \cong \Ext_R^{i-1}(R/I,M/x_{1}M) \cong \Hom(R/I, M/(x_{1}, \dots x_{i}))\neq 0
$$
as required.
\end{proof}

\begin{exercise}
 Use Theorem~\ref{depth} to check that the ring
 $$
 R = k[[s^{4}, s^{3}t, st^{3}, t^{4}]]
 $$
is \emph{not} Cohen-Macaulay.
\end{exercise}

The Cohen-Macaulay property has a homological interpretation that we shall use:
\fix{should the Auslander-Buchsbaum formula go here?}

\begin{theorem} \label{lower bound for pd}
 Let $(R,\gm,k)$ be a local ring, and suppose that $S\to R$ is a map of local  rings such that $S$ is a regular local ring and $R$ is a finitely generated $S$-module. The length of a minimal resolution of $R$ as an $S$ module
 is at least $\dim S - \dim R$; and it is equal to this value if and only if the 
 ring $R$ is Cohen-Macaulay.
 \end{theorem}
  
  
  By Proposition~\ref{pd lower bound}, if $C\subset \PP^{n}$ is 1-dimensional, then the projective dimension of $S_{C}$ is at least $n-1$. But we can be much more precise. Recall that a curve $C\subset \PP^{n}$ is said to be \emph{projectively normal} if the homogeneous coordinate ring of $C$ is integrally closed (which implies, in particular, that $C$ is smooth).

\begin{theorem}
 Let $C\subset \PP^{n}$ be a purely 1-dimensional subscheme. The projective dimension of the homogeneous coordinate ring $S_{C}$ of $C$  is
$$
 pd_{S}S_{C} = 
\begin{cases}
n-1 &\hbox{if $H^{1}(\sI_{C}(t)) = 0$ for all $t\in \ZZ$}\\
n &\hbox{otherwise}.
\end{cases}.
$$
Thus in the first case $S_{C}$ is Cohen-Macaulay. In particular, if $C$ is a smooth curve, the $pd_{S}(S_{C}) = n-1$ if and only if $C$ is projectively normal. \fix{we used Serre's Criterion. Ref?}
\end{theorem}

Here is a version that gives a measure of how far $S_C$ is  from being Cohen-Macaulay:

\begin{theorem}
Let $C\subset \PP^{n}$ be a purely 1-dimensional subscheme, and let  
$$
\FF: F_{0}\lTo^{d_{1}} F_{1}\lTo^{d_{2}} F_{2}\lTo \cdots \lTo F_{n-1}\lTo {d_{n}}F_{n}\lTo F_{n+1} \lTo 0
$$
be the minimal $S$-free resolution of the homogeneous coordinate ring of $C$. We have $F_{n+1}=0$, and 
$$
\oplus_{t\in \ZZ} (H^{1}\sI_{C}(t)) = \Hom_{\CC}(\Ext^{n}(S_{C}, S(-n-1)),\CC)
$$ 
which is sometimes called the \emph{Rao module} of $C$. Thus, up to a shift in grading,
the Rao module of $C$ is the vector space dual of the cokernel of the dual $d_{n}^{*}: F_{n-1}^{*}\to F_{n}$. This is a graded module of finite length.
\end{theorem}


\fix{Having introduced local coho, this is pretty much done.}


\begin{theorem}
 Let $C\subset \PP^{n}$ be a  curve (or more generally a purely 1-dimensional subscheme). The homogeneous coordinate ring $S_{C}= S/I_{C})$ of $C$ is Cohen-Macaulay if and only if
 $H^{1}(\cI_{C}(d)) = 0 $ for all $d$.
\end{theorem}

\begin{proof}
 Except in the trivial case $n=1$ we have $H^{1}(\cO_{\PP^{n}} (d)$ for all $d$, and since 
$C$ is supposed purely 1-dimensional we have $H^{0}(\cO_{C}(d) = 0$ for $d<0$, so from the
exact sequence 
$$
0\to \cI_{c}\to \cO_{\PP^{n}} \to \cO_{C}\to 0
$$
we deduce that $H^{1}(\cO_{C}(d)= 0$ for all $d<0$ in any case.


By Theorem~\ref{lower bound for pd}, the projective dimension of $S_{C}$ is at least $\dim S -\dim S_{c}= n-1$.

 Let $\gm$ be the maximal homogeneous ideal $(x_{0},\dots, x_{n})$ of 
 the homogeneous coordinate ring $S$ of $\PP^{n}$.
 By the Auslander-Buchsbaum formula \fix{this should be first, and we should give the graded version too(x} \ref{AB} the projective dimension
 of $S_{C}$ is $n+1$ (the dimension of  $S$ minus the depth of $\gm S_{C}$, that is, the length of a maximal regular sequence in $S_{C}$, which can be taken to be homogeneous. 
 
 If a finitely generated graded $S$-module $M$ has depth $>0$ (that is, $\gm$ contains a homogeneous nonzerdivisor on $M$) then clearly no nonzero element of $M$ is annihilated by $\gm$. The converse of this statement is a consequence of the theory of primary decomposition. Further,
 writing $\tilde M$ for the associated coherent sheaf on $\PP^{n}$, we have a map
 $M \to \oplus_{d\in \ZZ}H^{0}(\tilde M(d))$ whose kernel is precisely the set of elements annihilated by
 some power of $\gm$.
 
 If $J$ is the homogeneous ideal of any scheme, then by definition $J$ is saturated; that is, no element is annihilated by $\gm$, or equivalently $\gm$ is not an associated prime ideal. Thus $S/I_{C}$ has projective dimension $\leq n = \dim S - 1$.
To simplify the notation, if $\cF$ is a coherent sheaf, then we write $H_{*}^{i}(\cF)$ for $\bigoplus_{i}H^{i}(\cF(i))$. 

Suppose now that $f\in S_{C}$ is a nonzerodivisor of degree $d$ and let $H$ be the hypersurface in $\PP^{n}$ that it defines. By Theorem *** we must decide whether $S_{C}/fS_{C}$ contains a non-zerodivisor, that is, whether 
$S_{C}/fS_{C}$ is saturated, or, equivalently, whether the map
$$
\alpha: S_{C}/fS_{C} \to H_{*}^{0}(\widetilde{S_{C}/fS_{C}})  = H_{*}^{0}(\cO_{H\cap C}). 
$$
is an injection.


The diagram below has exact rows and columns, 
\begin{diagram}[small]
&& 0&&0& \\
&&\dTo&&\dTo\\
0&\rTo& S_{C}&\rTo^{f}&S_{C}(d)& \rTo &S_{C}/(f)(d)&\rTo&0\\
&& \dTo&& \dTo&& \dTo^{\alpha}\\
0&\rTo&H_{*}^{0}(\cO_{C})&\rTo^{f}&H_{*}^{0}(\cO_{C}(d)) &\rTo& H_{*}^{0}(\cO_{H\cap C}(d))&\rTo& 0\\
&& \dTo&& \dTo&& \dTo\\
0&\rTo&H_{*}^{1}(\cI_{C})&\rTo^{f}&H_{*}^{1}(\cI_{C}(d)) &\rTo& H_{*}^{1}(\cI_{H\cap C}(d))\\
&& \dTo&& \dTo\\
&&0&&0
\end{diagram}
and it follows from a diagram chase (the ``snake lemma'') that the kernel of $\alpha$ is the same as the kernel of 
$$
H_{*}^{1}(\cI_{C}) \rTo^{f} H_{*}^{1}(\cI_{C}(d)).
$$
 By Serre's vanishing theorem, $H_{*}^{1}(\cI_{C})$ is zero in high degree, and since multiplication by $f$ raises the degree, its kernel is 0 if and only if $H_{*}^{1}(\cI_{C})$ is zero, completing the proof.
\end{proof}

\subsection{Gorenstein rings and duality}
Intermediate between the class of Cohen-Macaulay rings and the class of regular rings is the class of Gorenstein rings. Roughly speaking, they are the rings for which duality is the simplest. As we shall see, all complete intersections are Gorenstein, a fact that will be central to 
our study of linkage, below.

\begin{definition}
A local ring $(R,\gm,k)$ of dimension $d$  is said to be \emph{Gorenstein} if it is Cohen-Macaulay and 
$\Ext_R^{d}(k, R) =k$. A (not necessarily) local ring is Gorenstein if all its localizations
are Gorenstein.
\end{definition}

If $(R,\gm,k)$ is regular then the resolution of $k$ is the Koszul complex of any set of $d$ generators of $\gm$, and we see directly that
$\Ext_R^{d}(k, R) =k$, so $R$ is Gorenstein.

\begin{proposition}
 If $(R,\gm,k)$ is Cohen-Macaulay, and $x_{1}, \dots x_{s} \in R$ is a regular sequence, then $R$ is Gorenstein if and only if $R/(x_{1}, \dots x_{s})$ is Gorenstein.
\end{proposition}
 
\begin{proof}
Since every regular sequence in $R$ is part of a maximal regular sequence, it suffices to prove the result when $s = d$, the dimension of $R$ so that $\overline R = R/(x_{1}, \dots x_{d})$ is Artinian. Since $R$ is Cohen-Macaulay, the smallest $i$ such that 
$\Ext_{R}^{i}(k, R) \neq 0$ is $d$, so by Lemma~\ref{Ext and nzd}, we see that 
$$
\Ext_{R}^{d}(k, R) = \Ext_{R}^{0}(k, \overline R) = Hom_{\overline R}(k,\overline R)
$$
proving the Proposition.
\end{proof}
\begin{lemma}\label{Ext and nzd}
 If $(R,\gm,k)$ is a local ring, and $x\in \gm$ is a nonzerodivisor on $N$ that annihilates $M$, and $i$ is the smallest index such that $ \Ext_R^{i}(M, N) \neq 0$, then
 $$
 \Ext_R^{i}(M, N) = \Ext_{R}^{i-1}(M, N/xN).
 $$
for all $i$. 
 \end{lemma}
\begin{proof}
The element $x$ annihilates all the $Ext^{j}_{R}(M,N)$ because it annihilates $M$. 
The short exact sequence $0\to N\rTo^{x}N \rTo N/xN \to 0$ gives rise to a long exact sequence containing the terms
and
$$
0 =  Ext_{R}^{i-1}(M,N) \rTo Ext_{R}^{i-1}(M,N/xN) \rTo Ext_{R}^{i}(M,N) \rTo^{0} \cdots.
$$
\end{proof}

The algebraic version of the canonical module of a scheme is usually called the \emph{dualizing module}:
\begin{definition}
 Let $(R, \gm, k)$ be a local Cohen-Macaulay ring of dimension $d$. A dualizing module for $R$ is a Cohen-Macaulay
 $R$ module with $\dim M = d$ such that $\Ext^{d}_{R}(M,k)\cong k$.
\end{definition}

\begin{proposition}
 Let $R$ be a local Cohen-Macaulay ring. Any two canonical modules for $R$ are isomorphic. Moreover,
 if $R = S/I$, with $S$ regular, then $\Ext_{S}^{\codim R}(R,S)$ is a canonical module for $R$.
\end{proposition}

\begin{proof}
 ******
\end{proof}

We shall see that $(R,\gm,k)$ is Gorenstein if and only if it is Cohen-Macaulay and 
$R$ itself is a dualizing module. We begin with the 0-dimensional case, where we can identify the dualizing module with the injective hull of the residue field. Recall that $E$ can be characterized as a module $E$ containing a copy of $k$ such that 
 $k$ is \emph{essential} in $E$; that is, every nonzero submodule of $E$ meets $k$; and
$E$ maximal with this property in the sense that if $E\subsetneq E'$, then $k$ is not essential
in $E$. Such a module always exists, by Zorn's lemma, and it is not difficult to show that it it unique up to isomorphism. Except for rings of dimension 0, it is never finitely generated.

\begin{theorem}\label{duality for Gor}
If $(R,\gm,k)$ is a local ring of dimension $0$, and $E$ is the injective hull of $k$, then 
$(-)^{\vee} := \Hom_{R}(-,E)$ is a perfect duality on modules of finite length. That is,
 $(-)^{\vee}$ is a contravariant equivalence of categories. Moreover, for any module $M$ of finite length we have
\begin{enumerate}
\item $\length\ M^{\vee} = \length\ M$; in particular, $E$ is a module of finite length $= \length\ R$.
\item The natural map $\nu_{M}: M\to M^{\vee\vee}$ is an isomorphism.
\item The ring $R$ is Gorenstein if and only if $R$ has a unique minimal nonzero ideal.
\item The ring $R$ is Gorenstein if and only if $R\cong E$.
\end{enumerate}
\end{theorem}

\begin{proof}
First, since $E$ is injective the functor $Hom_{R}(-,E)$ is exact. Since $k$ is essential in $E$, 
the largest submodule of $E$ annihilated by $\gm$ must be $k$ itself.

We  prove both (1) and (2) by induction on the length of $M$. If $\length M = 1$, then $M = k$.
The previous remark shows that  
$k^{\vee} = k$, so $k^{\vee\vee}= k$, proving (1). Choosing a generator $\phi$ of
$k^{\vee}$ and a generator $\alpha$ of $k$, we see that 
$\nu_{k}$ takes $\alpha$ to the map sending $\phi$ to $\phi(\alpha) \neq 0$. Since $k$ is a simple module, $\nu_{k}: k\to k$ is a monomorphism, and thus an isomorphism, as requireed.

  Now suppose by induction that (1) and (2) are true for all modules $M'$ of length at most $j$, and that $M$ is a module of length $j+1$.
  
Any minimal nonzero submodule of $M$ is isomorphic to $k$, so we may choose an exact sequence
$0\to k\to M\to M'\to 0$. Applying $(-)^{\vee}$ we get an exact sequence
$0\to M'^{\vee}\to M^{\vee }\to k^{\vee} \to 0$, proving (1) for $M$, and a diagram
$$
\begin{diagram}[small]
 0&\rTo& k&\rTo& M&\rTo& M'&\rTo &0\\
 &&\dTo^{\nu_{k}}&&\dTo^{\nu_{M}} &&\dTo^{\nu_{M'}}\\
 0&\rTo& k^{\vee\vee}&\rTo& M^{\vee\vee}&\rTo& M'^{\vee\vee}&\rTo& 0\\
\end{diagram}
$$
with exact rows, proving (2) for $M$, and completing the induction.

To prove (3) we note that if $R$  has a unique minimal ideal $I \cong k$ if and only if
$\Hom_{R}(k,R) = k$. Since any 0-dimensional ring is Cohen-Macaulay, this is equivalent to the Gorenstein property. 

Finally we prove (4): Since $E$ has unique miminal ideal in any case, we see that
$R\cong E$ implies that $R$ is Gorenstein. Conversely, suppose that $I\cong k$ is the
unique minimal nonzero ideal of $R$. The unique map
$I\hookleftarrow E$ extends to a map $\phi: R\to E$. If $\ker \phi$ were nonzero it would contain $I$, so $\phi$ is a monomorphism. Moreover,
$\length R = \length R^{\vee} = E$, so $\phi$ is surjective as well.
\end{proof}

\begin{fact}
Conditions (2) and (4) of Theorem~\ref{duality for Gor} have extensions to the higher dimensional case, though we will not need to use them:

\begin{theorem}\label{Gorenstein characterized}
 Suppose that $(R, \gm, k)$ is a $d$-dimensional local Noetherian ring $R$. the following conditions are equivalent:
\begin{enumerate}
\item $R$ is Gorenstein.
\item $R$ has finite injective dimension (equivalently, injective dimension $d$) as an $R$-module.
\item $R$ is a Cohen-Macaulay ring and the functor $\Hom_{R}(-,R)$ is a perfect duality on the category of maximal Cohen-Macaulay modules.
  \end{enumerate}  
  \qed
\end{theorem}
\end{fact}

Note that the equivalence of 1) and s) in Theorem~\ref{Gorenstein characterized} implies that the localization of a Gorenstein ring is Gorenstein, something not obvious from the definition.


\fix{The following proof is incomplete}
\begin{proof} 
Suppose first that $d=0$ and $R$ is Gorenstein, so that $\Hom_{R}(k,R) = k$ ---that is, $R$ has a unique minimal submodule $N$, necessarily $\cong k$.

Let $E$ be the $R$-injective hull of $k$. The inclusion $N\subset R$ induces an inclusion $R\subset E$. Since
$\Hom_{R}(-, E)$ is an exact functor, and $\Hom_{R}(k, E)\cong k$, it follows by induction on the length of a finitely generated module $M$ that the length of $M$ is equal to the length of $\Hom_{R}(M, E)$.  Thus
$E = \Hom_{R}(R,E)$ has the same length as $R$, so $R$ and $E$ coincide. Thus $\Ext^{i}_{R}(M,R)$ vanishes for all $i>0$ and all $R$-modules $M$. This shows that 1) implies 2) and 3) in this case.s

Next suppose that $d=0$ and $\Ext^{1}_{R}(k,R) = 0$. So 2) implies 3) in this case.

To show that 3) implies 1), let $N$ be the largest submodule of $R$ that is annihilated by $\gm$, so that $N \cong k^{s}$ for some $s$. We must show that $s = 1$. 
The vanishing of $\Ext^{1}_{R}(R/N,R)$ shows that the map we get a short exact sequence
$$
\Hom_{R}(R,R) \to \Hom_{R}(N, R) \cong N = k^{s}
$$
is surjective. But this map factors through $R\to R/\gm = k$, so $s=1$, so $R$ is Gorenstein.

Now we do induction on $d$,  and we may suppose $d>0$. Suppose first that  there is a nonzerodivisor $x\in \gm$.

\fix{ the following para is almost right; the resolution over R/x is the mapping cone, ... -- the conditions 2,3 refer to Exts over different rings} From the exact sequences $(*)$ of Lemma~\ref{Ext and nzd} we see that each of the three conditions of the
Theorem for $R/(x)$ is equivalent to the corresponding condition for $R$. By induction, the three conditions are
equivalent for $R/(x)$, so they are equivalent for $R$.

If $R$ is Gorenstein then it is Cohen-Macaulay by definition, and since $d>0$, $\gm$ automatically contains a nonzerodivisor. Thus, to conclude the proof, it suffices to show that $\Ext_{R}^{d+1}(k,R) = 0$ implies that $R$ contains a nonzerodivisor.

In the contrary case, the prime ideal $\gm$ is an associated prime of 0; this means that there is a submodule $N$ of $R$ isomorphic to $k$.
\end{proof}


\section{Syzygies and Betti tables}

 In this section we will return to the case of standard graded rings $R$; that is, $R$ is an algebra over the field $k := R_0$, and is generated by the finite dimensional vector space $R_1$. In particular, $R$ is a homomorphic image of 
$S = k[R_1]$, and thus $R$ is Noetherian.

A module over any ring can be specified by its generators and relations. But Hilbert saw that there was something to be gained by studying the relation on the relations, and the relations on those, and so on---in short, the syzygies of the module.
In the case of a graded module $M$ over a graded ring $R$, we may take a minimal free resolution
$$
0\lTo M \lTo F_0 \lTo^d F_1\lTo^d\cdots
$$
that is graded, with differential $d$ of degree 0. Recall that $R(-a)$ denotes a rank one free graded module generated in degree $-a$ (so that $R(a)_0 = R_a$). We may then identify each $F_i$ with a direct sum of the form 
$\bigoplus_j R(-a_j)^{\gb_{i,j}}$. 
The uniqueness of minimal free resolutions hold in this case as well, so that 
the numbers $\beta_{i,j}$ depend only on the module $M$, as is obvious from the formula $\Tor_i(M,k) = \bigoplus_j k(-a_j)^{\gb_{i,j}}$

The numbers $\beta_{i,j}$ in  the minimal free resolution of $M$ are called the \emph{graded Betti numbers} of $M$; it follows from Theorem~\ref{uniqueness} that the graded Betti numbers, and all the invariants of the matrices $d_{i}$, are invariants of $M$. 
We sometimes refer to $\beta_{i,j}$ informally as the \emph{number of $i$-th syzygies of degree $j$}; more properly, it is the number of minimal generators of degree $j$ required by the module of $i$-th syzygies of $M$.

For convenience, the graded Betti numbers are usually displayed in a compact \emph{Betti table}, with the nonzero $\beta_{i,j}$ appearing in the $i$-th column and the $(j-i)$-th row: \footnote{The reason for the initially non-intuitive choice $j-i$ instead of $j$ is that, for the resolution $\FF$ to be minimal, it is necessary that if $\beta_{i,j}\neq 0$, then some $\beta_{i-1,k}\neq 0$ for some $k<j$. Thus shift by $-j$ makes the diagram more compact.) This useful convention seems to go back to Bayer and Stillman and their work on the program Macaulay in the 1980s. In those days of small displays, efficiency was even more important than now.}
%\setcounter{MaxMatrixCols}{13}
%\begin{small}
%$$
%\begin{matrix}
%j \backslash i     &0&1&2&3&4&5&6&7&8&9&10&11\\ \hline
%%\text{total:}&1&55&359&1211&2602&3824&3954&2889&1466&493&99&9 \\
%\text{0: }\vline &1&.&\text{.}&\text{.}&\text{.}&\text{.}&\text{.}&\text{.}&\text{.}&\text{.}&\text{.}&\text{.}\\
%\text{1: }\vline &.&55&320&930&1688&2060&1728&987&368&81&8&\text{.}\\
%\text{2: }\vline &\text{.}&\text{.}&39&280&906&1736&2170&1832&1042&384&83&8\\
%\text{3: }\vline &\text{.}&\text{.}&\text{.}&1&8&28&56&70&56&28&8&1\\
%\end{matrix}
%$$
%\end{small}
\setcounter{MaxMatrixCols}{13}
\begin{small}
$$
\begin{matrix}
j \backslash i     &0&1&2\\ \hline
%\text{total:}&1&55&359&1211&2602&3824&3954&2889&1466&493&99&9 \\
\text{0 }\vline &\gb_{0,0}&\gb_{1,1}&\gb_{2,2}&\cdots&\\
\text{1 }\vline &\gb_{0,1}&\gb_{1,2}&\gb_{2,3}&\cdots&\\
\text{2 }\vline &\gb_{0,2}&\gb_{1,3}&\gb_{2,4}&\cdots&\\
\vdots&\vdots&\vdots&\cdots&\\
%\text{3: }\vline &\text{.}&\text{.}&\text{.}&1&8&28&56&70&56&28&8&1\\
\end{matrix}
$$
\end{small}
\noindent We sometimes speak of the \emph{Betti table of a variety $X\subset \PP^{n}$}, by which we will mean the Betti table of the minimal free resolution
of the homogeneous coordinate ring $S_{X}$ of $X$, as a module over the homogeneous coordinate ring of $\PP^{n}.$ A couple of examples will help absorb this notation, and suggest some of what one can read from it:


\begin{example}\label{syzygies of points}
As a first example, let $X$ be a set of three non-colinear points in $\PP^2$, and let $\ell_1, \ell_2,\ell_3$ be the equations of the three
lines joining them in pairs. It is not hard to see that the ideal $I$ of the points is generated by the three products $\ell_i\ell_j$ with $i\neq j$. Since $ \ell_i(\ell_j\ell_k) = \ell_j(\ell_k\ell_i) = \ell_k(\ell_i\ell_j)$
there are two linear syzygies among these equations, and it is not hard to see that the resolution of the homogeneous coordinate ring of the points
is
$$
0\lTo S/I\lTo S
\lTo^{\begin{pmatrix}
\ell_2\ell_3&\ell_1\ell_3&\ell_1\ell_2
\end{pmatrix}}
 S(-1)^3
 \lTo^{\begin{pmatrix}
  \ell_1&0\\
  -\ell_2&\ell_2\\
 0&-\ell_3
 \end{pmatrix}}
 S(-2)^2
 \lTo 0
$$
The Betti table of the 3 points is thus
\begin{small}
$$
\begin{matrix}
j \backslash i     &0&1&2\\ \hline
%\text{total:}&1&55&359&1211&2602&3824&3954&2889&1466&493&99&9 \\
\text{0 }\vline &1&-&-\\
\text{1 }\vline &-&3&2\\
\text{2 }\vline &-&-&-\\
\end{matrix}
$$
\end{small}
The fact that the 3 and the 2 are on the same line is reflects the fact that the 2 syzygies on the ideal are linear. Note that the
ideal $I$ can be written as the ideal of $2\times 2$ minors of the matrix
$$
 {\begin{pmatrix}
  \ell_1&0\\
  -\ell_2&\ell_2\\
 0&-\ell_3
 \end{pmatrix}}.
$$
The resolution above is thus a special case of the Eagon-Northcott complex, described more generally in Chapter~\ref{ 14- canonical curves}

\begin{example}[Points in $\PP^3$]
Any point in $\PP^3$ is the intersection of 3 hyperplanes, so it has Betti table:
\begin{small}
$$
\begin{matrix}
j \backslash i &0&1&2&3\\ \hline
\text{0 }\vline &1&3&3&1\\
\text{1 }\vline &-&-&-&-\\
\end{matrix}
$$
\end{small}
Note that the matrices of the differentials in the resolution---the Koszul complex on 3 linear forms---are all linear; again, this is reflect in the fact that all the 
nonzero entries of the table are on one horizontal line.

For a more interesting example, consider a set $X$ of 7 points in linearly general position $\PP^3$. Any 6 points in linearly general position lie on a twisted cubic, so the question
one
\end{example}


\fix{skip $d=3$; go to 7 points}
If $d=3$ there are essentially two cases: If the three points  lie on a line, then their ideal has 2 linear and one cubic generators, again forming a complete intersection, and thus with Betti table:
\begin{small}
$$
\begin{matrix}
j \backslash i     &0&1&2&3\\ \hline
%\text{total:}&1&55&359&1211&2602&3824&3954&2889&1466&493&99&9 \\
\text{0 }\vline &1&2&1&-\\
\text{1 }\vline &-&-&-&-\\
\text{2 }\vline &-&1&2&1\\
\text{3 }\vline &-&-&-&-\\
\end{matrix}
$$
\end{small}
The other possibility is that the three points are general. In that case the points span a hyperplane, and within that hyperplane are cut out by
3 quadratic equations: which can be taken to be the equations of the products, 2 at a time, of the 3 lines joining pairs of the points; these three quadrics
have 2 linear syzygies among them, since multiplication by the equation of the third line gives the same form in each case. Thus the 


\end{example}

\begin{example}\label{canonical in P3}
For example, the minimal free resolution of the homogeneous coordinate ring $S_{C}$ of a canonical curve $C$ of genus 4 in $\PP^{3}$ whose ideal is generated by a quadric $q$ and a cubic $f$, as a module over the homogeneous coordinate ring $S = \CC[x_{0},\dots,x_{3}]$ of $\PP^{3}$, is the Koszul complex
\small
$$
S \lTo^{
\begin{pmatrix}
  q& f
\end{pmatrix}}
S(-2) \oplus S(-3) \lTo^{
\begin{pmatrix}
f\\-q 
\end{pmatrix}
}
S(-5)\lTo 0.
$$
\normalsize
since
$q$ and $f$ are relatively prime, and thus form a regular sequence
Thus it has  Betti table:

\setcounter{MaxMatrixCols}{13}
\begin{small}
$$
\begin{matrix}
j \backslash i     &0&1&2\\ \hline
%\text{total:}&1&55&359&1211&2602&3824&3954&2889&1466&493&99&9 \\
\text{0 }\vline &1&-&-\\
\text{1 }\vline &-&1&-\\
\text{2 }\vline &-&1&-\\
\text{3 }\vline &-&-&1\\
\end{matrix}
$$
\end{small}
\end{example}

From now on in this section, we let $S = \CC[x_{0},\dots, x_{n}]$ be the homogeneous coordinate ring of $\PP^{n}$, and we consider only free resolutions of finitely generated graded $S$-modules. In this case something quite special happens \cite[****]{E}:

\begin{theorem}[Hilbert's Syzygy Theorem]\label{hst}
The minimal $S$-free resolution $\FF$ of any finitely generated graded $S$-module $M$ is finite: in fact, $F_{i}=0$ for all $i>n+1$.
\end{theorem}

\begin{fact}
 There are in fact finite resolutions for all $S$-modules; however there is generally no reasonable notion of a  minimal resolution outside the positively graded or finitely generated local cases. See \cite{???}.
\end{fact}

 In particular since we know the Hilbert function of $S$, and thus of $S(-j)$,
$$
H_{S(-j)}(m) = 
\begin{cases}
 {n+m-j \choose n} & \hbox{for $m\geq j$}
  \\ 
 0 & \hbox{for $m<j$}
\end{cases}
$$
we can compute the Hilbert function for a finitely generated graded $S$-module $M$ from its graded Betti numbers 
$$
H_{M}(m) = \sum_{i,j} (-1)^{i}\beta_{i,j}{n+m-j\choose n}.
$$
\begin{example} [The homogeneous coordinate ring of a plane curve] 
For the simplest non-trivial example, if $C$ is a plane curve with equation $F(x_{0},x_{1}x_{2})$ of 
degree $d$, then the minimal free resolution of the homogeneous coordinate ring $S_{C}$ has the form
$$
\FF: S\lTo^{F}S(-d)\lTo 0
$$
Thus the only nonzero graded Betti numbers of $S_{C}$ as an $S$-module are
 $\beta_{0,0} = \beta_{1,d} = 1$, so
$$
 H_{S_{C}}(m) = {2+m\choose 2} - {2-d+m\choose 2}
 $$
 which has the value  $dm + 1+(2-d)(2-d-1)/2 = dtm+ (d-1)(d-2)/2 +1$. Since the degree is the leading coefficient and the arithmetic genus \fix{where is this defined?} is the constant term minus 1, we get
$\deg C = d,\ p_{a}(C) = (d-1)(d-2)/2$ as we should expect.  Note that this method of computation is not sensitive at all to whether the curve is smooth and irreducible; it works for any divisor in $\PP^{2}$.
\end{example}

\begin{exercise} 
\begin{enumerate}
 \item Show that any curve in $\PP^{3}$ whose homogeneous coordinate ring has the
 form given in Example ~\ref{canonical in P3} has degree 6 and (arithmetic) genus 4.
 
\item In Section **** we computed the genus of a smooth complete intersection curve inductively, by using the adjunction formula for curves on a smooth surface along with Bertini's Theorem.
Show that the same formula gives the arithmetic genus of an arbitrary 1-dimensional complete intersection $C$ hypersurfaces 
$X_{i} := \{F_{i} = 0\}$ of degrees $d_{i}$,
using the fact that the minimal free resolution of the homogeneous coordinate ring 
$S/(F_{1}, \dots, F_{n-1})$ of $C$  is the Koszul complex (see \cite{???}):
%\scriptsize
\small
$$
 S \lTo \oplus_{1\leq i<n}S(-d_{j}) \lTo  \oplus_{1\leq j<k<n}S(-d_{j}-d_{k}) \cdots S(-\sum_{1\leq j<n}d_{j})\lTo 0.
 $$
\normalsize
\end{enumerate}
\end{exercise}

Computing the Hilbert function was the application for which Hilbert proved the Syzygy Theorem; but if that were the only use of free resolutions, we would not be introducing them here. A more interesting feature that the Betti table of the homogeneous coordinate ring (or homogeneous ideal) of a variety $X$ reflects is the presence of a variety $Y$ containing 
$X$ and having low degree syzygies. 

Here is a  simple example:

We have seen in Chapter~\ref{Scrolls}, the homogeneous ideal $I$ of the twisted cubic curve in $\PP^{3}$ is generated by the three $2\times 2$ minors of the matrix
$$
M = \begin{pmatrix}
 x_{0}&x_{1}&x_{2}\\
  x_{1}&x_{2}&x_{3}
\end{pmatrix}
$$
We shall soon compute the Betti tables of all rational normal scrolls. In particular, we shall see that the Betti table of the twisted cubic has the form:

\centerline{\small
\begin{tabular}{r|ccc} 
$j\backslash i$&0&1&2\\ 
\hline 
0&1&$-$&$-$\\ 
1&$-$&3&2\\ 
\end{tabular}}
\noindent
where the dashes indicate that the corresponding $\beta_{i,j}$ is zero. In plain language, the table indicates  that  the ideal $I$ of the curve is minimally generated by 3 elements of degree 2, and that there are two linear relations on the 3 (that is, generators of total degree $2+1=3$, and that these freely generate the module of  syzygies of $I$ (the two relations are in fact just the columns of the transpose of the matrix $M$).

The homogeneous ideal $J$ of any set of points $\Gamma$ that lies on the twisted cubic contains $I$. Supposing that $\Gamma$ does not lie on a plane, the ideal $J$ contains no linear forms. The 2 linear relations on the generators of $I$ must be consequences of relations on the generators of $J$. But since the relations on $I$ are linear, they are of the lowest possible degree of any relations on $J$, so there must be at least 2 linear relations on the quadratic generators of $J$. Here is the way this can be used:
\begin{fact}
 A lemma of Castelnuovo \fix{exercise in Ch 8; is it really Castelnuovo?} shows  that every set of 6 points in linearly general position
in $\PP^{3}$ lies on a twisted cubic;  a set of points $\Gamma\subset \PP^{3}$ in linearly general position of cardinality $n\geq 7$ lies on a twisted cubic curve if and only if
the Betti table of $\Gamma$ is termwise $\geq$ that of the twisted cubic.\end{fact}

\section{What Makes a Complex Exact}

Given that the resolution of any module over a polynomial ring $S = k[x_1,\dots,x_n]$ (or regular local ring) has  length bounded by $n$, the resolution of an $S$-module that is a $k$-th syzygy---that is, the image of the $k$-th map in a resolution---must have length $\leq n-k$. What is special about the presentation matrix of such a module? -- put differently, what is it about the $k$-th map in a resolution that is different than the first map?

One answer to this question was given by David Hilbert in his orginal paper \cite{} and another can be given in terms of Gr\"obner bases and initial ideals \cite{}. Here we give a third answer, one that lends itself better to conceptual proofs, such as the proof of exactness of the Eagon-Northcott complex resolving the ideal of minors of a matrix given in Section~\ref{}. We give the result in a special case; in its general form in \cite{} it applies to finite free complexes over any ring.

\begin{theorem}\label{WMACE} Let 
$$
{\bf F}:  \quad 0\rTo F_m\rTo^{\phi_m} \cdots\rTo^{\phi_2} F_1\rTo^{\phi_1} F_0
$$
be a finite complex of finitely generated free modules over a polynomial ring or, more generally, a Cohen-Macaulay ring. The following conditions are equivalent:
\begin{enumerate}

\item The complex is exact (and thus a resolution of $\coker \phi_1$);

\item The ranks $r_i$ of the maps $\phi_i$ satisfy $r_i+r_{i+1}  = \rank F_i$ and the $r_i\times r_i$ minors of a matrix representation of
$\phi_i$ generate an ideal of codimension $\geq i$.

\item For every prime ideal $P$ of codimension $c$, the localize truncated complex 
$$
({\bf F}_{\geq c})_P: \quad 0\rTo (F_m)_P\rTo^{(\phi_m)_P} \cdots\rTo^{(\phi_{c+1})_P} (F_c)_P
$$
is split exact (and thus is a free resolution of a projective module.)
\end{enumerate}
\end{theorem}

The proof that exactness implies items 2,3 is easy to summarize: if ${\bf F}$ is a free resolution of an $S$-module $M$ and $P$ is a prime of codimension $c$
then $({\bf F})_P$ is a free resolution of
$M_P$ over $S_P$, a regular ring of dimension $c$.Thus the kernel of $(\phi_{c-1})_P$ must be projective (actually, free) over $S_P$, 
and $({\bf F}_{\geq c})_P$ is a free resolution of this module, and thus split exact. Taking $P = 0$ gives the condition on ranks in
item 1), while the condition on codimension follows because the cokernel of each $(\phi_i)_P$ is projective for $i\geq c$. For a detailed treatment and the opposite implications, we refer to \cite{book}.

\section {Dualizing sheaves} 

\fix{Put the linkage computation of the dualizing sheaf in here explicitly!}
%%in the text below we used \HH instead of H for cohomology. This is fixed with a macro:
\def\HH{{H}}

Other than  the structure sheaf, the most important line bundle on a smooth variety   $X$ over $\CC$ is the top exterior power of the complex cotangent bundle, usually called the canonical line bundle or canonical sheaf $\omega_{X}$. 

In the case of curves  we have many times used it's key property, that if  $\cF$  is a line bundle on the smooth curve  $C$, then $\HH^{0}(\sF^{-1}\otimes \omega_{C})$ is the vector space dual of $\HH^{1}(\cF)$. Because $\sF$ is locally free, we may rewrite the formula in the attractively symmetric form:
$$
\Hom_{C}(\sF, \omega_{C})
\cong 
\Hom_{k}(\HH^{1}(\cF), k).
$$
The reward for writing the formula this way is that, in this form, 
it holds for any coherent sheaf $\cF$:

\begin{proposition} Let $C$ be a smooth curve.
There are natural isomorphisms
$$
\eta_{\sF}: \Hom(\sF,\omega_{C}) =  
\to 
\Hom_{k}(\HH^{1}(\cF), k).
$$
for any coherent sheaf $\cF$ on $C$.
\end{proposition}

\begin{proof}
 Let $\cF'$ be the torsion subsheaf  of $\cF$, a sheaf of finite support. And let
 $\cF'' = \cF/\cF'$.
 Since
$\cF'$ is locally free, the sequence is locally split (in fact it is globally split too, but we don't need this.)

Since $\omega_{C}$ is a line bundle, 
$$
\sHom_{\PP^1}(\sF, \omega_{C}) = 
\sHom_{\PP^1}(\sF', \omega_{C}) \oplus \sHom_{\PP^1}(\sF'', \omega_{C})  = 
\sHom_{\PP^1}(\sF', \omega_{C}) 
$$
and 
$\HH^{1}(\cF) = \HH^{1}(\cF'')
$
because $\HH^{1}(\cF') = 0$, so the duality formula for arbitrary coherent sheaves follows from the case of line bundles.
\end{proof}

An equivalent formulation can be made using a \emph{residue isomorphism} $\eta: H^{1}\omega \to k$. When $C$ is smooth over $\CC$, then regarding elements of 
$\HH^{1}(\omega_{C})$ as rational differential forms modulo linear equivalence,
we may take $\eta$ to be the classical ``sum of the residues'' map of complex analysis.
Of course, given the natural isomorphisms $\eta_{\sF}$ above, we can take
$$
\eta := \eta_{\omega_{C}}(1_{\omega_{C}}.
$$ Conversely,an isomorphism $\eta$, 
determines, for every $\sF$ a map
$$
\eta_{\sF}:\Hom_{C}(\sF, \omega_{C})
\to
\Hom_{k}(\HH^{1}(\cF), k).
$$
sending a homomorphism
$\alpha \in \Hom_{C}(\sF, \omega_{C}) $
to $\eta \circ \HH^{1}(\alpha)$. In particular, we see that $\eta$ itself corresponds to the 
identity map of $\omega_{C}$  

%Another manifestation of these phenomena is a
%special case of the Serre duality theorem on $\PP^{r}$, which asserts that  there is an isomorphism $\eta: H^{r}(\omega_{\PP^{r}}) \cong k$, where $\omega_{\PP^{r}} = \cO_{\PP^{r}}(-r-1)$, the top exterior power of the cotangent bundle. Again, there is
%a natural map
%$$
%H^{0}(\cF^{-1}\otimes \omega_{\PP^{r}}) \to \Hom(H^{r}(\cF), k)
%$$
%Of course $\cF^{-1}\otimes \omega_{\PP^{r}}$ may be rewritten as
%$\Hom(\cF, \omega_{\PP^{r}})$, and in the form
%$$
%\Hom(\cF, \omega_{\PP^{r}}) \to \Hom(H^{r}(\cF), H^{r}(\omega_{\PP^{r}})) 
%\rTo^{\eta \circ -} \Hom(H^{r}(\cF), k)
%$$
%the map is, as before, an isomorphism for every coherent sheaf $\cF$.
%

Grothendieck extended these ideas to all pure-dimensional projective schemes and beyond. Here is the basic definition:

\begin{definition}
If $X$ is a purely $r$-dimensional projective scheme over the field $k$, we say that a coherent sheaf $\omega$ on $X$, together with a linear
functional $\eta:\HH^{r}(\omega) \to k$ is \emph{dualizing} if the map
$$
f_{\eta}: \HH^{0}(\sHom_{X}(\sF, \omega))
\to
\Hom_{k}(\HH^{r}(\cF), k).
$$
defined as above is an isomorphism for every coherent sheaf $\sF$.
\end{definition}

\begin{proposition} Any two dualizing pairs $(\omega_{X}, \eta)$ and $(\omega'_{X}, \eta')$, on a scheme $X$ are canonically isomorphic.
\end{proposition}

\begin{proof}
We will show that there is a unique isomorphism $g: \omega\to \omega'$ making the diagram
$$
\begin{diagram}
 H^{1}(\omega)&\rTo^{g}&H^{1}(\omega')\\
 &\rdTo_{\eta}&\dTo_{\eta'}\\
 &&k
\end{diagram}
$$
commute. 

 The duality property of $\omega'$ yields
$$
\Hom_{X}(\omega, \omega')  = \Hom(\HH^{1}(\omega), k).
$$
Let $g: \omega \to \omega'$ be the map corresponding under this isomorphism to $\eta'$. It follows from the relation of $\eta'$ to the duality isomorphism, that 
$\eta'g = \eta$. Similarly, we get a map $g':\omega'\to \omega$ such that
$\eta g = \eta'$, and it also follows that $\eta gg' = f_{\eta}(gg') =  \eta$, so that
$gg' = 1_{\omega'}$. Similarly, $g'g = 1_{\omega}$, and we are done.
\end{proof}
 
We often abuse the terminology, and say simply that $\omega$ is a \emph{dualizing sheaf} or a \emph {canonical sheaf} on $X$. If $X$ is reduced and connected, so that $\HH^{0} (\sHom(\sO_{X} , \sO_{X})) = k$, then
$\HH^{r}(\omega) \cong k$, whence $\eta$ is, in any case, unique up to a nonzero scalar. 

Of course it is far from obvious that such a dualizing sheaf will exist on an arbitrary pure-dimensional scheme, and in general there is no such sheaf! However, dualizing sheaves do exist on any pure-dimensional scheme that is embeddable in a smooth scheme, and thus, in particular, they exist on any projective scheme.

On a smooth projective variety, Serre duality shows that we can choose the dualizing sheaf to be the top exterior power of the sheaf of differential forms, as already explained. To understand how dualizing sheaves are constructed in general, we must abandon the idea that the the canonical sheaf of $X$ must ``come from'' differential forms on $X$. For example, consider the ring $R = k[x,y,z]/x^{2}$ and the scheme $X = \Proj R$, a double line in $\PP^{2}$. Writing $d: \sO_{X}\to \Omega_{\sO_{X}/k}$ for the universal derivation, we have $0 = d(x^{2}) = 2xd(x)$ so (at least in characteristic $\neq 2$), $dx = 0$. Thus 
\def\red{{\rm red}}
$$
\Omega_{\sO_{X}/k} = \Omega_{\sO_{X_{\red}}/k} = \omega_{X_{\red}};
$$ 
that is, the differentials do not ``see'' the nilpotent part of the structure sheaf at all. Furthermore, 
$
h^{0}(\sO_{X}(1)) = 3
$
(as would be the case with a smooth conic in the plane)
while 
$
h^{1}(\Omega_{X} (-1)) = h^{1}(\Omega_{X_{red}} (-1)) = h^{1}\sO_{\PP^{1}}(-3) = 2
$
so Serre duality would fail if we took $\omega_{X} = \Omega_{X}$ as we would do for smooth curves.

In general, a dualizing sheaf on a scheme $X$ can be constructed by comparing $X$ with a 
variety $Y$ that already has a dualizing sheaf, such as $Y=\PP^{r}$. To understand the motivation behind the construction, 
consider first the situation where $\iota: X\subset Y$ is a closed immersion of smooth varieties, and suppose thta $X$ has dimension $d$ and codimension $c$ in $Y$.
In this case the conormal bundle of $X$ in $Y$ is by definition the sheaf
$\cI/\cI^{2}$, where $\cI$ is the ideal sheaf of $X$ in $Y$. If $p\in X$ then because $X$ is smooth, the kernel of the map of local rings $\cO_{Y,p} \rTo^{\iota^{*}} \cO_{X,p}$ is generated by a subset of a set of minimal generators of the maximal ideal $\gm_{Y,p}\subset \cO_{Y,p}$, and is thus a complete intersection. It follows that the left-most term of the right exact sequence
$$
\cI/\cI^{2} \to \iota^{*}(\Omega_{Y}) \to\Omega_{X} \to 0
$$
is a vector bundle on $X$ whose rank is  $c = \rank \Omega_{Y} -\rank \Omega_{X}$, so the sequence is exact on the left as well. All the terms are vector bundles on $X$, and thus the sequence
is locally split. It follows that 
$$
\omega_X = \wedge^{d}\Omega_{X} = \wedge^{c+d} \iota^{*}(\Omega_{Y})\otimes \wedge^{c}(\cI/\cI^{2})^{\vee} = \sHom(\wedge^{c}(\cI/\cI^{2}), \omega_{Y}).
$$ 

The next step is to recognize that this expression for $\omega_X$ can be interpreted as saying, always in the case $X\subset Y$ is smooth of
codimension $c$, that
$$
\omega_{X} = \sExt^{c}_{\cO_{Y}}(\cO_{X}, \omega_{Y}).
$$
To motivate this formula, consider just the simple case where $X$ is a complete intersection of hypersurfaces
of degrees $d_{i}$ in $Y = \PP^{n}$. In this case the Koszul complex
$$
0\to \wedge^{c} (\oplus_{i}\cO(-d_{i})) \rTo^{\phi_{c}} \cdots \to \oplus_{i}\cO(-d_{i}) \rTo^{\phi_{1}}\cO_{Y,p} \to\cO_{X,p} \to 0.
$$
Thus $\sExt^{c}_{\cO_{Y}}(\cO_{X}, \omega_{Y}) = \sHom(\coker \phi_{c}^{\vee}, \omega_{Y})$
and $\coker \phi_{c}^{\vee}$ may be canonically identified with $\wedge^{c}(\cI/\cI^{2})$.

This computation suggests the bold idea that the dualizing module of a closed subscheme
$X\subset Y$ of pure codimension $c$ can be computed by the formula
$$
\omega_{X} : = \sExt_{Y}^{c}(\cO_{X}, \omega_{Y}),
$$
or, still more generally, that given any finite morphism $\pi: X\to Y$ we have
$$
\omega_{X} : = \sExt_{Y}^{c}(\cO_{X}, \omega_{Y}),
$$
Where we can give the sheaf on the right the unique structure of a sheaf on $X$
such that $\pi_{*}\sExt_{Y}^{c}(\cO_{X}, \omega_{Y}) = \sExt_{Y}^{c}(\pi_{*}\cO_{X}, \omega_{Y})$, as explained below in the case $c=0$.

The truth of this assertion implies a web of theorems proving that the sheaf 
$\sExt_{Y}^{c}(\cO_{X}, \pi^{*}\omega_{Y})$ is independent of $\pi$; and moreover that such sheaves satisfy some form of Serre duality. For all this, see the book
\ref{Altman-Kleiman}.

We now explain the construction above in the one case we will need for studying the linkage of curves in $\PP^{3}$.


\begin{theorem}\label{construction of omega}
Let $\pi: X \to Y$ is a finite morphism of a purely $1$-dimensional schemes, and suppose that
$\omega_{Y}, \eta_{y}$ is a dualizing pair on $Y$. 
Let $\omega := \sHom(\pi_{*}\cO_{X}, \omega_{Y})$ regarded as a sheaf on $X$. There are
natural isomorphisms 
$$
\eta_{\sF}: \Hom_{X}(\sF, \omega) \to \Hom(H^{1}(\sF), k),
$$
and thus $\omega$, together with $\eta = \eta_{\omega}(1_{\omega})$ is a dualizing pair for $X$.
\end{theorem}

Note that one possible choice of $\pi: X\to Y$ in the theorem would be a Noether normalization, that is, a finite map to $X \to \PP^{1}$; in this form, at least when $X$ is smooth, it is the Riemann-Hurwitz formula \fix{did we decide on this name?} Another is the inclusion of $X$ into another curve, perhaps a complete intersection curve, and this is the one we need for linkage:

\begin{corollary}\label{dualizing formula}
 Let $X\subset Y\subset \PP^{n}$ be closed, purely 1-dimensional schemes. If  $\omega_{Y} = \sO_{Y}(d)$ for some integer $d$, then 
 $$
 \omega_{X} = \frac{\sI_{Y}:\sI_{X}}{\sI_{Y}}(d).
 $$
\end{corollary}

\begin{proof}
By Theorem~\ref{construction of omega} we have 
$$
\omega_{X} = \sHom(\sO_{X}, \omega_{Y}) = \sHom(\sO_{X}, \sO_{Y})(d).
$$
Clearly any  section of $\sI_{Y}:\sI_{X}$ on on open set $U$ gives rise by multiplication to a
map   
$\sO_{X}(U) \to \sO_{Y}(U)$, and the sections of  $\sI_{Y}$ give the zero map,
so there a natural mapping $\frac{\sI_{Y}:\sI_{X}}{\sI_{Y}} \to \sHom(\sO_{X}, \sO_{Y})$,
and locally this is an isomorphism because every map from $\sO_{X}$ is determined by the image of the global section 1.
\end{proof}


\begin{proof}[Proof of Theorem~\ref{construction of omega}]
The sheaf  
$\omega:= \sHom(\pi_{*}\cO_{X}, \omega_{Y})$
which is, a priori a sheaf on $Y$, has the structure of a sheaf on $X$
specified by the property that
$$
\pi_{*}(\omega) = \sHom(\pi_{*}\cO_{X}, \omega_{Y}).
$$
as a sheaf on $Y$.

To see that there is such a sheaf, take an open affine cover $\{U_{i}\}$ of $Y$ and pull it back to an open affine cover $\{V_{i} = \pi^{-1}(U_{i})\}$ of $X$. Because $\pi$ is finite, the restriction of 
$\pi_{*} \cO_{X}$ to $U_{i}$ is naturally isomorphic to $\sO_{V_{i}}$, regarded as an $\sO_{U_{i}}$-module, and thus the restriction of
$\sHom(\pi_{*}\cO_{X}, \omega_{Y})$ to $U_{i}$ is 
$Hom_{U_{i}}(\cO_{V_{i}}, \omega_{Y}|_{U_{i}})$,
which is naturally a module over $\cO_{V_{i}}$. This gives $\omega_{X}:= \sHom(\pi_{*}\cO_{X}, \omega_{Y})$
the structure of a sheaf on $X$, and it is obvious from the construction that this has the desired pushforward. 

Because $\pi$ is finite we have
\begin{align*}
 \Hom(\HH^{1}(\omega),k) &= \Hom(H^{1}(\pi_{*}\omega), k)\\ 
&= \Hom(\HH^{1}(\sHom(\pi_{*}\cO_{X}, \omega_{Y})),k)\\
&\cong \Hom(\cHom(\pi_{*}\cO_{X},\omega_{Y}), \omega_{Y})
\end{align*}
by the dualizing property of $\omega_{Y}$. 

%We may use the structure map $\cO_{Y} \to \pi_{*}\cO_{X}$ to deduce
%a map  
%$$
%\HH^{1}(\omega) = 
%\HH^{1}(\pi_{*}\sHom(\cO_{X}, \omega_{Y})
%\to
%\HH^{1}(\sHom(\cO_{Y}, \omega_{Y})
%= \HH^{1}\omega_{Y})
%$$
%and thus any residue map $\eta_{Y}: \HH^{1}(\omega_{Y}) \to k$
%gives rise, by composition, to a residue map 
%$\eta: \HH^{1}(\omega)\to k$.

It now suffices to show that there exist natural isomorphisms $\Hom_{X}(\sF, \omega) \cong \Hom_{k}(H^{1}(\sF), k)$.  Because $\pi$ is finite, the cohomology of a sheaf on $X$ is the same as the cohomology of its pushforward. In view of the construction of $\omega$, and the fact that $\omega_{Y}$ is a dualizing sheaf for $Y$, it suffices to show that there is a natural isomorphism
$$
\phi: \pi_{*}\sHom_{X}(\sF,\sHom_{Y}(\sO_{X}, \omega_{Y})) \to \sHom_{Y}(\pi_{*}\sF, \omega_{Y}).
$$
Passing to an affine open set $U_{i}\subset Y$ and its preimage $V_{i}\subset X$
as in the definition of $\omega$,  the left hand side becomes
$$
\Hom_{V_{i}}(\sF|_{V_{i}}, \Hom_{U_{i}}(\cO_{X}|V_{i}, \omega_{Y}|_{U_{i}}))
$$
where $\cO_{X}|V_{i}$ is considered a $U_{i}$-modules via the structure
map $\cO_{U_{i}} \to \cO_{V_{i}}$.  Note that $\sF|_{V_{i}} = \pi_{*}\sF|_{U_{i}}$. We define
$\phi$ to be the map sending an element $a$ in the left hand side to 
$$
\phi(a) \in \sHom_{U_{i}}(\pi_{*}\sF|_{U_{i}}, \omega_{Y}|_{U_{i}})\qquad \phi(a): t \mapsto a(t)(1).
$$
It is easy to check that this is a natural
isomorphism. 
\end{proof}

\begin{fact}[Dualizing sheaves in higher dimension]  There are two important extensions of Theorem~\ref{construction of omega}:

First, the proof given for curves above actually works for a purely $r$-dimensional projective scheme $X$ over $k$ if we replace the occurrences of  $\HH^{1}$ by $\HH^{r}$, and shows that every such scheme has a dualizing sheaf $\omega$. However, the isomorphisms
$$
\HH^{i} (\sHom(\sF, \omega)) \cong \Hom_{k}(\HH^{r-i}(\sF), k) 
$$
hold for all coherent $\sF$ \emph{ if and only if} $X$ is Cohen-Macaulay. In our situation
this condition means that, if $\pi: X\to \PP^{r}$ is a finite map, then $\pi_{*}\cO_{X}$
is locally free.
\end{fact}

 

\begin{example}[Adjunction formula] \label{canonical of CI}Prove directly that if $\omega_{Y}$ is a dualizing sheaf on a surface $Y$ and $X$ is a Cartier divisor on $Y$, then
$\omega := \cO_{X}\otimes_{Y}\omega_{Y}(X))$ is a dualizing sheaf for $X$.  
Use this to show by induction that if 
$$
X = \bigcap_{i=1}^{c}H_{1}\cap \cdots \cap H_{n}
$$ 
is a complete intersection
in $\PP^{r}$ of hypersurfaces of degrees $\deg H_{i} = d_{i}$,  then
$$
\omega_{X} = (\cO_{X}(\sum_{i=1}^{c} d_{i}) - r-1.
$$
\end{example}

Here is a special case that will be important to us:
\begin{proposition}\label{computation of omega}
 Suppose that 
$C \subset \PP^{n}$ is a purely 1-dimensional scheme. If $(f_{1}, \dots, f_{n-1}) \subset I_{C}$ is a regular sequence of forms of degrees $d_{1}\dots,d_{r}$ defining the scheme $X\supset C$, then 
$$
\omega_{C}\cong \widetilde{(\cI_{X}:\cI_{C})}(q),
$$
where $q = (\sum_{i=1}^{n-1} d_{i}) -r-1.$
\end{proposition}
 \fix{both the prop and the proof should be done for affine cones, then localized.}
\begin{proof}
 By Theorem~\ref{} we know that $\omega_{X} = \cO_{X}(q)$. Further, the map
 $C\to X$ is finite, so 
 $$
 \omega_{C} = Hom(\cO_{C}, \omega_{X}) = \Hom(\cO_{C}, \cO_{X})(q).
 $$
 But $\Hom(\cO_{C}, \cO_{X}) = (\cI_{X}:\cI_{C})$, completing the proof.
\end{proof}


\begin{theorem} \label{canonical of Gor}
 $R$ is Gorenstein if and only if $R$ is Cohen-Macaulay and $\omega_{R} \cong R$ (up to twist in the graded case)
\end{theorem}
\begin{proof}
 
\end{proof}
\input{footer}