\input{header.tex}
%\documentclass[12pt, leqno]{book}
%\usepackage{amsmath,amscd,amsthm,amssymb,amsxtra,latexsym,epsfig,epic,graphics}
%\usepackage[matrix,arrow,curve]{xy}
%\usepackage{graphicx}
%\usepackage{diagrams}
%%\usepackage{amsrefs}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%\textwidth16cm
%%\textheight20cm
%%\topmargin-2cm
%\oddsidemargin.8cm
%\evensidemargin1cm
%
%%%%%%Definitions
%\input preamble.tex
%\def\TU{{\bf U}}
%\def\AA{{\mathbb A}}
%\def\BB{{\mathbb B}}
%\def\CC{{\mathbb C}}
%\def\QQ{{\mathbb Q}}
%\def\RR{{\mathbb R}}
%\def\facet{{\bf facet}}
%\def\image{{\rm image}}
%\def\cE{{\cal E}}
%\def\cF{{\cal F}}
%\def\cG{{\cal G}}
%\def\cH{{\cal H}}
%\def\cHom{{{\cal H}om}}
%\def\h{{\rm h}}
% \def\bs{{Boij-S\"oderberg{} }}
%
%\makeatletter
%\def\Ddots{\mathinner{\mkern1mu\raise\p@
%\vbox{\kern7\p@\hbox{.}}\mkern2mu
%\raise4\p@\hbox{.}\mkern2mu\raise7\p@\hbox{.}\mkern1mu}}
%\makeatother
%
%%%
%%\pagestyle{myheadings}
%\date{April 30, 2018}
%%\date{}
%\title{Curves}
%%{\normalsize ***Preliminary Version***}} 
%\author{David Eisenbud and Joe Harris }
%
%\begin{document}

\chapter{What linear series exist?}\label{Brill-Noether}

\section{What linear series exist?}

In the last few chapters, we have alternated between setting up a general description of linear series on curves, and showing how this plays out in examples. It's time to return to the general theory, and the next question to ask, naturally, is ``What linear systems exist?"

There are various ways to interpret this question. Let's start by taking the question in its plain, unvarnished form---for which $g, r$ and $d$ does there exist a curve $C$ of genus $g$ and a linear system $(\cL,V)$ on $C$ of degree $d$ and dimension $r$? In this form, the answer is given for line bundles of large degree $d \geq 2g-1$ by the Riemann-Roch theorem: on any curve, there exists a linear series of degree $d \geq 2g-1$ and dimension $r$ iff $r \leq d-g$. 

\subsection{Clifford's theorem} 

Riemann-Roch still leaves open the question of what linear systems of degree $d \leq 2g-2$ may exist on a curve of genus $g$. The answer is given by the classical theorem of Clifford:

\begin{theorem}\label{Clifford}
Let $C$ be a curve of genus $g$ and $\cL$ a line bundle of degree $d \leq 2g-2$. Then
$$
r(\cL) \leq \frac{d}{2}.
$$
Moreover, if  equality holds then we must have either
\begin{enumerate}
\item $d=0$ and $\cL = \cO_C$;
\item $d = 2g-2$ and $\cL = K_C$; or
\item $C$ is hyperelliptic, and $|\cL|$ is a multiple of the $g^1_2$ on $C$.
\end{enumerate}
\end{theorem}

\begin{proof}
The proof of Clifford rests on a very basic construction and observation. 

To start, let $\cD = (\cL,V)$ and $\cE = (\cM, W)$ be two linear series on a curve $C$. By the \emph{sum} $\cD + \cE$ of $\cD$ and $\cE$, we will mean the pair 
$$
\cD + \cE = (\cL \otimes \cM, U) 
$$
where $U \subset H^0(\cL \otimes \cM)$ is the subspace generated by the image of $V \otimes W$, under the multiplication/cup product map $H^0(\cL) \otimes H^0(\cM) \to H^0(\cL \otimes \cM)$---in other words, it's the subspace of the complete linear series $|\cL\otimes \cM|$ spanned by divisors of the form $D+E$, with $D \in \cD$ and $E \in \cE$.

The observation is a simple one:
\begin{lemma}
If $\cD$ and $\cE$ are two nonempty linear series on a curve $C$, then
$$
\dim(\cD + \cE) \geq \dim \cD + \dim \cE.
$$
\end{lemma}
(To see this, we observe that to say $\dim \cD \geq m$ means exactly that we can find a divisor $D \in \cD$ containing any given $m$ points of $C$; since $\cD + \cE$ contains all pairwise sums $D + E$ with $D \in \cD$ and $E \in \cE$, we can certainly find a divisor $F \in cD + \cE$ containing any given $\dim \cD + \dim \cE$ points of $C$.)

Given this lemma, the proof of Clifford follows simply by applying it to the pair $|\cL|$ and $|K_C\otimes \cL^{-1}|$: by Riemann-Roch, we have
$$
r(K_C\otimes \cL^{-1}) = r(\cL) +g - d - 1
$$
and so we deduce that
$$
g = r(K_C) + 1 \geq r(\cL) + r(K_C\otimes \cL^{-1}) + 1 \geq 2r(\cL) +g - d;
$$
hence $r(\cL) \leq d/2$.

The proof of the second half of Clifford rests on a basic fact about the geometry of hyperplane sections of a curve in projective space (Proposition~\ref{monodromy of hyperplane section}); we'll defer it until we've established that fact.
\end{proof}

Combining Clifford with Riemann-Roch, we arrive at the answer to our initial question

\begin{theorem}\label{arbitrary linear series}
There exists a curve $C$ of genus $g$ and line bundle $\cL$ of degree $d$ on $C$ with $h^0(\cL) \geq r+1$ if and only if
$$
r \leq
\begin{cases}
d-g, \quad \text{if } d \geq 2g-1; \text{ and} \\
d/2,  \quad \text{if } 0 \leq d \leq 2g-2.
\end{cases}
$$
\end{theorem}

\begin{exercise}
Prove a slightly stronger version of Theorem~\ref{arbitrary linear series} in the range $d \leq g-1$: that under the hypotheses of Theorem~\ref{arbitrary linear series} there exists a \emph{complete} linear series of degree $d$ and dimension $r$ for any $r \leq d/2$.
\end{exercise}

\subsection{Castelnuovo's theorem}

Theorem~\ref{arbitrary linear series} gives a complete and sharp answer to the question originally posed: for which $d,r$ and $g$ does there exists a triple $(C,\cL,V)$ with $C$ a curve of genus $g$, $\cL$ a line bundle of degree $d$ on $C$ and $V \subset H^0(\cL)$ of dimension $r+1$. 

But maybe that wasn't the question we meant to ask! After all, we're interested in describing curves in projective space as images of abstract curves $C$ under maps given by linear systems on $C$. Observing that the linear series that achieve equality in Clifford's theorem give maps to $\PP^r$ that are 2 to 1 onto a rational curve, we might hope that we would have a different---and more meaningful---answer if we  restrict our attention to linear series $\cD = (\cL,V)$ for which the associated map $\phi_\cD$ is at least a birational embedding. 

Now, we'll see that the maximal dimension of a birationally very ample linear series of degree $d$ on a curve of genus $g$ is a decreasing function of $g$; so with this restriction, the question is tantamount to the

\begin{question}
What is the largest possible genus of an irreducible, nondegenerate curve $C \subset \PP^r$ of degree $d$?
\end{question}

The answer to this question is indeed quite different from the inequality provided by Theorem~\ref{arbitrary linear series}. It is the content of \emph{Castelnuovo's theorem}, which gives a sharp answer to the question. We'll sketch the derivation of the inequality here; we'll prove that it is in fact sharp and describe in detail  the curves that achieve it in Chapter~\ref{}.

To start, Castelnuovo's bound follows from a very straightforward approach: if $C$ is a curve of degree $d$ and genus $g$ in $\PP^r$, the idea is to prove successive lower bounds for the dimensions $h^0(\cO_C(m))$ of multiples of the $g^r_d$ cut on $C$ by hyperplanes. For large values of $m$, of course, the line bundle $\cO_C(m)$ is non-special, and so a lower bound on the dimension of its space of sections translates, via Riemann-Roch, into an upper bound on the genus $g$.

\begin{definition}
Let $\cL$ be any line bundle on a smooth projective variety $X$, and $D = \{p_1,\dots,p_d\}$ a collection of points of $X$. By the \emph{number of conditions imposed by $D$ on sections of $\cL$} we will mean simply the difference
$$
h^0(\cL) - h^0(\cL \otimes \cI_{D/X});
$$
that is, the codimension in $H^0(\cL)$ of the subspace of sections vanishing on $D$. More generally, if $V \subset H^0(\cL)$ is any linear system, by the number of conditions imposed by $D$ on $V$ we will mean the difference
$$
\dim(V) - \dim \left(V \cap H^0(\cL\otimes \cI_{D/X}) \right).
$$
\end{definition}
Thus, for example, if $X = \PP^r$, the number of conditions imposed by $D$ on $H^0(\cO_{\PP^r}(m))$ is the value $h_D(m)$ of the Hilbert function of $D$.
Note that the number of conditions imposed by $D$ on a linear system $V$ is necessarily less than or equal to the degree $d$ of $D$; if it is equal we say that $D$ \emph{imposes independent conditions on $V$}.

To apply this notion, suppose $C \subset \PP^r$ is an irreducible, nondegenerate curve. Let $\Gamma = C \cap H$ be a general hyperplane section of $C$. Let $V_m \subset H^0(\cO_C(m))$ be the linear series cut on $C$ by hypersurfaces of degree $m$ in $\PP^r$, that is, the image of the restriction map
$$
H^0(\cO_{\PP^r}(m)) \to H^0(\cO_C(m)).
$$
We have then a series of more or less trivial inequalities:
\begin{align*}
h^0(\cO_C(m)) - h^0(\cO_C(m-1)) & \geq \text{\# of conditions imposed by $\Gamma$ on $H^0(\cO_C(m))$} \\
&\geq \text{\# of conditions imposed by $\Gamma$ on $V_m$} \\
&\geq \text{\# of conditions imposed by $\Gamma$ on $H^0(\cO_{\PP^r}(m))$} ;
\end{align*}
in other words, the dimension $h^0(\cO_C(m))$ is bounded below by the sum
$$
h^0(\cO_C(m)) \geq \sum_{k=0}^m h_\Gamma(k).
$$

We need, in other words, a lower bound on the Hilbert function of a general hyperplane section $\Gamma$ of our curve $C$. This is turn requires that we have some knowledge of the geometry of $\Gamma$, but  in fact we don't need all that much: all we need is the basic

\begin{lemma}[general position lemma]\label{general position lemma}
If $C \subset \PP^r$ is an irreducible, nondegenerate curve and $\Gamma = C \cap H$ a general hyperplane section of $C$, then the points of $\Gamma$ are in linear general position in $H \cong \PP^{r-1}$, meaning no $r$ points of $\Gamma$ lie in a hyperplane $\PP^{r-2} \subset H$.
\end{lemma}

Thus, for example, if $C \subset \PP^3$ is a space curve, the general position lemma says that no three points of a general plane section $\Gamma = H \cap C$ of $C$ will be collinear. Even this case is surprisingly tricky to prove (and it's false in characteristic $p$!); the following exercise sketches a proof.

\begin{exercise}
Let $C \subset \PP^3$ be an irreducible, nondegenerate space curve. Assuming characteristic 0,
\begin{enumerate}
\item Show that if $p, q \in C$ are general, then the tangent lines $\TT_pC$ and $\TT_qC \subset \PP^3$ do not intersect.
\item Using this, show that for general $p, q \in C$ the line $\overline{p,q}$ is not a trisecant; that is, it does not intersect $C$ a third time.
\item Using the irreducibility of the variety of chords to $C$, show that $C$ can have at most a 1-parameter family of trisecant lines; and finally
\item Deduce that a general plane $H \subset \PP^3$ does not contain three colinear points of $C$.
\end{enumerate}
\end{exercise}

The general position lemma was originally asserted by Castelnuovo. In modern language, it can be deduced as a special case of the more general \emph{uniform position lemma}; since this is a useful (and beautiful) theorem in its own right we'll take a few pages out and describe this derivation.

\subsubsection{Uniform position} We start by introducing the \emph{monodromy group} of a generically finite cover. To set this up, let $f : Y \to X$ be a dominant map between irreducible varieties of the same dimension over $\CC$. There is then an open subset $U \subset X$ such that the restriction of $f$ to the preimage $V = f^{-1}(U)$ is a covering space in the classical topology; we'll denote by $d$ the number of sheets. Note that by restricting to a smaller open set $U$, we can assume that both $U$ and $V$ are smooth.

Now choose a base point $p_0 \in U \subset X$, and label the preimage $\Gamma = f^{-1}(p_0)$ as $\{q_1,\dots,q_d\}$. If $\gamma$ is any loop in $U$ with base point $p_0$, for any $i = 1, \dots, d$ there is a unique lifting of $\gamma$ to an arc $\tilde \gamma_i$ in $V$ with initial point $\tilde \gamma_i(0) = q_i$ and end point $\tilde \gamma_i(1) = q_j$ for some $j \in \{1,2,\dots,d\}$; in this way, we can associate to $\gamma$ a permutation of $\{1,2,\dots,d\}$. 
Since the permutation depends only on the class of $\gamma$ in $\pi_1(U,p_0)$, we get a homomorphism to the symmetric group
$$
\pi_1(U,p_0)  \to {\rm Perm}(\Gamma) \cong S_d.
$$
The image $M$ of this map is called the \emph{monodromy group} of the map $f$; it is well-defined as a subgroup of  $S_d$ up to conjugation (the choice of labelling of the points of $\Gamma$). Note that it is independent of the choice of open set $U$: if $U' \subset U$ is a Zariski open subset, the map $\pi_1(U', p_0) \to \pi_1(U,p_0)$ will be surjective, and so the image of $\pi_1(U', p_0)$ in $S_d$ is again $M$.

\begin{fact}
There is another characterization of the monodromy group $M$ that will not be used here but that is worth knowing. In the situation described above, the pullback map $f^*$ expresses the function field $K(Y)$ as a finite algebraic extension of $K(X)$; the degree $d$ is the degree of this extension, and $M$ is equal to the Galois group of the Galois normalization of $K(Y)$ over $K(X)$. (For a proof of this equality, see \cite{Harris}.)
\end{fact}

One note: we have assumed here that both $X$ and $Y$ are irreducible. In fact, we need only have assumed that $X$ is irreducible; we can apply the same construction in case $Y$ is reducible (note that any irreducible components of $Y$ that fail to dominate $X$ simply won't appear in the construction). In this setting, we see that \emph{$Y$ is irreducible if and only if the monodromy group $M \subset S_d$ is transitive}.


There are two basic lemmas we can use to describe the monodromy group.

\begin{lemma}\label{transitivity lemma}
Let $f : Y \to X$ be a generically finite cover of degree $d$, with  monodromy group $M \subset S_d$; let $U \subset X$ and $V = f^{-1}(U) \subset Y$ be open sets as above. For any $k = 1,2,\dots,d$, let $V_k^*$ be the complement of the large diagonal in the $k$th fiber power of $V \to U$; that is,
$$
V_k^* = \{ (x; y_1,\dots, y_k) \in U \times V^k \mid f(y_i) = x \text{ and } y_i \neq y_j \; \forall i \neq j\}.
$$
Then $V_k^*$ is irreducible if and only if $M$ is $k$ times transitive.
\end{lemma}


\begin{lemma}\label{transposition lemma}
Let $f : Y \to X$ be a generically finite cover of degree $d$, with  monodromy group $M \subset S_d$. If for some smooth point $p \in X$ the fiber $f^{-1}(p)$ consists of $d-2$ reduced points $p_1,\dots, p_{d-2}$ and one point $q$ of multiplicity 2, and $q$ is a smooth point of $Y$, then $M$ contains a transposition.
\end{lemma}

Let's now introduce the specific cover to which we'll apply these lemmas. Let $C \subset \PP^r$ be a smooth irreducible, nondegenerate curve of degree $d$, let $X = {\PP^r}^*$ be the space of hyperplanes in $\PP^r$, and let
$$
Y = \{ (H, p) \in {\PP^r}^* \times C \mid p \in H \}
$$
Here we can take $U$ to be simply the complement of the dual $C^* \subset {\PP^r}^*$, that is, the locus of hyperplanes transverse to $C$. Our claim is

\begin{proposition}\label{monodromy of hyperplane section}
In the situation above, the monodromy group of the cover $Y \to X$ is the full symmetric group; that is, $M = S_d$.
\end{proposition}

\begin{proof}
There are two components in this proof: we show first that $M$ is twice transitive, and then that it contains a transposition. Given this, $M$ will contain all transpositions, and hence equal $S_d$.

For the double transitivity, we introduce a related cover: set
$$
\Phi = \{ (H, p, q) \in {\PP^r}^* \times C \times C \mid p + q \subset H \}
$$
(Here $p+q$ is the divisor $p+q$ on $C$, viewed as a subscheme of $C$.) The projection $\pi_{2,3} : \Phi \to C \times C$ is a $\PP^{r-2}$-bundle, and so irreducible; applying Lemma~\ref{transitivity lemma}, we deduce that $M$ is twice transitive.

Finally, for the existence of a transposition in $M$, we have to use the hypothesis of characteristic zero to say that \emph{not every point of $C$ is a flex}; that is, if $p\in C$ is a general point and $H$ a general hyperplane containing the tangent line $\TT_pC$ then $H$ intersects $C$ with multiplicity 2 at $p$. (The notion of inflectionary behavior of curves in projective space will be taken up in Chapter~\ref{InflectionsChapter}; in particular, we will prove that in characteristic 0 not every point of  a curve $C\subset \PP^n$ is a flex.) Given this, let $p \in C$ be a non-flex point, and let $H \subset \PP^r$ be a general hyperplane containing the tangent line $T_pC$. Under these hypotheses, the fiber of $\Phi$ over the point $H \in {\PP^r}^*$ consists of the point $p$ with multiplicity 2, and $d-2$ reduced points; applying Lemma~\ref{transposition lemma}, we deduce that $M$ contains a transposition.
\end{proof}

Note that this proof works as well without the hypothesis of smoothness; we just restrict to the open subset of hyperplanes not passing through any of the singular points of $C$. It does, however, require in addition the fact that \emph{a general tangent line to $C$ is not bitangent}; we leave it as an exercise for the reader the reader to supply this argument.

Finally, as a consequence of Proposition~\ref{monodromy of hyperplane section} (and Lemma~\ref{transitivity lemma}) we can deduce the

\begin{lemma}[uniform position lemma]
With $C \subset \PP^r$ and $\Gamma = C \cap H$ as above, any two subsets $\Gamma', \Gamma'' \subset \Gamma$ of the same cardinality $k$ have the same Hilbert function, i.e., impose the same number of conditions on $\cO_{\PP^{r-1}}(m)$ for all $m$.
\end{lemma}

\begin{proof}
In this situation, we restrict to the open set $U = {\PP^r}^* \setminus C^*$ of hyperplanes transverse to $C$, and introduce the fiber power
$$
V_k^* = \{ (x; y_1,\dots, y_k) \in U \times V^k \mid f(y_i) = x \text{ and } y_i \neq y_j \; \forall i \neq j\}.
$$
as above; $V_k^*$ parametrizes subsets $\Gamma$ of cardinality $k$ in hyperplane sections $H \cap C$ of $C$. Applying Lemma~\ref{transitivity lemma}, we see that $V_k^*$ is irreducible of dimension $r$. 

Now, the Hilbert function $h_\Gamma(m)$ is lower semicontinuous, so it achieves its maximum on a Zariski open subset of $V_k^*$. Since $V_k^*$ is irreducible, the complement of this open will have dimension strictly less than $r$;  a general hyperplane $H \in {\PP^r}^*$ will lie outside this image, meaning that $h_\Gamma(m)$ is the same for all $\Gamma \subset C \cap H$ of cardinality $k$.
\end{proof}

As an immediate consequence of Proposition~\ref{monodromy of hyperplane section}, we can complete the proof of Clifford's theorem as stated above. Recall that Clifford's theorem was deduced from the general inequality 
$$
\dim(\cD + \cE) \geq \dim \cD + \dim \cE.
$$
for any pair of nonempty linear series on a curve $C$; applying this to a linear series $\cD = |D|$ and the residual series $\cE = |K-D|$ we arrived at Clifford's inequality $r(D) \leq d/2$.

The rest of Clifford's theorem describes when we can have equality in Clifford's inequality. Now, in that case, we have
$$
r(D) + r(K-D) = g-1;
$$
which means that \emph{every canonical divisor is expressible as a sum of a divisor in $|D|$ and a divisor in $|K-D|$}. In other words, assuming the curve $C$ is non-hyperelliptic, a general hyperplane section $H \cap C$ of the canonical curve contains a subset of $d$ points whose sum is linearly equivalent to $D$. But by the monodromy statement above, this means \emph{every} subset of $d$ points in $H \cap C$ is linearly equivalent to $D$. But this is clearly false: for example, for any $d+1$ points $p_1,\dots,p_{d+1} \in H \cap C$ we would have
$$
p_1 + \dots + p_d \sim D \sim p_1,\dots, p_{d-1} + p_{d+1},
$$
meaning $p_d \sim p_{d+1}$. Thus $C$ must be hyperelliptic, and the remainder of Clifford's theorem follows.

\

We return now to Castelnuovo's analysis.

The general position lemma is just the special case $m=1$ of the uniform position lemma. This may not seem like much information about $\Gamma$, but in fact it's all we need to prove a sharp bound! The basic (and completely elementary) statement is

\begin{proposition}
If $\Gamma \subset \PP^n$ is a collection of $d$ points in linear general position and spanning $\PP^n$, then 
$$
h_\Gamma(m) \geq \min\{d, mn+1\}
$$
\end{proposition}

\begin{proof}
Suppose first that $d \geq mn+1$, and let $p_1,\dots,p_{mn+1} \in \Gamma$ be any subset of $mn+1$ points. We want to show that $\Gamma' = \{p_1,\dots,p_{mn+1}\}$ imposes independent conditions of $H^0(\cO_{\PP^n}(m))$, that is, for any $p_i \in \Gamma'$ we can find a hypersurface $X \subset \PP^n$ of degree $m$ containing all the points $p_1,\dots, \hat{p_i},\dots,p_{mn+1}$ but not containing $p_i$.

This is easy: simply group the $mn$ points of $\Gamma' \setminus \{p_i\}$ into $m$ subsets $\Gamma_k$ of cardinality $n$; each set $\Gamma_k$ will span a hyperplane $H_k \subset \PP^n$, and we can take $X = H_1 \cup \dots \cup H_m$. 
\end{proof}

This may seem like a crude argument, but the bound derived is sharp: any collection of point $\Gamma \subset \PP^n$ lying on a rational normal curve $D \subset \PP^n$ has exactly this Hilbert function.

At this point, all that remains is to add up the lower bounds in the proposition. To this end, let $C \subset \PP^r$ be as above an irreducible, nondegenerate curve of degree $d$, and set $M = \lfloor{\frac{d-1}{r-1}}\rfloor$, so that we can write
$$
d = M(r-1) + 1 + \epsilon \quad \text{ with } \quad 0 \leq \epsilon \leq r-2.
$$
We have then
\begin{align*}
h^0(\cO_C(M)) &\geq \sum_{k=0}^M h^0(\cO_C(k)) - h^0(\cO_C(k-1)) \\
&\geq  \sum_{k=0}^M k(r-1)+1 \\
&= \frac{M(M+1)}{2}(r-1) + M + 1
\end{align*}
and similarly
$$
h^0(\cO_C(M+m)) \geq \frac{M(M+1)}{2}(r-1) + M + 1 + md.
$$
For sufficiently large $m$, the line bundle $\cO_C(M+m)$ will be nonspecial, so we can plug this in to Riemann-Roch to arrive at
\begin{align*}
g &= (M+m)d - h^0(\cO_C(M+m)) + 1 \\
&\leq (M+m)d - \bigl(  \frac{M(M+1)}{2}(r-1) + M + 1 + md \bigr) \\
& = M\bigl( M(r-1) + 1 + \epsilon \bigr) - \bigl(  \frac{M(M+1)}{2}(r-1) + M + 1 \bigr) \\
&= \frac{M(M-1)}{2}(r-1) + M\epsilon.
\end{align*}

To summarize our discussion: for positive integers $d$ and $r$, we write
$$
 d = M(r-1) + 1 + \epsilon \quad \text{ with } \quad 0 \leq \epsilon \leq r-2
$$
and set
$$
\pi(d,r) = \frac{M(M-1)}{2}(r-1) + M\epsilon.
$$
In these terms, we have proved the

\begin{theorem}[Castelnuovo's bound]
If $C \subset \PP^r$ is an irreducible, nondegenerate curve of degree $d$ and genus $g$, then
$$
g \leq \pi(d,r).
$$
\end{theorem}

We will see in Chapter~\ref{} that this is in fact sharp: for every $r$ and $d \geq r$, there do exist such curves with genus exactly $\pi(d,r)$. For now, we make a few observations:

\begin{enumerate}
\item In case $r=2$, all the inequalities used in the derivation of Castenuovo's bound are in fact equalities, and indeed we see that in this case $\pi(d,2) = \binom{d-1}{2}$ is the genus of a smooth plane curve of degree $d$.

\item In case $r=3$, we have
$$
\pi(d,3) =
\begin{cases}
\left( k - 1 \right)^2 &\text{ if $d=2k$ is even; and} \\
k(k-1) &\text{ if $d=2k+1$ is odd.}
\end{cases}
$$
In this case again, it's not hard to see the bound is sharp: these are exactly the genera of curves of bidegree $(k,k)$ and $(k+1,k)$ respectively on a quadric surface $Q \cong \PP^1 \times \PP^1 \subset \PP^3$.
\item In general, we see that for fixed $r$ asymptotically
$$
\pi(d,r) \sim \frac{d^2}{2(r-1)}.
$$
\end{enumerate}


\begin{exercise}
Show that with $C$ as above, the line bundle $\cO_C(M)$ is nonspecial. (We will see in Section~\ref{} that this is sharp; that is, there exist such curves $C$ with $\cO_C(M-1)$ special).
\end{exercise}

\section{Brill-Noether theory}
\fix{This needs to be amalgamate with the discussion in the Jacobians chapter--here or there}
\subsection{Basic questions addressed by Brill-Noether theory}

In the last section, we restricted our attention to the linear series most of interest to us: those corresponding to embeddings of our curve in projective space (or at any rate birational embeddings) and their limits. But there is one other respect in which Castelnuovo theory fails to address a basic concern: the curves with linear systems achieving Castelnuovo's bound are, like hyperelliptic curves, very special. (In fact, we'll see in Section~\ref{**} that in general they are even rarer than hyperelliptic curves.) That is, if we were to pick a curve $C$ of genus $g$ ``at random" (we'll make this notion more precise when we describe the moduli space of curves in Chapter~\ref{**}), we would still have no idea what linear systems existed on $C$ or how they behaved.

Brill-Noether theory addresses exactly this issue: it asks, ``what linear series exist on a \emph{general} curve of a given genus?" To start with, we'll give the crudest form of the theorem:

\begin{theorem}\label{basic BN}
Fix non-negative integers $g, r$ and $d$. It is the case that a general curve of genus $g$ possesses a linear series of degree $d$ and dimension $r$ if and only if
$$
\rho(g,r,d) := g - (r+1)(g-d+r) \geq 0.
$$
\end{theorem}

In the following sections, we'll see why we might naively expect this to be the case, and we'll also describe some of the many refinements and strengthenings of the theorem (we will be able to give better versions in later chapters, after we have, for example, introduced the schemes parametrizing linear systems on a given curve). A proof of the existence half of the theorem (the ``if" part of the statement) may be found in \cite{3264}; and we will give in the concluding chapter of this book a relatively simple proof of the nonexistence part (the ``only if"). In the meantime, we'll mention here the special case $r=1$:

\begin{corollary}
If $C$ is any curve of genus $g$, then $C$ admits a rational function of degree $d$ for some positive $d \leq \lceil \frac{g+2}{2}\rceil$.
\end{corollary}

Thus, for example, any curve of genus 2 is hyperelliptic, any curve of genus 3 or 4 is either hyperelliptic or trigonal, and so on.

\subsection{Heuristic argument leading to the statement of Brill-Noether}

The Brill-Noether theorem, as we'll see, is a far-reaching description of the linear series to be found on a general curve. It starts, though, with a relatively simple dimension count---one that was first carried out almost a century and a half ago.

To set this up, let $C$ be a smooth projective curve of genus $g$, and $D = p_1 + \dots + p_d$ a divisor on $C$. We'll assume here the points $p_i$ are distinct; the same argument (albeit with much more complicated notation) can be carried out in general.

When does the divisor $D$ move in an $r$-dimensional linear series? Riemann-Roch gives an answer: it says that $h^0(D) \geq r+1$ if and only if the vector space $H^0(K-D)$ of 1-forms vanishing on $D$ has dimension at least $g-d+r$---that is, if and only if the  evaluation map
$$
H^0(K) \to H^0(K|_D) = \oplus K_{p_i}
$$
has rank at most $d-r$. 

We can represent this map by a $g \times d$ matrix. Choose a basis $\omega_1,\dots,\omega_g$ for the space $H^0(K)$ of 1-forms on $C$; choose an analytic open neighborhood $U_j$ of each point $p_j \in D$ and choose a local coordinate $z_j$ in $U_j$ around each point $p_j$, and write
$$
\omega_i = f_{i,j}(z_j)dz_j
$$
in $U_j$. We will have $r(D) \geq r$ if and only if the  matrix-valued function
$$
A(z_1,\dots,z_d) = 
\begin{pmatrix}
f_{1,1}(z_1) & f_{2,1}(z_1) & \dots & f_{g,1}(z_1) \\
f_{1,2}(z_2) & f_{2,2}(z_2) & \dots & f_{g,2}(z_2) \\
\vdots & \vdots &  & \vdots \\
f_{1,d}(z_d) & f_{2,d}(z_d) & \dots & f_{g,d} (z_d)
\end{pmatrix}
$$
has rank $d-r$ or less at $(z_1,\dots,z_d) = (0,\dots,0)$.

The point is, we can think of $A$ as a matrix valued function in the open set $U = U_1 \times U_2 \times \dots \times U_d \subset C_d$; and for divisors $D \in U$, we have $r(D) \geq r$ if and only if $\rank(A(D)) \leq d-r$. Now, in the space $M_{d,g}$ of $d \times g$ matrices, the subset of matrices of rank $d-r$ or less has codimension $r(g-d+r)$, and so we might naively expect that the locus of divisors with $r(D) \geq r$ would have dimension $d - r(g-d+r)$. At the same time, if any divisor of degree $d$ with $h^0(D) \geq r+1$ exists, then there must be at least an $r$-dimensional family of them; so we'd suspect that such divisors exist only if
$$
d - r(g-d+r) \; \geq \; r,
$$
which is exactly the Brill-Noether statement.

As we indicated, Theorem~\ref{basic BN} represents only the most bare-bones version of Brill-Noether. The full statement describes as well the space parametrizing linear series $g^r_d$ on a general curve $C$---it says that it has dimension $\rho(g,r,d)$, is smooth and irreducible when $\rho > 0$---and also the geometry of $C$ as mapped to projective space by a general such $g^r_d$. The problem is, all these versions involve the existence of a parameter space for linear series on a given curve (which we'll see how to construct in Chapter~\ref{Jacobians chapter}), as well as the existence of a moduli space $M_g$ parameterizing abstract curves of genus $g$ (which we'll discuss further in Chapter~\ref{}). For this reason, we will have to defer the full statement of Brill-Noether to that chapter. In the meantime, though, we'll see in the next chapter how the theory plays out in the case of curves of low genus.

\section{The full Brill-Noether theorem}

The existence of the varieties $W^r_d(C)$ parametrizing linear series on an arbitrary curve $C$ allows us to strengthen Clifford's theorem to Martens' theorem. If we ask about linear series on a \emph{general} curve, similarly, it allows us to give a much more detailed version of the Brill-Noether theorem: instead of  saying when there exists a $g^r_d$ on a general curve $C$, we can give the dimension of the variety $W^r_d(C)$ parametrizing such linear series, and we can also talk about the geometry of a general linear series on $C$. We collect the basic facts into the 

\begin{theorem}[Brill-Noether theorem, omnibus version]
Let $C$ be a general curve of genus $g$. If we set $\rho = g - (r+1)(g-d+r)$, then
\begin{enumerate}
\item $\dim(W^r_d(C)) = \rho$;
\item the singular locus of $W^r_d(C)$ is exactly $W^{r+1}_d(C)$;
\item if $\rho > 0$ then $W^r_d(C)$ is irreducible;
\item if $\rho = 0$ then the variety $\cW^r_d$ is irreducible;
\item if $L$ is any invertible sheaf on $C$, the map
$$
H^0(L) \otimes H^0(\omega_CL^{-1}) \rTo H^0(\omega_C)
$$
is injective;
\item if $|D|$ is a general $g^r_d$ on $C$, then
\begin{enumerate}
\item if $r \geq 3$ then $D$ is very ample; that is, the map $\phi_D : C \to \PP^2$   embeds $C$ in $\PP^r$;
\item if $r=2$ the map $\phi_D : C \to \PP^2$ gives a birational embedding of $C$ as a nodal plane curve; and 
\item if $r=1$, the map $\phi_D : C \to \PP^2$ expresses $C$ as a simply branched cover of $\PP^1$.
\end{enumerate}
\end{enumerate}
\end{theorem}



\input footer.tex