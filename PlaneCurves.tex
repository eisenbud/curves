\input{header}

\chapter{Plane Curves}
\label{PlaneCurvesChapter}

Plane curves occupied a central role in the development of the theory of algebraic curves. Indeed, They were the only algebraic curves studied for a long time. Originally the study was of curves in the affine plane over the real numbers, but by about 1850 the complex projective plane was well understood, and complex curves in $\PP^2 = \PP^2_\CC$ were recognized as the natural objects of study. One of the central topics was duality: given a curve in $\PP^2$, the dual curve is the closure of the set of tangent lines at its smooth points, the dual curve. Starting with smooth curve each bitangent line corresponds to a node of the dual curve, and each flex corresponds to a cusp, so curve singularities were also studied.

The work of Bernard Riemann dramatically changed the focus of the theory to branched coverings of   the ``Riemann Sphere'' ($\PP^1_\CC$). The Riemann-Roch, theorem, in particular, gave information about the existenced of meromorphic functions on such coverings, well beyond what could be done in the earlier theory. However, Riemann's work, depending as it did on the then-obscure ``Dirichlet principle'', was not universally accepted. In the 1860s Rudolph Clebsch and, after Clebsch' death in 1872, Alexander Brill and Max Noether (Emmy Noether's father), undertook the ambitious program of redoing the Riemann-Roch theorem entirely in terms of plane curves. They went beyond Riemann in certain directions, too: the Brill-Noether Theorem treated in our Chapter~\ref{Brill-Noether chapter} was formulated by Brill and Noether, ``proved'' through an unsupported appeal to general position. 

A central difficulty in the Brill-Noether attempt on the Riemann-Roch theorem was that,
although any smooth curve can be embedded in $\PP^r$ for any $r \geq 3$, most curves cannot be embedded in the plane. 
However, we shall show in Section~\ref{projection section} that every curve can be mapped birationally into $\PP^2$: we can embed $C$ as a curve $\tilde C \subset \PP^r$ in a higher-dimensional projective space and find a projection $\PP^r \to \PP^2$ that carries $\tilde C$ birationally onto its image $C_0$, called a plane model of $C$, with singularities, so that $C$ is the normalization of $C_0$. Brill and Noether wanted to prove the Riemann-Roch theorem for $C$ by formulating and proving a related theorem for $C_0$. In particular, they tried to characterize linear equivalence of divisors on $C$ in terms of certain ``clusters'' of points on $C_0$. \fix{make the notation here and in the later part of the chapter consistent!}


To carry out this program, a key result is that if $D\subset C_0$ is contained in the intersection
$D'$ of $C_0$ and some other plane curve $C_0'$, then the diifference 
$E := D'-D$ can be defined with properties such as that $D'-E = D$; Brill and Noether seem simply to have assumed that this is so, but Frances Sowerby Macaulay who proved that this is possible a bit later. This early work of Macaulay led directly to his later definitions of  ``perfection'' (a homogeneous ideal
$I  \subset S:= k[x_0, \dots, x_n]$ is perfect if $S/I$ is Cohen-Macaulay) and ``super-perfection'' (the case when $S/I$ is
Gorenstein), and he proved what he called the ``Generalized Riemann-Roch Theorem'' (now called, erroneously, the ``Cayley Bacharach Theorem''---see for example the discussion in "\cite{Eisenbud-Gray}.)

In the first part of this Chapter we will use ideas that go back to Brill and Noether to prove the ``completeness of the adjoint series'', giving us a recipe using $C_0$ to find all effective divisors on $C$ equivalent on $C$ to a given (possibly) non-effective divisor. In the last Section we will study the ``Severi variety'' of nodal plane curves $C_0$ whose normalization $C$ has given genus (called the 
``geomtric genus'' of $C_0$.

\begin{exercise}
 Show that no curve of genus 2---can be represented as a smooth curve in $\PP^2$.
\end{exercise}

%; and there are still many aspects of the geometry of a curve that are best approached in this way. In this chapter, we'll describe some of the tools used to study  curves via their plane models.

%As illustrated in Chapter~\ref{HilbertSchemesCounterexamplesChapter}, describing curves in projective space $\PP^3$  is difficult: the ideal of such a curve typically has three or more generators, which in turn have to satisfy certain syzygies; in consequence, many basic facts about them---for example, the dimension of the family of all curves of given degree and genus---are unknown. We know even less about curves in $\PP^n$ for $n > 3$.
%
%On the other hand, we shall show in Section~\ref{projection section} that every curve can be mapped birationally into $\PP^2$: we can embed $C$ as a curve $\tilde C \subset \PP^r$ in a higher-dimensional projective space and find a projection $\PP^r \to \PP^2$ that carries $\tilde C$ birationally onto its image. This is indeed how 19th century geometers typically described a curve, in the days before abstract varieties: as the normalization of a plane curve. The points on the normalization were realized as valuations on the function field of $C$ \fix{this point of view is not 19th c.: I think it's due to Chevalley, mid 20th c},  taking advantage of the fact that for smooth curves birational and biregular isomorphism are the same thing. Much of the analysis of the geometry of the curve---for example, the description of the linear systems on the curve---was carried out on the plane model.\fix{the last is true -- work of Brill-Noether and others.}


\section{Using plane models to compute linear series}

Given the equations of a smooth curve $C$ embedded in some projective space, and the coordinates of a collection of points $p_i$,  we can project it birationally to a (possibly singular) plane curve $C_0$, and use this ``plane model'' to explicitly and algorithmically determine the complete the linear series 
$|\sum_i p_i|$. 

In particular:
\begin{enumerate}
\item Given the equation $F(X,Y,Z)$ of a plane curve $C_0$, with normalization $C$, we will find a basis for $H^0(K_C)$; and
\item  Given, in addition, a divisor $D = \sum m_ip_i$ on $C$, we will describe the complete linear system $|D|$; that is, we will find all effective divisors $E$ on $C$ with $E \sim D$, or, equivalently, a basis for $H^0(\cO_C(D)$.
\end{enumerate}

Along the way we will see how to test when two given divisors $D$ and $E$ on $C$ are linearly equivalent; and whether a given divisor $D$ linearly equivalent to an effective divisor.

We will pursue these goals in three stages: first when $C = C_0$ is a smooth plane curve (\S \ref{smooth plane curves}); next for nodal curves (\S~\ref{nodal plane curves}), which in principle this covers all smooth curves; and finally for arbitrary reduced, irreducible plane curves (\S\ref{arbitrary plane curves}): many times a curve $C$ is given to us as (the normalization of) a plane curve with singularities other than nodes, and while Theorem~\ref{****} assures us in principal that we can also realize $C$ as the normalization of a nodal plane curve, it is often easier to work with the given plane model. 

\section{Smooth plane curves}\label{smooth plane curves}

Let $C \subset \PP^2$  be a smooth plane curve, given as the zero locus of a homogeneous polynomial $F(X,Y,Z)$ of degree $d$. We'll introduce coordinates $x = X/Z$ and $y = Y/Z$ on the affine open subset $U \cong \AA^2$ given by $Z \neq 0$, and let $f(x,y) = F(X,Y,1)$ be the inhomogeneous form of $F$, so that $\tilde C = C \cap U$ is given as the zero locus $V(f) \subset  \AA^2$. \fix{in the B-N chapter, $\tilde C$ is the
normalization of $C$.}

Since an automorphism of $\PP^2$ can carry any line in the plane to the line at infinity, and any point on that line to the point $(0,1,0)$, we may assume:
\begin{enumerate}
\item The point $[0,1,0]$ (that is, the point at infinity in the vertical direction) does not lie on $C$; equivalently,  the projection $C \to \PP^1$ from $(0,1,0)$, which is given by $[X,Y,Z] \mapsto [X,Z]$ (or, in affine coordinates, $(x,y) \mapsto x$)  has degree $d$; and
\item The line $L$ at infinity given by $Z = 0$ intersects $C$ transversely in $d$ distinct points $p_1, \dots, p_d$; We write $H = p_1+ \dots +p_d$ for the corresponding divisor, the ``hyperplane section at infinity''.
\end{enumerate}

These conditions are not necessary: in Exercise~\ref{****} we will see how to do  without them.
 
We start toward our first goal by writing down a single rational 1-form on $C$: just take a regular 1-form on $\AA^2$, such as $dx$, and restrict/pull back to $C$. Though $dx$ is regular on $\tilde C$, writing
$$
dx = d\frac{X}{Z} = \frac{X dZ+ Z dX}{Z^2}
$$
 shows that $dx$ has double poles at the points $p_1,\dots,p_d$ of the divisor $D := C \cap L$.
 
How do we get rid of the poles of $dx$? The extension of $\PP^2$ of a polynomial $h(x,y)$ of degree $d$ on
$\AA^2$ has a pole of order $d$ along the line $L$ at infinity. Thus if $h$ has degree at least 2 then $dx/h$ will have no poles at infinity. However, $h(x,y)$ will vanish at points of $C \cap U$, and this may create new poles of $dx/h$. Of course if $h$ vanishes only at  points of $C \cap U$ where $dx$ already has a zero, the zeroes of $h$ may cancel the zeroes of $dx$ rather than creating new poles.
 
 To insure that this does not happen, we take
 $$
 h(x,y) = \frac{\partial f}{\partial y}(x,y).
 $$
 Note that on $\tilde C$,
 $$
 df = \frac{\partial f}{\partial x}dx + \frac{\partial f}{\partial y}dy \equiv 0.
 $$
Because $C$ is smooth, the functions $\frac{\partial f}{\partial x}$ and $\frac{\partial f}{\partial y}$ have no common zeroes on $\tilde C$. Moreover, the differentials $dx$ and $dy$ have no common zeros on $\tilde C$. It follows that at for all $p \in \tilde C$ we  have
$$
\ord_p(dx) = \ord_p(\frac{\partial f}{\partial y}), 
$$ 
and thus the quotient 
$$
\omega_0 = \frac{dx}{\partial f/\partial y}
$$
is everywhere regular and nowhere 0 in $\tilde C$.

The differential $dx$ has poles of order $2$ at the points $p_i$. The polynomial $\partial f/\partial y$, having degree $d-1$, has poles of order $d-1$. Thus $\omega_0$ has zeroes of order $d-3$ at the points $p_i$; in other words, as divisors,
$$
(\omega_0) = (d-3)D.
$$
In particular, if $d \geq 3$ then $\omega_0$ is a global regular differential on $C$.

Moreover, we can  multiply $\omega_0$ by any polynomial $g(x,y)$ 
 \fix{unfortunate notation given the genus $g$ -- change the polynomials g to something else} of degree $d-3$ or less without introducing poles, so that 
$$
g\omega_0 = \frac{g(x,y)dx}{\partial f/\partial y}
$$ 
is likewise a global regular differential, for $g$  any polynomial of degree $\leq d-3$.

We have thus found a vector space of regular differentials, of dimension $\binom{d-1}{2}$. But at the same time, the degree of a differential like $\omega_0$ is
$$
\deg((\omega_0)) = (d-3)\deg(D) = d(d-3),
$$
so that the genus of $g(C)$ satisfies
$2g(C)-2 = d(d-3)$, whence
$$
\frac{d(d-3)}{2} + 1 = \binom{d-1}{2}.
$$
In other words, we have found all the global regular differentials on $C$! We have
$$
H^0(K_C) = \left\{ \frac{g(x,y)dx}{\partial f/\partial y} \mid \deg g \leq d-3\right\};
$$
or, equivalently, the space of regular differentials on $C$ has basis $\{\omega_{i,j} \}_{i+j \leq d-3}$, where
$$
\omega_{i,j} =  \frac{x^iy^jdx}{\partial f/\partial y}
$$

We could have achieved the same result by using the adjunction formula \fix{reference to this}: we have
$$
K_C = (K_{\PP^2} \otimes \cO_{\PP^2}(d))|_C = \cO_C(d-3),
$$
and from the exact sequence
$$
0 \to \cO_{\PP^2}((d-3)-d) \rTo^f \cO_{\PP^2}(d-3) \to \cO_C(d-3)=K_C \to 0
$$
and the vanishing of $H^1(\cO_{\PP^2}(-3))$, we see that the map on global sections
$$
H^0(\cO_{\PP^2}(d-3)) \to H^0(K_C)
$$
is surjective. 

\begin{exercise}\label{gonality of smooth plane curve}
Let $C$ be a smooth plane curve of degree $d$. Show that $C$ admits a one-parameter family of maps $C \to \PP^1$ of degree $d-1$. Using the Riemann-Roch Theorem, show that $C$ does not admit a map $C \to \PP^1$ of degree $d-2$ or less.
\end{exercise}


\subsection{Finding complete linear systems on smooth plane curves}

Suppose that $D$ is any divisor on a smooth plane curve $C$, expressed as the difference of
two effective divisors, $D= E-F$. We would like to find all the \emph{effective} divisors linearly equivalent to $D$, that is, of the form
$D + (H/G)$, where $G, H$ are forms of the same degree $m$. Choose $m$ large enough so that
there is
 a form $G$ of degree $m$ that vanishes on $E$ plus some divisor $A$ (but not on all of $C$). If we can find a form $H$ of degree $m$ that vanishes on both $F$ and $A$, as well as a further divisor $D'$, but does not vanish identically on $C$, then
$$
D' = D + (H/G) = E- F - (E+A)+(F+A+D')
$$
as required. Since $m$ is already chosen, there may not exist any such polynomial; we shall see that in this case there is no effective divisor linearly equivalent to $D$. 

\begin{example}
Suppose that $C$ has degree 3, so that $C$ has genus 1. Ã¥If we choose as origin on the curve $C$ a point $o$, then to add two points $p$ and $q \in C$ means to find the (unique) effective divisor of degree 1 linearly equivalent to $p + q - o$. In this situation, we can carry out the process described above with $m=1$: draw the line $L$ through the points $p$ and $q$, and let $r \in C$ be the remaining point of intersection of $L$ with $C$; then draw the line $M$ though the points $r$ and $o$, and let $s \in C$ be the remaining point of intersection of $L$ with $C$. This is the classical construction of the group law.
\end{example}

We claim that we find in this way \emph{all} effective divisors $D' \sim D$ a special case of the Completeness of the Adjoint series, Proposition~\ref{adjoint completeness}. In particular, this will show that if there is no polynomial $H$ as above, then there are no effective divisors equivalent to $D$.

Indeed, suppose $D'$ is any effective divisor with $D' \sim D$. Carrying out the first step of the process as before, we arrive at a divisor $A$ with 
$$
\cO_C(A+F+D') = \cO_C(A+F+D)  = \cO_C(m),
$$
that is, $A+F+D$ is linearly equivalent on $C$ to the divisor (H) defined by the vanishing of some form $H$ of degree $m. This means that
$A+F+D  = (H') +(P/Q) for some forms $P,Q$ of equal degree, with $Q$ not vanishing identically on $C$. Since $A+F+D$ is effective,
the zeros of $Q$ on $C$ must be contained in the zeros of $H'P$ on $C$. Writing
$G$ for the generator of the ideal of $C$, and using the fact that
$G,Q$ is a regular sequence, and thus unmixed, we see that $H'P = LG+HQ$ for some
forms $L,H$ of degree $\deg HP - \deg Q$. In particular, $H = (H'P- LG)/Q$ is a form
of degree $m$ defining $A+F+D$, as desired.

Alternatively, the fact that any regular sequence $G,Q$ defines an unmixed ideal is equivalent to the vanishing of the intermediate cohomology of all twists of the structure sheaf of $\PP^2$; and we can use this to achieve the same conclusion with fewer symbols, though more sophistication: from the exact sequence 
$$
0 \to \cO_{\PP^2}(m-d) \to \cO_{\PP^2}(m)  \to \cO_C(m) ]\to 0
$$
and the vanishing of $H^1(\cO_{\PP^2}(m-d))$, we again see that every global section of $ \cO_C(m)$ is the restriction to $C$ of a homogeneous polynomial of degree $m$ on $\PP^2$. 

Note that if, in the process described, it turns out there is no polynomial $H$ vanishing on  $A + F + D$ but not vanishing identically on $C$, that simply means that $|D| = \emptyset$; that is, \emph{$D$ is not linearly equivalent to any effective divisor}. (It may not be obvious that the existence of such an $H$ is independent of the choice of $m$ or $G$, but the argument here shows it is.)

\section{Nodal plane curves}\label{nodal plane curves}

As noted, smooth plane curves are very special among all curves. We now want to carry out the analyses above for curves with at most nodes as singularities. These are still special among all plane curves, but as we'll see in Section~\ref{projection section} below, every smooth curve is the normalization of a nodal plane curve.

Given a smooth projective curve $C$ and a birational embedding of $C$ in $\PP^2$ with image a nodal curve $C_0$, our goal is:
\begin{enumerate}
\item to write out explicitly all global regular 1-forms on $C$; and
\item given a divisor $D$ on $C$, to  determine $|D|$; that is, find all effective divisors linearly equivalent to $D$.
\end{enumerate}

As before, we may choose homogeneous coordinates  $[X,Y,Z]$ on $\PP^2$ so that the curve $C_0$ intersects the line $L = V(Z)$ at infinity transversely at points $p_1,\dots,p_d$ other than $[0,1,0]$. In particular,  all the nodes of $C_0$ will lie in the affine plane $U = \PP^2 \setminus L$.
In addition, we can assume that  neither branch of $C_0$ at a node has vertical tangent. (These conditions serve only to keep the notation reasonably simple, and are satisfied by a general choice of coordinates.) Let the nodes of $C_0$ be $q_1,\dots,q_\delta$, with $r_i, s_i \in C$ lying over $q_i$; we'll denote by $\Delta$ the divisor $\sum r_i + \sum s_i$ on $C$.

Let $F(X,Y,Z)$ be the homogeneous polynomial of degree $d$ defining the curve $C_0$, and let $f(x,y) = F(x,y,1)$ be the defining equation of the affine part $C_0 \cap U$ of $C_0$. We start by considering the rational differential $\nu^*(dx)$ on $C$. In the smooth case, we saw that this differential was regular and nonzero in the finite plane, but had poles of order 2 at the point of $C \cap L$; this followed from the equation
$$
 df = \frac{\partial f}{\partial x}dx + \frac{\partial f}{\partial y}dy \equiv 0.
 $$
and the fact that $\frac{\partial f}{\partial x}$ and $\frac{\partial f}{\partial y}$ have no common zeroes on $C_0$. But now $\frac{\partial f}{\partial x}$ and $\frac{\partial f}{\partial y}$ \emph{do} have common zeroes; specifically, the pullbacks $\nu^*(\frac{\partial f}{\partial x})$ and $\nu^*(\frac{\partial f}{\partial y})$ have simple zeroes at the points $r_i$ and $s_i$. We conclude, accordingly, that the differential $\nu^*dx$ has double poles at the points $p_i$, and simple poles at the points $r_i$ and $s_i$ \fix{it seems to me that this needs a little more argument}; proceeding as before, we see that for a polynomial $g(x,y)$ of degree $\leq d-3$, the differential
$$
\nu^*( \frac{g(x,y)dx}{\partial f/\partial y})
$$
will be regular except for simple poles at the points $r_i$ and $s_i$.

So, how do we get rid of these poles? There is one simple way: we require that $g$ vanishes at the points $q_i$. We say in this case that $g$ (and the curve defined by $g$) \emph{satisfies the adjoint conditions}. (In the following section, we'll describe the adjoint conditions associated to an arbitrary singularity.) In any event, we see that
$$
 \left\{ \nu^* \frac{g(x,y)dx}{\partial f/\partial y} \mid \deg g \leq d-3 \text{ and } g(q_i) = 0 \; \forall i \right\} \subset H^0(K_C).
$$
Now, in the smooth case, we were able to compare dimensions to conclude that this inclusion was indeed an equality. We can do the same thing here: to begin with, we have seen that the  rational 1-form $\omega = \nu^*(\frac{dx}{\partial f/\partial y})$ has zeroes of order $d-3$ at the points $p_1,\dots,p_d$ and simple poles at the points $r_i$ and $s_i$ and is otherwise regular and nonzero; in other words, if we set $H = p_1+\dots + p_d$, the divisor
$$
(\omega) = (d-3)H - \Delta.
$$
In particular, we see that
$$
\deg((\omega)) = d(d-3) - 2\delta
$$
and correspondingly
$$
g(C) = \binom{d-1}{2} - \delta;
$$
this is called the genus formula for plane curves.

On the other hand, the space of polynomials $g$ of degree $\leq d-3$ vanishing at the points $q_i$ has dimension at least $ \binom{d-1}{2} - \delta$; we conclude from this that indeed
$$
H^0(K_C) =  \left\{ \nu^* \frac{g(x,y)dx}{\partial f/\partial y} \mid \deg g \leq d-3 \text{ and } g(q_i) = 0 \; \forall i \right\},
$$
and as lagniappe we have proved the useful

\begin{lemma}\label{adjoint independent}
The nodes $q_i$ of an irreducible nodal plane curve of degree $d$ impose independent conditions on curves of degree $d-3$, and hence on curves of any degree $m \geq d-3$.
\end{lemma}

We will need this in Section~\ref{severi variety} of this chapter.

In Exercise~\ref{gonality of smooth plane curve}, we saw how to use the description of the canonical series on a smooth plane curve to determine its gonality. Now that we have an analogous description of the canonical series on (the normalization of) a nodal plane curve, we can deduce a similar statement about the gonality of such a curve. Here are the first two cases: 
\begin{exercise}
Let $C_0$ be a plane curve of degree $d$ with one node and no other singularities, and let $C$ be its normalization. Show that $C$ admits a unique map $C \to \PP^1$ of degree $d-2$, but does not admit a map $C \to \PP^1$ of degree $d-3$ or less.
\end{exercise}

\begin{exercise}
Let $C_0$ be a plane curve of degree $d$ with two nodes and no other singularities, and let $C$ be its normalization. Show that $C$ admits two maps $C \to \PP^1$ of degree $d-2$, but does not admit a map $C \to \PP^1$ of degree $d-3$ or less.
\end{exercise}

\fix{this suggests, falsely, I suppose, the generalization to $n$ nodes. That needs a comment---where does it break?}

\subsection{Linear series on a nodal curve}

Next, we take up the second of our keynote problems in this setting: with $C \to C_0 \subset \PP^2$ as above, given a divisor $D$ on $C$, can we find the complete linear series $|D|$?

In fact we can, by a process analogous to what we did in the smooth case. We'll do this first in the case where $D = E-F$ is the difference of two effective divisors whose support is disjoint from the support $\{r_i, s_i\}$ of $\Delta$; the general case is only notationally more complicated. To start, we find an integer $m$ and a polynomial $G$ vanishing on the divisor $E$ \emph{and at the nodes $r_1,\dots,r_\delta$ of $C_0$}, but not vanishing identically on $C_0$. We can then write the zero locus of $G$ pulled back to $C$ as
$$
(\nu^*G) = E + \Delta + A,
$$
as before. Once more, just for simplicity, let's assume that the support of $A$ is disjoint from the support of $\Delta$; this means just that the curve $V(G)$ is smooth at the points $q_i$ and is not tangent to either of the branches of $C_0$ there (this can certainly be done if we take $m$ large).

Next, we find polynomials $H$ of the same degree $m$, vanishing at $A+F$ and at the points $q_i$ \fix{the vanishing at the $q_i$ is not intuitive. How to make it so?} but not on all of $C_0$. Let $D'$ be the divisor cut on $C$ by $H$ residual to $E + \Delta + A$; that is, we write
$$
(\nu^*H) = E + \Delta + A + D'.
$$
Finally, since $\nu^*(G/H)$ is a rational function on $C$, we see that 
$$
E + \Delta + A = (\nu^*H) \sim (\nu^*G) = E + \Delta + A + D',
$$
and we conclude that $D'$ is an effective divisor linearly equivalent to $D$ on $C$.

But, do we get in this way \emph{all} effective divisors linearly equivalent to $D$ on $C$? The answer is yes, but it's not immediate; it follows from the following proposition, known classically as \emph{completeness of the adjoint series}.

\begin{proposition}\label{adjoint completeness}
If $C_0 \subset \PP^2$ is a nodal plane curve and $\nu : C \to C_0$ its normalization, then the linear series cut on $C$ by plane curves of degree $m$ passing through the nodes is complete.
\end{proposition}

Note  that the solution to our problem follows from this proposition exactly as in the smooth case; that is, \emph{every} effective divisor $D' \sim D$ on $C$ is obtained in this way.

\begin{proof}
To prove Proposition~\ref{adjoint completeness}, it will be helpful to introduce another surface: the blow-up $\pi : S \to \PP^2$ of $\PP^2$ at the points $r_i$. The proper transform on $C_0 \subset \PP^2$ in $S$ is the normalization of $C_0$, which we will again call $C$.

There are two divisor classes on $S$ that will come up in our analysis: the pullback of the class of line in $\PP^2$, which we'll denote $H$; and the sum of the exceptional divisors, which we'll call $E$. In these terms, we have
$$
C \sim dH - 2E \quad \text{and} \quad K_S \sim -3H + E
$$
(the first follows from the fact that $C_0$ has multiplicity 2 at each of the points $q_i$, the second from considering the pullback to $S$ of a rational 2-form on $\PP^2$). If $A$ is a curve in $\PP^2$ of degree $m$ passing through the points $q_i$, we can associate to it the effective divisor $\pi^*A - E$; this gives us an isomorphism
$$
H^0(\cI_{\{q_1,\dots,q_\delta\}/\PP^2}(m)) \cong H^0(\cO_S(mH-E)).
$$
In these terms we can describe the linear series cut on $C$ by plane curves of degree $m$ passing through the nodes of $C_0$ as the image of the map
$$
H^0(\cO_S(mH-E)) \to H^0(\cO_C(mH-E)),
$$
and the proposition amounts to the assertion that this map is surjective.

The obvious way to prove this is to view this map as part of the long exact cohomology sequence associated to the exact sequence of sheaves
$$
0 \to \cO_S(mH-E-C) = \cO_S((m-d)H + E)  \to \cO_S(mH-E) \to \cO_C(mH-E) \to 0,
$$
from which we see that it will suffice to establish that $H^1(\cO_S((m-d)H + E)) = 0$. To do this, we apply Serre duality, which says that $H^1(\cL) \cong H^1(K_S\otimes \cL^{-1})^*$; in this instance it 
tells us that
$$
H^1(\cO_S((m-d)H + E)) \cong H^1(\cO_S((d-m-3)H))^*
$$
Now, the line bundle $\cO_S((d-m-3)H)$ is just the pullback to $S$ of the bundle $\cO_{\PP^2}(d-m-3)$, which has vanishing $H^1$; thus the Proposition will follow from the 
\begin{lemma}
Let $X$ be a smooth projective surface, and $\pi : Y \to X$ a blow-up. If $\cL$ is any line bundle on $X$, then
$$
H^1(Y, \pi^*\cL) = H^1(X, \cL).
$$
\end{lemma}
The lemma follows by applying the Leray spectral sequence, which relates the cohomology of $\cL$ on $Y$ to the cohomology of the direct image $\pi_*\pi^*\cL$ (Leray is particularly simple in this setting, since all higher direct images are 0), and the observation that $\pi_*\pi^*\cL \cong \cL$.
\end{proof}


\subsection{Existence of good projections}\label{projection section}

In this section, we want to verify the assertion made above that every smooth curve $C$ is birational to a nodal plane curve $C_0 \subset \PP^2$; we'll do this by first embedding $C$ in $\PP^n$, and then arguing that the projection $\pi_\Lambda : C \to \PP^2$ from a general $(n-3)$-plane $\Lambda \subset \PP^n$ is birational onto its image $C_0$ and that $C_0$ has only nodes as singularities. This is certainly plausible, but in fact a proof relies on an application of the uniform position lemma of Section~\ref{****}.

\begin{proposition}\label{nodal projection}
If $C \subset \PP^n$ is a smooth curve in projective space, and $\Lambda \cong \PP^{n-3} \subset \PP^n$ a general $(n-3)$-plane, then the projection $\pi_\Lambda : C \to \PP^2$ is birational onto its image, which will be a nodal curve.
\end{proposition}

\begin{proof} The basic idea here is to look at how the plane $\Lambda$ intersects the \emph{secant variety} of the curve $C \subset \PP^n$. The secant variety consists of the union of the lines $\overline{q,r}$ joining pairs of distinct points $q,r \in C$, plus the tangent lines ${\mathbb T}_q(C)$; altogether, these lines form a single family, parametrized by the symmetric square of $C$. The secant variety thus has dimension 3, so that a general $(n-3)$-plane $\Lambda$ will meet it in finitely many points $p \in \PP^n$. These will in turn correspond to the singularities of the image curve $C_0 \subset \PP^2$: if $p \in \overline{q,r}$ lies on a secant line, then the projection $\pi_\Lambda$ fails to be one-to-one at the image point $\pi_\Lambda(q) = \pi_\Lambda(r)$, while if $p$ lies on a tangent line ${\mathbb T}_q(C)$ the differential of $\pi_\Lambda$ will vanish at $q$. To prove the proposition, accordingly, we just have to say a little more about the intersection of $\Lambda$ with the secant variety of $C$. 


It is logically superfluous, but it will be much easier to visualize what's going on if we first reduce to the case $n=3$. This is straightforward: if $\Gamma \subset \PP^n$ is a general $(n-4)$-plane, then a general $(n-3)$-plane $\Lambda$ containing $\Gamma$ is a general $(n-3)$-plane in $\PP^n$, so we can view the projection $\pi_\Lambda : C \to \PP^2$ as the composition of the projection $\pi_\Gamma : C \to \PP^3$ with the projection $\pi_p$ of the image $\pi_\Gamma(C)$ from a general point $p \in \PP^3$. Moreover, since a general  $(n-4)$-plane $\Gamma \subset \PP^n$ will be disjoint from the secant variety of $C \subset \PP^n$, the projection $\pi_\Gamma : C \to \PP^3$ will be an embedding; thus we can just start with a smooth curve $C \subset \PP^3$ and project from a general point $p \in \PP^3$.


Now, when we project $C \subset \PP^3$ from a general point, we do expect to introduce singularities: since the family of secant lines to $C$ is two-dimensional,  we expect a finite number of them will contain a general point $p \in \PP^3$. Indeed, we see from this naive dimension count \fix{doesn't this depend on char 0?} that $p$ can lie on at most a finite number of secant lines, proving that \emph{the map $\pi_p$ is birational onto its image}. We can say more: since there is only a 1-dimensional family of tangent lines to $C$, a general point $p \in \PP^3$ will not lie on any tangent lines, we see as well that the differential of $\pi_p : C \to \PP^2$ does not vanish; in other words, \emph{the map $\pi_p$ is an immersion}.

We now just have to make sure the singularities introduced are just nodes, and here is where we need to invoke the uniform position lemma. For example, suppose we want to prove that the map $\pi_p$ is never three-to-one. This amounts to saying that a general point $p \in \PP^3$ does not lie on any \emph{trisecant line}; equivalently, that the family of trisecant lines to $C$ has dimension at most one. Moreover, since the variety of secant lines is irreducible of dimension 2, this follows from the simple assertion that \emph{not every secant line to $C \subset \PP^3$ is a trisecant}.

At this point we'd encourage you to try to give an elementary argument for this seemingly obvious assertion \fix{is this a doable exercise? or...?}. Whether you succeed or not, it does follow immediately from the uniform position lemma: this says that if $H \subset \PP^3$ is a general plane, then the points of intersection $p_1,\dots,p_d \in C \cap H$ are in linear general position in $H$; that is, no three are collinear. The line joining any two is thus a secant line to $C$ but not a trisecant line, which suffices to prove our assertion.

So now we know that the map $pi_p$ is an immersion, and at most two-to-one everywhere; thus the image curve $C_0 \subset \PP^2$ will have at most double points, and an analytic neighborhood of each double point will consist of two smooth branches.
To complete the proof of Proposition~\ref{nodal projection} we have to show that those two branches have distinct tangent lines; that is, that
if $q, r \in C$ are any two points collinear with $p$, then the images of the tangent lines ${\mathbb T}_q(C)$ and ${\mathbb T}_r(C)$ in $\PP^2$ are distinct. But if in fact it were the case that  $\pi_p({\mathbb T}_q(C)) = \pi_p({\mathbb T}_r(C))$ then the tangent lines ${\mathbb T}_q(C)$ and ${\mathbb T}_r(C)$ would necessarily intersect.

Classically, a secant line $\overline{q,r}$ was called a \emph{stationary secant} if the tangent lines ${\mathbb T}_q(C)$ and ${\mathbb T}_r(C)$ met; in these terms, it remains to show that a general point $p \in \PP^3$ does not lie on any stationary secant. Again, this follows from the assertion that the family of stationary secants has dimension at most 1; and again, since the family of all secant lines is irreducible of dimension 2, it will suffice to show that \emph{not every secant line to $C$ is a stationary secant}.

In characteristic 0 we can conclude as follows: It can't be the case that for a general pair of points $q, r \in C$ we have $\TT_qC \cap \TT_rC \neq \emptyset$; otherwise the projection $\pi_{\TT_qC} : C \to \PP^1$ would have derivative everywhere 0, but be nonconstant. Thus the space of  stationary secants is at most 1-dimensional, and a general $p \in \PP^3$ will not lie on one.
\end{proof}

In characteristic $p > 0$ it may not be the case that a general projection of a smooth curve to $\PP^2$ is nodal---but it's still true that every curve is the normalization of a nodal plane curve: we have the slightly weaker

\begin{exercise}
Let $C\subset \PP^n$ be a smooth curve. If we re-embed $C$ by a Veronese map of sufficiently high degree---that is, we let $\nu_m : \PP^n \to \PP^N$ be the $m$th Veronese map, and let $\tilde C = \nu_m(C)$ be image of $C$. Prove:

\begin{proposition}[Proposition~\ref{nodal projection} in characteristic $p$]\label{positive characteristic nodes}
The projection of $\tilde C$ from a general $\PP^{N-3}$ is a nodal plane curve.
\end{proposition}

by showing that, for a general $\Lambda \cong \PP^{N-3}$:
\begin{enumerate}
\item there do not exist three points $p,q,r \in \tilde C$ such that $p, q, r$ and $\Lambda$ are all contained in a $\PP^{N-2}$; and
\item there does not exist a pair of points $p, q \in \tilde C$ such that 
$p, q$ and $\Lambda$ are contained in a $\PP^{N-2}$ and $\TT_p(\tilde C), \TT_q(\tilde C)$ and $\Lambda$ are contained in a $\PP^{N-1}$.
\end{enumerate}
\end{exercise}

\begin{exercise}
Let $C_0$ be a plane quartic curve with two nodes $q_1, q_2$; let $\nu : C \to C_0$ be its normalization, and let $o \in C$ be any point not lying over a node of $C_0$.
By the genus formula, $C$ has genus 1. Using the construction above, describe the group law on $C$ with $o$ as origin.
\end{exercise}

\section{Arbitrary plane curves}\label{arbitrary plane curves}

Well, not exactly arbitrary: in this section, we'll deal with a plane curve $C_0$ that is assumed to be reduced and irreducible, with normalization $\nu : C \to C_0$. 

The geometry of singular curves is a fascinating topic, from the local analysis of the singularities to the global questions involving linear series on singular curves. Indeed, it's remarkable how many of the constructions and theorems we've discussed in the realm of smooth curves can be extended to the world of singular curves, given the right definitions (and some restrictions on the type of singularities, such as the Gorenstein condition). But this is a topic beyond our ken, at least in this book; for us, the questions are about smooth curves, with singular curves appearing as a useful adjunct. The description, in the last section, of complete linear series on a smooth curve $C$, using a nodal plane model $C_0$ of $C$, is a perfect example.

There is, however, one fundamental invariant of a singular curve $C$ that is both readily calculated and highly relevant in relating it to smooth curves: the \emph{arithmetic genus} of $C$. This will come up in what we're going to do next, which is to describe linear series on a smooth curve $C$ via a birational model as a plane curve with general singularities, and so we'll take a moment out here and introduce this notion.

\subsection{Arithmetic genus and geometric genus}

To start with, the arithmetic genus is a very broadly applicable: it is defined for an arbitrary one-dimensional scheme over a field. Recall that among the characterizations of the genus $g$ of a smooth projective curve $C$ there was one in terms of the Euler characteristic of the structure sheaf: we have $g = 1 - \chi(\cO_C)$. This is directly equivalent to the characterization in terms of the constant term of the Hilbert polynomial of any projective embedding.

And that is how we extend the notion of genus to arbitrary singular curves $C_0$: for any 1-dimensional scheme $C_0$ over a field, we define the \emph{arithmetic genus} of $C_0$ to be $1-\chi(\cO_{C_0})$. Very often (as, for example, right now!) we want also to deal at the same time with the genus of the normalization $\nu : C \to C_0$; to distinguish between these two notions of the genus of a singular curve, we call $1-\chi(\cO_{C_0})$ the arithmetic genus of $C_0$ and denote it $p_a(C_0)$; the genus of the normalization is called the \emph{geometric genus} and often denoted $g(C_0)$ or $p_g(C_0)$.

What's the difference? Well, we can relate the two notions via the map of sheaves
$$
\cO_{C_0} \to \nu_*\cO_C.
$$
This is injective; the cokernel sheaf will be a skyscraper sheaf supported exactly on the singular points of $C_0$. Denoting this sheaf by $\cF$, we have an exact sequence
$$
0 \to \cO_{C_0} \to \nu_*\cO_C \to \cF \to 0.
$$

Now, the normalization map $\nu: C \to C_0$ is finite, so that the higher direct images $R^i\nu_*\cO_C = 0$ for $i > 0$; it follows from the Leray spectral sequence that $\chi(\nu_*\cO_C) = \chi(\cO_C)$. We have, accordingly,
$$
p_a(C_0) - g(C) =  \chi(\cO_{C}) -   \chi(\cO_{C_0}) = \chi(\cF) = h^0(\cF);
$$ 
in other words, the difference between the arithmetic and geometric genera of $C_0$ is the sum of the vector space dimensions of the stalks on $\cF$; colloquially, it's the number of linear conditions a function $f$ on $C$ has to satisfy to be the pullback of a function from $C_0$. The length of the stalk of $\cF$ at a particular singular point $p \in C_0$ is called the \emph{$\delta$-invariant of the singularity}; to rephrase the statement above in these terms, we have
$$
p_a(C_0) - g(C) = \sum_{p \in (C_0)_{sing}} \delta_p
$$ 

Happily, the $\delta$ invariant of a singularity is readily calculated. Here are some examples:
\begin{enumerate}

\item (nodes) If $p \in C_0$ is a node, with points $r,s \in C$ lying over it, the condition for a function $f$ on $C$ to descend is simply that $f(r)=f(s)$; this is one linear condition and accordingly $\delta_p = 1$.

\item (cusps) If $p \in C_0$ is a cusp, with  $r \in C$ lying over it, the condition for a function $f$ on $C$ to descend is simply that the derivative $f'(r)=0$; again, this is one linear condition and accordingly $\delta_p = 1$.

\item (tacnodes) Suppose now that $p \in C_0$ is a \emph{tacnode}, that is, $C_0$ has two smooth branches at $p$ simply tangent to one another. There will be two points $r, s \in C$ lying over it, and the condition for a function $f$ on $C$ to descend is that in terms of suitable local coordinates both $f(r)=f(s)$ and $f'(r)=f'(s)$.  This represents two linear conditions and accordingly $\delta_p = 2$.

\item (planar triple points) Next up, consider an ordinary triple point $p \in C_0$ of a plane curve: that is, a singularity consisting of three smooth branches meeting pairwise transversely, such as the zero locus of $y^3-x^3$. There will be three points $r,s,t \in C$ lying over $p$, and certainly a necessary condition for a function $f$ on $C$ to descend is that $f(r)=f(s)=f(t)$---two linear conditions. But there's a third, less obvious linear condition: in order for $f$ to descend, the derivatives $f'(r), f'(s), f'(t)$ have to satisfy a linear condition---a reflection of the fact that a function on $C_0$ cannot vanish to order 2 on each of two branches without vanishing to order 2 along the third as well. Thus $\delta_p = 3$

\item (spatial triple points) We will be concerned in what follows only with planar singularities, but spatial triple points provide a useful contrast to the last example. A spatial triple point is a singularity consisting of three smooth branches, with linearly independent tangent lines, so that its Zariski tangent space is 3-dimensional. An example would be the union of the three coordinate axes in $\AA^3$.

In this case, in contrast to the last one, the condition that $f(r)=f(s)=f(t)$ is both necessary and sufficient for $f$ to descend, and accordingly we have $\delta_p=2$.

\end{enumerate}

\begin{exercise}
Let $p \in C$ be a singular point of a reduced curve $C$. Show that if $\delta_p = 1$, then $p$ must be either a node or a cusp.
\end{exercise}



\subsection{Linear series on (the normalization of) a plane curve} 

We return now to our basic setting: we have a reduced and irreducible curve $C_0 \subset \PP^2$ with normalization $\nu : C \to C_0$, and we want to extend our solution to the keynote problems---finding all regular differentials on $C$, and finding all divisors on $C$ linearly equivalent to a given $D \in \Div(C)$---to this more general setting.

In this setting, if we simply try to mimic the analysis above in the nodal case we're led to introduce the \emph{adjoint ideal} of each singularity (which is simply the maximal ideal of the point in the case of a node), in terms of which we have theorems analogous to the results obtained above in the nodal case.

So: let $C_0 \subset \PP^2$ be a reduced and irreducible plane curve, with normalization $\nu : C \to C_0$. We focus for now on one singular point $q \in C_0$, with points $r_1,\dots,r_k \in C$ lying over $q$. If our goal is to describe the canonical series on $C$, we can start as we did in the previous two sections: by considering differentials of  the form $g(x,y)\omega_0$, where
$$
\omega_0 = \nu^* \frac{dx}{\partial f/\partial y},
$$
and $f$ is the defining equation of $C_0$ in an affine open containing $q$. As we saw in the nodal case, $\omega_0$ will have poles at the points $r_i$; let $m_i$ be the order of the pole of $\omega_0$ at $r_i$. We can define the \emph{adjoint ideal} of $C_0$ at $q$ to be the ideal
$$
A_q = \left\{ g \in \cO_{\PP^2, q} \mid \ord_{r_i}(\nu^*g) \geq m_i \; \forall i \right\}
$$

In other words, $A$ is the ideal of functions $g$ such that $\nu^* \frac{gdx}{\partial f/\partial y}$ is regular at all the points $r_i$. We accordingly define the \emph{adjoint ideal $\cI_A$ of $C_0$} to be the product of $A_q$ over all singular points  $q \in C_0$; the \emph{adjoint series of degree $m$} is then the linear series $H^0(\cI_A(m))$. 

In these terms, we can give the solution to our keynote problems much as we did in the case of plane curves with nodes. Specifically:

First, we can say that every global regular 1-form on the curve $C$ is of the form 
$$
\frac{g(x,y) dx}{\partial f/\partial y},
$$
with $g$ in the adjoint ideal $A$, and of degree $d-3$ or less.

Second, if we are given a divisor $D = E - F$ on the curve $C$, we can find all effective divisors $D'$ on $C$ linearly equivalent to $D$ exactly as we did in the previous case. We start by choosing a polynomial $G$ of any degree $m$ in the adjoint ideal and vanishing on $E$ but not vanishing identically on $C_0$; we write
$$
(G) = E + \Delta + A.
$$
We then find all polynomials $H$ of degree $m$ in the adjoint ideal, vanishing on $A + F$ but not vanishing identically on $C_0$; writing
$$
(H) = F + A + \Delta + D'
$$
we arrive at an effective divisor $D'$ on $C$ linearly equivalent to $D$. Indeed,  the analog of the theorem of completeness of the adjoint series tells us that we arrive at \emph{every} effective divisor $D'$ on $C$ linearly equivalent to $D$ in this way.



At this point it may seem that without an explicit description of the adjoint ideal we have merely slapped a label on our ignorance. But in fact, the adjoint ideal is relatively straightforward to find. To begin with, let's do some simple examples:

\begin{example}[nodes and cusps]
We have already seen that in case $q$ is a node of $C_0$, there are two points of $C$ lying over it, and $m_1=m_2=1$; the adjoint ideal is thus just the maximal ideal $\cI_q$ at $q$. In the case of a cusp, for example the zero locus of $y^2-x^3$, there is only one point $r=r_1$ of $C$ lying over $q$, and the differential $\omega_0$ vanishes to order $m_1=2$; since the pullback to $C$ of any polynomial $g$ vanishing at $q$ will vanish to order at least two at $r$, and so again the adjoint ideal is again just the maximal ideal at $q$.
\end{example}


\begin{example}[tacnodes]
Next, consider the case of a \emph{tacnode}; that is, a singularity with two smooth branches simply tangent to one another, such as the zero locus of $y^2-x^4$. In this case there are again two points of $C$ lying over $q$, and a simple calculation shows that $m_1=m_2=2$. The adjoint ideal is thus the ideal of functions vanishing at $q$ and having derivative 0 in the direction of the common tangent line to the branches.
\end{example}


\begin{example}[ordinary triple points]
In the case of an ordinary triple point---three smooth branches simply tangent to one another pairwise---there are three points of $C$ lying over $q$, and we have $m_1=m_2=m_3= 2$; the adjoint ideal is correspondingly just the square of the maximal ideal at $q$
\end{example}

\begin{exercise}
Find the adjoint ideals of the following plane curve singularities:
\begin{enumerate}
\item a \emph{triple tacnode}: three smooth branches, pairwise simply tangent
\item a triple point with an infinitely near double point: three smooth branches, two of which are simply tangent, with the third transverse to both
\item a unibranch triple point, such as the zero locus of $y^3-x^4$
\end{enumerate}
\end{exercise}

In general, the adjoint ideal of an isolated plane curve singularity is something we can determine in practice; for example, here is a simply general description in case the individual branches of $C_0$ at $p$ are each smooth:

\begin{proposition}
Let $\nu : C \to C_0$ be the normalization of a plane curve $C_0$ and $p \in C_0$ a singular point. Denote the branches of $C_0$ at $p$ by $B_1,\dots,B_k$, and let $r_i$ be the point in $B_i$ lying over $p$. If the individual branches $B_i$ of $C_0$ at $p$ are each smooth, and we set
$$
m_i = \sum_{j \neq i} mult_p(B_i \cdot B_j)
$$
then the adjoint ideal of $C_0$ at $p$ is simply the ideal of functions $g$ such that $ord_{r_i}(\nu^*g) \geq m_i$.
\end{proposition}

\subsection{The conductor ideal}

There is another ideal we can associate to an isolated curve singularity, called the \emph{conductor ideal}. It's simple to define: if $C_0$ is a reduced curve and $\nu : C \to C_0$ its normalization, we can think of the direct image $\nu_*\cO_C$ as a module over the structure sheaf $\cO_{C_0}$; the conductor ideal is simply the annihilator of the quotient $\nu_*\cO_C/\cO_{C_0}$. In concrete terms, on any affine open $U \subset C_0$ this is the ideal of functions $g \in \cO_{C_0}(U)$ such that for any function $h \in \cO_C(\nu^{-1}(U))$ the product $hg$ will be the pullback of a function on $C_0$.

For example, in the case of a node $q \in C_0$, with $r_1,r_2$ the points of $C$ lying over $q$, we see that any function on $C$ vanishing at both $r_1$ and $r_2$ is the pullback of a function on $C_0$; thus the conductor is simply the maximal ideal at $q$. Similarly, if $q \in C_0$ is a cusp, with $r \in C$ lying over it, a function $f$ on $C$ will descend to $C_0$---that is, be the pullback of a function on $C_0$---if it vanishes to order 2 at $r$; since the pullback to $C$ of any function on $C_0$ vanishing at $q$ vanishes to order at least 2 at $r$, the conductor ideal is just the maximal ideal at $q$.

The sharp-eyed reader will have noticed a coincidence here, and will not be completely surprised by the

\begin{theorem}
For any plane curve singularity, the adjoint ideal and the conductor ideal coincide.
\end{theorem}

This is a reflection of the fact that plane curve singularities are necessarily local complete intersections, and hence \emph{Gorenstein}, about which we will hear more in the following chapter.

\subsection{The ``deficiency" of a curve}

One thing that may elucidate both the notion of the adjoint ideal of a plane curve $C$, and the algorithm described above for finding the complete linear system associated to a divisor on the normalization of $C$, is a historical discussion of how the notion of genus first appeared.

Most people, when you mention the genus of a curve, think immediately of the topological definition, in terms of the classification of compact oriented 2-manifolds. But in fact, the genus was defined long before this classification was carried out, and indeed was defined without any reference to the complex points of the curve or their topology.

The starting point seems to have been the simple observation that, while any $2n$ points on a plane conic curve $C$ form the intersection of $C$ with a  curve of degree $n$, the analogous statement---that any $3n$ points on a smooth plane cubic comprise the intersection of $C$ with a plane curve of degree $n$---is not true. This is a reflection of the fact that there are fewer rational functions on the cubic than on the conic: if $D = p_1+\dots + p_d$ is a $d$-tuple of points on a conic curve $C$, we have
$$
h^0(\cO_C(D)) = d+1,
$$ 
and so there is a rational function with poles just along $D$ and vanishing at any given $d$-tuple of points; by contrast, a plane cubic $C$ has genus 1, and so by Riemann-Roch for such a divisor we have
$$
h^0(\cO_C(D)) = d.
$$

This lack of rational functions was viewed as a defect of the curve, and called its \emph{deficiency} (and typically denoted $p$, rather than $g$). Of course, now that we're in possession of the Riemann-Roch formula, we can recognize this as equivalent to the genus.

Of course, at the time the notion of deficiency first appeared, Riemann-Roch was still well into the future. But the method of finding rational functions described in the algorithm above was known, and they applied it. 

\section{Severi varieties}\label{severi variety}

As we said at the outset of this chapter, there is a trade-off when we go from studying curves in $\PP^3$ and higher-dimensional projective space to studying plane curves. On the one hand, a curve $C \subset \PP^n$ with $n \geq 3$ is defined by a collection of polynomials, which in turn (unless the curve is a complete intersection) have to satisfy non-trivial syzygies. It's thus not a priori clear how we can vary the coefficients of these polynomials without losing the syzygies they satisfy; as a consequence, things like the dimension of the family of such curves can be obscure.

A plane curve $C_0 \subset \PP^2$, by contrast, is simply the zero locus of a single polynomial, and we can vary the coefficients of that polynomial arbitrarily to arrive at a family of curves. But as we said, there's a trade-off: unless we're dealing with the very special case of curves of degree $d$ and geometric genus $g = \binom{d-1}{2}$, the plane model of a curve $C$ of genus $g$ will be singular; and it's not so clear how we can vary the coefficients of its defining polynomial so as to preserve those singularities and arrive at a family of curves of degree $d$ and geometric genus $g$.

In this section, we'll address exactly this question. Our main goal will be to give a description of at least an open subset of the Severi variety parametrizing plane curves of degree $d$ and geometric genus $g$; we'll be able to deduce the fact that the Severi variety always has the expected dimension; and we'll be able to prove the existence of specializations from a smooth projective curve of genus $g$ to a general $g$-nodal curve, which we used in Chapter~\ref{InflectionsChapter}.

\subsection{Definitions, and the statement of our main theorem}

Let's start by defining the objects we'll be considering. Fix a degree $d$, and let $\PP^N$ be the projective space parametrizing plane curves of degree $d$.

\begin{definition} 
\begin{enumerate}
\item By the \emph{Severi variety} $V_{d,g}$ we will mean the locus of reduced and irreducible curves of degree $d$ and geometric genus $g$. Note that this is a locally closed subvariety of $\PP^N$.

\item By the \emph{small Severi variety} $\tilde V_{d,g} \subset V_{d,g}$ we'll mean the locus of plane curves of degree $d$ with exactly $\delta = \binom{d-1}{2} - g$ nodes. Note that this is an open subset of $V_{d,g}$.

\item By the \emph{large Severi variety} $\overline V_{d,g}$ we'll mean the closure of $V_{d,g}$ in the projective space $\PP^n$.
\end{enumerate}
\end{definition}

We should remark that the large Severi variety is not something we would want to encounter in a dark alley: it includes points, for example, corresponding to $d$-fold lines, and the singularities of $\overline V_{d,g}$ at such points are impenetrable. We introduce it here for the sole purpose of posing the problem of finding a better compactification of $\tilde V_{d,g}$, a problem that is very much open. Indeed, even the singularities of $V_{d,g}$  are not well understood, which is why we try to focus on the small Severi variety whenever possible.

\subsection{The universal singular point}

The key to understanding the geometry of nodal curves is to introduce what we may call the \emph{universal singular point}. This is the incidence correspondence
$$
\Phi := \left\{ (C, p) \in \PP^N \times \PP^2 \mid p \in C_{sing} \right\}
$$

The first thing to say about $\Phi$ is that \emph{it is smooth and irreducible of dimension $N-1$}. We can see this readily via projection on the second factor, which expresses $\Phi$ as a $\PP^{N-3}$-bundle over $\PP^2$. Explicitly, if $[X,Y,Z]$ are homogeneous coordinates on $\PP^2$, and $\{a_{i,j,k} \mid i+j+k = d \}$ are homogeneous coordinates on $\PP^N$, then the universal curve 
$$
\CC := \left\{ (C, p) \in \PP^N \times \PP^2 \mid p \in C \right\}
$$
is given as the zero locus of the single bihomogenous polynomial of bidegree $(1, d)$
$$
F([a_{i,j,k}], [X,Y,Z] ) = \sum a_{i,j,k} X^iY^jZ^k;
$$
and the universal singular point is given (in characteristic 0!) as the common zero locus of the three partial derivatives $\partial F/\partial X$, $\partial F/\partial Y$ and  $\partial F/\partial Z$. 

The key now is to understand the map $\pi : \Phi \to \PP^N$, and the geometry of its image, the discriminant hypersurface  $\Delta \subset \PP^n$. A fundamental fact is the

\begin{lemma}\label{tangent space to discriminant}
Let $C \subset \PP^2$ be a plane curve of degree $d$, and $p \in C$ a node of $C$. The differential 
$$
d\pi : T_{(C,p)}\Phi \to T_C \PP^N
$$
is injective, with image the hyperplane $H_p \subset \PP^N$ of plane curves containing the point $p$.
\end{lemma}

Thus, if $p$ is the only singularity of $C$, then $\Delta$ is smooth at $C$; and more generally the image of a small analytic neighborhood of $(C,p) \in \Phi$ is smooth, with tangent space the hyperplane $H_p$.

\begin{proof}
For this, it's easier to work with affine coordinates on both projective spaces. Suppose that the point $p$ is $[0,0,1]$, and let $x = X/Z$ and $y = Y/Z$ be coordinates on the affine plane $Z \neq 0$; and write the polynomial $F(x,y,1)$ above as
$$
f(x,y) = \sum_{i+j \leq d} a_{i,j} x^iy^j
$$
with $a_{d,0}$ normalized to 1. (Thus assumes that the point $[1,0,0] \notin C$; if not, change coordinates.)

Now, let's consider $f$ and its two partial derivatives  
$$
g(x,y) := \binom{\partial f}{\partial x} = \sum_{i+j \leq d} i a_{i,j} x^{i-1}y^j
$$
and
$$
h(x,y) := \binom{\partial f}{\partial y} = \sum_{i+j \leq d} j a_{i,j} ix^{i}y^{j-1}.
$$
$f, g$ and $h$ are local defining equations for $\Phi$; we consider their partial derivatives with respect to $x, y$ and $a_{0,0}$, evaluated at the point $(C,p)$. In matrix form, we have

\begin{table}[h!]
  \begin{center}
     \begin{tabular}{c|c|c|c} % <-- Alignments: 1st column left, 2nd middle and 3rd right, with vertical lines in between
            & $f$ & $g$ & $h$ \\
      \hline
$\frac{\partial}{\partial x}$ & 0 & $a_{2,0}$ & $a_{1,1}$ \\
$\frac{\partial}{\partial y}$ & 0 & $a_{1,1}$ & $a_{0,2}$ \\
$\frac{\partial}{\partial a_{0,0}}$ & 1 & 0 & 0 
    \end{tabular}
  \end{center}
\end{table}

Now, the hypothesis that $p$ is a node of $C$ means exactly that the upper right $2 \times 2$ minor of this matrix is nonsingular, which shows that the differential $d\pi$ is injective, and its image is the hyperplane $a_{0,0} = 0$ in $\PP^N$, which is exactly the hyperplane of curves containing $p$.
\end{proof}

Now, suppose that $C \subset \PP^2$ is a curve with $\delta$ nodes $p_1,\dots,p_\delta$ and no other singularities. The preimage of the point $C \in \PP^N$ is then the $\delta$ points $(C,p_i) \in \Phi$, and according to  Lemma~\ref{tangent space to discriminant} an analytic neighborhood of $C$ in the discriminant hypersurface $\Delta$ will consist of $\delta$ smooth sheets. Moreover, by Lemma~\ref{adjoint independent} above, the tangent spaces to these sheets are linearly independent; in other words, \emph{$\Delta$ has normal crossing singularities at $C$}.

This in turn gives us a beautiful picture of the closure of the Severi variety $V_{d,g}$, at least in a neighborhood of a nodal curve such as $C$ above. For example, suppose we start with a rational nodal curve $C$ of degree $d$, with nodes $p_1,\dots,p_\delta$ (so that $\delta = \binom{d-1}{2}$). Again, in a neighborhood of the point $C \in \PP^N$, the discriminant hypersurface $\Delta$ will consist of $\delta$ smooth sheets intersecting transversely. What's more, if we set $\delta' = \binom{d-1}{2} - g$, we see that in that neighborhood the variety $V_{d,g}$ will consist of the $\delta'$-fold intersections of these sheets. In other words, we have established the

\begin{lemma}\label{local geometry of Severi}
In a neighborhood of a point $C \in \PP^N$ corresponding to a nodal curve with nodes $p_1,\dots,p_\delta$,
the variety $\overline V_{d,g}$ is the union of $\binom{\delta}{\delta'}$ smooth branches, each of dimension $N - \delta'$, corresponding bijectively with subsets of $\{p_1,\dots,p_\delta\}$ of cardinality $\delta'$.
\end{lemma}

There are a number of immediate consequences. First of all, we have the

\begin{corollary}\label{dim Severi}
The small Severi variety $V_{d,g}$ has pure dimension $N - \delta$, where $\delta = \binom{d-1}{2} - g$.
\end{corollary}

Note that this is exactly the ``expected dimension:" in Section~\ref{estimating dim hilb}, we gave a heuristic calculation of the expected dimension $h(d,g,r)$ of the variety parametrizing curves of degree $d$ and genus $g$ in $\PP^r$:
$$
h(g,r,d) := 4g-3 + (r+1)(d-g+1) - 1.
$$
As we saw in that chapter, the actual dimension of the restricted Hilbert scheme may be quite different. But what Corollary~\ref{dim Severi} is saying that in case $r=2$ (as in the case of $r=1$), \emph{the actual dimension is always the expected}.

Lemma~\ref{local geometry of Severi} has another important consequence, one which we have already invoked in Chapter~\ref{InflectionsChapter}: the existence of families of curves of genus $g$ specializing to a $g$-nodal rational curve. In fact, such families are already explicit in Lemma~\ref{local geometry of Severi}: if we start with a rational nodal  curve $C_0 \subset \PP^2$---for example, the general projection of a rational normal curve $\PP^1 \hookrightarrow \PP^d$ to $\PP^2$---the lemma says that we can find a family of nodal curves $C_t$ of geometric genus $g$ specializing to $C_0$, in which the  $\delta = \binom{d-1}{2} - g$ nodes of $C_t$ specialize to a subset of $\delta$ of the nodes of $C_0$. Taking the normalization of the total space of this family yields a family of smooth curves of genus $g$ specializing to a $g$-nodal rational curve, as desired.

To carry this out in detail, let us first state precisely the lemma we seek to establish:

\begin{lemma}
Let $p_1, \dots, p_g, q_1, \dots, q_g \in \PP^1$ be any $2g$ distinct points, and let $C := \PP^1/p_i \sim q_i$ be the nodal curve of arithmetic genus $g$ obtained by identifying $p_i$ with $q_i$ for $i = 1,\dots,g$. There exists a family $\cC \to  \Delta $ of curves, parametrized by the disc $\Delta$, with $C_t$ a smooth projective curve of genus $g$ for all $t \neq 0$ and $C_0 = C$ as above.
\end{lemma}

\begin{proof}
Let's start by realizing the curve $C_0$ in projective space. This is straightforward: to begin, choose a degree $d > 2g+2$, and embed $\PP^1$ as a rational normal curve in $\PP^d$ via the Veronese map. Let $L_i = \overline{p_i,q_i} \subset \PP^d$ be the line spanned by $p_i$ and $q_i$, and let $\Lambda \cong \PP^{g-1} \subset \PP^d$ be a general $(g-1)$-plane meeting each of the lines $L_1,\dots,L_g$. Let $\pi_\Lambda : \PP^d \to \PP^{d-g}$ be the projection with center $\Lambda$, and let $C \subset \PP^{d-g}$ be the image of our rational normal curve. We claim to begin with that \emph{the curve $C$ is the curve above obtained by identifying the $g$ pairs of points $p_i, q_i \in \PP^1$}. 

This requires a sequence of verifications: we have to check that
\begin{enumerate}
\item $\Lambda$ is disjoint from the rational normal curve, so that the map $\pi_\Lambda$ is regular on $\PP^1$;
\item $\Lambda$ does not meet any secant or tangent lines to $\PP^1$ other than the $L_i$, so that the map $\pi_\Lambda$ is an isomorphism away from the points $p_i, q_i$; and
\item for each $i$, the 3-plane $\overline{2p_i + 2q_i}$ spanned by the tangent lines to $\PP^1$ at $p_i$ and $q_i$ meets $\Lambda$ in only one point (the point of intersection of $\Lambda$ with $L_i$), so that the common image point $\pi_\Lambda(p_i) = \pi_\Lambda(q_i) \in C$ is indeed a node of $C$.
\end{enumerate}

Each of these assertions can be verified by a simple (or at least straightforward) dimension count. Denote by $\Sigma_{d-g}(L_i) \subset \GG(g-1, d)$ the Schubert cycle of $(g-1)$-planes in $\PP^d$ meeting $L_i$. The cycles $\Sigma_{d-g}(L_i)$ have codimension $d-g$ in $\GG(g-1,d)$; since the lines $L_i$ are linearly independent, they intersect properly in a subvariety
$$
X := \bigcap_{i=1}^g \Sigma_{d-g}(L_i) \subset \GG(g-1,d)
$$
of dimension $g(d-g+1) - g(d-g) = g$. (This makes sense: a $(g-1)$-plane $\Lambda \in X$ is determined by its points of intersection with the $L_i$.) Since $\Lambda$ corresponds to a general point of $X$, we just have to show that the locus of $(g-1)$-planes violating each of the conditions above has strictly smaller dimension; we leave these verifications as Exercise~\ref{} below.

Next, we project again: we take $\Gamma \cong \PP^{d-g-3} \subset \PP^{d-g}$ a general $(d-g-3)$-plane, and consider the projection $\pi_\Gamma : C \to \PP^2$. We claim that this map is regular and birational onto a rational nodal plane curve $C_0$, so that $C_0$ has $\binom{d-1}{2}$ nodes $r_1,\dots,r_{\binom{d-1}{2}}$, of which $r_1,\dots,r_g$ are the images of the nodes of $C$. Again, this requires a series of verifications: we have to show that the locus of planes $\Gamma \cong \PP^{d-g-3} \subset \PP^{d-g}$ for which each part of the statement fails has dimension strictly less than $\dim \GG(d-g-3, d-g) = 3(d-g-2)$; again, we leave this as an exercise.

Finally, given all this, Lemma~\ref{local geometry of Severi} gives us what we seek: it says we can find an arc $\{C_t\}$ in the Severi variety $\overline V_{d,g}$ whose general member has $\binom{d-1}{2} - g$ nodes and whose special member $C_0$ is the curve we've just constructed, with the $\binom{d-1}{2} - g$ nodes of $C_t$ specializing to the nodes $r_{g+1}, \dots r_{\binom{d-1}{2}} \in C_0$.
\end{proof}

%Throughout this book thus far, we have developed techniques for dealing with smooth, projective curves; to the extent that we have considered singular curves we have studied them by applying the ideas and constructions we've developed to their normalizations. But singular curves have a fascinating geometry in their own right, not only for the singularities themselves but the effect singularities have on associated objects such as the Jacobian. In this chapter, we will undertake a brief survey of the geometry of singular curves and what we can say about linear series on them.
%
%To say what classes of curves we'll be dealing with here: for the most part, we will confine ourselves to working with reduced, projective curves. Many of the results we will derive will in fact will be applicable to a larger class of curves, namely those that are \emph{Cohen-Macaulay}; these may well be non-reduced, but cannot have embedded points. In Section~\ref{} below, we'll mention some examples of nonreduced curves to which we can apply our ideas (such as, for example, \emph{ribbons}), and we'll develop these ideas further in the following chapter, where we introduce more algebraic techniques. But for the rest of this chapter, we will take the objects of our study to be reduced, projective curves over $\CC$.
%
%
%\section{The arithmetic genus and singularities}
%
%To start at the beginning, when we first defined the notion of the \emph{genus} of a smooth projective curve, we gave several different but equivalent characterizations of the genus. As you might expect, these diverge in the presence of singularities, so we adopt the following universal definition.
%
%\begin{definition}
%Let $C$ be an arbitrary one-dimensional projective scheme over a field $\CC$. By the \emph{arithmetic genus} $p_a(C)$ of $C$ we mean 1 minus the Euler characteristic of the structure sheaf of $C$:
%$$
%p_a(C) \; = \; 1 - \chi(\cO_{C}).
%$$
%In contrast, if $C$ is reduced, we define the \emph{geometric genus} to be the genus of the normalization $C^\nu$ of $C$.
%\end{definition}
%
%Note that the arithmetic genus satisfies many of the formulas derived above in the smooth case: for example, if $C \subset S$ is a divisor on a smooth surface, the adjunction formula holds:
%$$
%p_a(C) \; = \; \frac{C\cdot C + K_S\cdot C}{2} + 1.
%$$
%Thus, for example, a double conic curve $C = V((XY-Z^2)^2) \subset \PP^2$, like every other plane quartic curve, has arithmetic genus 3. (If you're curious, we'll see what the Jacobian of $C$ looks like in Section\ref{} below.)
%
%\subsection{Relation between the arithmetic and geometric genus}
%
%Our first order of business is to understand the relationship between the arithmetic and geometric genera of a reduced projective curve $C$. To this end, let $\nu : C^\nu \to C$ be the normalization of $C$, and consider the exact sequence of sheaves on $C$:
%$$
%0 \to \cO_C \to \nu_*\cO_{C^\nu} \to \cF \to 0
%$$
%where $\cF$ is simply defined to be the quotient $\nu_*\cO_{C^\nu}/\cO_C$; note that $\cF$ is supported exactly at the singular points of $C$.
%
%The point here is that, because the map $\nu$ is finite, there are no higher direct images of $\nu_*\cO_{C^\nu}$; so the Leray-Serre spectral sequence tells us that
%$$
%\chi(\nu_*\cO_{C^\nu}) \; = \chi(\cO_C).
%$$
%Thus, the difference between the arithmetic and geometric genera of $C$ is
%$$
%g(C) \; = \; p_a(C) - h^0(\cF).
%$$
%We can refine this a little: for each singular point $p \in C$, denote by $\delta_p$ the dimension (as vector space over $\CC$) of the stalk $\cF_p$ of $\cF$ at $p$. This is called the \emph{delta-invariant} of $p$, and is the most fundamental numerical invariant of a curve singularity. In these terms, we can write
%$$
%g(C) \; = \; p_a(C) - \sum_{p \in C} \delta_p.
%$$
%
%\subsection{The delta invariant}
%
%To see how this works in practice, let's calculate the delta invariant of some relatively simple singularities.
%
%\subsubsection{the $\delta$-invariant of a node}
%
%To start with the simplest singularity, suppose that $p$ is a node of $C$: that is, a neighborhood of $p \in C$\footnote{we can take this to be either a complex analytic neighborhood or an \'etale neighborhood} is the union of two smooth curves intersecting transversely at $p$. In this case, there will be two points $q, r \in C^\nu$ in the normalization lying over $p$, and we see that if $U$ is a suitably small neighborhood of $p \in C$ then a function $\tilde f \in \cO_{C^\nu}(\nu^{-1}(U)$ on the preimage of $U$ in $C^\nu$  is the pullback of a function $f \in \cO_C(U)$ if and only if the values $\tilde f(q) = \tilde f(r)$ agree. It follows that the stalk of the sheaf $\cF$ at $p$ is one-dimensional, so $\delta_p = 1$.
%
%\subsubsection{the $\delta$-invariant of a cusp}
%
%By definition, a \emph{cusp} of a curve $C$ is a point $p \in C$ such that the normalization map is given in terms of suitable local coordinates in a neighborhood $U$ of $p$ as
%$$
%\nu : t \mapsto (t^2, t^3).
%$$
%We see from this that a function  is the pullback of a function $f \in \cO_C(U)$ if and only if the derivative $f'(0) = 0$; this being again one linear condition, we see that $\delta_p = 1$.
%
%\subsubsection{the $\delta$-invariant of a tacnode}
%$\tilde f \in \cO_{C^\nu}(\nu^{-1}(U))$
%As with a node, a suitably small neighborhood $U$ of a tacnode $p \in C$ is a union of two smooth curves; but this time the two branches are simply tangent to one another rather than transverse. It is no longer the case, accordingly, that a function $\tilde f \in \cO_{C^\nu}(\nu^{-1}(U))$ is a pullback if and only if the values of $\tilde f$ at the points  $q, r \in C^\nu$ lying over $p$ agree: for example, a function that has a simple zero at $q$ but vanishes to order 2 or more at $r$ cannot be a pullback. The correct statement is that $\tilde f$ will descend to $C$ if and only if $f(q) = f(r)$ and the derivatives $f'(q)$ and $f'(r)$ (with respect to suitably chosen local coordinates) agree. Thus we see that $\delta_p = 2$.
%
%\subsubsection{the $\delta$-invariant of an ordinary triple point}
%
%An ordinary triple point is again a \emph{planar} singularity, meaning its Zariski tangent space is 2-dimensional, or, equivalently, it is embeddable in a smooth surface. A small neighborhood of such a point $p \in C$ consists of a union of three smooth branches, intersecting pairwise transversely at $p$. In order for a function on the preimage of $U$ to be a pullback, naturally, its values at the three points $q,r,s \in \nu^{-1}(p)$ lying over $p$ have to agree, so that $\delta_p \geq 2$. But this is not a sufficient condition: a function  $\tilde f$ with a simple zero at $q$ but vanishing to order at least 2 at $r$ and $s$ cannot be a pullback. Rather, the fact that the tangent lines to the three branches are linearly dependent means that in order for $\tilde f$ to descend its derivatives at $q, r$ and $s$ must satisfy a linear relation as well, and so we have $\delta_p = 3$. 
%
%\subsubsection{the $\delta$-invariant of a spatial triple point}
%
%By way of contrast with the last example, suppose now that $p$ is a \emph{spatial triple point}: in other words, a neighborhood of $p \in C$ is a union of three smooth branches with linearly independent tangent lines (so that $\dim T_p(C) = 3$). In this case, it is a necessary and sufficient condition for a function $\tilde f$ to descend is simply that its values at the points lying over $p$ agree, from which we see that $\delta_p = 2$.
%
%\begin{exercise}
%Consider the following curves $C \subset \PP^3$ of degree 3 in $\PP^3$. In each case, determine the arithmetic genus; and, in those cases where $p_a(C) = 0$ show that the curve $C$ is indeed the flat limit of a family of twisted cubics.
%\begin{enumerate}
%\item the union of a line and a conic curve meeting transversely at one point;
%\item the union of a conic and a tangent line;
%\item the union of three concurrent, coplanar lines;
%\item the union of three concurrent but not coplanar lines.
%\end{enumerate}
%\end{exercise}
%
%\section{The dualizing sheaf and Riemann-Roch for singular curves}
%
%Without question, the most fundamental object we deal with in analyzing the geometry of a smooth curve $C$ is its canonical bundle/divisor class $K_C$, defined simply to be the cotangent bundle of $C$ or equivalently the sheaf of regular 1-forms. Is there an analog of this in the case of singular curves?
%
%The answer is an emphatic ``yes:" if $C$ is Cohen-Macaulay (and in particular, if $C$ is reduced), we can introduce the \emph{dualizing sheaf} $\omega_C$, which is a more than adequate understudy for the role of canonical bundle. (Indeed, in a large range of cases, those of \emph{Gorenstein} curves, it is locally free, as we'll see in the subsection below.) We will give a relatively concrete description of the dualizing sheaf here, and a more abstract, algebraic definition in the next chapter.
%
%To understand the definition of the dualizing sheaf, it is useful (and amusing) to recall a bogus proof of the Riemann-Roch formula, which highlights the key property of the canonical bundle. To set this up, suppose now that $C$ is a smooth projective curve of genus $g$, and imagine we have a divisor $D = p_1 + \dots + p_d$ consisting of $d$ distinct points on $C$. We choose a local coordinate $z_i$ on $C$ around $p_i$, and ask: given a $d$-tuple of scalars $a_1,\dots,a_d$, when is there a rational function on $C$, regular away from the points $p_i$, with polar part $a_i/z_i$ at $p_i$? 
%
%Since any rational function regular away from the $p_i$ is determined, up to the addition of a scalar, by its polar parts at the $p_i$, this is tantamount to asking for the dimension of the vector space $\cL(D)$ of rational functions with at most simple poles along $D$. In particular, we see that the dimension
%$$
%\dim \c(D) \; \leq \; d + 1,
%$$
%with equality holding iff every $d$-tuple of scalars $a_1,\dots,a_d$ represents the polar part of some function $f \in \cL(D)$. But there is an obstruction to this being the case: if $\phi$ is any global regular 1-form on $C$, then for any $f \in \cL(D)$ we have
%$$
%\sum_i Res_{p_i} (f \cdot \phi) \; = \; 0,
%$$
%which (potentially) imposes a linear condition on the polar parts of $f$. Of course, if $\omega$ vanishes at all the points $p_i$ of $D$, this condition is vacuous; the actual number of conditions imposed is the difference $g - h^0(K_C -D)$. Altogether, then, we have established the inequality
%$$
%h^0(D) \; \leq \; d + 1 - g + h^0(K_C - D).
%$$
%
%Now we apply this inequality to the divisor $K-D$, which has degree $2g-2-d$; we arrive at
%$$
%h^0(K-D) \; \leq \; 2g - 2 + 1 - g + h^0(D).
%$$
%Finally, we add the last two inequalities, and almost all the terms cancel, leaving us with
%$$
%h^0(D) + h^0(K-D) \; \leq \; h^0(K-D) + h^0(D);
%$$
%since equality holds here, it most hold in both the inequalities above, and we deduce the statement of the Riemann-Roch formula.
%
%The point of this derivation of Riemann-Roch is that is emphasizes the crucial fact underlying the formula: that \emph{the sum of the residues of a rational 1-form on a smooth projective curve is zero}. Now, suppose that $C$ is a possibly singular projective curve, and $D = p_1+\dots + p_d$ a divisor $D$ (whose support we will for simplicity assume is disjoint from the singular locus of $C$). Say we want to derive an analogous formula for the dimension $h^0(D)$ of the space of rational functions on $C$ with at most poles along a divisor $D$, with the role of a global regular 1-form $\phi \in H^0(K)$ played by a global section of the dualizing sheaf $\omega_C$. We need to define the dualizing sheaf $\omega_C$ so that its sections may be viewed as rational differentials on $C$, with three properties:
%
%\begin{enumerate}
%\item we should have $\deg(\omega_C) = 2p_a(C)-2$;
%\item we should have $h^0(\omega_C) = p_a(C)$; and, crucially,
%\item for any rational function $f \in h^0(D)$ and every section $\phi \in H^0(\omega_C)$, the sum of the residues of the rational differential $f\phi$ at the points of $D$ is 0.
%\end{enumerate}
%
%
%
%\subsection{the Gorenstein condition}
%
%\section{Picard groups of singular curves}
%
%Let's start with the simplest case: suppose $C$ is an irreducible curve with a node $r$ and no other singularities. We'll denote by $\nu : C^\nu \to C$ the normalization of $C$, and let $p, q \in C^\nu$ be the two points of $C^\nu$ lying over $r$.
%
%Let $\Pic^0(C)$ denote the group of line bundles of degree 0 on $C$, and $\Pic^d(C)$ the set of line bundles of degree $d$ (which is again a principal homogeneous space for $\Pic^0(C)$). To describe these, consider the map
%$$
%\nu^* : \Pic^0(C) \to \Pic^0(C^\nu)
%$$
%given simply by associating to a line bundle $\cL \in \Pic^0(C)$ its pullback $\nu^*\cL$ to $C^\nu$. If $\cL \in \Pic^0(C)$ is any line bundle on $C$, the fibers $(\nu^*\cL)_p$ and $(\nu^*\cL)_q$ of the pullback are each identified with the fiber $\cL_r$, and so with each other; conversely, if $\cM$ is any line bundle on $C^\nu$ and $\phi : \cM_p \cong \cM_q$ any isomorphism between the fibers of $\cM$ at $p$ and $q$, we can identify the fibers to arrive at a line bundle $\cL$ on $C$ whose pullback to $C^\nu$ is $\cM$ with the specified identification of fibers.
%
%We see thus that the map $\nu^*$ above is surjective, with fibers isomorphic to $\CC^*$; that is, we have an exact sequence
%$$
%0 \to \CC^* \to \Pic^0(C) \to \Pic^0(C^\nu) \to 0.
%$$
%In other words, $\Pic^0(C)$ is a $\CC^*$-bundle over $\Pic^0(C^\nu)$ (though not a product). \fix{to describe the extension, we need the Poincar\'e bundle of $C^\nu$---is this something we're planning to introduce?}
%
%A similar description applies to an irreducible curve $C$ with an ordinary cusp $r$ and no other singularities. Again,  denote by $\nu : C^\nu \to C$ the normalization map, with $p \in C^\nu$ the point lying over the cusp of $C$. Just as in the nodal case, the pullback $\nu^*\cL$ of a line bundle $\cL$ on $C$ comes equipped with a trivialization over the scheme-theoretic preimage $\nu^{-1}(p)$; the difference is that now $\nu^{-1}(p) = 2r$ is a double point. The space of such trivializations is now a copy of $\CC$ rather than $\CC^*$, so we have instead a sequence
%$$
%0 \to \CC \to \Pic^0(C) \to \Pic^0(C^\nu) \to 0.
%$$
%
%We note in passing that these descriptions of the Picard variety $\Pic^0(C)$ can also be arrived at via a variant of Abel's theorem. For example, in the nodal case, if we let $H^0(\omega_C)^*$ be the space of linear functions on the space of sections of the dualizing sheaf $\omega_C$, we can define an inclusion of the first homology group $H_1(C,\ZZ)$ (the condition that a section of $\omega$ correspond to a rational differential on $C^\nu$ with opposite residues at $p$ and $q$ allows us to define the integral of such a form along a loop passing through the node).  \fix{need a picture here}
%We can then define the Jacobian to be the quotient $H^0(\omega_C)^*/H_1(C,\ZZ)$, and a variant of the Abel-Clebsch theorem tells us that this is naturally identified with $\Pic^0(C)$.
%
%The difference here is that, while $H^0(\omega_C)^*$ is still a complex vector space of dimension $g$, the lattice $H_1(C,\ZZ)$ has rank only $2g-1$: it contains the homology of $C^\nu$, with one additional generator corresponding to a loop on $C$ passing through the node. The quotient is therefore not compact, and we arrive at the same picture of $\Pic^0(C)$ as a $\CC^*$-bundle over $\Pic^0(C^\nu)$. 
%
%We conclude this discussion with some terminology and one important fact. To start with, the object $\Pic^0(C)$ described here may be called simply the Jacobian of $C$; in some sources, however, it is called a \emph{generalized Jacobian}; the term ``Jacobian" is reserved for Jacobians of smooth curves, which are abelian varieties. Similarly, the sort of algebraic group arising here---an extension of an abelian variety by a product of $\CC^*$s and $\CC$s---is often called a \emph{semi-abelian variety}, to distinguish it from abelian varieties.
%
%\begin{fact}
%Picard varieties fit in families: if $\pi : \cC \to B$ is a flat, projective morphism whose fibers  are irreducible  curves having at worst nodes and cusps, the Picard varieties $\{\Pic^0(C_b)\}_{b \in B}$ likewise form a flat family: that is, there exists an associated morphism $\cP \to B$ whose fiber over each point $b \in B$ is the Picard variety of the corresponding curve $C_b$.
%\end{fact}
%
%\subsection{Compactifying the Jacobian}  
%
%Many of the applications of the Jacobian we gave in Chapter~\ref{} depended only on the fact that the Jacobian of a smooth curve is irreducible of dimension $g$, and those continue to hold in the case of nodal and/or cuspidal curves. For example, we have the
%
%\begin{exercise}
%Let $C$ be a projective curve of genus $g$ having only nodes and cusps as singularities. Show that a general line bundle of degree $g+3$ on $C$ is very ample.
%\end{exercise}
%
%On the other hand, many of the deeper applications of the Jacobian rely essentially on the fact that it is a complete variety, and here we need to modify our construction if we are to port over these results. We need, in other words, to \emph{compactify} the Jacobians of singular curves, if we can, and this is what we'll describe below.

\input{footer}